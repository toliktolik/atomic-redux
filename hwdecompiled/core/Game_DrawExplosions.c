/*
 * Function: Game_DrawExplosions
 * Address: 00487de0
 * Category: core
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall Game_DrawExplosions(void *this,int *param_1,_String_base *param_2,int *param_3)

{
  uint uVar1;
  int iVar2;
  int *piVar3;
  int iVar4;
  int extraout_ECX;
  uint extraout_EDX;
  int extraout_EDX_00;
  undefined4 *puVar5;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffbb4;
  undefined4 *in_stack_fffffbb8;
  undefined1 local_4c [4];
  int local_48;
  uint local_34;
  int local_30;
  int local_2c;
  int local_28;
  int local_24;
  int local_20;
  int local_1c;
  uint local_18;
  int local_14;
  char local_d;
  int local_c;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  (**(code **)(*param_1 + 0x40))();
  local_c = 1;
  (**(code **)(*param_1 + 0x50))();
  if ((((*(char *)((int)param_1 + 0x32) == '\0') && (*(char *)((int)param_1 + 0x31) == '\0')) &&
      ((DAT_0056e34c & 4) != 0)) && ((*(byte *)(param_1 + 9) & 8) == 0)) {
    local_c = 4;
  }
  iVar4 = 0;
  local_24 = 0;
  if ((param_1[0xb] != 0) && ((DAT_0056e34c & 8) != 0)) {
    local_14 = param_1[10] - (int)&stack0xfffffbb4;
    iVar2 = param_1[10] - (int)&stack0xfffffbb4;
    do {
      local_18 = *(uint *)(&stack0xfffffbb4 + iVar2 + iVar4 * 4);
      *(uint *)(&stack0xfffffbb4 + iVar4 * 4) =
           local_18 >> 0x10 & 0xff | (local_18 & 0xff) << 0x10 | local_18 & 0xff00ff00;
      iVar4 = iVar4 + 1;
      iVar2 = local_14;
    } while (iVar4 < 0x100);
    iVar4 = (**(code **)(*param_3 + 0x14))(param_3,0x444,&stack0xfffffbb4,&local_24,0);
    if (iVar4 < 0) {
      Image_Clone(local_4c,iVar4);
      DAT_0056e34c = DAT_0056e34c & 0xfffffff7;
      if (0xf < local_34) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(local_48,extraout_EDX);
      }
    }
    else {
      local_c = 8;
    }
  }
  if ((param_1[9] & 4U) == 0) {
    if (local_c != 1) goto LAB_00487f20;
LAB_00487f14:
    if ((DAT_0056e34c & 1) != 0) goto LAB_00487f20;
  }
  else {
    if (local_c != 1) goto LAB_00487f20;
    if ((DAT_0056e34c & 2) == 0) goto LAB_00487f14;
  }
  local_c = 2;
LAB_00487f20:
  local_d = '\0';
  if (((*(int *)((int)this + 0x14) != param_1[1]) || (*(int *)((int)this + 0x18) != param_1[2])) ||
     ((local_c != *(int *)((int)this + 0x3c) || (param_1[9] != *(uint *)((int)this + 0x40))))) {
    Threading_WaitSemaphore((int)this);
    *(int *)((int)this + 0x3c) = local_c;
    *(int *)((int)this + 0x40) = param_1[9];
    Game_UpdateExplosions(this,(int)param_1);
    local_d = '\x01';
  }
  *(int *)((int)this + 0x10) = local_24;
  local_30 = SexyWidget_GetHeight((int)param_1);
  local_14 = SexyWidget_GetWidth(extraout_ECX);
  if (local_24 != 0) {
    *(int *)((int)this + 0x30) = *(int *)((int)this + 0x30) + 0x400;
  }
  local_28 = 4;
  if (local_c == 8) {
    local_28 = 1;
  }
  else if (local_c == 4) {
    local_28 = 2;
  }
  iVar2 = 0;
  local_20 = 0;
  local_1c = 0;
  iVar4 = extraout_EDX_00;
  if (0 < extraout_EDX_00) {
    do {
      local_2c = 0;
      if (0 < local_14) {
        local_18 = iVar2 * 0xc;
        do {
          if (local_d != '\0') {
            iVar4 = *(int *)((int)this + 4);
            puVar5 = (undefined4 *)(iVar4 + local_18);
            piVar3 = (int *)D3DTexture_CreateSurface
                                      (param_2,*(undefined4 *)(iVar4 + 4 + local_18),
                                       *(undefined4 *)(iVar4 + 8 + local_18),local_c);
            *puVar5 = piVar3;
            if (piVar3 == (int *)0x0) {
              *(undefined4 *)((int)this + 0x3c) = 0;
              Exception_SetMessage
                        ((void *)(local_8 ^ unaff_retaddr),in_stack_fffffbb4,in_stack_fffffbb8);
              return;
            }
            if (*(int *)((int)this + 0x10) != 0) {
              (**(code **)(*piVar3 + 0x7c))(piVar3,*(int *)((int)this + 0x10));
            }
            *(int *)((int)this + 0x30) =
                 *(int *)((int)this + 0x30) + puVar5[2] * local_28 * puVar5[1];
          }
          uVar1 = local_18;
          iVar4 = local_2c;
          Threading_CreateSemaphore
                    (*(_String_base **)(*(int *)((int)this + 4) + local_18),param_1,local_2c,
                     local_1c,*(int *)((int)this + 0x24),*(int *)((int)this + 0x28),local_c);
          local_2c = iVar4 + *(int *)((int)this + 0x24);
          iVar2 = local_20 + 1;
          local_18 = uVar1 + 0xc;
          iVar4 = local_30;
          local_20 = iVar2;
        } while (local_2c < local_14);
      }
      local_1c = local_1c + *(int *)((int)this + 0x28);
    } while (local_1c < iVar4);
  }
  *(int *)((int)this + 0x14) = param_1[1];
  *(int *)((int)this + 0x18) = param_1[2];
  *(int *)((int)this + 0x2c) = param_1[7];
  *(int *)((int)this + 0x3c) = local_c;
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffbb4,in_stack_fffffbb8);
  return;
}


