/*
 * Function: Graphics_CreateTexture
 * Address: 004e4530
 * Category: graphics
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


uint * __cdecl Graphics_CreateTexture(int param_1,int param_2)

{
  uint *puVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  uint *puVar6;
  int iVar7;
  byte bVar8;
  int iVar9;
  uint uVar10;
  int *piVar11;
  uint *puVar12;
  uint local_24;
  int *local_14;
  int local_10;
  int local_c;
  
  iVar9 = *(int *)(*(int *)(*(int *)(*(int *)(param_1 + 0x48) + 4) + 0x1c) + 0xc20);
  piVar2 = *(int **)(param_2 + 0x308);
  puVar1 = (uint *)(param_1 + 4);
  uVar5 = GIF_SetTransparentIndex(puVar1,1);
  if (uVar5 != 1) {
    return (uint *)0x0;
  }
  puVar6 = (uint *)CPU_ProcessData12(param_1,*(int *)(param_2 + 0x2fc) << 2);
  iVar7 = License_CheckExpiry(*(int *)(param_2 + 0x304) - 1);
  uVar5 = GIF_SetTransparentIndex(puVar1,iVar7);
  *puVar6 = uVar5;
  iVar7 = License_CheckExpiry(*(int *)(param_2 + 0x304) - 1);
  uVar5 = GIF_SetTransparentIndex(puVar1,iVar7);
  puVar6[1] = uVar5;
  param_1 = 0;
  local_10 = 2;
  local_14 = piVar2;
  if (0 < *piVar2) {
    do {
      local_14 = local_14 + 1;
      iVar7 = *local_14;
      iVar3 = piVar2[iVar7 + 0x20];
      bVar8 = (byte)piVar2[iVar7 + 0x30];
      uVar5 = 0;
      if ((piVar2[iVar7 + 0x30] != 0) &&
         (uVar5 = GIF_GetImagePointer(piVar2[iVar7 + 0x40] * 0x34 + iVar9,puVar1),
         uVar5 == 0xffffffff)) {
        return (uint *)0x0;
      }
      local_c = 0;
      if (0 < iVar3) {
        puVar12 = puVar6 + local_10;
        do {
          uVar10 = (1 << (bVar8 & 0x1f)) - 1U & uVar5;
          uVar5 = (int)uVar5 >> (bVar8 & 0x1f);
          if (piVar2[uVar10 + iVar7 * 8 + 0x50] < 0) {
            *puVar12 = 0;
          }
          else {
            uVar10 = GIF_GetImagePointer(piVar2[uVar10 + iVar7 * 8 + 0x50] * 0x34 + iVar9,puVar1);
            *puVar12 = uVar10;
            if (uVar10 == 0xffffffff) {
              return (uint *)0x0;
            }
          }
          local_c = local_c + 1;
          puVar12 = puVar12 + 1;
        } while (local_c < iVar3);
      }
      local_10 = local_10 + iVar3;
      param_1 = param_1 + 1;
    } while (param_1 < *piVar2);
  }
  param_1 = 2;
  if (2 < *(int *)(param_2 + 0x2fc)) {
    local_14 = piVar2 + 0xd3;
    piVar11 = (int *)(param_2 + 0x104);
    do {
      uVar5 = Graphics_CreateDevice
                        (*local_14,puVar6[piVar11[0x3f]],piVar2[piVar11[0x3f] + 0xd1],
                         piVar2[*piVar11 + 0xd1]);
      uVar10 = *(int *)(param_2 + 0x304) - uVar5;
      local_24 = uVar10;
      if ((int)uVar5 <= (int)uVar10) {
        local_24 = uVar5;
      }
      uVar4 = puVar6[param_1];
      if (uVar4 == 0) {
        puVar6[param_1] = uVar5 | 0x8000;
      }
      else {
        if (SBORROW4(uVar4,local_24 * 2) == (int)(uVar4 + local_24 * -2) < 0) {
          if ((int)uVar5 < (int)uVar10) {
            iVar9 = uVar4 - uVar5;
          }
          else {
            iVar9 = (uVar10 - uVar4) + -1;
          }
        }
        else if ((uVar4 & 1) == 0) {
          iVar9 = (int)uVar4 >> 1;
        }
        else {
          iVar9 = -((int)(uVar4 + 1) >> 1);
        }
        puVar6[param_1] = iVar9 + uVar5;
        puVar6[piVar11[0x3f]] = puVar6[piVar11[0x3f]] & 0x7fff;
        puVar6[*piVar11] = puVar6[*piVar11] & 0x7fff;
      }
      local_14 = local_14 + 1;
      param_1 = param_1 + 1;
      piVar11 = piVar11 + 1;
    } while (param_1 < *(int *)(param_2 + 0x2fc));
  }
  return puVar6;
}


