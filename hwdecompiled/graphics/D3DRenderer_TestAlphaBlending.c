/*
 * Function: D3DRenderer_TestAlphaBlending
 * Address: 00485970
 * Category: graphics
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined1 __fastcall D3DRenderer_TestAlphaBlending(int param_1)

{
  char *pcVar1;
  char cVar2;
  undefined1 uVar3;
  int iVar4;
  char *pcVar5;
  undefined4 uVar6;
  uint uVar7;
  int extraout_ECX;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  undefined1 local_58 [4];
  uint local_54;
  undefined4 local_44;
  uint local_40;
  _String_base local_3c [4];
  uint local_38;
  undefined4 local_30 [2];
  undefined4 local_28;
  uint local_24;
  int local_1c [2];
  undefined1 *local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  uStack_c = 0x514c68;
  local_10 = ExceptionList;
  local_14 = &stack0xffffff9c;
  local_8 = 0;
  ExceptionList = &local_10;
  local_1c[0] = param_1;
  iVar4 = (**(code **)(**(int **)(param_1 + 0x18) + 0x14))(*(int **)(param_1 + 0x18));
  D3D_ValidateRenderTarget(iVar4,(_String_base *)&DAT_0052c7cf);
  iVar4 = (**(code **)(**(int **)(param_1 + 0x18) + 0x28))
                    (*(int **)(param_1 + 0x18),0,0,1,0xff000000,0x3f800000,0);
  D3D_ValidateRenderTarget(iVar4,(_String_base *)"Clear");
  iVar4 = (**(code **)(**(int **)(param_1 + 0x18) + 0x50))(*(int **)(param_1 + 0x18),0x1b,1);
  D3D_ValidateRenderTarget(iVar4,(_String_base *)"D3DRENDERSTATE_ALPHABLENDENABLE, TRUE");
  iVar4 = (**(code **)(**(int **)(param_1 + 0x18) + 0x50))(*(int **)(param_1 + 0x18),0x13,5);
  D3D_ValidateRenderTarget(iVar4,(_String_base *)"D3DRENDERSTATE_SRCBLEND, D3DBLEND_SRCALPHA");
  iVar4 = (**(code **)(**(int **)(param_1 + 0x18) + 0x50))(*(int **)(param_1 + 0x18),0x14,2);
  D3D_ValidateRenderTarget(iVar4,(_String_base *)"D3DRENDERSTATE_DESTBLEND, D3DBLEND_ONE");
  iVar4 = (**(code **)(**(int **)(param_1 + 0x18) + 0x50))(*(int **)(param_1 + 0x18),0x16,1);
  D3D_ValidateRenderTarget(iVar4,(_String_base *)"D3DRENDERSTATE_CULLMODE, D3DCULL_NONE");
  DirectX_ValidateDisplayMode(local_30,extraout_EDX,0x40,0x40);
  local_8 = CONCAT31(local_8._1_3_,1);
  Image_FillRectangle(local_30,0,0,0x40,0x40,0xff404040);
  D3D_CreateVertexBuffer
            (local_30,*(_String_base **)(param_1 + 0x18),*(_String_base **)(param_1 + 0xc),0,0,
             0xffffffff);
  Image_FillRectangle(local_30,0,0,0x40,0x40,0x80808080);
  D3D_CreateVertexBuffer
            (local_30,*(_String_base **)(param_1 + 0x18),*(_String_base **)(param_1 + 0xc),0,0,
             0xffffffff);
  (**(code **)(**(int **)(param_1 + 0x18) + 0x18))(*(int **)(param_1 + 0x18));
  D3D_ProcessRenderState(param_1);
  Graphics_ValidateTexture(local_30,extraout_EDX_00);
  local_8 = 0xffffffff;
  local_1c[0] = 0;
  cVar2 = Image_AnalyzeColorUniformity((void *)(param_1 + 0x30),0x808080,local_1c,10,10);
  if (local_1c[0] == 0) {
    if (cVar2 != '\0') {
      ExceptionList = local_10;
      return 1;
    }
    local_24 = 0xf;
    local_28 = 0;
    local_38 = local_38 & 0xffffff00;
    pcVar1 = "AlphaAdd blend test not uniform.";
    do {
      pcVar5 = pcVar1;
      pcVar1 = pcVar5 + 1;
    } while (*pcVar5 != '\0');
    String_Assign(local_3c,(_String_base *)"AlphaAdd blend test not uniform.",
                  (uint)(pcVar5 + -0x533794));
    local_8 = 3;
    uVar6 = D3D_SetRenderTarget(param_1,extraout_EDX_01,local_3c);
    uVar3 = (undefined1)uVar6;
    if (0xf < local_24) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_38,extraout_EDX_02);
    }
  }
  else {
    local_40 = 0xf;
    local_44 = 0;
    local_54 = local_54 & 0xffffff00;
    pcVar1 = "AlphaAdd blend not supported.";
    do {
      pcVar5 = pcVar1;
      pcVar1 = pcVar5 + 1;
    } while (*pcVar5 != '\0');
    String_Assign(local_58,(_String_base *)"AlphaAdd blend not supported.",
                  (uint)(pcVar5 + -0x533774));
    local_8 = 4;
    uVar7 = D3D_CreateRenderTarget(param_1,(uint)local_58,(_String_base *)local_58);
    uVar3 = (undefined1)uVar7;
    if (0xf < local_40) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,extraout_EDX_03);
    }
  }
  ExceptionList = local_10;
  return uVar3;
}


