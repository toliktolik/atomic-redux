/*
 * Function: Boss_LoadEncounterTextFromXML
 * Address: 0040eb30
 * Category: bosses
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Boss_LoadEncounterTextFromXML(int param_1)

{
  _String_base _Var1;
  char *pcVar2;
  char cVar3;
  _String_base *p_Var4;
  uint uVar5;
  char *pcVar6;
  int extraout_ECX;
  undefined2 extraout_DX;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  undefined4 *puVar7;
  uint unaff_retaddr;
  undefined4 *in_stack_ffffff3c;
  undefined4 *in_stack_ffffff40;
  undefined1 local_a4 [20];
  uint local_90;
  undefined1 local_6c [24];
  undefined1 local_54 [4];
  uint local_50;
  undefined4 local_40;
  uint local_3c;
  _String_base local_38 [4];
  uint local_34;
  undefined4 local_24;
  uint local_20;
  undefined4 *local_1c;
  undefined4 *local_18;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_00510066;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  if (*(int *)(*(int *)(param_1 + 4) + 0x960) == 0) {
    pcVar2 = "ENCOUNTERED: TWINBLADE\n\n- HOMING MISSILES";
    do {
      pcVar6 = pcVar2;
      pcVar2 = pcVar6 + 1;
    } while (*pcVar6 != '\0');
    ExceptionList = &local_10;
    String_Assign((void *)(param_1 + 0x1c),
                  (_String_base *)"ENCOUNTERED: TWINBLADE\n\n- HOMING MISSILES",
                  (uint)(pcVar6 + -0x52b058));
  }
  else {
    ExceptionList = &local_10;
    local_1c = (undefined4 *)operator_new(0x74);
    local_8 = 0;
    if (local_1c == (undefined4 *)0x0) {
      local_18 = (undefined4 *)0x0;
    }
    else {
      local_18 = (undefined4 *)ObjectType1_Constructor(local_1c);
    }
    puVar7 = local_18;
    local_8 = 0xffffffff;
    local_3c = 0xf;
    local_40 = 0;
    local_50 = local_50 & 0xffffff00;
    pcVar2 = "data\\bosses.xml";
    do {
      pcVar6 = pcVar2;
      pcVar2 = pcVar6 + 1;
    } while (*pcVar6 != '\0');
    String_Assign(local_54,(_String_base *)"data\\bosses.xml",(uint)(pcVar6 + -0x52b048));
    local_8 = 1;
    Image_UpdateTexture((int)puVar7,extraout_DX,(int)local_54);
    local_8 = 0xffffffff;
    if (0xf < local_3c) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,local_50);
    }
    WeaponBomb_ProcessBurstingRocket((int)&stack0xffffff3c);
    local_8 = 2;
    local_1c = (undefined4 *)
               GetBossIndex(*(void **)(param_1 + 4),*(int *)((int)*(void **)(param_1 + 4) + 0x960));
    cVar3 = XML_ParseDocument((int)puVar7,extraout_EDX,(int *)&stack0xffffff3c);
    while (cVar3 != '\0') {
      if (in_stack_ffffff3c == (undefined4 *)0x1) {
        p_Var4 = (_String_base *)("Helicopter" + (int)local_1c * 0x20);
        do {
          _Var1 = *p_Var4;
          p_Var4 = p_Var4 + 1;
        } while (_Var1 != (_String_base)0x0);
        uVar5 = String_Compare(local_a4,0,local_90,
                               (_String_base *)("Helicopter" + (int)local_1c * 0x20),
                               (int)p_Var4 - (int)("Helicopter" + (int)local_1c * 0x20 + 1));
        puVar7 = local_18;
        if (uVar5 == 0) {
          local_20 = 0xf;
          local_24 = 0;
          local_34 = local_34 & 0xffffff00;
          pcVar2 = "info";
          do {
            pcVar6 = pcVar2;
            pcVar2 = pcVar6 + 1;
          } while (*pcVar6 != '\0');
          String_Assign(local_38,(_String_base *)&DAT_0052b040,(uint)(pcVar6 + -0x52b040));
          local_8._0_1_ = 3;
          p_Var4 = (_String_base *)StringMap_LookupAndConcatenate(local_6c,extraout_EDX_00,local_38)
          ;
          PowerUp_ProcessThunderstrike
                    ((_String_base *)(param_1 + 0x1c),extraout_EDX_01,p_Var4,0,0xffffffff);
          local_8 = CONCAT31(local_8._1_3_,2);
          if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(local_34,extraout_EDX_02);
          }
          local_20 = 0xf;
          local_24 = 0;
          local_34 = local_34 & 0xffffff00;
          puVar7 = local_18;
        }
      }
      cVar3 = XML_ParseDocument((int)puVar7,(uint)&stack0xffffff3c,(int *)&stack0xffffff3c);
    }
    if (puVar7 != (undefined4 *)0x0) {
      (**(code **)*puVar7)(1);
    }
    local_8 = 0xffffffff;
    PowerUp_ProcessNuke((int)&stack0xffffff3c);
  }
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_ffffff3c,in_stack_ffffff40);
  return;
}


