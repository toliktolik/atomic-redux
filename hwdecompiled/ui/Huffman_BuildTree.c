/*
 * Function: Huffman_BuildTree
 * Address: 004dc2e0
 * Category: ui
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl Huffman_BuildTree(int *param_1)

{
  byte bVar1;
  undefined4 uVar2;
  int iVar3;
  int iVar4;
  byte bVar5;
  undefined4 extraout_ECX;
  int iVar6;
  int iVar7;
  int iVar8;
  int unaff_ESI;
  int local_c;
  
  iVar4 = *param_1;
  iVar8 = ((int *)param_1[2])[3];
  iVar7 = *(int *)param_1[2];
  iVar3 = 0;
  local_c = -1;
  *(undefined4 *)(unaff_ESI + 0x1448) = 0;
  *(undefined4 *)(unaff_ESI + 0x144c) = 0x23d;
  if (0 < iVar8) {
    do {
      if (*(short *)(iVar4 + iVar3 * 4) == 0) {
        *(undefined2 *)(iVar4 + 2 + iVar3 * 4) = 0;
      }
      else {
        iVar6 = *(int *)(unaff_ESI + 0x1448) + 1;
        *(int *)(unaff_ESI + 0x1448) = iVar6;
        *(int *)(unaff_ESI + 0xb54 + iVar6 * 4) = iVar3;
        *(undefined1 *)(iVar3 + 0x1450 + unaff_ESI) = 0;
        local_c = iVar3;
      }
      iVar3 = iVar3 + 1;
    } while (iVar3 < iVar8);
  }
  iVar3 = *(int *)(unaff_ESI + 0x1448);
  while (iVar3 < 2) {
    if (local_c < 2) {
      iVar3 = local_c + 1;
      local_c = iVar3;
    }
    else {
      iVar3 = 0;
    }
    iVar6 = *(int *)(unaff_ESI + 0x1448) + 1;
    *(int *)(unaff_ESI + 0x1448) = iVar6;
    *(int *)(unaff_ESI + 0xb54 + iVar6 * 4) = iVar3;
    *(undefined2 *)(iVar4 + iVar3 * 4) = 1;
    *(undefined1 *)(unaff_ESI + 0x1450 + iVar3) = 0;
    *(int *)(unaff_ESI + 0x16a0) = *(int *)(unaff_ESI + 0x16a0) + -1;
    if (iVar7 != 0) {
      *(int *)(unaff_ESI + 0x16a4) =
           *(int *)(unaff_ESI + 0x16a4) - (uint)*(ushort *)(iVar7 + 2 + iVar3 * 4);
    }
    iVar3 = *(int *)(unaff_ESI + 0x1448);
  }
  param_1[1] = local_c;
  for (iVar7 = *(int *)(unaff_ESI + 0x1448) / 2; 0 < iVar7; iVar7 = iVar7 + -1) {
    Huffman_HeapifyDown(iVar7);
  }
  do {
    iVar7 = *(int *)(unaff_ESI + 0xb58);
    uVar2 = *(undefined4 *)(unaff_ESI + 0xb54 + *(int *)(unaff_ESI + 0x1448) * 4);
    *(int *)(unaff_ESI + 0x1448) = *(int *)(unaff_ESI + 0x1448) + -1;
    *(undefined4 *)(unaff_ESI + 0xb58) = uVar2;
    Huffman_HeapifyDown(1);
    iVar3 = *(int *)(unaff_ESI + 0xb58);
    iVar6 = *(int *)(unaff_ESI + 0x144c) + -1;
    *(int *)(unaff_ESI + 0x144c) = iVar6;
    *(int *)(unaff_ESI + 0xb54 + iVar6 * 4) = iVar7;
    iVar6 = *(int *)(unaff_ESI + 0x144c) + -1;
    *(int *)(unaff_ESI + 0x144c) = iVar6;
    *(int *)(unaff_ESI + 0xb54 + iVar6 * 4) = iVar3;
    *(short *)(iVar4 + iVar8 * 4) = *(short *)(iVar4 + iVar3 * 4) + *(short *)(iVar4 + iVar7 * 4);
    bVar1 = *(byte *)(unaff_ESI + 0x1450 + iVar3);
    bVar5 = *(byte *)(unaff_ESI + 0x1450 + iVar7);
    if (bVar5 < bVar1) {
      bVar5 = bVar1;
    }
    *(byte *)(unaff_ESI + 0x1450 + iVar8) = bVar5 + 1;
    *(short *)(iVar4 + 2 + iVar3 * 4) = (short)iVar8;
    *(short *)(iVar4 + 2 + iVar7 * 4) = (short)iVar8;
    *(int *)(unaff_ESI + 0xb58) = iVar8;
    iVar8 = iVar8 + 1;
    Huffman_HeapifyDown(1);
  } while (1 < *(int *)(unaff_ESI + 0x1448));
  uVar2 = *(undefined4 *)(unaff_ESI + 0xb58);
  iVar4 = *(int *)(unaff_ESI + 0x144c) + -1;
  *(int *)(unaff_ESI + 0x144c) = iVar4;
  *(undefined4 *)(unaff_ESI + 0xb54 + iVar4 * 4) = uVar2;
  Huffman_BuildOptimalTree(uVar2,unaff_ESI);
  Huffman_GenerateCodes(extraout_ECX,unaff_ESI + 0xb34);
  return;
}


