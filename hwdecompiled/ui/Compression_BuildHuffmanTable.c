/*
 * Function: Compression_BuildHuffmanTable
 * Address: 004ddfa0
 * Category: ui
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl Compression_BuildHuffmanTable(int *param_1,char param_2,int param_3,int *param_4)

{
  byte bVar1;
  int iVar2;
  char *pcVar3;
  int *piVar4;
  uint uVar5;
  int *piVar6;
  undefined1 *puVar7;
  char cVar8;
  int iVar9;
  undefined1 *puVar10;
  int iVar11;
  uint uVar12;
  int iVar13;
  int *piVar14;
  int iVar15;
  undefined4 *puVar16;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffadc;
  undefined4 *in_stack_fffffae0;
  char local_120 [260];
  int *local_1c;
  int local_18;
  int local_14;
  int local_10;
  int local_c;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  if ((param_3 < 0) || (3 < param_3)) {
    *(undefined4 *)(*param_1 + 0x14) = 0x32;
    *(int *)(*param_1 + 0x18) = param_3;
    (**(code **)*param_1)(param_1);
  }
  if (param_2 == '\0') {
    iVar11 = param_1[param_3 + 0x2c];
  }
  else {
    iVar11 = param_1[param_3 + 0x28];
  }
  if (iVar11 == 0) {
    *(undefined4 *)(*param_1 + 0x14) = 0x32;
    *(int *)(*param_1 + 0x18) = param_3;
    (**(code **)*param_1)(param_1);
  }
  if (*param_4 == 0) {
    iVar2 = (**(code **)param_1[1])(param_1,1,0x590);
    *param_4 = iVar2;
  }
  iVar2 = *param_4;
  piVar14 = (int *)0x0;
  local_10 = iVar2;
  *(int *)(iVar2 + 0x8c) = iVar11;
  param_4 = (int *)0x0;
  local_c = 1;
  do {
    iVar13 = local_c;
    bVar1 = *(byte *)(local_c + iVar11);
    uVar12 = (uint)bVar1;
    if (0x100 < (int)(uVar12 + (int)piVar14)) {
      *(undefined4 *)(*param_1 + 0x14) = 8;
      (**(code **)*param_1)(param_1);
      iVar2 = local_10;
    }
    if (uVar12 != 0) {
      cVar8 = (char)iVar13;
      pcVar3 = local_120 + (int)piVar14;
      for (uVar5 = (uint)(bVar1 >> 2); iVar2 = local_10, uVar5 != 0; uVar5 = uVar5 - 1) {
        *(uint *)pcVar3 = CONCAT22(CONCAT11(cVar8,cVar8),CONCAT11(cVar8,cVar8));
        pcVar3 = pcVar3 + 4;
      }
      for (uVar5 = uVar12 & 3; uVar5 != 0; uVar5 = uVar5 - 1) {
        *pcVar3 = cVar8;
        pcVar3 = pcVar3 + 1;
      }
      piVar14 = (int *)((int)param_4 + uVar12);
      iVar13 = local_c;
      param_4 = piVar14;
    }
    local_c = iVar13 + 1;
  } while (iVar13 + 1 < 0x11);
  local_120[(int)piVar14] = '\0';
  local_1c = piVar14;
  iVar15 = 0;
  iVar13 = 0;
  iVar9 = (int)local_120[0];
  if (local_120[0] != '\0') {
    pcVar3 = local_120;
    do {
      cVar8 = *pcVar3;
      while (cVar8 == iVar9) {
        cVar8 = local_120[iVar13 + 1];
        *(int *)(&stack0xfffffadc + iVar13 * 4) = iVar15;
        iVar13 = iVar13 + 1;
        iVar15 = iVar15 + 1;
      }
      if (1 << ((byte)iVar9 & 0x1f) <= iVar15) {
        *(undefined4 *)(*param_1 + 0x14) = 8;
        (**(code **)*param_1)(param_1);
        iVar2 = local_10;
      }
      pcVar3 = local_120 + iVar13;
      iVar15 = iVar15 << 1;
      iVar9 = iVar9 + 1;
    } while (local_120[iVar13] != '\0');
  }
  piVar14 = local_1c;
  iVar15 = 0;
  iVar13 = 1;
  do {
    if (*(char *)(iVar13 + iVar11) == '\0') {
      *(undefined4 *)(iVar2 + iVar13 * 4) = 0xffffffff;
    }
    else {
      *(int *)(iVar2 + 0x48 + iVar13 * 4) = iVar15 - *(int *)(&stack0xfffffadc + iVar15 * 4);
      iVar15 = iVar15 + (uint)*(byte *)(iVar13 + iVar11);
      *(undefined4 *)(iVar2 + iVar13 * 4) = *(undefined4 *)(&stack0xfffffad8 + iVar15 * 4);
    }
    iVar13 = iVar13 + 1;
  } while (iVar13 < 0x11);
  *(undefined4 *)(iVar2 + 0x44) = 0xfffff;
  puVar16 = (undefined4 *)(iVar2 + 0x90);
  for (iVar13 = 0x100; iVar13 != 0; iVar13 = iVar13 + -1) {
    *puVar16 = 0;
    puVar16 = puVar16 + 1;
  }
  piVar6 = (int *)0x0;
  param_4 = (int *)0x0;
  iVar2 = 1;
  local_c = 7;
  do {
    local_14 = 1;
    if (*(char *)(iVar2 + iVar11) != '\0') {
      local_18 = 1 << ((byte)local_c & 0x1f);
      puVar10 = (undefined1 *)((int)piVar6 + iVar11 + 0x11);
      do {
        iVar13 = *(int *)(&stack0xfffffadc + (int)piVar6 * 4) << ((byte)local_c & 0x1f);
        if (0 < local_18) {
          puVar7 = (undefined1 *)(iVar13 + 0x490 + local_10);
          piVar4 = (int *)(local_10 + 0x90 + iVar13 * 4);
          iVar13 = local_18;
          do {
            *piVar4 = iVar2;
            piVar4 = piVar4 + 1;
            *puVar7 = *puVar10;
            puVar7 = puVar7 + 1;
            iVar13 = iVar13 + -1;
            piVar6 = param_4;
          } while (iVar13 != 0);
        }
        local_14 = local_14 + 1;
        piVar6 = (int *)((int)piVar6 + 1);
        puVar10 = puVar10 + 1;
        param_4 = piVar6;
      } while (local_14 <= (int)(uint)*(byte *)(iVar2 + iVar11));
    }
    iVar2 = iVar2 + 1;
    local_c = local_c + -1;
  } while (-1 < local_c);
  if ((param_2 != '\0') && (iVar2 = 0, 0 < (int)local_1c)) {
    do {
      if (0xf < *(byte *)(iVar11 + 0x11 + iVar2)) {
        *(undefined4 *)(*param_1 + 0x14) = 8;
        (**(code **)*param_1)(param_1);
      }
      iVar2 = iVar2 + 1;
    } while (iVar2 < (int)piVar14);
  }
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffadc,in_stack_fffffae0);
  return;
}


