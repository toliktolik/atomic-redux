/*
 * Function: UserDataSystem_SaveUserProfiles
 * Address: 00404c90
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall UserDataSystem_SaveUserProfiles(void *param_1)

{
  char *pcVar1;
  bool bVar2;
  undefined4 *this;
  char *pcVar3;
  undefined2 extraout_DX;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint uVar4;
  undefined1 local_4c [4];
  uint local_48;
  undefined4 local_38;
  uint local_34;
  undefined1 local_30 [4];
  uint local_2c;
  undefined4 local_1c;
  uint local_18;
  undefined4 *local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_0050f69b;
  local_10 = ExceptionList;
  uVar4 = 0;
  local_34 = 0xf;
  local_38 = 0;
  local_48 = local_48 & 0xffffff00;
  pcVar1 = "userdata";
  do {
    pcVar3 = pcVar1;
    pcVar1 = pcVar3 + 1;
  } while (*pcVar3 != '\0');
  ExceptionList = &local_10;
  String_Assign(local_4c,(_String_base *)"userdata",(uint)(pcVar3 + -0x52a3b8));
  local_8 = 0;
  bVar2 = Math_ClampToRange((int)param_1,extraout_DX);
  local_8 = 0xffffffff;
  if (0xf < local_34) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_48,extraout_EDX);
  }
  if (!bVar2) {
    func_0x0050f21a("userdata");
  }
  if ((*(int *)((int)param_1 + 0x148c) != 0) &&
     (local_14 = (undefined4 *)
                 ((*(int *)((int)param_1 + 0x1490) - *(int *)((int)param_1 + 0x148c)) / 0x60),
     local_14 != (undefined4 *)0x0)) {
    local_14 = (undefined4 *)operator_new(0x20);
    local_8 = 1;
    if (local_14 == (undefined4 *)0x0) {
      this = (undefined4 *)0x0;
    }
    else {
      this = (undefined4 *)ObjectType2_Constructor(local_14);
    }
    local_8 = 0xffffffff;
    BitStream_WriteByte(this,0);
    local_14 = (undefined4 *)0x0;
    for (; (*(int *)((int)param_1 + 0x148c) != 0 &&
           (uVar4 < (uint)((*(int *)((int)param_1 + 0x1490) - *(int *)((int)param_1 + 0x148c)) /
                          0x60))); uVar4 = uVar4 + 1) {
      BitStream_WriteBuffer(this,*(int *)((int)param_1 + 0x148c) + (int)local_14,0x60);
      local_14 = (undefined4 *)((int)local_14 + 0x60);
    }
    local_18 = 0xf;
    local_1c = 0;
    local_2c = local_2c & 0xffffff00;
    pcVar1 = "userdata\\users.dat";
    do {
      pcVar3 = pcVar1;
      pcVar1 = pcVar3 + 1;
    } while (*pcVar3 != '\0');
    String_Assign(local_30,(_String_base *)"userdata\\users.dat",(uint)(pcVar3 + -0x52a3a4));
    local_8 = 2;
    Log_WriteMessage(param_1,local_30,(int)this);
    local_8 = 0xffffffff;
    if (local_18 < 0x10) {
      local_18 = 0xf;
      local_1c = 0;
      local_2c = local_2c & 0xffffff00;
      if (this == (undefined4 *)0x0) {
        ExceptionList = local_10;
        return;
      }
      (**(code **)*this)(1);
      ExceptionList = local_10;
      return;
    }
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_2c,extraout_EDX_00);
  }
  DeleteFileA("userdata\\users.dat");
  ExceptionList = local_10;
  return;
}


