/*
 * Function: Profile_CreateNew
 * Address: 00429300
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Type propagation algorithm not settling */

void __fastcall Profile_CreateNew(int param_1)

{
  _String_base _Var1;
  char cVar2;
  int iVar3;
  undefined1 uVar4;
  uint uVar5;
  int *piVar6;
  _String_base *p_Var7;
  int iVar8;
  void *pvVar9;
  char *pcVar10;
  char *pcVar11;
  char *******extraout_ECX;
  undefined4 extraout_ECX_00;
  int extraout_ECX_01;
  uint extraout_ECX_02;
  uint extraout_ECX_03;
  char *******extraout_ECX_04;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  byte *extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint uVar12;
  uint extraout_EDX_06;
  char *******pppppppcVar13;
  int iVar14;
  uint extraout_EDX_07;
  undefined4 *unaff_ESI;
  _String_base *p_Var15;
  undefined4 *unaff_EDI;
  uint unaff_retaddr;
  char local_f8 [66];
  undefined2 local_b6;
  undefined1 local_98 [4];
  uint local_94;
  undefined4 local_84;
  uint local_80;
  _String_base local_7c [4];
  char *******local_78 [4];
  uint local_68;
  uint local_64;
  _String_base local_60 [4];
  uint local_5c;
  undefined4 local_4c;
  uint local_48;
  uint local_44;
  _String_base local_40 [4];
  uint local_3c;
  undefined4 local_2c;
  uint local_28;
  int local_24;
  bool local_1d;
  void *local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x511685;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  local_18 = 0;
  ExceptionList = &local_10;
  local_24 = param_1;
  Sound_LoadFromFile(local_7c,(void *)(*(int *)(param_1 + 0x124) + 0x5c));
  local_8._0_1_ = 0;
  local_8._1_3_ = 0;
  pcVar11 = "";
  do {
    pcVar10 = pcVar11;
    pcVar11 = pcVar10 + 1;
  } while (*pcVar10 != '\0');
  uVar5 = String_Compare(local_7c,0,local_68,(_String_base *)&DAT_0052c7cf,
                         (uint)(pcVar10 + -0x52c7cf));
  if (uVar5 == 0) {
    local_1c = operator_new(0x11c);
    local_8._0_1_ = 1;
    if (local_1c == (void *)0x0) {
      piVar6 = (int *)0x0;
      uVar5 = extraout_EDX;
    }
    else {
      local_28 = 0xf;
      local_2c = 0;
      local_3c = local_3c & 0xffffff00;
      pcVar11 = "You must enter a name in order to continue.";
      do {
        pcVar10 = pcVar11;
        pcVar11 = pcVar10 + 1;
      } while (*pcVar10 != '\0');
      String_Assign(local_40,(_String_base *)"You must enter a name in order to continue.",
                    (uint)(pcVar10 + -0x52e7dc));
      local_8 = CONCAT31(local_8._1_3_,2);
      local_18 = 1;
      local_48 = 0xf;
      local_4c = 0;
      local_5c = local_5c & 0xffffff00;
      pcVar11 = "INVALID NAME";
      do {
        pcVar10 = pcVar11;
        pcVar11 = pcVar10 + 1;
      } while (*pcVar10 != '\0');
      String_Assign(local_60,(_String_base *)"INVALID NAME",(uint)(pcVar10 + -0x52e7cc));
      local_8._0_1_ = 3;
      local_8._1_3_ = 0;
      local_18 = 3;
      piVar6 = ParticleSystem_Constructor
                         (local_1c,*(int *)(param_1 + 0x118),0x140,200,local_60,(uint)local_40);
      uVar5 = extraout_EDX_00;
    }
    if ((local_18 & 2) != 0) {
      local_18 = local_18 & 0xfffffffd;
      if (0xf < local_48) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(local_18,uVar5);
      }
      local_48 = 0xf;
      local_4c = 0;
      local_5c = local_5c & 0xffffff00;
    }
    local_8._0_1_ = 0;
    local_8._1_3_ = 0;
    if ((local_18 & 1) != 0) {
      if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(local_3c,uVar5);
      }
      local_28 = 0xf;
      local_2c = 0;
      local_3c = local_3c & 0xffffff00;
    }
    (**(code **)(**(int **)(param_1 + 0x118) + 0x100))(0x1f,piVar6);
    (**(code **)(*piVar6 + 0xd4))(0);
    UI_Widget_ApplyBlending
              (*(void **)(*(int *)(param_1 + 0x118) + 0x2dc),*(int **)(param_1 + 0x124));
    local_78[0] = extraout_ECX;
    uVar5 = extraout_EDX_01;
    pvVar9 = ExceptionList;
    ExceptionList = local_10;
  }
  else {
    local_44 = 0;
    local_1c = (void *)0x0;
    while( true ) {
      iVar8 = *(int *)(param_1 + 0x118);
      if ((*(int *)(iVar8 + 0x148c) == 0) ||
         ((uint)((*(int *)(iVar8 + 0x1490) - *(int *)(iVar8 + 0x148c)) / 0x60) <= local_44)) break;
      if (((local_44 != *(uint *)(param_1 + 300)) || (*(char *)(param_1 + 0x129) == '\0')) ||
         (local_44 != *(uint *)(param_1 + 300))) {
        local_28 = 0xf;
        local_2c = 0;
        p_Var15 = (_String_base *)((int)local_1c + *(int *)(iVar8 + 0x148c));
        local_3c = local_3c & 0xffffff00;
        p_Var7 = p_Var15;
        do {
          _Var1 = *p_Var7;
          p_Var7 = p_Var7 + 1;
        } while (_Var1 != (_String_base)0x0);
        String_Assign(local_40,p_Var15,(int)p_Var7 - (int)(p_Var15 + 1));
        local_8._0_1_ = 6;
        iVar8 = Image_LoadFromFile(local_98,extraout_EDX_02,(_String_base *)local_98,(int)local_40);
        local_8._0_1_ = 7;
        pvVar9 = (void *)Image_LoadFromFile(extraout_ECX_00,(byte *)local_7c,local_60,(int)local_7c)
        ;
        local_8._0_1_ = 8;
        if (*(uint *)(iVar8 + 0x18) < 0x10) {
          p_Var15 = (_String_base *)(iVar8 + 4);
        }
        else {
          p_Var15 = *(_String_base **)(iVar8 + 4);
        }
        uVar5 = String_Compare(pvVar9,0,*(uint *)((int)pvVar9 + 0x14),p_Var15,
                               *(uint *)(iVar8 + 0x14));
        local_1d = uVar5 == 0;
        if (0xf < local_48) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_01,local_5c);
        }
        local_48 = 0xf;
        local_4c = 0;
        local_5c = local_5c & 0xffffff00;
        if (0xf < local_80) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_01,extraout_EDX_03);
        }
        local_80 = 0xf;
        local_84 = 0;
        local_94 = local_94 & 0xffffff00;
        local_8._0_1_ = 0;
        if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(local_3c,extraout_EDX_03);
        }
        local_28 = 0xf;
        local_2c = 0;
        local_3c = local_3c & 0xffffff00;
        param_1 = local_24;
        if (uVar5 == 0) {
          local_1c = operator_new(0x11c);
          local_8._0_1_ = 9;
          uVar4 = (undefined1)local_8;
          local_8._0_1_ = 9;
          if (local_1c == (void *)0x0) {
            piVar6 = (int *)0x0;
            uVar5 = extraout_ECX_02;
            uVar12 = extraout_EDX_04;
            iVar8 = local_24;
            local_8._0_1_ = uVar4;
          }
          else {
            local_48 = 0xf;
            local_4c = 0;
            local_5c = local_5c & 0xffffff00;
            pcVar11 = "This name already exists. Please enter a unique name.";
            do {
              pcVar10 = pcVar11;
              pcVar11 = pcVar10 + 1;
            } while (*pcVar10 != '\0');
            String_Assign(local_60,(_String_base *)
                                   "This name already exists. Please enter a unique name.",
                          (uint)(pcVar10 + -0x52e794));
            local_8 = CONCAT31(local_8._1_3_,10);
            local_18 = 4;
            local_28 = 0xf;
            local_2c = 0;
            local_3c = local_3c & 0xffffff00;
            pcVar11 = "DUPLICATE NAME";
            do {
              pcVar10 = pcVar11;
              pcVar11 = pcVar10 + 1;
            } while (*pcVar10 != '\0');
            String_Assign(local_40,(_String_base *)"DUPLICATE NAME",(uint)(pcVar10 + -0x52e784));
            iVar8 = local_24;
            local_8._0_1_ = 0xb;
            local_8._1_3_ = 0;
            local_18 = 0xc;
            piVar6 = ParticleSystem_Constructor
                               (local_1c,*(int *)(local_24 + 0x118),0x140,200,local_40,
                                (uint)local_60);
            uVar5 = extraout_ECX_03;
            uVar12 = extraout_EDX_05;
          }
          if ((local_18 & 8) != 0) {
            uVar5 = local_18 & 0xfffffff7;
            local_18 = uVar5;
            if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
              System_ShutdownHandler(uVar5,local_3c);
            }
            local_28 = 0xf;
            local_2c = 0;
            local_3c = local_3c & 0xffffff00;
          }
          local_8._0_1_ = 0;
          local_8._1_3_ = 0;
          if ((local_18 & 4) != 0) {
            if (0xf < local_48) {
                    /* WARNING: Subroutine does not return */
              System_ShutdownHandler(uVar5,uVar12);
            }
            local_48 = 0xf;
            local_4c = 0;
            local_5c = local_5c & 0xffffff00;
          }
          (**(code **)(**(int **)(iVar8 + 0x118) + 0x100))(0x1f,piVar6);
          (**(code **)(*piVar6 + 0xd4))(0);
          UI_Widget_ApplyBlending
                    (*(void **)(*(int *)(iVar8 + 0x118) + 0x2dc),*(int **)(iVar8 + 0x124));
          local_78[0] = extraout_ECX_04;
          uVar5 = extraout_EDX_06;
          pvVar9 = ExceptionList;
          ExceptionList = local_10;
          goto joined_r0x00429772;
        }
      }
      local_44 = local_44 + 1;
      local_1c = (void *)((int)local_1c + 0x60);
    }
    if (*(char *)(param_1 + 0x129) == '\0') {
      pcVar11 = local_f8;
      for (iVar8 = 0x18; iVar8 != 0; iVar8 = iVar8 + -1) {
        pcVar11[0] = '\0';
        pcVar11[1] = '\0';
        pcVar11[2] = '\0';
        pcVar11[3] = '\0';
        pcVar11 = pcVar11 + 4;
      }
      pppppppcVar13 = local_78[0];
      if (local_64 < 0x10) {
        pppppppcVar13 = (char *******)local_78;
      }
      pcVar11 = local_f8;
      do {
        cVar2 = *(char *)pppppppcVar13;
        pppppppcVar13 = (char *******)((int)pppppppcVar13 + 1);
        *pcVar11 = cVar2;
        iVar8 = local_24;
        pcVar11 = pcVar11 + 1;
      } while (cVar2 != '\0');
      local_b6 = 0;
      Vector_PushBack_96ByteObjects
                ((void *)(*(int *)(local_24 + 0x118) + 0x1488),(undefined4 *)local_f8);
      iVar3 = *(int *)(iVar8 + 0x118);
      if (*(int *)(iVar3 + 0x148c) == 0) {
        iVar14 = 0;
      }
      else {
        iVar14 = (*(int *)(iVar3 + 0x1490) - *(int *)(iVar3 + 0x148c)) / 0x60;
      }
      *(int *)(iVar3 + 0xb40) = iVar14 + -1;
      *(undefined1 *)(*(int *)(iVar8 + 0x118) + 0xb31) = 1;
      (**(code **)(**(int **)(iVar8 + 0x118) + 0x108))(0x15);
      UserDataSystem_SaveUserProfiles(*(void **)(iVar8 + 0x118));
      param_1 = local_24;
    }
    else {
      pppppppcVar13 = local_78[0];
      if (local_64 < 0x10) {
        pppppppcVar13 = (char *******)local_78;
      }
      pcVar11 = (char *)(*(int *)(param_1 + 300) * 0x60 +
                        *(int *)(*(int *)(param_1 + 0x118) + 0x148c));
      do {
        cVar2 = *(char *)pppppppcVar13;
        pppppppcVar13 = (char *******)((int)pppppppcVar13 + 1);
        *pcVar11 = cVar2;
        pcVar11 = pcVar11 + 1;
      } while (cVar2 != '\0');
      iVar8 = (**(code **)(**(int **)(param_1 + 0x118) + 0xfc))(0x15);
      *(undefined4 *)(iVar8 + 0x138) = *(undefined4 *)(param_1 + 300);
      UserProfileSelector_PopulateList(iVar8);
      (**(code **)(**(int **)(iVar8 + 0x130) + 0xf0))(*(int *)(param_1 + 300) + 1);
    }
    (**(code **)(**(int **)(param_1 + 0x118) + 0x108))(0x1b);
    uVar5 = extraout_EDX_07;
    pvVar9 = ExceptionList;
    ExceptionList = local_10;
  }
joined_r0x00429772:
  local_10 = ExceptionList;
  if (local_64 < 0x10) {
    Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),unaff_EDI,unaff_ESI);
    return;
  }
  ExceptionList = pvVar9;
                    /* WARNING: Subroutine does not return */
  System_ShutdownHandler((int)local_78[0],uVar5);
}


