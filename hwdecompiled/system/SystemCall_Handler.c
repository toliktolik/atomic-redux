/*
 * Function: SystemCall_Handler
 * Address: 004fbaf0
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x00504262) overlaps instruction at (ram,0x00504260)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Removing unreachable block (ram,0x00504232) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

float10 __fastcall SystemCall_Handler(uint *param_1,int param_2,double param_3)

{
  uint *puVar1;
  byte *pbVar2;
  byte *pbVar3;
  undefined4 *puVar4;
  undefined1 uVar5;
  code *pcVar6;
  byte bVar7;
  ushort uVar8;
  uint in_EAX;
  uint uVar9;
  undefined4 *puVar10;
  uint uVar11;
  undefined2 uVar13;
  undefined1 *unaff_EBX;
  uint unaff_EBP;
  char *unaff_ESI;
  undefined2 in_CS;
  byte in_AF;
  bool bVar14;
  bool bVar15;
  bool bVar16;
  ushort in_FPUControlWord;
  float10 fVar17;
  double dVar18;
  longlong lVar19;
  undefined2 unaff_retaddr;
  byte bVar12;
  
  bVar16 = false;
  bVar15 = DAT_005a5224 < 0;
  bVar14 = DAT_005a5224 == 0;
  if (!bVar14) {
    in_EAX = MXCSR & 0x1f80;
    bVar16 = SBORROW4(in_EAX,0x1f80);
    bVar15 = (int)(in_EAX - 0x1f80) < 0;
    bVar14 = in_EAX == 0x1f80;
    if (bVar14) {
      uVar8 = in_FPUControlWord & 0x7f;
      in_EAX = (uint)uVar8;
      bVar16 = SBORROW2(uVar8,0x7f);
      bVar15 = (short)(uVar8 - 0x7f) < 0;
      bVar14 = uVar8 == 0x7f;
    }
    if (bVar14) {
      uVar11 = (uint)((ulonglong)param_3 >> 0x20);
      uVar9 = uVar11 >> 0x14;
      lVar19 = CONCAT44(_UNK_00547084,_DAT_00547080 - (uVar11 >> 0x14 & _DAT_005470a0));
      if ((uVar9 & 0x800) == 0) {
        dVar18 = (double)(((ulonglong)param_3 >> lVar19) << lVar19);
        if (uVar9 < 0x3ff) {
          return (float10)(double)(-(ulonglong)(_DAT_00547090 < param_3) & _DAT_00547070);
        }
        if (uVar9 < 0x433) {
          return (float10)(dVar18 + (double)(-(ulonglong)(dVar18 < param_3) & _DAT_00547070));
        }
      }
      else {
        if (uVar9 < 0xbff) {
          return (float10)_DAT_005470b0;
        }
        if (uVar9 < 0xc33) {
          return (float10)(double)(((ulonglong)param_3 >> lVar19) << lVar19);
        }
      }
      if (NAN(param_3)) {
        func_0x00503f38(&param_3,&param_3,&param_3,0x3ec);
      }
      return (float10)param_3;
    }
  }
  bVar7 = (byte)in_EAX;
  uVar13 = (undefined2)param_2;
  out(uVar13,bVar7);
  if (bVar14 || bVar16 != bVar15) {
    while( true ) {
      unaff_ESI = unaff_ESI + 1;
      puVar10 = (undefined4 *)in(uVar13);
      param_1 = (uint *)CONCAT31((int3)((uint)param_1 >> 8),0x88);
      if (!bVar15) break;
      in(uVar13);
      unaff_retaddr = 0xffd6;
    }
    puVar4 = puVar10 + 1;
    *puVar10 = *(undefined4 *)unaff_ESI;
    unaff_EBP = unaff_EBP & *param_1;
  }
  else {
    out(0x62,bVar7);
    *(int *)((int)param_1 + -9) =
         (*(int *)((int)param_1 + -9) + 0x72) - (uint)(_DAT_1aa0c900 < 0xffffffdf);
    bVar12 = 9 < (bVar7 & 0xf) | in_AF;
    uVar11 = CONCAT31((int3)(in_EAX >> 8),bVar7 + bVar12 * '\x06') & 0xffffff0f;
    bVar12 = (char)(in_EAX >> 8) + bVar12;
    *(byte *)(param_2 + -0x31ff7dd5) =
         *(byte *)(param_2 + -0x31ff7dd5) & (byte)((uint)unaff_EBX >> 8);
    _DAT_ece8fbfa = 0xece8fbfe;
    _DAT_ece8fbfa = 0xfbfe;
    unaff_retaddr = _DAT_ece8fbfa;
    pbVar3 = unaff_EBX + 1;
    uVar5 = in(uVar13);
    *unaff_EBX = uVar5;
    *pbVar3 = *pbVar3 | bVar12;
    if (*pbVar3 != 0) {
      unaff_ESI[5] = unaff_ESI[5] + -0x49;
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    _DAT_ece8fbfa = CONCAT22((short)(uVar11 >> 0x10),CONCAT11(bVar12,(char)uVar11));
    *unaff_ESI = *unaff_ESI + -6;
    LOCK();
    puVar1 = (uint *)(((uint)unaff_ESI & unaff_EBP) + 0xc2f77975);
    pbVar2 = (byte *)*puVar1;
    _DAT_ca54bc4e = in_CS;
    *puVar1 = (uint)unaff_ESI & unaff_EBP;
    UNLOCK();
    puVar4 = (undefined4 *)(unaff_EBX + 2);
    *pbVar3 = *pbVar2;
  }
  *(uint *)((int)puVar4 + 0x3f073e12) = *(uint *)((int)puVar4 + 0x3f073e12) | unaff_EBP;
  param_3._0_5_ = CONCAT23(unaff_retaddr,param_3._0_3_);
  pcVar6 = (code *)swi(1);
  fVar17 = (float10)(*pcVar6)();
  return fVar17;
}


