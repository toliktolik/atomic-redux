/*
 * Function: TrialSystem_CheckLimitsAndPromptRegistration
 * Address: 004045d0
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall TrialSystem_CheckLimitsAndPromptRegistration(int *param_1)

{
  undefined1 uVar1;
  char *pcVar2;
  char cVar3;
  void *pvVar4;
  undefined4 *puVar5;
  _String_base *p_Var6;
  _String_base *p_Var7;
  int iVar8;
  int iVar9;
  char *pcVar10;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint extraout_EDX_07;
  uint extraout_EDX_08;
  uint extraout_EDX_09;
  uint extraout_EDX_10;
  uint extraout_EDX_11;
  uint extraout_EDX_12;
  uint extraout_EDX_13;
  uint extraout_EDX_14;
  uint uVar11;
  uint uVar12;
  undefined8 uVar13;
  uint unaff_retaddr;
  undefined4 *in_stack_ffffff3c;
  undefined4 *in_stack_ffffff40;
  _String_base local_a8 [28];
  _String_base local_8c [28];
  _String_base local_70 [4];
  uint local_6c;
  int local_5c;
  uint local_58;
  _String_base local_54 [4];
  uint local_50;
  undefined4 local_40;
  uint local_3c;
  _String_base local_38 [4];
  uint local_34;
  undefined4 local_24;
  uint local_20;
  void *local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_0050f669;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  uVar11 = 0;
  local_18 = 0;
  if (*(char *)((int)param_1 + 0xb32) != '\0') {
    ExceptionList = &local_10;
    pvVar4 = operator_new(0x124);
    local_8 = 0;
    local_1c = pvVar4;
    if (pvVar4 == (void *)0x0) {
      puVar5 = (undefined4 *)0x0;
      iVar8 = extraout_ECX;
      uVar12 = extraout_EDX;
    }
    else {
      local_24 = 0;
      local_34 = local_34 & 0xffffff00;
      local_20 = 0xf;
      pcVar2 = 
      "Your trial has expired, but Red Star\'s lust for power never will!  Do you wish to register at this time?"
      ;
      do {
        pcVar10 = pcVar2;
        pcVar2 = pcVar10 + 1;
      } while (*pcVar10 != '\0');
      String_Assign(local_38,(_String_base *)
                             "Your trial has expired, but Red Star\'s lust for power never will!  Do you wish to register at this time?"
                    ,(uint)(pcVar10 + -0x52a338));
      local_8 = CONCAT31(local_8._1_3_,1);
      local_18 = 1;
      local_3c = 0xf;
      local_40 = 0;
      local_50 = local_50 & 0xffffff00;
      pcVar2 = "TRIAL EXPIRED";
      do {
        pcVar10 = pcVar2;
        pcVar2 = pcVar10 + 1;
      } while (*pcVar10 != '\0');
      String_Assign(local_54,(_String_base *)"TRIAL EXPIRED",(uint)(pcVar10 + -0x52a328));
      local_8 = 2;
      local_18 = 3;
      if (param_1[0x252] == 0) {
        uVar11 = 0;
      }
      else {
        uVar11 = param_1[0x252] + 0x58;
      }
      puVar5 = Dialog_YesNoConstructor
                         (pvVar4,(int)param_1,uVar11,local_54,(uint)local_38,0x168,0xdc,0x2e,0x2f);
      iVar8 = extraout_ECX_00;
      uVar12 = extraout_EDX_00;
      uVar11 = local_18;
    }
    if ((uVar11 & 2) != 0) {
      uVar11 = uVar11 & 0xfffffffd;
      if (0xf < local_3c) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(iVar8,uVar12);
      }
      local_3c = 0xf;
      local_40 = 0;
      local_50 = local_50 & 0xffffff00;
    }
    local_8 = 0xffffffff;
    if ((uVar11 & 1) != 0) {
      if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(local_34,uVar12);
      }
      local_20 = 0xf;
      local_24 = 0;
      local_34 = local_34 & 0xffffff00;
    }
    pcVar2 = "QUIT";
    do {
      pcVar10 = pcVar2;
      pcVar2 = pcVar10 + 1;
    } while (*pcVar10 != '\0');
    String_Assign((void *)(puVar5[0x48] + 0x5c),(_String_base *)&DAT_0052a320,
                  (uint)(pcVar10 + -0x52a320));
    (**(code **)(*param_1 + 0x100))(0x20,puVar5);
    goto LAB_00404c63;
  }
  ExceptionList = &local_10;
  if ((char)param_1[0x2cf] == '\0') {
    ExceptionList = &local_10;
    cVar3 = (**(code **)(*param_1 + 0x140))();
    if (cVar3 == '\0') goto LAB_00404852;
    (**(code **)(*param_1 + 0x144))();
    pvVar4 = operator_new(0x124);
    local_8 = 5;
    local_1c = pvVar4;
    if (pvVar4 == (void *)0x0) {
      puVar5 = (undefined4 *)0x0;
      uVar12 = extraout_EDX_01;
    }
    else {
      Level_InitializeDictastroika(local_54,"Do you want to check for updates to Heavy Weapon?");
      local_8 = CONCAT31(local_8._1_3_,6);
      local_18 = 4;
      Level_InitializeDictastroika(local_38,"UPDATES");
      local_8 = 7;
      local_18 = 0xc;
      puVar5 = Dialog_YesNoConstructor
                         (pvVar4,(int)param_1,(uint)param_1,local_38,(uint)local_54,0x140,0xdc,10,
                          0x39);
      uVar12 = extraout_EDX_02;
      uVar11 = local_18;
    }
    if ((uVar11 & 8) != 0) {
      uVar11 = uVar11 & 0xfffffff7;
      local_18 = uVar11;
      String_Destructor((int)local_38,uVar12);
      uVar12 = extraout_EDX_03;
    }
    local_8 = 0xffffffff;
    if ((uVar11 & 4) != 0) {
      local_18 = uVar11 & 0xfffffffb;
      String_Destructor((int)local_54,uVar12);
    }
    (**(code **)(*param_1 + 0x100))(0x20,puVar5);
  }
  else {
LAB_00404852:
    if ((*(char *)((int)param_1 + 0xb3d) != '\0') && (*(char *)((int)param_1 + 0x47f) != '\0')) {
      Game_GetState(param_1[0x166]);
      iVar8 = Game_GetState(param_1[0x166]);
      if (iVar8 == 2) {
        cVar3 = Network_IsClientMessageValid((undefined4 *)param_1[0x166]);
        if (cVar3 == '\0') {
          pvVar4 = operator_new(0x124);
          local_8 = 10;
          local_1c = pvVar4;
          if (pvVar4 == (void *)0x0) {
            puVar5 = (undefined4 *)0x0;
            uVar11 = extraout_EDX_04;
          }
          else {
            Level_InitializeDictastroika(local_54,"NEW_VERSION_BODY");
            local_8 = CONCAT31(local_8._1_3_,0xb);
            local_18 = 0x10;
            Level_InitializeDictastroika(local_38,"NEW_VERSION_TITLE");
            local_8 = 0xc;
            local_18 = 0x30;
            p_Var6 = STL_String_Erase(param_1,local_8c,local_54);
            local_8 = 0xd;
            local_18 = 0x70;
            p_Var7 = STL_String_Erase(param_1,(_String_base *)&stack0xffffff3c,local_38);
            local_8 = 0xe;
            local_18 = 0xf0;
            puVar5 = Dialog_YesNoConstructor
                               (pvVar4,(int)param_1,(uint)param_1,p_Var7,(uint)p_Var6,0x168,0xf0,
                                0x38,0x39);
            uVar11 = extraout_EDX_05;
          }
          uVar12 = local_18;
          if ((char)local_18 < '\0') {
            uVar12 = local_18 & 0xffffff7f;
            local_18 = uVar12;
            String_Destructor((int)&stack0xffffff3c,uVar11);
            uVar11 = extraout_EDX_06;
          }
          if ((uVar12 & 0x40) != 0) {
            uVar12 = uVar12 & 0xffffffbf;
            local_18 = uVar12;
            String_Destructor((int)local_8c,uVar11);
            uVar11 = extraout_EDX_07;
          }
          if ((uVar12 & 0x20) != 0) {
            uVar12 = uVar12 & 0xffffffdf;
            local_18 = uVar12;
            String_Destructor((int)local_38,uVar11);
            uVar11 = extraout_EDX_08;
          }
          local_8 = 0xffffffff;
          if ((uVar12 & 0x10) != 0) {
            local_18 = uVar12 & 0xffffffef;
            String_Destructor((int)local_54,uVar11);
          }
          (**(code **)(*param_1 + 0x100))(0x20,puVar5);
        }
        *(undefined1 *)((int)param_1 + 0xb3d) = 0;
      }
    }
  }
  if ((char)param_1[0x19d] != '\0') goto LAB_00404c63;
  iVar8 = (**(code **)(*param_1 + 0xfc))(0x20);
  if (iVar8 != 0) goto LAB_00404c63;
  local_58 = 0xf;
  local_6c = local_6c & 0xffffff00;
  local_8 = 0x13;
  local_5c = iVar8;
  Level_InitializeDictastroika(local_38,"MaxTime");
  local_8._0_1_ = 0x14;
  local_1c = (void *)HTTP_SetUserAgent(param_1,local_38,0x3c);
  local_8._0_1_ = 0x13;
  if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_01,local_34);
  }
  Level_InitializeDictastroika(local_38,"MaxPlays");
  local_8._0_1_ = 0x15;
  iVar8 = HTTP_SetUserAgent(param_1,local_38,0);
  local_8._0_1_ = 0x13;
  if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_34,extraout_EDX_09);
  }
  Level_InitializeDictastroika(local_38,"MaxExecutions");
  local_8._0_1_ = 0x16;
  iVar9 = HTTP_SetUserAgent(param_1,local_38,0);
  local_8._0_1_ = 0x13;
  uVar1 = (undefined1)local_8;
  local_8._0_1_ = 0x13;
  if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_02,extraout_EDX_10);
  }
  if ((int)local_1c < 1) {
    local_8._0_1_ = uVar1;
    if (iVar8 < 1) {
      if (0 < iVar9) {
        if (iVar9 != param_1[0x19f]) {
          uVar13 = Sound_SetPosition(local_8c,"You have %d free plays remaining!");
          local_8._0_1_ = 0x19;
          goto LAB_00404b61;
        }
        Background_UpdateParallaxLayers(local_70,(_String_base *)"You have 1 free play remaining!");
      }
    }
    else {
      if (iVar8 - param_1[0x19e] != 1) {
        uVar13 = Sound_SetPosition(local_8c,"You have %d free plays remaining!");
        local_8._0_1_ = 0x18;
        goto LAB_00404b61;
      }
      Background_UpdateParallaxLayers(local_70,(_String_base *)"You have 1 free play remaining!");
    }
  }
  else if ((int)local_1c - param_1[0x19e] == 1) {
    Background_UpdateParallaxLayers
              (local_70,(_String_base *)"You have 1 minute remaining in this trial!");
  }
  else {
    uVar13 = Sound_SetPosition(local_8c,"You have %d minutes remaining in this trial!");
    local_8._0_1_ = 0x17;
LAB_00404b61:
    PowerUp_ProcessThunderstrike
              (local_70,(uint)((ulonglong)uVar13 >> 0x20),(_String_base *)uVar13,0,0xffffffff);
    local_8._0_1_ = 0x13;
    String_Destructor((int)local_8c,extraout_EDX_11);
  }
  pcVar2 = "  Do you want to register now to get the full unlocked version?";
  do {
    pcVar10 = pcVar2;
    pcVar2 = pcVar10 + 1;
  } while (*pcVar10 != '\0');
  Enemy_ProcessSatelliteLogic
            (local_70,(_String_base *)
                      "  Do you want to register now to get the full unlocked version?",
             (uint)(pcVar10 + -0x52a1b8));
  pvVar4 = operator_new(0x124);
  local_8._0_1_ = 0x1a;
  local_1c = pvVar4;
  if (pvVar4 == (void *)0x0) {
    puVar5 = (undefined4 *)0x0;
    uVar11 = extraout_EDX_12;
  }
  else {
    Level_InitializeDictastroika(local_a8,"REGISTER NOW?");
    local_18 = local_18 | 0x100;
    local_8 = CONCAT31(local_8._1_3_,0x1b);
    if (param_1[0x252] == 0) {
      uVar11 = 0;
    }
    else {
      uVar11 = param_1[0x252] + 0x58;
    }
    puVar5 = Dialog_YesNoConstructor
                       (pvVar4,(int)param_1,uVar11,local_a8,(uint)local_70,0x168,0xf0,0x2e,0x36);
    uVar11 = extraout_EDX_13;
  }
  local_8 = 0x13;
  if ((local_18 & 0x100) != 0) {
    String_Destructor((int)local_a8,uVar11);
  }
  (**(code **)(*param_1 + 0x100))(0x20,puVar5);
  local_8 = 0xffffffff;
  if (0xf < local_58) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_6c,extraout_EDX_14);
  }
  local_58 = 0xf;
  local_5c = 0;
  local_6c = local_6c & 0xffffff00;
LAB_00404c63:
  PowerUp_ProcessSpreadShot(param_1[0x252]);
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_ffffff3c,in_stack_ffffff40);
  return;
}


