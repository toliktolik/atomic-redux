/*
 * Function: Threading_ReleaseMutex
 * Address: 004fd486
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x004fd520) overlaps instruction at (ram,0x004fd51f)
    */
/* WARNING: Removing unreachable block (ram,0x004fd4c1) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

float10 __fastcall Threading_ReleaseMutex(int param_1,undefined4 param_2)

{
  int *piVar1;
  undefined4 uVar2;
  undefined4 *puVar3;
  code *pcVar4;
  undefined1 uVar5;
  char cVar6;
  uint uVar8;
  undefined4 in_EAX;
  uint uVar10;
  undefined3 uVar11;
  int extraout_EDX;
  int iVar12;
  int unaff_EBX;
  undefined4 **ppuVar13;
  undefined4 **ppuVar14;
  int unaff_ESI;
  undefined4 *unaff_EDI;
  undefined2 in_FS;
  bool bVar15;
  byte in_AF;
  bool bVar16;
  byte in_TF;
  byte in_IF;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  undefined4 *puVar17;
  float10 fVar18;
  float10 in_ST0;
  float10 in_ST4;
  undefined4 *apuStack_14 [3];
  byte bVar7;
  int iVar9;
  
  uVar5 = in((short)param_2);
  uVar10 = CONCAT31((int3)((uint)in_EAX >> 8),uVar5) & 0x8d598058;
  bVar7 = (byte)uVar10;
  bVar15 = bVar7 < 0xde;
  uVar11 = (undefined3)(uVar10 >> 8);
  cVar6 = bVar7 + 0x22;
  bVar16 = cVar6 == '\0';
  puVar17 = (undefined4 *)
            ((uint)(in_NT & 1) * 0x4000 | (uint)SBORROW1(bVar7,-0x22) * 0x800 |
             (uint)(in_IF & 1) * 0x200 | (uint)(in_TF & 1) * 0x100 | (uint)(cVar6 < '\0') * 0x80 |
             (uint)bVar16 * 0x40 | (uint)(in_AF & 1) * 0x10 |
             (uint)((POPCOUNT(cVar6) & 1U) == 0) * 4 | (uint)bVar15 | (uint)(in_ID & 1) * 0x200000 |
             (uint)(in_VIP & 1) * 0x100000 | (uint)(in_VIF & 1) * 0x80000 |
            (uint)(in_AC & 1) * 0x40000);
  if (bVar15 || bVar16) {
    if ((char)bVar7 < -0x22) {
      LOCK();
      *(char *)((int)unaff_EDI + -0x211a6d9b) = (char)((uint)unaff_EBX >> 8);
      UNLOCK();
      ppuVar14 = (undefined4 **)puVar17;
      if (bVar16) {
        bVar7 = 9 < (-bVar15 & 0xfU) | in_AF;
        uVar8 = CONCAT31(uVar11,-bVar15 + bVar7 * '\x06') & 0xffffff0f;
        iVar9 = CONCAT22((short)(uVar8 >> 0x10),CONCAT11((char)(uVar10 >> 8) + bVar7,(char)uVar8));
        piVar1 = (int *)(iVar9 + -0x3c);
        *piVar1 = *piVar1 - iVar9;
        ppuVar13 = apuStack_14 + 1;
        ppuVar14 = apuStack_14 + 1;
        cVar6 = '\x16';
        puVar3 = puVar17;
        do {
          puVar3 = puVar3 + -1;
          ppuVar13 = ppuVar13 + -1;
          *ppuVar13 = (undefined4 *)*puVar3;
          cVar6 = cVar6 + -1;
        } while ('\0' < cVar6);
        apuStack_14[1] = puVar17;
        if (CONCAT22((short)((uint)param_1 >> 0x10),CONCAT11(0xdf,(char)param_1)) == 0) {
          pcVar4 = (code *)swi(1);
          fVar18 = (float10)(*pcVar4)();
          return fVar18;
        }
        *(char *)(unaff_ESI + 0x18) = *(char *)(unaff_ESI + 0x18) + '\x16';
        *(char *)(unaff_EDI + 0x17e26560) = *(char *)(unaff_EDI + 0x17e26560) + '\x01';
      }
      pcVar4 = (code *)swi(0x7b);
      (*pcVar4)(ppuVar14);
      *(undefined2 *)(extraout_EDX + -0x7a60bf46) = in_FS;
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    if (!SBORROW1(bVar7,-0x22)) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    iVar12 = CONCAT31((int3)((uint)param_2 >> 8),0xf);
    uVar2 = in((short)iVar12);
    *unaff_EDI = uVar2;
    *(byte *)(param_1 + 0x60) = *(byte *)(param_1 + 0x60) & (byte)((uint)param_1 >> 8);
    LOCK();
    piVar1 = (int *)(unaff_EBX + -0x57 + iVar12);
    iVar9 = *piVar1;
    *piVar1 = (int)puVar17;
    UNLOCK();
    uVar5 = in((short)iVar12);
    *(undefined1 *)(unaff_EDI + 1) = uVar5;
    unaff_ESI = CONCAT31(uVar11,cVar6);
    if (iVar12 != 0 || iVar9 != 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
  }
  else {
    in(0x13);
    _DAT_ab3ad67c = _DAT_ab3ad67c << 1 | (uint)bVar15;
    if (cVar6 < '\0') {
      pcVar4 = (code *)swi(1);
      fVar18 = (float10)(*pcVar4)();
      return fVar18;
    }
  }
  out(0x90,(char)unaff_ESI);
  return in_ST4 - in_ST0;
}


