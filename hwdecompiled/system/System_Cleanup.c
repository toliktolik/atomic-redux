/*
 * Function: System_Cleanup
 * Address: 004d7bf0
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl System_Cleanup(int *param_1,char param_2)

{
  int iVar1;
  int *piVar2;
  undefined4 uVar3;
  int iVar4;
  int iVar5;
  undefined4 *puVar6;
  bool bVar7;
  int local_10;
  undefined4 *local_8;
  
  piVar2 = param_1;
  iVar1 = param_1[0x57];
  *(char *)(iVar1 + 0xc) = param_2;
  *(int **)(iVar1 + 0x20) = param_1;
  bVar7 = param_1[0x4b] == 0;
  if (param_1[0x4d] == 0) {
    if (bVar7) {
      *(code **)(iVar1 + 4) = Directory_CreatePath;
    }
    else {
      *(code **)(iVar1 + 4) = Time_GetCurrentTime;
    }
  }
  else if (bVar7) {
    *(code **)(iVar1 + 4) = Time_GetSystemUptime;
  }
  else {
    *(code **)(iVar1 + 4) = Time_Sleep;
    if (*(int *)(iVar1 + 0x40) == 0) {
      uVar3 = (**(code **)param_1[1])(param_1,1,1000);
      *(undefined4 *)(iVar1 + 0x40) = uVar3;
    }
  }
  if (param_2 == '\0') {
    *(code **)(iVar1 + 8) = Utility_FinalFunction;
  }
  else {
    *(code **)(iVar1 + 8) = Utility_LastFunction;
  }
  local_10 = 0;
  if (0 < param_1[0x39]) {
    local_8 = (undefined4 *)(iVar1 + 0x24);
    param_1 = param_1 + 0x3a;
    do {
      iVar5 = *param_1;
      *local_8 = 0;
      if (bVar7) {
        if (piVar2[0x4d] == 0) {
          iVar5 = *(int *)(iVar5 + 0x14);
          goto LAB_004d7cc4;
        }
      }
      else {
        iVar5 = *(int *)(iVar5 + 0x18);
        *(int *)(iVar1 + 0x34) = iVar5;
LAB_004d7cc4:
        if (param_2 == '\0') {
          String_Replace(piVar2,bVar7,iVar5,(int *)(iVar1 + 0x4c + iVar5 * 4));
        }
        else {
          if ((iVar5 < 0) || (3 < iVar5)) {
            *(undefined4 *)(*piVar2 + 0x14) = 0x32;
            *(int *)(*piVar2 + 0x18) = iVar5;
            (**(code **)*piVar2)(piVar2);
          }
          if (*(int *)(iVar1 + 0x5c + iVar5 * 4) == 0) {
            uVar3 = (**(code **)piVar2[1])(piVar2,1,0x404);
            *(undefined4 *)(iVar1 + 0x5c + iVar5 * 4) = uVar3;
          }
          puVar6 = *(undefined4 **)(iVar1 + 0x5c + iVar5 * 4);
          for (iVar4 = 0x101; iVar4 != 0; iVar4 = iVar4 + -1) {
            *puVar6 = 0;
            puVar6 = puVar6 + 1;
          }
        }
      }
      param_1 = param_1 + 1;
      local_8 = local_8 + 1;
      local_10 = local_10 + 1;
    } while (local_10 < piVar2[0x39]);
  }
  *(undefined4 *)(iVar1 + 0x38) = 0;
  *(undefined4 *)(iVar1 + 0x3c) = 0;
  *(undefined4 *)(iVar1 + 0x18) = 0;
  *(undefined4 *)(iVar1 + 0x1c) = 0;
  iVar5 = piVar2[0x2f];
  *(undefined4 *)(iVar1 + 0x48) = 0;
  *(int *)(iVar1 + 0x44) = iVar5;
  return;
}


