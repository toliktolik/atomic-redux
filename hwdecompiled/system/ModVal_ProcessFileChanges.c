/*
 * Function: ModVal_ProcessFileChanges
 * Address: 004adaa0
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall ModVal_ProcessFileChanges(undefined4 param_1,undefined4 param_2)

{
  _String_base _Var1;
  int *piVar2;
  char *pcVar3;
  byte bVar4;
  _String_base *p_Var5;
  undefined4 ****ppppuVar6;
  int iVar7;
  char *pcVar8;
  int extraout_ECX;
  int *extraout_ECX_00;
  int *extraout_ECX_01;
  int *extraout_ECX_02;
  undefined4 extraout_ECX_03;
  int *extraout_ECX_04;
  int *extraout_ECX_05;
  int *piVar9;
  int extraout_ECX_06;
  int extraout_ECX_07;
  int extraout_ECX_08;
  int extraout_ECX_09;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint uVar10;
  uint extraout_EDX_04;
  int iVar11;
  undefined8 uVar12;
  uint unaff_retaddr;
  char cVar13;
  undefined4 *in_stack_fffffc38;
  undefined4 *in_stack_fffffc3c;
  _String_base local_1c8 [96];
  int local_168;
  byte abStack_164 [100];
  int local_100;
  undefined **local_fc [13];
  undefined1 local_c8 [4];
  uint local_c4;
  undefined4 local_b4;
  uint local_b0;
  _String_base local_ac [4];
  uint local_a8;
  undefined4 local_98;
  uint local_94;
  undefined1 local_90 [4];
  uint local_8c;
  undefined4 local_7c;
  uint local_78;
  char local_74;
  undefined4 local_73;
  undefined4 local_6f;
  undefined1 local_6b;
  undefined1 local_68 [4];
  uint local_64;
  int local_54;
  uint local_50;
  undefined4 local_4c;
  undefined4 local_48;
  int local_44;
  int *local_40;
  _String_base local_3c [4];
  undefined4 ***local_38 [4];
  undefined4 local_28;
  uint local_24;
  int local_20;
  int *local_1c;
  char local_15;
  uint local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  uVar12 = CONCAT44(param_2,DAT_005a3868);
  local_8 = 0xffffffff;
  uStack_c = 0x5166bc;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  DAT_005a3864 = 0;
  ExceptionList = &local_10;
  if (DAT_005a3868 == 0) {
    ExceptionList = &local_10;
    GetModuleFileNameA((HMODULE)0x0,(LPSTR)local_1c8,0x100);
    p_Var5 = local_1c8;
    local_24 = 0xf;
    local_28 = 0;
    local_38[0] = (undefined4 ***)((uint)local_38[0] & 0xffffff00);
    do {
      _Var1 = *p_Var5;
      p_Var5 = p_Var5 + 1;
    } while (_Var1 != (_String_base)0x0);
    String_Assign(local_3c,local_1c8,(int)p_Var5 - (int)(local_1c8 + 1));
    uVar12 = Vector_IsPerpendicular((int)local_3c);
    DAT_005a3868 = (int)uVar12;
    if (0xf < local_24) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,(uint)((ulonglong)uVar12 >> 0x20));
    }
  }
  DAT_005a3868 = (int)uVar12;
  local_15 = '\0';
  local_50 = 0xf;
  local_54 = 0;
  local_64 = local_64 & 0xffffff00;
  local_40 = (int *)*DAT_005a388c;
  local_8._1_3_ = 0;
  if (local_40 == DAT_005a388c) {
LAB_004ade66:
    local_8._0_1_ = 0;
    pcVar3 = "none";
    do {
      pcVar8 = pcVar3;
      pcVar3 = pcVar8 + 1;
    } while (*pcVar8 != '\0');
    String_Assign(local_68,(_String_base *)&DAT_00535a98,(uint)(pcVar8 + -0x535a98));
  }
  else {
    do {
      uVar10 = (uint)((ulonglong)uVar12 >> 0x20);
      DAT_005a3868 = (int)uVar12;
      local_8._0_1_ = 0;
      piVar9 = local_40 + 0xd;
      iVar11 = 10;
      do {
        if (*piVar9 != 0) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(0,uVar10);
        }
        *piVar9 = 0;
        piVar9[1] = 0;
        piVar9[2] = 0;
        piVar9 = piVar9 + 4;
        iVar11 = iVar11 + -1;
      } while (iVar11 != 0);
      *(undefined1 *)(local_40 + 0xb) = 1;
      local_24 = 0xf;
      local_28 = 0;
      local_38[0] = (undefined4 ***)((uint)local_38[0] & 0xffffff00);
      PowerUp_ProcessThunderstrike(local_3c,uVar10,(_String_base *)(local_40 + 3),0,0xffffffff);
      local_8 = CONCAT31(local_8._1_3_,1);
      iVar11 = Vector_IsPerpendicular((int)local_3c);
      if (DAT_005a3868 < iVar11) {
        local_15 = '\x01';
        DAT_005a3868 = iVar11;
      }
      if (local_54 != 0) {
        pcVar3 = "\r\n  ";
        do {
          pcVar8 = pcVar3;
          pcVar3 = pcVar8 + 1;
        } while (*pcVar8 != '\0');
        Enemy_ProcessSatelliteLogic
                  (local_68,(_String_base *)&DAT_0053654c,(uint)(pcVar8 + -0x53654c));
      }
      Enemy_UpdateAI(local_68,(int)local_3c,0,0xffffffff);
      local_20 = 1;
      ppppuVar6 = (undefined4 ****)local_38[0];
      if (local_24 < 0x10) {
        ppppuVar6 = local_38;
      }
      STL_Iterator_ArrowOperator(&local_168,(int)ppppuVar6,1,1);
      local_8._0_1_ = 2;
      if (local_100 == 0) {
        local_78 = 0xf;
        local_7c = 0;
        local_8c = local_8c & 0xffffff00;
        pcVar3 = "ERROR: Unable to open ";
        do {
          pcVar8 = pcVar3;
          pcVar3 = pcVar8 + 1;
        } while (*pcVar8 != '\0');
        String_Assign(local_90,(_String_base *)"ERROR: Unable to open ",(uint)(pcVar8 + -0x5363f0));
        local_8._0_1_ = 3;
        p_Var5 = Background_ProcessBackgroundLayer
                           (local_3c,(uint)local_90,local_ac,(_String_base *)local_90,(int)local_3c)
        ;
        local_8._0_1_ = 4;
        p_Var5 = Intel_DisplayPopulationData
                           (local_c8,extraout_EDX_01,(_String_base *)local_c8,p_Var5,
                            (_String_base *)" for reparsing.");
        if (*(uint *)(p_Var5 + 0x18) < 0x10) {
          p_Var5 = p_Var5 + 4;
        }
        else {
          p_Var5 = *(_String_base **)(p_Var5 + 4);
        }
        MessageBoxA((HWND)0x0,(LPCSTR)p_Var5,"MODVAL ERROR!",0x10);
        if (0xf < local_b0) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_07,local_c4);
        }
        local_b0 = 0xf;
        local_b4 = 0;
        local_c4 = local_c4 & 0xffffff00;
        if (0xf < local_94) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_07,extraout_EDX_02);
        }
        local_94 = 0xf;
        local_98 = 0;
        local_a8 = local_a8 & 0xffffff00;
        if (0xf < local_78) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(local_8c,extraout_EDX_02);
        }
        local_8._0_1_ = 1;
        STL_String_FindLastNotOf((int)local_fc);
        local_fc[0] = &PTR_IOSBase_DestructorWrapper_00531324;
        IOStream_RefCountDestructor((ios_base *)local_fc);
        iVar11 = extraout_ECX_08;
        uVar10 = extraout_EDX_03;
        if (0xf < local_24) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_08,(uint)local_38[0]);
        }
LAB_004ae09e:
        local_24 = 0xf;
        local_28 = 0;
        local_38[0] = (undefined4 ***)((uint)local_38[0] & 0xffffff00);
        if (0xf < local_50) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(iVar11,uVar10);
        }
        goto LAB_004ae12f;
      }
      iVar11 = *(int *)(local_168 + 4);
      bVar4 = abStack_164[iVar11];
      while ((bVar4 & 1) == 0) {
        local_73 = 0;
        local_6f = 0;
        local_6b = 0;
        local_74 = '\0';
        bVar4 = Collision_RectIntersect(abStack_164 + iVar11 + -4,10);
        Array_GetElement(&local_168,&stack0xfffffc38,0x200,bVar4);
        local_1c = (int *)0x0;
        cVar13 = (char)in_stack_fffffc38;
        piVar9 = extraout_ECX_00;
        piVar2 = local_1c;
        while (local_1c = piVar2, cVar13 != '\0') {
          if (cVar13 == '(') {
            if ((((int)piVar2 < 2) || ((&stack0xfffffc37)[(int)piVar2] != 'M')) ||
               (iVar11 = Security_AntiDebugCheck(piVar9), piVar9 = extraout_ECX_01, iVar11 != 0)) {
              if (((((int)piVar2 < 3) ||
                   (cVar13 = (&stack0xfffffc37)[(int)local_1c], piVar9 = local_1c, cVar13 < '1')) ||
                  (('9' < cVar13 ||
                   (((&stack0xfffffc36)[(int)local_1c] != 'M' ||
                    (iVar11 = Security_AntiDebugCheck
                                        ((int *)(uint)(byte)(&stack0xfffffc35)[(int)local_1c]),
                    piVar9 = extraout_ECX_02, iVar11 != 0)))))) ||
                 (iVar11 = cVar13 + -0x30, iVar11 == -1)) goto LAB_004addb5;
            }
            else {
              iVar11 = 0;
            }
            local_44 = 0;
            local_4c = 0;
            local_48 = 0;
            iVar7 = Level_InitializeKillingrad(piVar9,&local_44);
            if (((char)iVar7 != '\0') ||
               (iVar7 = Level_InitializeRedStarHQ(extraout_ECX_03,(double *)&local_4c),
               piVar9 = extraout_ECX_04, (char)iVar7 != '\0')) {
              if ((&local_74)[iVar11] != '\0') {
                Exception_Release(&stack0xfffffc38,
                                  "ERROR in %s on line %d: If you want to use more than one M() value per line, you must use the numbered macros (ie: M1(), M2(), M3(), etc), using each one a maximum of once per line.  Alternatively, you may split up your statement into multiple lines."
                                 );
                MessageBoxA((HWND)0x0,&stack0xfffffc38,"MODVAL ERROR",0x10);
                local_8._0_1_ = 1;
                STL_String_FindLastNotOf((int)local_fc);
                local_fc[0] = &PTR_IOSBase_DestructorWrapper_00531324;
                IOStream_RefCountDestructor((ios_base *)local_fc);
                iVar11 = extraout_ECX_06;
                uVar10 = extraout_EDX_00;
                if (0xf < local_24) {
                    /* WARNING: Subroutine does not return */
                  System_ShutdownHandler(extraout_ECX_06,(uint)local_38[0]);
                }
                goto LAB_004ae09e;
              }
              Memory_InstallHook((char *)local_40[10],iVar11,local_44,local_4c,local_48);
              (&local_74)[iVar11] = '\x01';
              piVar9 = extraout_ECX_05;
            }
          }
LAB_004addb5:
          local_1c = (int *)((int)local_1c + 1);
          piVar2 = local_1c;
          cVar13 = (&stack0xfffffc38)[(int)local_1c];
        }
        iVar11 = *(int *)(local_168 + 4);
        local_20 = local_20 + 1;
        bVar4 = abStack_164[iVar11];
      }
      Vector_Length((int *)&local_40);
      local_8._0_1_ = 1;
      STL_String_FindLastNotOf((int)local_fc);
      local_fc[0] = &PTR_IOSBase_DestructorWrapper_00531324;
      IOStream_RefCountDestructor((ios_base *)local_fc);
      uVar12 = CONCAT44(extraout_EDX,DAT_005a3868);
      local_8._0_1_ = 0;
      if (0xf < local_24) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler((int)local_38[0],extraout_EDX);
      }
      local_24 = 0xf;
      local_28 = 0;
      local_38[0] = (undefined4 ***)((uint)local_38[0] & 0xffffff00);
    } while (local_40 != DAT_005a388c);
    if (local_15 != '\0') {
      if (0xf < local_50) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(local_64,extraout_EDX);
      }
      goto LAB_004ae12f;
    }
    if (local_54 == 0) goto LAB_004ade66;
  }
  local_78 = 0xf;
  local_7c = 0;
  local_8c = local_8c & 0xffffff00;
  pcVar3 = "WARNING: No file changes detected.  Files parsed: \r\n  ";
  do {
    pcVar8 = pcVar3;
    pcVar3 = pcVar8 + 1;
  } while (*pcVar8 != '\0');
  String_Assign(local_90,(_String_base *)"WARNING: No file changes detected.  Files parsed: \r\n  ",
                (uint)(pcVar8 + -0x536514));
  local_8._0_1_ = 5;
  p_Var5 = Background_ProcessBackgroundLayer
                     (local_68,(uint)local_90,local_ac,(_String_base *)local_90,(int)local_68);
  if (*(uint *)(p_Var5 + 0x18) < 0x10) {
    p_Var5 = p_Var5 + 4;
  }
  else {
    p_Var5 = *(_String_base **)(p_Var5 + 4);
  }
  MessageBoxA((HWND)0x0,(LPCSTR)p_Var5,"MODVAL WARNING!",0x30);
  if (0xf < local_94) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_a8,extraout_EDX_04);
  }
  local_94 = 0xf;
  local_98 = 0;
  local_a8 = local_a8 & 0xffffff00;
  if (0xf < local_78) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_09,local_8c);
  }
  if (0xf < local_50) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_09,extraout_EDX_04);
  }
LAB_004ae12f:
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_fffffc38,in_stack_fffffc3c);
  return;
}


