/*
 * Function: System_ShutdownHandler
 * Address: 004fdb46
 * Category: system
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x004fdb34) overlaps instruction at (ram,0x004fdb33)
    */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall System_ShutdownHandler(int param_1,uint param_2)

{
  ushort *puVar1;
  char *pcVar2;
  uint uVar3;
  short sVar4;
  undefined1 uVar5;
  byte bVar6;
  char cVar7;
  undefined4 *puVar9;
  undefined3 uVar11;
  uint in_EAX;
  undefined4 *puVar10;
  byte bVar13;
  undefined4 extraout_ECX;
  int iVar12;
  int unaff_EBX;
  uint unaff_EBP;
  undefined4 *unaff_ESI;
  char *unaff_EDI;
  undefined2 in_ES;
  byte bVar14;
  byte in_AF;
  bool bVar15;
  float10 extraout_ST0;
  float10 in_ST0;
  float10 extraout_ST1;
  float10 fVar16;
  float10 in_ST1;
  float10 fVar17;
  float10 in_ST2;
  float10 fVar18;
  float10 in_ST3;
  float10 fVar19;
  float10 in_ST4;
  float10 fVar20;
  float10 in_ST5;
  float10 fVar21;
  float10 in_ST6;
  float10 fVar22;
  float10 in_ST7;
  undefined8 uVar23;
  undefined4 unaff_retaddr;
  undefined4 uStack_4;
  double *pdVar8;
  
  iVar12 = param_1 + 1;
  puVar10 = (undefined4 *)CONCAT31((int3)(in_EAX >> 8),*(undefined1 *)(unaff_EBX + (in_EAX & 0xff)))
  ;
  do {
    if (iVar12 != 0) {
      return;
    }
    bVar6 = (byte)puVar10;
    uVar11 = (undefined3)((uint)puVar10 >> 8);
    fVar22 = in_ST7;
    if (SBORROW1(bVar6,*unaff_EDI)) {
      uVar5 = in((short)param_2);
      unaff_EBX = unaff_EBX + 1;
      _DAT_ae2e1365 = puVar10;
      *(longlong *)(param_2 - 0x7f) = (longlong)ROUND(in_ST0);
      bVar15 = (CONCAT31(uVar11,uVar5) | 0x85c507f0) == 0;
      in_AF = 9 < ((byte)unaff_retaddr & 0xf) | in_AF;
      bVar6 = (byte)unaff_retaddr + in_AF * '\x06';
      bVar14 = 0x90 < (bVar6 & 0xf0) | in_AF * (0xf9 < bVar6);
      puVar9 = (undefined4 *)CONCAT31((int3)((uint)unaff_retaddr >> 8),bVar6 + bVar14 * '`');
      iVar12 = -1;
      if (bVar15) {
        uVar23 = func_0xc9ead6cd();
        param_2 = (uint)((ulonglong)uVar23 >> 0x20);
        cVar7 = (char)uVar23 + '\x03';
        pdVar8 = (double *)CONCAT31((int3)((ulonglong)uVar23 >> 8),cVar7);
        *(undefined4 *)unaff_EDI = *unaff_ESI;
        unaff_retaddr = 0xffffffd0;
        in_ST1 = extraout_ST0 / (float10)*pdVar8;
        if ((char)uVar23 < -3) {
          pdVar8 = (double *)
                   CONCAT22((short)((ulonglong)uVar23 >> 0x10),
                            (ushort)(byte)(cVar7 + (char)((ulonglong)uVar23 >> 8) * '\x1e'));
        }
        pcVar2 = (char *)(unaff_ESI + 2);
        out(unaff_ESI[1],(short)((ulonglong)uVar23 >> 0x20));
        bVar13 = (byte)((uint)extraout_ECX >> 8);
        bVar14 = bVar13 < *(byte *)(unaff_EBP + 0x2b6d898a);
        bVar6 = *(byte *)(unaff_EBP + 0x2b6d898a);
        uStack_4 = 0xd6f97434;
        puVar1 = (ushort *)(unaff_EBP + 0x1e + param_2 * 8);
        sVar4 = ((ushort)pdVar8 & 3) - (*puVar1 & 3);
        bVar15 = 0 < sVar4;
        *puVar1 = *puVar1 + (ushort)bVar14 * sVar4;
        out(0x94,pdVar8);
        out(0x9d,(char)pdVar8);
        puVar9 = (undefined4 *)(int)(short)(ushort)pdVar8;
        unaff_ESI = (undefined4 *)((int)unaff_ESI + 9);
        unaff_EDI[4] = *pcVar2;
        in_ES = (undefined2)((uint6)*(undefined6 *)(unaff_EBP + 0x1de39d3f) >> 0x20);
        unaff_EDI = (char *)*(undefined6 *)(unaff_EBP + 0x1de39d3f);
        iVar12 = CONCAT22((short)((uint)extraout_ECX >> 0x10),
                          CONCAT11(bVar13 - bVar6,(char)extraout_ECX)) + -1;
        in_ST2 = extraout_ST1;
        if (iVar12 == 0 || bVar15) {
                    /* WARNING: Bad instruction - Truncating control flow here */
          halt_baddata();
        }
      }
      puVar10 = puVar9;
      in_ST0 = in_ST1;
      fVar16 = in_ST2;
      fVar17 = in_ST3;
      fVar18 = in_ST4;
      fVar19 = in_ST5;
      fVar20 = in_ST6;
      fVar21 = in_ST7;
      if (iVar12 != 0) goto code_r0x004fdb36;
    }
    else {
      bVar14 = 0x1c < bVar6;
      puVar9 = (undefined4 *)CONCAT31(uVar11,bVar6 - 0x1d);
      bVar15 = (byte)(bVar6 - 0x1d) == '\0';
      uStack_4 = CONCAT22(uStack_4._2_2_,in_ES);
      iVar12 = 0;
      fVar16 = in_ST1;
      fVar17 = in_ST2;
      fVar18 = in_ST3;
      fVar19 = in_ST4;
      fVar20 = in_ST5;
      fVar21 = in_ST6;
code_r0x004fdb36:
      if (!bVar15) {
        return;
      }
      bVar15 = unaff_EBP < param_2;
      uVar3 = unaff_EBP - param_2;
      unaff_EBP = uVar3 - bVar14;
      *(int *)(unaff_EBX + 0x62) =
           (*(int *)(unaff_EBX + 0x62) - unaff_EBP) - (uint)(bVar15 || uVar3 < bVar14);
      puVar10 = &uStack_4;
      unaff_ESI = puVar9;
      in_ST1 = in_ST0;
      in_ST2 = fVar16;
      in_ST3 = fVar17;
      in_ST4 = fVar18;
      in_ST5 = fVar19;
      in_ST6 = fVar20;
      in_ST7 = fVar21;
    }
    LOCK();
    uVar5 = *(undefined1 *)(iVar12 + -0x28be7347);
    *(undefined1 *)(iVar12 + -0x28be7347) = (char)((uint)iVar12 >> 8);
    iVar12 = CONCAT22((short)((uint)iVar12 >> 0x10),CONCAT11(uVar5,(char)iVar12));
    UNLOCK();
    in_ST0 = in_ST1;
    in_ST1 = in_ST2;
    in_ST2 = in_ST3;
    in_ST3 = in_ST4;
    in_ST4 = in_ST5;
    in_ST5 = in_ST6;
    in_ST6 = in_ST7;
    in_ST7 = fVar22;
  } while( true );
}


