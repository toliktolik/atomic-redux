/*
 * Function: DirectX_SetDeviceState
 * Address: 0047c4c0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall DirectX_SetDeviceState(void *this,int *param_1,char param_2)

{
  int *piVar1;
  int iVar2;
  int iVar3;
  undefined4 *puVar4;
  bool bVar5;
  undefined1 local_1a8 [88];
  undefined4 local_150 [27];
  undefined4 local_e4 [25];
  int local_80;
  int local_78;
  int local_70 [3];
  undefined4 local_64;
  int local_60;
  int local_5c;
  int local_58;
  int local_54;
  int local_50;
  int local_4c;
  int local_48;
  undefined4 local_44;
  int local_40;
  int local_3c;
  tagPOINT local_38;
  int local_30;
  int local_2c;
  int local_28;
  int local_24;
  int local_20;
  int local_1c;
  int local_18;
  int local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x5146a6;
  local_10 = ExceptionList;
  if ((*(int *)((int)this + 0xccc) == 0) ||
     (piVar1 = *(int **)((int)this + 0x60), piVar1 == (int *)0x0)) {
    *(undefined1 *)((int)this + 0xcd0) = 0;
    return;
  }
  puVar4 = local_150;
  for (iVar2 = 0x1b; iVar2 != 0; iVar2 = iVar2 + -1) {
    *puVar4 = 0;
    puVar4 = puVar4 + 1;
  }
  local_150[0] = 0x6c;
  local_150[1] = 0x1006;
  ExceptionList = &local_10;
  (**(code **)(*piVar1 + 0x58))(piVar1,local_150);
  local_38.y = *(int *)((int)this + 0xcb8);
  local_64 = local_150[2];
  local_70[2] = local_150[3];
  iVar2 = *(int *)((int)this + 0xcc8) - local_38.y / 2;
  local_70[0] = 0;
  local_70[1] = 0;
  local_38.x = *(int *)((int)this + 0xcb4);
  local_40 = *(int *)((int)this + 0xcc4) - local_38.x / 2;
  local_44 = *(undefined4 *)((int)this + 0x70);
  local_48 = *(undefined4 *)((int)this + 0x6c);
  local_50 = 0;
  local_4c = 0;
  local_3c = iVar2;
  Collision_CalculateIntersection(&local_40,&local_20,&local_50);
  iVar2 = local_1c - iVar2;
  local_30 = local_20 - local_40;
  local_80 = local_30;
  if (param_2 != '\0') {
    local_38.x = 0;
    local_38.y = 0;
    ClientToScreen(*(HWND *)((int)this + 0xc94),&local_38);
    local_20 = local_20 + local_38.x;
    local_1c = local_1c + local_38.y;
  }
  local_48 = local_18 + local_30;
  local_24 = local_14 + iVar2;
  local_58 = local_18 + local_20;
  local_54 = local_14 + local_1c;
  puVar4 = local_e4;
  local_60 = local_20;
  local_5c = local_1c;
  local_28 = local_48;
  for (iVar3 = 0x19; iVar3 != 0; iVar3 = iVar3 + -1) {
    *puVar4 = 0;
    puVar4 = puVar4 + 1;
  }
  local_e4[0] = 100;
  local_2c = iVar2;
  iVar3 = (**(code **)(**(int **)((int)this + 0xcd4) + 0x14))
                    (*(int **)((int)this + 0xcd4),&local_30,param_1,&local_60,0x1000000,local_e4);
  bVar5 = iVar3 == 0;
  if (!bVar5) {
    local_50 = local_20;
    local_4c = local_1c;
    piVar1 = (int *)Collision_CalculateIntersection(&local_20,&local_40,local_70);
    local_5c = piVar1[1];
    local_60 = *piVar1;
    local_18 = piVar1[2];
    local_14 = piVar1[3];
    local_30 = local_80 + (local_60 - local_50);
    local_78 = local_18 + local_30;
    local_2c = (iVar2 - local_4c) + local_5c;
    local_24 = local_14 + local_2c;
    local_54 = local_14 + local_5c;
    local_58 = local_18 + local_60;
    local_28 = local_78;
    iVar2 = (**(code **)(**(int **)((int)this + 0xcd4) + 0x14))
                      (*(int **)((int)this + 0xcd4),&local_30,param_1,&local_60,0x1000000,local_e4);
    bVar5 = iVar2 == 0;
  }
  *(bool *)((int)this + 0xcd0) = bVar5;
  if ((param_1 == *(int **)((int)this + 0x68)) && (*(char *)((int)this + 0x38) == '\0')) {
    Graphics_InitializeSurface(local_1a8,*(undefined4 *)((int)this + 0xc9c));
    local_8 = 0;
    Graphics_DrawImage(local_1a8,*(int *)((int)this + 0xccc));
    ExceptionList = local_10;
    return;
  }
  (**(code **)(**(int **)((int)this + 0xcd8) + 0x14))
            (*(int **)((int)this + 0xcd8),&local_30,*(undefined4 *)((int)this + 0xcd4),&local_30,
             0x1000000,local_e4);
  Graphics_InitializeSurface(local_1a8,*(undefined4 *)((int)this + 0xce0));
  local_8 = 1;
  Graphics_DrawImage(local_1a8,*(int *)((int)this + 0xccc));
  (**(code **)(*param_1 + 0x14))
            (param_1,&local_60,*(undefined4 *)((int)this + 0xcd8),&local_30,0x1000000,local_e4);
  ExceptionList = local_10;
  return;
}


