/*
 * Function: DirectXRenderer_Initialize3DGraphics
 * Address: 00491930
 * Category: graphics
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 __thiscall DirectXRenderer_Initialize3DGraphics(void *this,HWND param_1,int *param_2)

{
  uint *puVar1;
  int *piVar2;
  undefined4 uVar3;
  byte bVar4;
  char *pcVar5;
  int *piVar6;
  char cVar7;
  undefined1 uVar8;
  int iVar9;
  uint uVar10;
  int *piVar11;
  char *pcVar12;
  byte bVar13;
  byte bVar14;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  uint extraout_EDX;
  uint extraout_EDX_00;
  undefined4 *puVar15;
  int iVar16;
  tagRECT local_124;
  undefined4 local_114 [2];
  undefined4 local_10c [21];
  int local_b8;
  uint local_b4;
  uint local_b0;
  uint local_ac;
  int local_a0 [5];
  undefined4 local_8c;
  undefined4 local_38;
  int *local_24;
  undefined1 local_20 [4];
  int *local_1c;
  undefined4 local_18;
  LPCRITICAL_SECTION local_14;
  void *local_10;
  undefined *puStack_c;
  uint local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_005150a6;
  local_10 = ExceptionList;
  local_14 = (LPCRITICAL_SECTION)((int)this + 0x3c);
  ExceptionList = &local_10;
  EnterCriticalSection(local_14);
  local_8 = 0;
  *(undefined1 *)((int)this + 0xc90) = 0;
  local_20[0] = param_2._3_1_;
  local_1c = (int *)Tree_UpdateHeight();
  *(undefined1 *)((int)local_1c + 0x11) = 1;
  local_1c[1] = (int)local_1c;
  *local_1c = (int)local_1c;
  local_1c[2] = (int)local_1c;
  local_18 = 0;
  piVar11 = (int *)**(int **)((int)this + 0xca4);
  local_8._0_1_ = 1;
  if (piVar11 != *(int **)((int)this + 0xca4)) {
    do {
      local_24 = (int *)piVar11[3];
      if (((local_24[0x13] != 0) || (*(char *)((int)local_24 + 0x53) != '\0')) ||
         ((char)local_24[0x15] != '\0')) {
        SexyWidget_CleanupTexture(local_24);
        D3D_ValidateTransform(local_20,local_114,(uint *)&local_24);
      }
      if (*(char *)((int)piVar11 + 0x11) == '\0') {
        piVar2 = (int *)piVar11[2];
        if (*(char *)((int)piVar2 + 0x11) == '\0') {
          cVar7 = *(char *)(*piVar2 + 0x11);
          piVar11 = piVar2;
          piVar2 = (int *)*piVar2;
          while (cVar7 == '\0') {
            cVar7 = *(char *)(*piVar2 + 0x11);
            piVar11 = piVar2;
            piVar2 = (int *)*piVar2;
          }
        }
        else {
          cVar7 = *(char *)(piVar11[1] + 0x11);
          piVar6 = (int *)piVar11[1];
          piVar2 = piVar11;
          while ((piVar11 = piVar6, cVar7 == '\0' && (piVar2 == (int *)piVar11[2]))) {
            cVar7 = *(char *)(piVar11[1] + 0x11);
            piVar6 = (int *)piVar11[1];
            piVar2 = piVar11;
          }
        }
      }
    } while (piVar11 != *(int **)((int)this + 0xca4));
  }
  FileIO_FindClose((int)this);
  if (DAT_0056e354 == (code *)0x0) {
    iVar9 = (*DAT_0056e350)(0,(int)this + 0x58,0);
  }
  else {
    iVar9 = (*DAT_0056e354)(0,(undefined4 *)((int)this + 0x5c),&DAT_00532f10);
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') {
      local_8 = (uint)local_8._1_3_ << 8;
      Memory_CompareBuffer(local_20,&param_2,(int *)*local_1c,local_1c);
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler((int)local_1c,extraout_EDX);
    }
    puVar15 = *(undefined4 **)((int)this + 0x5c);
    iVar9 = (**(code **)*puVar15)(puVar15,&DAT_00532f20,(int)this + 0x58);
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') {
      local_8 = (uint)local_8._1_3_ << 8;
      FileIO_FindFirstFile(local_20);
      LeaveCriticalSection(local_14);
      ExceptionList = local_10;
      return 2;
    }
  }
  puVar15 = (undefined4 *)((int)this + 0x58);
  uVar10 = FileIO_FindNextFile(this,param_1);
  if (((char)uVar10 != '\0') && (*(char *)(*(int *)((int)this + 0x34) + 0x82) != '\0')) {
    (**(code **)(**(int **)((int)this + 0x2c) + 0x128))();
  }
  GetClientRect(param_1,&local_124);
  *(HWND *)((int)this + 0xc94) = param_1;
  iVar16 = *(int *)((int)this + 0x2c);
  *(undefined4 *)((int)this + 0x6c) = *(undefined4 *)(iVar16 + 0x84);
  *(undefined4 *)((int)this + 0x70) = *(undefined4 *)(iVar16 + 0x88);
  uVar3 = *(undefined4 *)(iVar16 + 0x8c);
  *(char *)((int)this + 0xc98) = (char)param_2;
  *(undefined4 *)((int)this + 0x74) = uVar3;
  *(undefined1 *)((int)this + 0xcd0) = 0;
  cVar7 = System_JoinThread(this,iVar9);
  if (cVar7 != '\0') {
    local_8 = (uint)local_8._1_3_ << 8;
    Memory_CompareBuffer(local_20,&param_2,(int *)*local_1c,local_1c);
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX,extraout_EDX_00);
  }
  piVar11 = (int *)*puVar15;
  if ((char)param_2 == '\0') {
    iVar9 = (**(code **)(*piVar11 + 0x50))(piVar11,param_1,0x11);
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') {
      local_8 = (uint)local_8._1_3_ << 8;
      FileIO_FindFirstFile(local_20);
      LeaveCriticalSection(local_14);
      ExceptionList = local_10;
      return 4;
    }
    iVar9 = (**(code **)(*(int *)*puVar15 + 0x54))
                      ((int *)*puVar15,*(undefined4 *)((int)this + 0x6c),
                       *(undefined4 *)((int)this + 0x70),*(undefined4 *)((int)this + 0x74));
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') {
      local_8 = (uint)local_8._1_3_ << 8;
      FileIO_FindFirstFile(local_20);
      LeaveCriticalSection(local_14);
      ExceptionList = local_10;
      return 5;
    }
    piVar11 = local_a0;
    for (iVar9 = 0x1f; iVar9 != 0; iVar9 = iVar9 + -1) {
      *piVar11 = 0;
      piVar11 = piVar11 + 1;
    }
    local_a0[0] = 0x7c;
    local_a0[1] = 0x21;
    local_38 = 0x218;
    local_8c = 1;
    if (*(char *)((int)this + 0x38) != '\0') {
      local_38 = 0x2218;
    }
    iVar9 = SexyWidget_ApplyRotation(this,local_a0,(undefined4 *)((int)this + 0x60));
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') goto LAB_0049206c;
    piVar11 = *(int **)((int)this + 0x60);
    local_24 = (int *)0x4;
    iVar9 = (**(code **)(*piVar11 + 0x30))(piVar11,&local_24,(int)this + 100);
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') goto LAB_00492016;
    piVar11 = local_a0;
    for (iVar9 = 0x1f; iVar9 != 0; iVar9 = iVar9 + -1) {
      *piVar11 = 0;
      piVar11 = piVar11 + 1;
    }
    local_a0[0] = 0x7c;
    local_a0[1] = 7;
    local_38 = 0x840;
    if (*(char *)((int)this + 0x38) != '\0') {
      local_38 = 0x6040;
    }
    local_a0[3] = *(undefined4 *)((int)this + 0x6c);
    local_a0[2] = *(undefined4 *)((int)this + 0x70);
    iVar9 = SexyWidget_ApplyRotation(this,local_a0,(undefined4 *)((int)this + 0x68));
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') goto LAB_0049206c;
    iVar9 = (**(code **)(*(int *)*puVar15 + 0x10))((int *)*puVar15,0,&param_2,0);
  }
  else {
    (**(code **)(*piVar11 + 0x50))(piVar11,param_1,8);
    piVar11 = local_a0;
    for (iVar9 = 0x1f; iVar9 != 0; iVar9 = iVar9 + -1) {
      *piVar11 = 0;
      piVar11 = piVar11 + 1;
    }
    local_a0[0] = 0x7c;
    local_a0[1] = 1;
    local_38 = 0x200;
    if (*(char *)((int)this + 0x38) != '\0') {
      local_38 = 0x2200;
    }
    local_8c = 1;
    iVar9 = SexyWidget_ApplyRotation(this,local_a0,(undefined4 *)((int)this + 0x60));
    if (iVar9 == -0x7789ff6f) {
      local_8 = (uint)local_8._1_3_ << 8;
      FileIO_FindFirstFile(local_20);
      LeaveCriticalSection(local_14);
      ExceptionList = local_10;
      return 6;
    }
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') {
      local_8 = (uint)local_8._1_3_ << 8;
      FileIO_FindFirstFile(local_20);
      LeaveCriticalSection(local_14);
      ExceptionList = local_10;
      return 3;
    }
    piVar11 = local_a0;
    for (iVar9 = 0x1f; iVar9 != 0; iVar9 = iVar9 + -1) {
      *piVar11 = 0;
      piVar11 = piVar11 + 1;
    }
    local_a0[0] = 0x7c;
    local_a0[1] = 7;
    local_38 = 0x840;
    if (*(char *)((int)this + 0x38) != '\0') {
      local_38 = 0x6040;
    }
    local_a0[3] = *(undefined4 *)((int)this + 0x6c);
    local_a0[2] = *(undefined4 *)((int)this + 0x70);
    iVar9 = SexyWidget_ApplyRotation(this,local_a0,(undefined4 *)((int)this + 0x68));
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 != '\0') goto LAB_00492016;
    iVar9 = (**(code **)(*(int *)*puVar15 + 0x10))((int *)*puVar15,0,&param_2,0);
  }
  cVar7 = System_JoinThread(this,iVar9);
  if (cVar7 != '\0') {
    local_8 = (uint)local_8._1_3_ << 8;
    FileIO_FindFirstFile(local_20);
    LeaveCriticalSection(local_14);
    ExceptionList = local_10;
    return 1;
  }
  iVar9 = (**(code **)(*param_2 + 0x20))(param_2,0,param_1);
  if (-1 < iVar9) {
    (**(code **)(**(int **)((int)this + 0x60) + 0x70))(*(int **)((int)this + 0x60),param_2);
  }
  (**(code **)(*param_2 + 8))(param_2);
  puVar1 = (uint *)((int)this + 0x78);
  iVar9 = (**(code **)(*(int *)*puVar15 + 0x3c))((int *)*puVar15,puVar1);
  if ((iVar9 < 0) || (*puVar1 < 0x3c)) {
    *puVar1 = 0x3c;
  }
  if (*puVar1 < 0x3c) {
    *puVar1 = 0x3c;
  }
  else if (100 < *puVar1) {
    *puVar1 = 100;
  }
  *(int *)((int)this + 0x7c) = (int)(1000 / (ulonglong)*puVar1);
  piVar11 = local_a0;
  for (iVar9 = 0x1f; iVar9 != 0; iVar9 = iVar9 + -1) {
    *piVar11 = 0;
    piVar11 = piVar11 + 1;
  }
  local_a0[2] = *(undefined4 *)((int)this + 0xcb8);
  local_a0[3] = *(undefined4 *)((int)this + 0xcb4);
  local_a0[0] = 0x7c;
  local_a0[1] = 7;
  local_38 = 0x840;
  iVar9 = SexyWidget_ApplyRotation(this,local_a0,(undefined4 *)((int)this + 0xcd4));
  cVar7 = System_JoinThread(this,iVar9);
  if (cVar7 == '\0') {
    iVar9 = SexyWidget_ApplyRotation(this,local_a0,(undefined4 *)((int)this + 0xcd8));
    cVar7 = System_JoinThread(this,iVar9);
    if (cVar7 == '\0') {
      param_2 = (int *)operator_new(200);
      local_8._0_1_ = 2;
      if (param_2 == (int *)0x0) {
        piVar11 = (int *)0x0;
      }
      else {
        piVar11 = Game_UpdateParticles(param_2,(int)this);
      }
      *(int **)((int)this + 0xcdc) = piVar11;
      local_8._0_1_ = 1;
      (**(code **)(*piVar11 + 0xa4))(*(undefined4 *)((int)this + 0xcd4));
      (**(code **)(**(int **)((int)this + 0xcdc) + 0x68))(0,0);
      param_2 = (int *)operator_new(200);
      local_8._0_1_ = 3;
      if (param_2 == (int *)0x0) {
        piVar11 = (int *)0x0;
      }
      else {
        piVar11 = Game_UpdateParticles(param_2,(int)this);
      }
      *(int **)((int)this + 0xce0) = piVar11;
      local_8 = CONCAT31(local_8._1_3_,1);
      (**(code **)(*piVar11 + 0xa4))(*(undefined4 *)((int)this + 0xcd8));
      (**(code **)(**(int **)((int)this + 0xce0) + 0x68))(0,0);
      piVar11 = *(int **)((int)this + 0x60);
      if (piVar11 != (int *)0x0) {
        puVar15 = local_10c;
        for (iVar9 = 0x1b; iVar9 != 0; iVar9 = iVar9 + -1) {
          *puVar15 = 0;
          puVar15 = puVar15 + 1;
        }
        local_10c[0] = 0x6c;
        local_10c[1] = 0x1006;
        (**(code **)(*piVar11 + 0x58))(piVar11,local_10c);
        if ((local_b8 != 0x10) && (local_b8 != 0x20)) {
          local_8 = local_8 & 0xffffff00;
          FileIO_FindFirstFile(local_20);
          LeaveCriticalSection(local_14);
          ExceptionList = local_10;
          return 6;
        }
        *(int *)((int)this + 4) = local_b8;
        *(uint *)((int)this + 8) = local_b4;
        *(uint *)((int)this + 0xc) = local_b0;
        *(uint *)((int)this + 0x10) = local_ac;
        iVar9 = 0x20;
        do {
          bVar13 = (byte)iVar9;
          if ((local_b4 >> (bVar13 & 0x1f) & 1) != 0) {
            *(int *)((int)this + 0x20) = iVar9;
          }
          if ((local_b0 >> (bVar13 & 0x1f) & 1) != 0) {
            *(int *)((int)this + 0x24) = iVar9;
          }
          if ((local_ac >> (bVar13 & 0x1f) & 1) != 0) {
            *(int *)((int)this + 0x28) = iVar9;
          }
          iVar9 = iVar9 + -1;
        } while (-1 < iVar9);
        iVar9 = 2;
        param_2 = (int *)(*(int *)((int)this + 0x28) + 2);
        iVar16 = *(int *)((int)this + 0x24) + 2;
        uVar10 = *(int *)((int)this + 0x20) + 2;
        param_1 = (HWND)0x8;
        do {
          bVar13 = (byte)uVar10;
          if (((int)(uVar10 - 2) < 0x20) && (local_b4 >> (bVar13 - 2 & 0x1f) != 0)) {
            *(int *)((int)this + 0x14) = iVar9 + -1;
          }
          bVar14 = (byte)iVar16;
          if ((iVar16 + -2 < 0x20) && (local_b0 >> (bVar14 - 2 & 0x1f) != 0)) {
            *(int *)((int)this + 0x18) = iVar9 + -1;
          }
          bVar4 = (byte)param_2;
          if (((int)param_2 + -2 < 0x20) && (local_ac >> (bVar4 - 2 & 0x1f) != 0)) {
            *(int *)((int)this + 0x1c) = iVar9 + -1;
          }
          if (((int)(uVar10 - 1) < 0x20) && (local_b4 >> (bVar13 - 1 & 0x1f) != 0)) {
            *(int *)((int)this + 0x14) = iVar9;
          }
          if ((iVar16 + -1 < 0x20) && (local_b0 >> (bVar14 - 1 & 0x1f) != 0)) {
            *(int *)((int)this + 0x18) = iVar9;
          }
          if (((int)param_2 + -1 < 0x20) && (local_ac >> (bVar4 - 1 & 0x1f) != 0)) {
            *(int *)((int)this + 0x1c) = iVar9;
          }
          if (((int)uVar10 < 0x20) && (local_b4 >> (bVar13 & 0x1f) != 0)) {
            *(int *)((int)this + 0x14) = iVar9 + 1;
          }
          if ((iVar16 < 0x20) && (local_b0 >> (bVar14 & 0x1f) != 0)) {
            *(int *)((int)this + 0x18) = iVar9 + 1;
          }
          if (((int)param_2 < 0x20) && (local_ac >> (bVar4 & 0x1f) != 0)) {
            *(int *)((int)this + 0x1c) = iVar9 + 1;
          }
          if (((int)(uVar10 + 1) < 0x20) && (local_b4 >> ((byte)(uVar10 + 1) & 0x1f) != 0)) {
            *(int *)((int)this + 0x14) = iVar9 + 2;
          }
          if ((iVar16 + 1 < 0x20) && (local_b0 >> ((byte)(iVar16 + 1) & 0x1f) != 0)) {
            *(int *)((int)this + 0x18) = iVar9 + 2;
          }
          if (((int)param_2 + 1 < 0x20) && (local_ac >> ((byte)((int)param_2 + 1) & 0x1f) != 0)) {
            *(int *)((int)this + 0x1c) = iVar9 + 2;
          }
          param_2 = param_2 + 1;
          iVar9 = iVar9 + 4;
          uVar10 = uVar10 + 4;
          iVar16 = iVar16 + 4;
          param_1 = (HWND)((int)&param_1[-1].unused + 3);
        } while (param_1 != (HWND)0x0);
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(0,uVar10);
      }
      piVar11 = (int *)*local_1c;
      if (piVar11 != local_1c) {
        do {
          piVar2 = (int *)piVar11[3];
          param_2 = piVar2;
          Log_FlushBuffer((void *)((int)this + 0xca0),(int *)&param_1,(uint *)&param_2);
          if (param_1 != *(HWND *)((int)this + 0xca4)) {
            if (*(char *)((int)this + 0x38) == '\0') {
              if ((char)piVar2[0x15] == '\0') {
                if (*(char *)((int)piVar2 + 0x53) != '\0') {
                  Texture_ConvertAndUpload(piVar2);
                }
              }
              else {
                Graphics_SetTextureFilter(piVar2);
              }
            }
            else if (*(char *)((int)piVar2 + 0x55) != '\0') {
              uVar8 = (**(code **)(*piVar2 + 0x70))();
              *(undefined1 *)((int)piVar2 + 0x55) = uVar8;
            }
          }
          if (*(char *)((int)piVar11 + 0x11) == '\0') {
            piVar2 = (int *)piVar11[2];
            if (*(char *)((int)piVar2 + 0x11) == '\0') {
              cVar7 = *(char *)(*piVar2 + 0x11);
              piVar11 = piVar2;
              piVar2 = (int *)*piVar2;
              while (cVar7 == '\0') {
                cVar7 = *(char *)(*piVar2 + 0x11);
                piVar11 = piVar2;
                piVar2 = (int *)*piVar2;
              }
            }
            else {
              cVar7 = *(char *)(piVar11[1] + 0x11);
              piVar6 = (int *)piVar11[1];
              piVar2 = piVar11;
              while ((piVar11 = piVar6, cVar7 == '\0' && (piVar2 == (int *)piVar11[2]))) {
                cVar7 = *(char *)(piVar11[1] + 0x11);
                piVar6 = (int *)piVar11[1];
                piVar2 = piVar11;
              }
            }
          }
        } while (piVar11 != local_1c);
      }
      Player_ProcessInput(this,*(undefined1 *)((int)this + 0xcac));
      if ((*(char *)((int)this + 0x38) != '\0') &&
         (uVar10 = Threading_DestroyMutex(*(void **)((int)this + 0x30),(int)this),
         (char)uVar10 == '\0')) {
        pcVar5 = "3D init error: ";
        do {
          pcVar12 = pcVar5;
          pcVar5 = pcVar12 + 1;
        } while (*pcVar12 != '\0');
        String_Assign((void *)((int)this + 0xce4),(_String_base *)"3D init error: ",
                      (uint)(pcVar12 + -0x533a84));
        Enemy_UpdateAI((void *)((int)this + 0xce4),0x566b6c,0,0xffffffff);
        local_8 = local_8 & 0xffffff00;
        Memory_CompareBuffer(local_20,&param_2,(int *)*local_1c,local_1c);
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(extraout_ECX_00,(uint)local_1c);
      }
      *(int *)((int)this + 0xcb0) = *(int *)((int)this + 0xcb0) + 1;
      *(undefined1 *)((int)this + 0xc90) = 1;
      local_8 = local_8 & 0xffffff00;
      Memory_CompareBuffer(local_20,&param_2,(int *)*local_1c,local_1c);
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX_01,(uint)local_1c);
    }
LAB_0049206c:
    local_8 = (uint)local_8._1_3_ << 8;
    FileIO_FindFirstFile(local_20);
    LeaveCriticalSection(local_14);
    ExceptionList = local_10;
    return 3;
  }
LAB_00492016:
  local_8 = (uint)local_8._1_3_ << 8;
  FileIO_FindFirstFile(local_20);
  LeaveCriticalSection(local_14);
  ExceptionList = local_10;
  return 3;
}


