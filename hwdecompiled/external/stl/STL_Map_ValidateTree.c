/*
 * Function: STL_Map_ValidateTree
 * Address: 00453c10
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall
STL_Map_ValidateTree(void *this,_String_base *param_1,DWORD param_2,BYTE *param_3,DWORD param_4)

{
  _String_base *p_Var1;
  uint uVar2;
  _String_base *p_Var3;
  LSTATUS LVar4;
  LPCSTR **pppCVar5;
  undefined4 extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  int extraout_ECX_03;
  int iVar6;
  int extraout_ECX_04;
  int extraout_ECX_05;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint extraout_EDX_07;
  void *pvVar7;
  uint unaff_retaddr;
  undefined4 *in_stack_ffffff74;
  undefined4 *in_stack_ffffff78;
  uint local_74;
  _String_base local_70 [4];
  uint local_6c;
  undefined4 local_5c;
  uint local_58;
  _String_base local_54 [4];
  LPCSTR *local_50 [5];
  uint local_3c;
  _String_base local_38 [4];
  LPCSTR *local_34 [4];
  undefined4 local_24;
  uint local_20;
  HKEY local_1c;
  char local_18 [4];
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8._0_1_ = 0xff;
  local_8._1_3_ = 0xffffff;
  puStack_c = &DAT_00513276;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  if (*(int *)((int)this + 0x70) == 0) goto LAB_00453f20;
  if (*(char *)((int)this + 0x491) != '\0') {
    if (*(char *)((int)this + 0x492) == '\0') {
      ExceptionList = &local_10;
      Threading_WaitForThread((int)this);
      *(undefined1 *)((int)this + 0x4fc) = 1;
      String_FindSubstring((void *)((int)this + 0x4cc),1,'\0');
    }
    goto LAB_00453f20;
  }
  ExceptionList = &local_10;
  p_Var1 = Survival_LoadConfiguration(local_70,(_String_base *)"SOFTWARE\\",(int)this + 0x5c);
  local_8 = 0;
  Sound_SetFrequency(extraout_ECX,local_54,local_54,p_Var1);
  p_Var1 = param_1;
  if (0xf < local_58) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_00,extraout_EDX);
  }
  local_20 = 0xf;
  local_24 = 0;
  local_34[0] = (LPCSTR *)((uint)local_34[0] & 0xffffff00);
  local_8._0_1_ = 3;
  local_18[0] = '\\';
  uVar2 = XML_GetElementValue(param_1,local_18,0xffffffff,1);
  if (uVar2 == 0xffffffff) {
    PowerUp_ProcessThunderstrike(local_38,extraout_EDX_00,p_Var1,0,0xffffffff);
  }
  else {
    p_Var3 = GameMenu_ProcessRegistrationScreen(p_Var1,(_String_base *)&stack0xffffff74,0,uVar2);
    local_8._0_1_ = 4;
    p_Var3 = Survival_LoadConfiguration(local_70,(_String_base *)&DAT_0053162c,(int)p_Var3);
    local_8._0_1_ = 5;
    Enemy_UpdateAI(local_54,(int)p_Var3,0,0xffffffff);
    if (0xf < local_58) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_6c,extraout_EDX_01);
    }
    local_58 = 0xf;
    local_5c = 0;
    local_6c = local_6c & 0xffffff00;
    local_8._0_1_ = 3;
    if (0xf < local_74) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX_01,(uint)in_stack_ffffff78);
    }
    p_Var1 = GameMenu_ProcessRegistrationScreen
                       (p_Var1,(_String_base *)&stack0xffffff74,uVar2 + 1,0xffffffff);
    local_8._0_1_ = 6;
    PowerUp_ProcessThunderstrike(local_38,extraout_EDX_02,p_Var1,0,0xffffffff);
    local_8._0_1_ = 3;
    if (0xf < local_74) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler((int)in_stack_ffffff78,extraout_EDX_03);
    }
  }
  pppCVar5 = (LPCSTR **)local_50[0];
  if (local_3c < 0x10) {
    pppCVar5 = local_50;
  }
  LVar4 = RegOpenKeyExA((HKEY)0x80000002,(LPCSTR)pppCVar5,0,0x20006,&local_1c);
  if (LVar4 == 0) {
LAB_00453e89:
    pppCVar5 = (LPCSTR **)local_34[0];
    if (local_20 < 0x10) {
      pppCVar5 = local_34;
    }
    RegSetValueExA(local_1c,(LPCSTR)pppCVar5,0,param_2,param_3,param_4);
    RegCloseKey(local_1c);
    iVar6 = extraout_ECX_04;
    uVar2 = extraout_EDX_06;
    if (*(char *)((int)this + 0x490) != '\0') {
      Threading_TerminateThread((int)this);
      pvVar7 = (void *)((int)this + 0x4cc);
      BitStream_WriteBits(pvVar7,0,1);
      BitStream_WriteBits(pvVar7,0xc,5);
      BitStream_WriteBits(pvVar7,1,1);
      iVar6 = extraout_ECX_05;
      uVar2 = extraout_EDX_07;
    }
    if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(iVar6,(uint)local_34[0]);
    }
    local_20 = 0xf;
    local_24 = 0;
    local_34[0] = (LPCSTR *)((uint)local_34[0] & 0xffffff00);
    if (0xf < local_3c) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(iVar6,uVar2);
    }
  }
  else {
    pppCVar5 = (LPCSTR **)local_50[0];
    if (local_3c < 0x10) {
      pppCVar5 = local_50;
    }
    LVar4 = RegCreateKeyExA((HKEY)0x80000002,(LPCSTR)pppCVar5,0,"Key",0,0xf003f,
                            (LPSECURITY_ATTRIBUTES)0x0,&local_1c,(LPDWORD)&param_1);
    if (LVar4 == 0) goto LAB_00453e89;
    iVar6 = extraout_ECX_02;
    uVar2 = extraout_EDX_04;
    if (*(char *)((int)this + 0x490) != '\0') {
      Threading_TerminateThread((int)this);
      pvVar7 = (void *)((int)this + 0x4cc);
      BitStream_WriteBits(pvVar7,0,1);
      BitStream_WriteBits(pvVar7,0xc,5);
      BitStream_WriteBits(pvVar7,0,1);
      iVar6 = extraout_ECX_03;
      uVar2 = extraout_EDX_05;
    }
    if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(iVar6,uVar2);
    }
    local_20 = 0xf;
    local_24 = 0;
    local_34[0] = (LPCSTR *)((uint)local_34[0] & 0xffffff00);
    if (0xf < local_3c) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler((int)local_50[0],uVar2);
    }
  }
  local_20 = 0xf;
  local_24 = 0;
LAB_00453f20:
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_ffffff74,in_stack_ffffff78);
  return;
}


