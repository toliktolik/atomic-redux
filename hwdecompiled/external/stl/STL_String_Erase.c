/*
 * Function: STL_String_Erase
 * Address: 004f1d05
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void STL_String_Erase(void)

{
  short sVar1;
  short *psVar2;
  short *psVar3;
  short sVar4;
  int iVar5;
  undefined4 uVar6;
  undefined1 uVar7;
  undefined4 *puVar8;
  short *extraout_EDX;
  short *psVar10;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint uVar11;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  int unaff_EBP;
  uint uVar12;
  int iVar13;
  undefined4 *in_stack_ffffffd8;
  undefined4 *in_stack_ffffffdc;
  uint uVar9;
  
  Assembly_BitShiftLocking();
  psVar2 = *(short **)(unaff_EBP + 0x14);
  sVar4 = *psVar2;
  *(uint *)(unaff_EBP + -0x10) = DAT_00569f5c ^ *(uint *)(unaff_EBP + 4);
  psVar10 = psVar2;
  sVar1 = sVar4;
  psVar3 = extraout_EDX;
  while (sVar1 != 0) {
    if (sVar1 == sVar4) {
      *(int *)(unaff_EBP + 0x10) = *(int *)(unaff_EBP + 0x10) + 1;
    }
    psVar10 = psVar10 + 1;
    psVar3 = psVar10;
    sVar1 = *psVar10;
  }
  Database_GetLastError
            ((_String_base *)(unaff_EBP + -0x34),(uint)psVar3,*(uint *)(unaff_EBP + 0x10),
             (_String_base)0x0);
  *(undefined4 *)(unaff_EBP + -4) = 0;
  *(undefined4 *)(unaff_EBP + -0x18) = 0xfffffffe;
  *(undefined4 *)(unaff_EBP + -0x14) = 1;
  uVar11 = extraout_EDX_00;
  while( true ) {
    *(undefined1 *)(unaff_EBP + 0x17) = 0;
    uVar12 = 0;
    iVar13 = 0;
    if (*(int *)(unaff_EBP + 0x10) == 0) break;
    do {
      sVar4 = psVar2[iVar13];
      if (sVar4 != 0) {
        do {
          if (sVar4 == *psVar2) break;
          iVar13 = iVar13 + 1;
          sVar4 = psVar2[iVar13];
        } while (sVar4 != 0);
      }
      iVar5 = *(int *)(unaff_EBP + -0x30);
      if (*(uint *)(unaff_EBP + -0x1c) < 0x10) {
        iVar5 = unaff_EBP + -0x30;
      }
      if (*(char *)(iVar5 + uVar12) == '\0') {
        iVar13 = iVar13 + *(int *)(unaff_EBP + -0x14);
        if ((psVar2[iVar13] == *psVar2) || (psVar2[iVar13] == 0)) {
          uVar7 = 0x7f;
          if (*(uint *)(unaff_EBP + -0x14) < 0x7f) {
            uVar7 = (undefined1)*(undefined4 *)(unaff_EBP + -0x14);
          }
          iVar5 = *(int *)(unaff_EBP + -0x30);
          if (*(uint *)(unaff_EBP + -0x1c) < 0x10) {
            iVar5 = unaff_EBP + -0x30;
          }
          *(uint *)(unaff_EBP + -0x18) = uVar12;
        }
        else {
          uVar6 = equal(*(void **)(unaff_EBP + 8),*(int **)(unaff_EBP + 0xc));
          uVar11 = extraout_EDX_01;
          if ((char)uVar6 == '\0') {
            puVar8 = *(undefined4 **)(unaff_EBP + 8);
            if (*(char *)(puVar8 + 1) == '\0') {
              Peek(puVar8);
              puVar8 = *(undefined4 **)(unaff_EBP + 8);
              uVar11 = extraout_EDX_02;
            }
            if (psVar2[iVar13] == *(short *)((int)puVar8 + 6)) {
              *(undefined1 *)(unaff_EBP + 0x17) = 1;
              goto LAB_004f1e2a;
            }
          }
          uVar9 = *(uint *)(unaff_EBP + -0x14);
          if (0x7e < uVar9) {
            uVar9 = 0x7f;
          }
          uVar7 = (undefined1)uVar9;
          iVar5 = *(int *)(unaff_EBP + -0x30);
          if (*(uint *)(unaff_EBP + -0x1c) < 0x10) {
            iVar5 = unaff_EBP + -0x30;
          }
        }
        *(undefined1 *)(iVar5 + uVar12) = uVar7;
      }
      else {
        iVar5 = *(int *)(unaff_EBP + -0x30);
        if (*(uint *)(unaff_EBP + -0x1c) < 0x10) {
          iVar5 = unaff_EBP + -0x30;
        }
        iVar13 = iVar13 + *(char *)(iVar5 + uVar12);
      }
LAB_004f1e2a:
      uVar12 = uVar12 + 1;
    } while (uVar12 < *(uint *)(unaff_EBP + 0x10));
    if ((*(char *)(unaff_EBP + 0x17) == '\0') ||
       (uVar6 = equal(*(void **)(unaff_EBP + 8),*(int **)(unaff_EBP + 0xc)),
       uVar11 = extraout_EDX_03, (char)uVar6 != '\0')) break;
    *(int *)(unaff_EBP + -0x14) = *(int *)(unaff_EBP + -0x14) + 1;
    STL_String_Find(*(undefined4 **)(unaff_EBP + 8));
    *(undefined4 *)(unaff_EBP + -0x18) = 0xffffffff;
    uVar11 = extraout_EDX_04;
  }
  String_Reset(unaff_EBP + -0x34,uVar11,'\x01');
  ExceptionList = *(void **)(unaff_EBP + -0xc);
  Exception_SetMessage
            ((void *)(*(uint *)(unaff_EBP + -0x10) ^ *(uint *)(unaff_EBP + 4)),in_stack_ffffffd8,
             in_stack_ffffffdc);
  return;
}


