/*
 * Function: STL_String_Reserve
 * Address: 00455b80
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


uint __fastcall STL_String_Reserve(int *param_1)

{
  char cVar1;
  uint uVar2;
  DWORD DVar3;
  DWORD DVar4;
  undefined4 uVar5;
  int iVar6;
  DWORD DVar7;
  code *pcVar8;
  undefined4 local_68 [22];
  void *local_10;
  undefined *puStack_c;
  uint local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_00513480;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  Player_FireWeapon('\0');
  local_8 = 0;
  if (DAT_0056da25 != '\0') {
    (**(code **)(*param_1 + 0x138))(0);
    *(undefined1 *)((int)param_1 + 0x3ea) = 0;
    *(undefined1 *)((int)param_1 + 0x3e9) = 1;
    local_8 = 0xffffffff;
    uVar2 = Player_FireWeapon('\x01');
    ExceptionList = local_10;
    return uVar2 & 0xffffff00;
  }
  if ((char)param_1[0x11c] != '\0') {
    if (param_1[0x11d] == 0) {
      STL_Vector_MoveData();
    }
    else if ((param_1[0x11d] == 1) && (param_1[0xb7] != 0)) {
      STL_Vector_ReallocateMemory();
    }
    if (*(char *)((int)param_1 + 0x491) != '\0') {
      STL_Vector_SwapContainers();
    }
  }
  pcVar8 = timeGetTime_exref;
  DVar3 = timeGetTime();
  if (1000 < DVar3 - DAT_0056dafc) {
    DAT_0056dafc = DVar3;
    Game_HandleUserInput();
  }
  if (DAT_0056da24 != '\0') {
LAB_00455eb2:
    *(undefined1 *)((int)param_1 + 0x3e9) = 1;
    *(undefined1 *)((int)param_1 + 0x3ea) = 0;
    local_8 = 0xffffffff;
    uVar2 = Player_FireWeapon('\x01');
    ExceptionList = local_10;
    return uVar2 & 0xffffff00;
  }
  *(undefined1 *)(param_1 + 0xfa) = 1;
  cVar1 = UI_RenderWidgetContainer(param_1[0xb7]);
  *(undefined1 *)(param_1 + 0xfa) = 0;
  if ((((cVar1 == '\0') && (DVar3 - param_1[0x10b] < 1000)) &&
      (*(char *)((int)param_1 + 0x485) == '\0')) || ((int)(DVar3 - param_1[0x10c]) < 0))
  goto LAB_00455eb2;
  *(undefined1 *)((int)param_1 + 0x3e9) = 0;
  param_1[0x104] = param_1[0x104] + 1;
  DVar4 = timeGetTime();
  param_1[0x11b] = param_1[0x11b] + 1;
  param_1[0x11a] = param_1[0x11a] + (DVar4 - DVar3);
  param_1[0x116] = param_1[0x116] + (DVar4 - DVar3);
  if ((char)param_1[0x11c] != '\0') {
    uVar5 = SexyWidget_GetRotation(param_1[0xca]);
    Graphics_InitializeSurface(local_68,uVar5);
    local_8 = CONCAT31(local_8._1_3_,1);
    SexyWidget_GetHeight(DAT_0056da28);
    SexyWidget_GetWidth(DAT_0056da28);
    Graphics_DrawImage(local_68,DAT_0056da28);
    if (*(char *)((int)param_1 + 0x491) != '\0') {
      SexyWidget_GetHeight(DAT_0056da28);
      SexyWidget_GetHeight(DAT_0056da30);
      SexyWidget_GetWidth(DAT_0056da30);
      Graphics_DrawImage(local_68,DAT_0056da30);
    }
    local_8 = local_8 & 0xffffff00;
    Graphics_ClearClipRect(local_68);
    pcVar8 = timeGetTime_exref;
  }
  if ((((char)param_1[0x151] != '\0') && (*(char *)((int)param_1 + 0x2ff) != '\0')) &&
     (*(char *)((int)param_1 + 0x545) != '\0')) {
    iVar6 = (*pcVar8)();
    if ((uint)(iVar6 - param_1[0x10b]) < *(uint *)(param_1[0xca] + 0x7c)) {
      Sleep((*(uint *)(param_1[0xca] + 0x7c) - iVar6) + param_1[0x10b]);
    }
  }
  DVar4 = timeGetTime();
  param_1[0x10b] = DVar4;
  (**(code **)(*param_1 + 0x138))(0);
  Threading_ResetEvent((int)param_1);
  DVar7 = timeGetTime();
  param_1[0x11e] = DVar7 - DVar4;
  if ((*(char *)((int)param_1 + 0x47d) != '\0') && (*(char *)((int)param_1 + 0x47e) == '\0')) {
    iVar6 = DVar7 - DVar3;
    if (iVar6 < 0x10) {
      iVar6 = 0xf;
    }
    iVar6 = param_1[0x10c] + iVar6 + 0x23;
    param_1[0x10c] = iVar6;
    if ((int)(DVar7 - iVar6) < 0) goto LAB_00455e80;
  }
  param_1[0x10c] = DVar7;
LAB_00455e80:
  *(undefined1 *)((int)param_1 + 0x3ea) = 0;
  *(undefined1 *)((int)param_1 + 0x485) = 0;
  local_8 = 0xffffffff;
  uVar5 = Player_FireWeapon('\x01');
  ExceptionList = local_10;
  return CONCAT31((int3)((uint)uVar5 >> 8),1);
}


