/*
 * Function: STL_Iterator_End
 * Address: 00458320
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void * __fastcall STL_Iterator_End(void *param_1,undefined2 param_2,int param_3,uint param_4)

{
  uint uVar1;
  int iVar2;
  locale *plVar3;
  facet *pfVar4;
  undefined4 *puVar5;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_005135f8;
  local_10 = ExceptionList;
  if (*(int *)((int)param_1 + 0x5c) == 0) {
    ExceptionList = &local_10;
    iVar2 = Memory_ConditionalCodepageAlloc(param_3,param_2,param_3,param_4);
    if (iVar2 != 0) {
      *(undefined1 *)((int)param_1 + 0x54) = 1;
      *(undefined1 *)((int)param_1 + 0x4c) = 0;
      SexyAppFramework_InitializeDirectDraw((int)param_1);
      *(int *)((int)param_1 + 0x30) = iVar2 + 4;
      *(int *)((int)param_1 + 0x34) = iVar2 + 4;
      *(int *)((int)param_1 + 0x10) = iVar2 + 8;
      *(int *)((int)param_1 + 0x14) = iVar2 + 8;
      *(int *)((int)param_1 + 0x20) = iVar2;
      *(int *)((int)param_1 + 0x24) = iVar2;
      *(int *)((int)param_1 + 0x5c) = iVar2;
      *(undefined4 *)((int)param_1 + 0x50) = DAT_0056da7c;
      *(undefined4 *)((int)param_1 + 0x40) = DAT_0056da7c;
      *(undefined4 *)((int)param_1 + 0x3c) = 0;
      plVar3 = (locale *)Threading_ProcessSoundEffects(param_1,(int *)&param_4);
      local_8 = 0;
      pfVar4 = Locale_GetFacet(plVar3);
      STL_String_CompareNoCase(param_1,pfVar4);
      uVar1 = param_4;
      local_8 = 0xffffffff;
      if (param_4 != 0) {
        Threading_LockSectorByIndex(&param_3,0);
        iVar2 = *(int *)(uVar1 + 4);
        if ((iVar2 != 0) && (iVar2 != -1)) {
          *(int *)(uVar1 + 4) = iVar2 + -1;
        }
        puVar5 = (undefined4 *)(uVar1 & (*(int *)(uVar1 + 4) != 0) - 1);
        Threading_UnlockSectorByIndex(&param_3);
        if (puVar5 != (undefined4 *)0x0) {
          (**(code **)*puVar5)(1);
        }
      }
      ExceptionList = local_10;
      return param_1;
    }
  }
  ExceptionList = local_10;
  return (void *)0x0;
}


