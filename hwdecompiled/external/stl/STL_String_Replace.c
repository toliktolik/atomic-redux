/*
 * Function: STL_String_Replace
 * Address: 004f1eda
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void STL_String_Replace(void)

{
  undefined4 *this;
  size_t _MaxCount;
  char cVar1;
  wint_t wVar2;
  wint_t wVar3;
  wint_t wVar4;
  facet *this_00;
  undefined4 uVar5;
  undefined1 *puVar6;
  uint uVar7;
  void *pvVar8;
  int iVar9;
  char *pcVar10;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  char *pcVar11;
  uint extraout_EDX_05;
  short sVar12;
  int unaff_EBP;
  int iVar13;
  undefined4 *in_stack_ffffffb0;
  undefined4 *in_stack_ffffffb4;
  
  Assembly_BitShiftLocking();
  *(uint *)(unaff_EBP + -0x10) = DAT_00569f5c ^ *(uint *)(unaff_EBP + 4);
  wVar2 = _btowc(0x30);
  this_00 = Log_FlushBuffer();
  Runtime_FreeBlock(this_00,unaff_EBP + -0x5c);
  iVar13 = *(int *)this_00;
  *(undefined4 *)(unaff_EBP + -4) = 0;
  uVar5 = (**(code **)(iVar13 + 8))();
  this = *(undefined4 **)(unaff_EBP + 0xc);
  *(undefined4 *)(unaff_EBP + -0x24) = uVar5;
  *(undefined4 *)(unaff_EBP + -0x18) = *(undefined4 *)(unaff_EBP + 8);
  uVar5 = equal(this,*(int **)(unaff_EBP + 0x10));
  if ((char)uVar5 == '\0') {
    if (*(char *)(this + 1) == '\0') {
      Peek(this);
    }
    wVar4 = *(wint_t *)((int)this + 6);
    wVar3 = _btowc(0x2b);
    if (wVar4 == wVar3) {
      puVar6 = *(undefined1 **)(unaff_EBP + 8);
      *puVar6 = 0x2b;
    }
    else {
      if (*(char *)(this + 1) == '\0') {
        Peek(this);
      }
      wVar4 = *(wint_t *)((int)this + 6);
      wVar3 = _btowc(0x2d);
      if (wVar4 != wVar3) goto LAB_004f1f8e;
      puVar6 = *(undefined1 **)(unaff_EBP + 8);
      *puVar6 = 0x2d;
    }
    *(undefined1 **)(unaff_EBP + -0x18) = puVar6 + 1;
    STL_String_Find(this);
  }
LAB_004f1f8e:
  uVar7 = *(uint *)(unaff_EBP + 0x14) & 0xe00;
  if (uVar7 == 0x400) {
    *(undefined4 *)(unaff_EBP + -0x14) = 8;
  }
  else if (uVar7 == 0x800) {
    *(undefined4 *)(unaff_EBP + -0x14) = 0x10;
  }
  else {
    *(uint *)(unaff_EBP + -0x14) = -(uint)(uVar7 != 0) & 10;
  }
  *(undefined1 *)(unaff_EBP + -0x1c) = 0;
  *(undefined1 *)(unaff_EBP + 0x17) = 0;
  uVar5 = equal(this,*(int **)(unaff_EBP + 0x10));
  uVar7 = extraout_EDX;
  if ((char)uVar5 == '\0') {
    if (*(char *)(this + 1) == '\0') {
      Peek(this);
      uVar7 = extraout_EDX_00;
    }
    if (*(wint_t *)((int)this + 6) != wVar2) goto LAB_004f2071;
    *(undefined1 *)(unaff_EBP + -0x1c) = 1;
    STL_String_Find(this);
    uVar5 = equal(this,*(int **)(unaff_EBP + 0x10));
    uVar7 = extraout_EDX_01;
    if ((char)uVar5 != '\0') {
LAB_004f2064:
      if (*(int *)(unaff_EBP + -0x14) == 0) {
        *(undefined4 *)(unaff_EBP + -0x14) = 8;
        goto LAB_004f2071;
      }
      goto LAB_004f2077;
    }
    if (*(char *)(this + 1) == '\0') {
      Peek(this);
    }
    wVar2 = *(wint_t *)((int)this + 6);
    wVar4 = _btowc(0x78);
    uVar7 = extraout_EDX_02;
    if (wVar2 != wVar4) {
      if (*(char *)(this + 1) == '\0') {
        Peek(this);
      }
      wVar2 = *(wint_t *)((int)this + 6);
      wVar4 = _btowc(0x58);
      uVar7 = extraout_EDX_03;
      if (wVar2 != wVar4) goto LAB_004f2064;
    }
    if ((*(int *)(unaff_EBP + -0x14) != 0) && (*(int *)(unaff_EBP + -0x14) != 0x10))
    goto LAB_004f2064;
    *(undefined1 *)(unaff_EBP + -0x1c) = 0;
    *(undefined4 *)(unaff_EBP + -0x14) = 0x10;
    STL_String_Find(this);
    uVar7 = extraout_EDX_04;
LAB_004f207d:
    *(uint *)(unaff_EBP + -0x20) = ((*(int *)(unaff_EBP + -0x14) != 8) - 1 & 0xfffffff2) + 0x16;
  }
  else {
LAB_004f2071:
    if (*(int *)(unaff_EBP + -0x14) != 0) {
LAB_004f2077:
      if (*(int *)(unaff_EBP + -0x14) != 10) goto LAB_004f207d;
    }
    *(undefined4 *)(unaff_EBP + -0x20) = 10;
  }
  Database_GetLastError
            ((_String_base *)(unaff_EBP + -0x40),uVar7,1,SUB41(*(undefined4 *)(unaff_EBP + -0x1c),0)
            );
  *(undefined1 *)(unaff_EBP + -4) = 1;
  iVar13 = 0;
  uVar5 = equal(this,*(int **)(unaff_EBP + 0x10));
  if ((char)uVar5 == '\0') {
    do {
      if (*(char *)(this + 1) == '\0') {
        Peek(this);
      }
      cVar1 = String_WideCharToStackBuffer(*(WCHAR *)((int)this + 6));
      pcVar11 = *(char **)(unaff_EBP + -0x18);
      _MaxCount = *(size_t *)(unaff_EBP + -0x20);
      *pcVar11 = cVar1;
      pvVar8 = _memchr("0123456789abcdefABCDEF",(int)cVar1,_MaxCount);
      if (pvVar8 == (void *)0x0) {
        iVar9 = *(int *)(unaff_EBP + -0x3c);
        if (*(uint *)(unaff_EBP + -0x28) < 0x10) {
          iVar9 = unaff_EBP + -0x3c;
        }
        if ((*(char *)(iVar9 + iVar13) == '\0') ||
           (sVar12 = (short)*(undefined4 *)(unaff_EBP + -0x24), sVar12 == 0)) break;
        if (*(char *)(this + 1) == '\0') {
          Peek(this);
        }
        if (*(short *)((int)this + 6) != sVar12) break;
        Memory_AllocateSound((_String_base *)(unaff_EBP + -0x40),1,(_String_base)0x0);
        iVar13 = iVar13 + 1;
      }
      else {
        if (((*(char *)(unaff_EBP + 0x17) != '\0') || (*pcVar11 != '0')) &&
           (pcVar11 < (char *)(*(int *)(unaff_EBP + 8) + 0x1f))) {
          *(char **)(unaff_EBP + -0x18) = pcVar11 + 1;
          *(undefined1 *)(unaff_EBP + 0x17) = 1;
        }
        iVar9 = *(int *)(unaff_EBP + -0x3c);
        *(undefined1 *)(unaff_EBP + -0x1c) = 1;
        if (*(uint *)(unaff_EBP + -0x28) < 0x10) {
          iVar9 = unaff_EBP + -0x3c;
        }
        if (*(char *)(iVar9 + iVar13) != '\x7f') {
          iVar9 = *(int *)(unaff_EBP + -0x3c);
          if (*(uint *)(unaff_EBP + -0x28) < 0x10) {
            iVar9 = unaff_EBP + -0x3c;
          }
          *(char *)(iVar9 + iVar13) = *(char *)(iVar9 + iVar13) + '\x01';
        }
      }
      STL_String_Find(this);
      uVar5 = equal(this,*(int **)(unaff_EBP + 0x10));
    } while ((char)uVar5 == '\0');
    if (iVar13 != 0) {
      iVar9 = *(int *)(unaff_EBP + -0x3c);
      if (*(uint *)(unaff_EBP + -0x28) < 0x10) {
        iVar9 = unaff_EBP + -0x3c;
      }
      if (*(char *)(iVar9 + iVar13) < '\x01') {
        *(undefined1 *)(unaff_EBP + -0x1c) = 0;
      }
      else {
        iVar13 = iVar13 + 1;
      }
    }
  }
  pcVar11 = *(char **)(unaff_EBP + -0x58);
  if (*(uint *)(unaff_EBP + -0x44) < 0x10) {
    pcVar11 = (char *)(unaff_EBP + -0x58);
  }
  if (*(char *)(unaff_EBP + -0x1c) == '\0') {
LAB_004f220b:
    *(undefined4 *)(unaff_EBP + -0x18) = *(undefined4 *)(unaff_EBP + 8);
  }
  else {
    while ((iVar13 != 0 && (cVar1 = *pcVar11, cVar1 != '\x7f'))) {
      iVar13 = iVar13 + -1;
      if (iVar13 != 0) {
        iVar9 = *(int *)(unaff_EBP + -0x3c);
        if (*(uint *)(unaff_EBP + -0x28) < 0x10) {
          iVar9 = unaff_EBP + -0x3c;
        }
        if (cVar1 != *(char *)(iVar9 + iVar13)) goto LAB_004f220b;
      }
      if (iVar13 == 0) {
        pcVar10 = *(char **)(unaff_EBP + -0x3c);
        if (*(uint *)(unaff_EBP + -0x28) < 0x10) {
          pcVar10 = (char *)(unaff_EBP + -0x3c);
        }
        if (cVar1 < *pcVar10) goto LAB_004f220b;
      }
      if ('\0' < pcVar11[1]) {
        pcVar11 = pcVar11 + 1;
      }
    }
    if (*(char *)(unaff_EBP + 0x17) == '\0') {
      puVar6 = *(undefined1 **)(unaff_EBP + -0x18);
      *(int *)(unaff_EBP + -0x18) = *(int *)(unaff_EBP + -0x18) + 1;
      *puVar6 = 0x30;
    }
  }
  **(undefined1 **)(unaff_EBP + -0x18) = 0;
  String_Reset(unaff_EBP + -0x40,(uint)pcVar11,'\x01');
  String_Reset(unaff_EBP + -0x5c,extraout_EDX_05,'\x01');
  ExceptionList = *(void **)(unaff_EBP + -0xc);
  Exception_SetMessage
            ((void *)(*(uint *)(unaff_EBP + -0x10) ^ *(uint *)(unaff_EBP + 4)),in_stack_ffffffb0,
             in_stack_ffffffb4);
  return;
}


