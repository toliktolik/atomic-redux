/*
 * Function: STL_Map_FindOrInsert
 * Address: 004a9ac0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall STL_Map_FindOrInsert(void *this,undefined4 *param_1,_String_base *param_2)

{
  _String_base *p_Var1;
  _String_base *p_Var2;
  uint uVar3;
  undefined4 *puVar4;
  _String_base *p_Var5;
  uint uVar6;
  uint uVar7;
  _String_base *p_Var8;
  bool bVar9;
  bool bVar10;
  bool local_8;
  
  p_Var1 = param_2;
  p_Var8 = *(_String_base **)((int)this + 4);
  local_8 = true;
  if ((*(_String_base **)(p_Var8 + 4))[0x39] == (_String_base)0x0) {
    uVar6 = *(uint *)(param_2 + 0x14);
    p_Var2 = *(_String_base **)(p_Var8 + 4);
    do {
      p_Var8 = p_Var2;
      if (*(uint *)(p_Var8 + 0x24) < 0x10) {
        p_Var2 = p_Var8 + 0x10;
      }
      else {
        p_Var2 = *(_String_base **)(p_Var8 + 0x10);
      }
      if (uVar6 == 0) {
LAB_004a9b37:
        if (uVar6 < *(uint *)(p_Var8 + 0x20)) {
          uVar3 = 0xffffffff;
        }
        else {
          uVar3 = (uint)(uVar6 != *(uint *)(p_Var8 + 0x20));
        }
      }
      else {
        uVar7 = *(uint *)(p_Var8 + 0x20);
        if (uVar6 < *(uint *)(p_Var8 + 0x20)) {
          uVar7 = uVar6;
        }
        if (*(uint *)(param_2 + 0x18) < 0x10) {
          p_Var5 = param_2 + 4;
        }
        else {
          p_Var5 = *(_String_base **)(param_2 + 4);
        }
        bVar9 = false;
        uVar3 = 0;
        bVar10 = true;
        do {
          if (uVar7 == 0) break;
          uVar7 = uVar7 - 1;
          bVar9 = (byte)*p_Var5 < (byte)*p_Var2;
          bVar10 = *p_Var5 == *p_Var2;
          p_Var5 = p_Var5 + 1;
          p_Var2 = p_Var2 + 1;
        } while (bVar10);
        if (!bVar10) {
          uVar3 = (1 - (uint)bVar9) - (uint)(bVar9 != 0);
        }
        if (uVar3 == 0) goto LAB_004a9b37;
      }
      local_8 = (int)uVar3 < 0;
      if (local_8) {
        p_Var2 = *(_String_base **)p_Var8;
      }
      else {
        p_Var2 = *(_String_base **)(p_Var8 + 8);
      }
    } while (p_Var2[0x39] == (_String_base)0x0);
  }
  param_2 = p_Var8;
  if (local_8) {
    if (p_Var8 == (_String_base *)**(int **)((int)this + 4)) {
      puVar4 = (undefined4 *)STL_Map_InsertNode(this,&param_2,'\x01',(undefined4 *)p_Var8,p_Var1);
      *param_1 = *puVar4;
      *(undefined1 *)(param_1 + 1) = 1;
      return;
    }
    XML_FreeDocument((int *)&param_2);
  }
  p_Var2 = param_2;
  if (*(uint *)(p_Var1 + 0x18) < 0x10) {
    p_Var5 = p_Var1 + 4;
  }
  else {
    p_Var5 = *(_String_base **)(p_Var1 + 4);
  }
  uVar6 = String_Compare(param_2 + 0xc,0,*(uint *)(param_2 + 0x20),p_Var5,*(uint *)(p_Var1 + 0x14));
  if (-1 < (int)uVar6) {
    *param_1 = p_Var2;
    *(undefined1 *)(param_1 + 1) = 0;
    return;
  }
  puVar4 = (undefined4 *)STL_Map_InsertNode(this,&param_2,local_8,(undefined4 *)p_Var8,p_Var1);
  *param_1 = *puVar4;
  *(undefined1 *)(param_1 + 1) = 1;
  return;
}


