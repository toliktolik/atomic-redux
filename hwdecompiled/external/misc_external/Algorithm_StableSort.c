/*
 * Function: Algorithm_StableSort
 * Address: 0045c110
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Algorithm_StableSort(undefined4 param_1,uint param_2,int param_3,char param_4)

{
  int *piVar1;
  _String_base *p_Var2;
  BOOL BVar3;
  int iVar4;
  LPCSTR lpFileName;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  undefined4 extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  _String_base *unaff_EDI;
  undefined8 uVar5;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffe54;
  undefined4 *in_stack_fffffe58;
  undefined1 local_6c [4];
  int local_68;
  uint local_54;
  undefined4 local_50 [2];
  _String_base local_48 [4];
  uint local_44;
  undefined4 local_34;
  uint local_30;
  int local_2c;
  undefined1 local_25;
  undefined1 local_24 [4];
  int *local_20;
  int local_1c;
  int *local_18;
  uint local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x5139e0;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  p_Var2 = Intel_DisplayPopulationData(param_1,param_2,local_48,unaff_EDI,(_String_base *)"*.dmo");
  if (*(uint *)(p_Var2 + 0x18) < 0x10) {
    p_Var2 = p_Var2 + 4;
  }
  else {
    p_Var2 = *(_String_base **)(p_Var2 + 4);
  }
  local_18 = (int *)FindFirstFileA((LPCSTR)p_Var2,(LPWIN32_FIND_DATAA)&stack0xfffffe54);
  if (0xf < local_30) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX,local_44);
  }
  if (local_18 == (int *)0xffffffff) {
    ExceptionList = local_10;
    Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_fffffe54,in_stack_fffffe58);
    return;
  }
  local_24[0] = local_25;
  uVar5 = Tree_UpdateHeight();
  iVar4 = (int)uVar5;
  *(undefined1 *)(iVar4 + 0x11) = 1;
  *(int *)(iVar4 + 4) = iVar4;
  *(int *)iVar4 = iVar4;
  *(int *)(iVar4 + 8) = iVar4;
  local_1c = 0;
  local_8 = 0;
  do {
    local_20 = (int *)uVar5;
    local_2c = 0;
    p_Var2 = Intel_DisplayPopulationData
                       (local_48,(uint)((ulonglong)uVar5 >> 0x20),local_48,unaff_EDI,
                        (_String_base *)"%d.dmo");
    uVar5 = Threading_GetThreadID(*(int **)(p_Var2 + 0x18),(short)&local_2c);
    if (0xf < local_30) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_44,(uint)((ulonglong)uVar5 >> 0x20));
    }
    local_30 = 0xf;
    local_34 = 0;
    local_44 = local_44 & 0xffffff00;
    if ((int)uVar5 == 1) {
      STL_String_Substring(local_24,local_50,&local_2c);
    }
    BVar3 = FindNextFileA(local_18,(LPWIN32_FIND_DATAA)&stack0xfffffe54);
    uVar5 = CONCAT44(extraout_EDX,local_20);
  } while (BVar3 != 0);
  FindClose(local_18);
  if ((param_3 + -1 < local_1c) && (param_4 != '\0')) {
    p_Var2 = Intel_DisplayPopulationData
                       (param_3 + -1,(uint)local_6c,(_String_base *)local_6c,unaff_EDI,
                        (_String_base *)"%d.dmo");
    local_8 = CONCAT31(local_8._1_3_,1);
    if (*(uint *)(p_Var2 + 0x18) < 0x10) {
      p_Var2 = p_Var2 + 4;
    }
    else {
      p_Var2 = *(_String_base **)(p_Var2 + 4);
    }
    iVar4 = Sound_SetPosition(local_48,p_Var2);
    if (*(uint *)(iVar4 + 0x18) < 0x10) {
      lpFileName = (LPCSTR)(iVar4 + 4);
    }
    else {
      lpFileName = *(LPCSTR *)(iVar4 + 4);
    }
    DeleteFileA(lpFileName);
    if (0xf < local_30) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX_00,extraout_EDX_00);
    }
    local_30 = 0xf;
    local_34 = 0;
    local_44 = local_44 & 0xffffff00;
    if (0xf < local_54) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_68,extraout_EDX_00);
    }
  }
  piVar1 = local_20;
  if (local_1c == 0) {
    local_8 = 0xffffffff;
    STL_String_Clear(local_24,&local_18,(int *)*local_20,local_20);
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_01,extraout_EDX_01);
  }
  local_18 = local_20;
  XML_SetElementValue((int *)&local_18);
  local_8 = 0xffffffff;
  STL_String_Clear(local_24,&local_18,(int *)*piVar1,piVar1);
                    /* WARNING: Subroutine does not return */
  System_ShutdownHandler(extraout_ECX_02,extraout_EDX_02);
}


