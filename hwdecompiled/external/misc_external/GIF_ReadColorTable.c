/*
 * Function: GIF_ReadColorTable
 * Address: 004d18c0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 GIF_ReadColorTable(void)

{
  undefined1 uVar1;
  byte bVar2;
  undefined4 *puVar3;
  int iVar4;
  ushort uVar5;
  uint uVar6;
  int iVar7;
  int iVar8;
  int iVar9;
  undefined1 *puVar10;
  byte *pbVar11;
  ushort *puVar12;
  int *unaff_EDI;
  int *local_18;
  int local_8;
  
  puVar3 = (undefined4 *)unaff_EDI[6];
  local_8 = puVar3[1];
  puVar10 = (undefined1 *)*puVar3;
  if (local_8 == 0) {
    uVar6 = (*(code *)puVar3[3])();
    if ((char)uVar6 == '\0') goto LAB_004d1b3b;
    local_8 = puVar3[1];
    puVar10 = (undefined1 *)*puVar3;
  }
  uVar1 = *puVar10;
  local_8 = local_8 + -1;
  puVar10 = puVar10 + 1;
  if (local_8 == 0) {
    uVar6 = (*(code *)puVar3[3])();
    if ((char)uVar6 == '\0') {
LAB_004d1b3b:
      return uVar6 & 0xffffff00;
    }
    local_8 = puVar3[1];
    puVar10 = (undefined1 *)*puVar3;
  }
  local_8 = local_8 + -1;
  pbVar11 = puVar10 + 1;
  iVar8 = CONCAT11(uVar1,*puVar10) - 2;
  do {
    iVar9 = iVar8;
    if (iVar9 < 1) {
      if (iVar9 != 0) {
        *(undefined4 *)(*unaff_EDI + 0x14) = 0xb;
        iVar9 = (**(code **)*unaff_EDI)();
      }
      *puVar3 = pbVar11;
      puVar3[1] = local_8;
      return CONCAT31((int3)((uint)iVar9 >> 8),1);
    }
    if (local_8 == 0) {
      uVar6 = (*(code *)puVar3[3])();
      if ((char)uVar6 == '\0') goto LAB_004d1b3b;
      local_8 = puVar3[1];
      pbVar11 = (byte *)*puVar3;
    }
    local_8 = local_8 + -1;
    bVar2 = *pbVar11;
    *(undefined4 *)(*unaff_EDI + 0x14) = 0x51;
    uVar6 = bVar2 & 0xf;
    *(uint *)(*unaff_EDI + 0x18) = uVar6;
    iVar7 = (int)(uint)bVar2 >> 4;
    *(int *)(*unaff_EDI + 0x1c) = iVar7;
    pbVar11 = pbVar11 + 1;
    (**(code **)(*unaff_EDI + 4))();
    if (3 < uVar6) {
      *(undefined4 *)(*unaff_EDI + 0x14) = 0x1f;
      *(uint *)(*unaff_EDI + 0x18) = uVar6;
      (**(code **)*unaff_EDI)();
    }
    if (unaff_EDI[uVar6 + 0x24] == 0) {
      iVar8 = ZLIB_CompressBound((int)unaff_EDI);
      unaff_EDI[uVar6 + 0x24] = iVar8;
    }
    iVar8 = unaff_EDI[uVar6 + 0x24];
    local_18 = &DAT_00542c30;
    do {
      if (iVar7 == 0) {
        if (local_8 == 0) {
          uVar6 = (*(code *)puVar3[3])();
          if ((char)uVar6 == '\0') goto LAB_004d1b3b;
          local_8 = puVar3[1];
          pbVar11 = (byte *)*puVar3;
        }
        uVar5 = (ushort)*pbVar11;
      }
      else {
        if (local_8 == 0) {
          uVar6 = (*(code *)puVar3[3])();
          if ((char)uVar6 == '\0') goto LAB_004d1b3b;
          local_8 = puVar3[1];
          pbVar11 = (byte *)*puVar3;
        }
        bVar2 = *pbVar11;
        local_8 = local_8 + -1;
        pbVar11 = pbVar11 + 1;
        if (local_8 == 0) {
          uVar6 = (*(code *)puVar3[3])();
          if ((char)uVar6 == '\0') goto LAB_004d1b3b;
          local_8 = puVar3[1];
          pbVar11 = (byte *)*puVar3;
        }
        uVar5 = (ushort)bVar2 * 0x100 + (ushort)*pbVar11;
      }
      local_8 = local_8 + -1;
      iVar4 = *local_18;
      local_18 = local_18 + 1;
      pbVar11 = pbVar11 + 1;
      *(ushort *)(iVar8 + iVar4 * 2) = uVar5;
    } while ((int)local_18 < 0x542d30);
    if (1 < *(int *)(*unaff_EDI + 0x68)) {
      puVar12 = (ushort *)(iVar8 + 4);
      local_18 = (int *)0x8;
      do {
        iVar8 = *unaff_EDI;
        *(uint *)(iVar8 + 0x18) = (uint)puVar12[-2];
        *(uint *)(iVar8 + 0x1c) = (uint)puVar12[-1];
        *(uint *)(iVar8 + 0x20) = (uint)*puVar12;
        *(uint *)(iVar8 + 0x24) = (uint)puVar12[1];
        *(uint *)(iVar8 + 0x28) = (uint)puVar12[2];
        *(uint *)(iVar8 + 0x2c) = (uint)puVar12[3];
        *(uint *)(iVar8 + 0x30) = (uint)puVar12[4];
        *(uint *)(iVar8 + 0x34) = (uint)puVar12[5];
        *(undefined4 *)(*unaff_EDI + 0x14) = 0x5d;
        (**(code **)(*unaff_EDI + 4))();
        puVar12 = puVar12 + 8;
        local_18 = (int *)((int)local_18 + -1);
      } while (local_18 != (int *)0x0);
    }
    iVar8 = iVar9 + -0x41;
    if (iVar7 != 0) {
      iVar8 = iVar9 + -0x81;
    }
  } while( true );
}


