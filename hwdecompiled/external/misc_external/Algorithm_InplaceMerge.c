/*
 * Function: Algorithm_InplaceMerge
 * Address: 0045c970
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Algorithm_InplaceMerge(int *param_1)

{
  char cVar1;
  bool bVar2;
  DWORD DVar3;
  _String_base *p_Var4;
  UINT UVar5;
  HANDLE pvVar6;
  undefined1 *puVar7;
  int *lpWindowName;
  HWND hWnd;
  undefined4 *puVar8;
  HCURSOR pHVar9;
  int iVar10;
  LONG LVar11;
  uint uVar12;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  void *this;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  int iVar13;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffe04;
  undefined4 *in_stack_fffffe08;
  DEVMODEA local_f8;
  _String_base local_5c [4];
  uint local_58;
  undefined4 local_48;
  uint local_44;
  void *local_40;
  WNDCLASSA local_3c;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_00513a6e;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  DVar3 = GetCurrentThreadId();
  param_1[0xbe] = DVar3;
  iVar13 = 0;
  if (*(char *)((int)param_1 + 0x2fd) != '\0') goto LAB_0045cf16;
  if ((DAT_0056da14 == 0) || (DAT_0056da18 == 0)) {
    MessageBoxA((HWND)0x0,
                "This application requires DirectX to run.  You can get DirectX at http://www.microsoft.com/directx"
                ,"You need DirectX",0x10);
    Algorithm_EqualRange(param_1,(char *)0x0);
  }
  if (*(char *)((int)param_1 + 0xb2) == '\0') {
    (**(code **)(*param_1 + 0x9c))();
  }
  cVar1 = Registry_CloseKey((int)param_1);
  if (cVar1 != '\0') {
    *(undefined1 *)(param_1 + 0x2e) = 0;
  }
  if ((char)param_1[0x2e] != '\0') {
    p_Var4 = Survival_LoadConfiguration(local_5c,(_String_base *)"Notify",(int)(param_1 + 9));
    if (*(uint *)(p_Var4 + 0x18) < 0x10) {
      p_Var4 = p_Var4 + 4;
    }
    else {
      p_Var4 = *(_String_base **)(p_Var4 + 4);
    }
    UVar5 = RegisterWindowMessageA((LPCSTR)p_Var4);
    param_1[0x2f] = UVar5;
    if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,local_58);
    }
    p_Var4 = Intel_DisplayPopulationData
                       (extraout_ECX,extraout_EDX,local_5c,(_String_base *)(param_1 + 9),
                        (_String_base *)"Mutex");
    if (*(uint *)(p_Var4 + 0x18) < 0x10) {
      p_Var4 = p_Var4 + 4;
    }
    else {
      p_Var4 = *(_String_base **)(p_Var4 + 4);
    }
    pvVar6 = CreateMutexA((LPSECURITY_ATTRIBUTES)0x0,1,(LPCSTR)p_Var4);
    if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_58,extraout_EDX_00);
    }
    DVar3 = GetLastError();
    if (DVar3 == 0xb7) {
      if (param_1[0x2f] != 0) {
        PostMessageA((HWND)0xffff,param_1[0x2f],0,0);
      }
      Algorithm_EqualRange(param_1,(char *)0x0);
    }
    else {
      param_1[0x2d] = (int)pvVar6;
    }
  }
  if (DAT_005a33c0 == (HINSTANCE)0x0) {
    DAT_005a33c0 = GetModuleHandleA((LPCSTR)0x0);
  }
  GetModuleFileNameA((HMODULE)0x0,&stack0xfffffe04,0x100);
  Threading_SleepThread();
  Threading_SleepThread();
  puVar7 = (undefined1 *)Threading_SleepThread();
  if (puVar7 != (undefined1 *)0x0) {
    *puVar7 = 0;
  }
  cVar1 = (**(code **)(*param_1 + 0xb4))();
  if (cVar1 == '\0') {
    Debug_GetRegisterESP();
  }
  DVar3 = GetTickCount();
  param_1[1] = DVar3;
  Scoring_LoadScores(DVar3);
  if (*(char *)((int)param_1 + 0x491) != '\0') {
    local_44 = 0xf;
    local_48 = 0;
    local_58 = local_58 & 0xffffff00;
    local_8 = 0;
    cVar1 = DemoFile_Load((int)param_1,(short)local_5c,local_5c);
    iVar10 = extraout_ECX_00;
    if (cVar1 == '\0') {
      *(undefined1 *)((int)param_1 + 0x491) = 0;
      (**(code **)(*param_1 + 0x70))();
      Algorithm_EqualRange(param_1,(char *)0x0);
      iVar10 = extraout_ECX_01;
    }
    local_8 = 0xffffffff;
    if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(iVar10,local_58);
    }
  }
  (**(code **)(*param_1 + 0x13c))();
  GetTickCount();
  Threading_ResumeThread(extraout_ECX_02,extraout_EDX_01);
  (**(code **)(*param_1 + 0x58))();
  local_3c.style = 8;
  local_3c.cbClsExtra = 0;
  local_3c.cbWndExtra = 0;
  local_3c.hbrBackground = (HBRUSH)0x0;
  local_3c.hCursor = (HCURSOR)0x0;
  local_3c.hIcon = LoadIconA(DAT_005a33c0,"IDI_MAIN_ICON");
  local_3c.hInstance = DAT_005a33c0;
  local_3c.lpfnWndProc = STL_Iterator_Increment;
  local_3c.lpszClassName = "MainWindow";
  local_3c.lpszMenuName = (LPCSTR)0x0;
  RegisterClassA(&local_3c);
  local_3c.style = 0;
  local_3c.cbClsExtra = 0;
  local_3c.cbWndExtra = 0;
  local_3c.hbrBackground = (HBRUSH)0x0;
  local_3c.hCursor = (HCURSOR)0x0;
  local_3c.hIcon = (HICON)0x0;
  local_3c.hInstance = DAT_005a33c0;
  local_3c.lpfnWndProc = STL_Iterator_Increment;
  local_3c.lpszClassName = "InvisWindow";
  local_3c.lpszMenuName = (LPCSTR)0x0;
  RegisterClassA(&local_3c);
  if ((uint)param_1[0x16] < 0x10) {
    lpWindowName = param_1 + 0x11;
  }
  else {
    lpWindowName = (int *)param_1[0x11];
  }
  hWnd = CreateWindowExA(0,"InvisWindow",(LPCSTR)lpWindowName,0,0,0,0,0,(HWND)0x0,(HMENU)0x0,
                         DAT_005a33c0,(LPVOID)0x0);
  param_1[0xc4] = (int)hWnd;
  SetWindowLongA(hWnd,-0x15,(LONG)param_1);
  local_40 = operator_new(0x178);
  local_8 = 1;
  if (local_40 == (void *)0x0) {
    puVar8 = (undefined4 *)0x0;
  }
  else {
    puVar8 = SexyWidget_SetColor(local_40,param_1);
  }
  param_1[0xb7] = (int)puVar8;
  local_8 = 0xffffffff;
  pHVar9 = CreateCursor(DAT_005a33c0,0xb,4,0x20,0x20,&DAT_00565ee0,&DAT_00565f60);
  param_1[0x10f] = (int)pHVar9;
  pHVar9 = CreateCursor(DAT_005a33c0,0xf,10,0x20,0x20,&DAT_00565fe0,&DAT_00566060);
  param_1[0x110] = (int)pHVar9;
  (**(code **)(*param_1 + 0xac))();
  Algorithm_NextPermutation((void *)param_1[0xb7],param_1[0x21],param_1[0x22]);
  if (*(char *)((int)param_1 + 0x2fe) == '\0') {
LAB_0045cd74:
    if ((char)param_1[0xc0] != '\0') goto LAB_0045cd80;
  }
  else {
    if ((char)param_1[0xc0] == '\0') {
      iVar10 = GetSystemMetrics(0x10);
      if ((iVar10 <= param_1[0x21]) || (iVar10 = GetSystemMetrics(0x11), iVar10 <= param_1[0x22])) {
        *(undefined1 *)((int)param_1 + 0x2fe) = 0;
      }
      goto LAB_0045cd74;
    }
LAB_0045cd80:
    EnumWindows(Algorithm_LowerBound,0);
    EnumDisplaySettingsA((LPCSTR)0x0,0xffffffff,&local_f8);
    if (((local_f8.dmPelsWidth != param_1[0x21]) || (local_f8.dmPelsHeight != param_1[0x22])) ||
       ((local_f8.dmBitsPerPel != 0x10 && (local_f8.dmBitsPerPel != 0x20)))) {
      local_f8.dmPelsHeight = param_1[0x22];
      local_f8.dmFields = (DWORD)&DAT_00580000;
      if ((local_f8.dmBitsPerPel != 0x10) && (local_f8.dmBitsPerPel != 0x20)) {
        local_f8.dmBitsPerPel = 0x10;
        local_f8.dmFields = 0x5c0000;
      }
      local_f8.dmPelsWidth = param_1[0x21];
      LVar11 = ChangeDisplaySettingsA(&local_f8,4);
      if (LVar11 != 0) {
        *(undefined1 *)(param_1 + 0xc0) = 0;
        *(undefined1 *)((int)param_1 + 0x2fe) = 0;
      }
    }
  }
  (**(code **)(*param_1 + 0x2c))();
  if (*(char *)((int)param_1 + 0x491) != '\0') {
    Threading_WaitForThread((int)param_1);
    *(undefined1 *)(param_1 + 0x13f) = 1;
    bVar2 = String_ReplaceSubstring((int)(param_1 + 0x133));
    *(bool *)((int)param_1 + 0x2fe) = bVar2;
    uVar12 = String_ToLowerCase((int)(param_1 + 0x133));
    param_1[0x14c] = uVar12 & 0xff;
  }
  if (param_1[0x10e] == 0) {
    local_40 = operator_new(0x14a0);
    local_8 = 2;
    if (local_40 == (void *)0x0) {
      puVar8 = (undefined4 *)0x0;
    }
    else {
      if ((char)param_1[0x2c] == '\0') {
        iVar13 = param_1[0xc3];
      }
      puVar8 = DirectSoundManager_Constructor(local_40,iVar13,*(undefined1 *)((int)param_1 + 0xb1));
    }
    local_8 = 0xffffffff;
    param_1[0x10e] = (int)puVar8;
  }
  (**(code **)(*param_1 + 0xd8))();
  iVar13 = (**(code **)(*param_1 + 0x44))();
  param_1[0xcc] = iVar13;
  (**(code **)(*param_1 + 0xd4))();
  cVar1 = Registry_CloseKey((int)param_1);
  if (cVar1 != '\0') {
    Threading_CreateSemaphore(this,5);
  }
  *(undefined1 *)((int)param_1 + 0x303) = 1;
LAB_0045cf16:
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_fffffe04,in_stack_fffffe08);
  return;
}


