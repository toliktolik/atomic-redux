/*
 * Function: Algorithm_IsHeap
 * Address: 0045e020
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Algorithm_IsHeap(int *param_1)

{
  HWND pHVar1;
  char *pcVar2;
  int *piVar3;
  char cVar4;
  undefined4 uVar5;
  _String_base *p_Var6;
  int iVar7;
  char *pcVar8;
  int extraout_ECX;
  undefined4 extraout_ECX_00;
  int extraout_ECX_01;
  undefined2 extraout_DX;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  int *piVar9;
  uint extraout_EDX_04;
  int *piVar10;
  _String_base local_38 [4];
  uint local_34;
  undefined4 local_24;
  uint local_20;
  int local_1c;
  int *local_18;
  char local_12;
  char local_11;
  void *pvStack_10;
  undefined4 uStack_c;
  undefined1 local_8;
  undefined3 uStack_7;
  
  uStack_c = 0x513c5e;
  pvStack_10 = ExceptionList;
  ExceptionList = &pvStack_10;
  *param_1 = (int)&PTR_EmptyFunction_NoOp_00531f1c;
  local_8 = 0x16;
  uStack_7 = 0;
  local_18 = param_1;
  Algorithm_Includes(param_1);
  local_11 = '\0';
  if (*(char *)((int)param_1 + 0x546) != '\0') {
    local_20 = 0xf;
    local_24 = 0;
    local_34 = local_34 & 0xffffff00;
    pcVar2 = "Is3D";
    do {
      pcVar8 = pcVar2;
      pcVar2 = pcVar8 + 1;
    } while (*pcVar8 != '\0');
    String_Assign(local_38,(_String_base *)&DAT_00531d44,(uint)(pcVar8 + -0x531d44));
    local_8 = 0x17;
    uVar5 = STL_Vector_Clear(param_1,local_38,&local_12);
    local_12 = (char)uVar5;
    local_8 = 0x16;
    if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,local_34);
    }
    if ((local_12 == '\0') &&
       (uVar5 = Compression_ValidateHeader((int)param_1), (char)uVar5 == '\0')) {
      uVar5 = Compression_GetCompressedSize((int)param_1);
      if ((char)uVar5 == '\0') goto LAB_0045e1b7;
      local_11 = '\x01';
      p_Var6 = Intel_DisplayPopulationData
                         (local_38,extraout_EDX,local_38,(_String_base *)(param_1 + 2),
                          (_String_base *)" Hardware Acceleration Confirmation");
      if (*(uint *)(p_Var6 + 0x18) < 0x10) {
        p_Var6 = p_Var6 + 4;
      }
      else {
        p_Var6 = *(_String_base **)(p_Var6 + 4);
      }
      iVar7 = MessageBoxA((HWND)0x0,
                          "Hardware Acceleration was switched on during this session.\r\nIf this resulted in slower performance, it should be switched off.\r\nWould you like to keep Hardware Acceleration switched on?"
                          ,(LPCSTR)p_Var6,0x24);
      String_Destructor((int)local_38,extraout_EDX_00);
      *(bool *)(param_1[0xca] + 0x38) = iVar7 == 6;
      if (iVar7 != 6) goto LAB_0045e243;
    }
    local_20 = 0xf;
    local_24 = 0;
    local_34 = local_34 & 0xffffff00;
    pcVar2 = "Is3D";
    do {
      pcVar8 = pcVar2;
      pcVar2 = pcVar8 + 1;
    } while (*pcVar8 != '\0');
    String_Assign(local_38,(_String_base *)&DAT_00531d44,(uint)(pcVar8 + -0x531d44));
    local_8 = 0x18;
    STL_Vector_PushBack(param_1,local_38,*(BYTE *)(param_1[0xca] + 0x38));
    local_8 = 0x16;
    if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_34,extraout_EDX_01);
    }
    if (local_11 != '\0') goto LAB_0045e243;
  }
LAB_0045e1b7:
  if ((DAT_0056e359 != '\0') && (cVar4 = Registry_CloseKey((int)param_1), cVar4 == '\0')) {
    p_Var6 = Intel_DisplayPopulationData
                       (extraout_ECX_00,(uint)(param_1 + 2),local_38,(_String_base *)(param_1 + 2),
                        (_String_base *)" Hardware Acceleration Confirmation");
    if (*(uint *)(p_Var6 + 0x18) < 0x10) {
      p_Var6 = p_Var6 + 4;
    }
    else {
      p_Var6 = *(_String_base **)(p_Var6 + 4);
    }
    iVar7 = MessageBoxA((HWND)0x0,
                        "Hardware Acceleration may not have been working correctly during this session.\r\nIf you noticed graphics problems, you may want to turn off Hardware Acceleration.\r\nWould you like to keep Hardware Acceleration switched on?"
                        ,(LPCSTR)p_Var6,0x24);
    if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_34,extraout_EDX_02);
    }
    if (iVar7 == 7) {
      Level_InitializeDictastroika(local_38,"Is3D");
      local_8 = 0x19;
      STL_Vector_PushBack(param_1,local_38,'\0');
      local_8 = 0x16;
      String_Destructor((int)local_38,extraout_EDX_03);
    }
  }
LAB_0045e243:
  piVar10 = *(int **)param_1[0xb9];
  if (piVar10 != (int *)param_1[0xb9]) {
    do {
      UI_ProcessChildAnimation((void *)param_1[0xb7],(int *)piVar10[4]);
      if ((undefined4 *)piVar10[4] != (undefined4 *)0x0) {
        (*(code *)**(undefined4 **)piVar10[4])(1);
      }
      if (*(char *)((int)piVar10 + 0x15) == '\0') {
        piVar9 = (int *)piVar10[2];
        if (*(char *)((int)piVar9 + 0x15) == '\0') {
          cVar4 = *(char *)(*piVar9 + 0x15);
          piVar10 = piVar9;
          piVar9 = (int *)*piVar9;
          while (cVar4 == '\0') {
            cVar4 = *(char *)(*piVar9 + 0x15);
            piVar10 = piVar9;
            piVar9 = (int *)*piVar9;
          }
        }
        else {
          cVar4 = *(char *)(piVar10[1] + 0x15);
          piVar3 = (int *)piVar10[1];
          piVar9 = piVar10;
          while ((piVar10 = piVar3, cVar4 == '\0' && (piVar9 == (int *)piVar10[2]))) {
            cVar4 = *(char *)(piVar10[1] + 0x15);
            piVar3 = (int *)piVar10[1];
            piVar9 = piVar10;
          }
        }
      }
    } while (piVar10 != (int *)param_1[0xb9]);
  }
  Memory_FreeRecursive(*(int *)(param_1[0xb9] + 4));
  *(int *)(param_1[0xb9] + 4) = param_1[0xb9];
  param_1[0xba] = 0;
  *(int *)param_1[0xb9] = param_1[0xb9];
  *(int *)(param_1[0xb9] + 8) = param_1[0xb9];
  piVar10 = (int *)param_1[0xbc];
  if (piVar10 == (int *)0x0) {
    piVar9 = (int *)0x0;
  }
  else {
    piVar9 = (int *)*piVar10;
  }
  System_ClearTaskQueue(param_1 + 0xbb,&local_1c,piVar9,piVar10);
  pHVar1 = (HWND)param_1[0xc4];
  if (pHVar1 != (HWND)0x0) {
    param_1[0xc4] = 0;
    SetWindowLongA(pHVar1,-0x15,0);
    DestroyWindow(pHVar1);
  }
  if ((undefined4 *)param_1[0xb7] != (undefined4 *)0x0) {
    (*(code *)**(undefined4 **)param_1[0xb7])(1);
  }
  if ((undefined4 *)param_1[0xca] != (undefined4 *)0x0) {
    (*(code *)**(undefined4 **)param_1[0xca])(1);
  }
  if ((undefined4 *)param_1[0xcc] != (undefined4 *)0x0) {
    (*(code *)**(undefined4 **)param_1[0xcc])(1);
  }
  if ((undefined4 *)param_1[0x10e] != (undefined4 *)0x0) {
    (*(code *)**(undefined4 **)param_1[0x10e])(1);
  }
  if ((int *)param_1[0x164] != (int *)0x0) {
    (**(code **)(*(int *)param_1[0x164] + 8))(1);
  }
  pHVar1 = (HWND)param_1[0xc3];
  if (pHVar1 != (HWND)0x0) {
    param_1[0xc3] = 0;
    SetWindowLongA(pHVar1,-0x15,0);
    DestroyWindow(pHVar1);
  }
  Registry_EnumerateValues((int)param_1);
  DestroyCursor((HCURSOR)param_1[0x10f]);
  DestroyCursor((HCURSOR)param_1[0x110]);
  DAT_0056da10 = 0;
  JSON_SaveDocument((int)param_1,extraout_DX);
  if ((HANDLE)param_1[0x2d] != (HANDLE)0x0) {
    CloseHandle((HANDLE)param_1[0x2d]);
  }
  FreeLibrary(DAT_0056da14);
  FreeLibrary(DAT_0056da18);
  FreeLibrary(DAT_0056da1c);
  _local_8 = CONCAT31(uStack_7,0x15);
  Algorithm_PopHeap(param_1 + 0x161,&local_1c,*(int **)param_1[0x162],(int *)param_1[0x162]);
                    /* WARNING: Subroutine does not return */
  System_ShutdownHandler(extraout_ECX_01,extraout_EDX_04);
}


