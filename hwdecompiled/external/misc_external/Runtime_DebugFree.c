/*
 * Function: Runtime_DebugFree
 * Address: 004f9304
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void Runtime_DebugFree(void)

{
  char cVar1;
  undefined4 *puVar2;
  bool bVar3;
  undefined1 uVar4;
  byte bVar5;
  facet *this;
  uint uVar6;
  char *pcVar7;
  _String_base *p_Var8;
  int iVar9;
  undefined4 uVar10;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint uVar11;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint extraout_EDX_07;
  uint uVar12;
  int unaff_EBP;
  byte *pbVar13;
  undefined4 *unaff_EDI;
  int iVar14;
  undefined4 *puVar15;
  
  Assembly_BitShiftLocking();
  *(uint *)(unaff_EBP + -0x10) = DAT_00569f5c ^ *(uint *)(unaff_EBP + 4);
  *(undefined4 *)(unaff_EBP + -4) = 0;
  SexyWidget_ProcessInput(*(void **)(unaff_EBP + 0x18),(int *)(unaff_EBP + -0x24));
  if (*(char *)(unaff_EBP + 0x14) == '\0') {
    *(undefined1 *)(unaff_EBP + -4) = 2;
    this = Runtime_FinalizeHeap();
  }
  else {
    *(undefined1 *)(unaff_EBP + -4) = 1;
    this = Runtime_ValidateHeap();
  }
  *(undefined1 *)(unaff_EBP + -4) = 0;
  *(facet **)(unaff_EBP + -0x20) = this;
  SmartPointer_Destructor((uint *)(unaff_EBP + -0x24));
  uVar6 = (**(code **)(*(int *)this + 0x1c))();
  *(uint *)(unaff_EBP + 0x14) = uVar6;
  Runtime_FreeBlock(this,unaff_EBP + -0xb4);
  *(undefined1 *)(unaff_EBP + -4) = 3;
  if (uVar6 < *(uint *)(unaff_EBP + 0x38)) {
    pcVar7 = *(char **)(unaff_EBP + -0xb0);
    if (*(uint *)(unaff_EBP + -0x9c) < 0x10) {
      pcVar7 = (char *)(unaff_EBP + -0xb0);
    }
    if ('\0' < *pcVar7) {
      uVar4 = (**(code **)(*(int *)this + 8))();
      pcVar7 = *(char **)(unaff_EBP + -0xb0);
      *(undefined1 *)(unaff_EBP + -0x14) = uVar4;
      if (*(uint *)(unaff_EBP + -0x9c) < 0x10) {
        pcVar7 = (char *)(unaff_EBP + -0xb0);
      }
      uVar6 = *(int *)(unaff_EBP + 0x38) - *(int *)(unaff_EBP + 0x14);
      while (((cVar1 = *pcVar7, cVar1 != '\x7f' && ('\0' < cVar1)) && ((uint)(int)cVar1 < uVar6))) {
        uVar6 = uVar6 - (int)cVar1;
        UI_ShowOptionsMenu((_String_base *)(unaff_EBP + 0x24),uVar6,1,
                           SUB41(*(undefined4 *)(unaff_EBP + -0x14),0));
        if ('\0' < pcVar7[1]) {
          pcVar7 = pcVar7 + 1;
        }
      }
    }
  }
  *(undefined4 *)(unaff_EBP + -100) = 0xf;
  String_SetLength((void *)(unaff_EBP + -0x7c),0);
  iVar9 = *(int *)this;
  puVar15 = (undefined4 *)(unaff_EBP + 0x20);
  *(undefined1 *)(unaff_EBP + -4) = 4;
  if (*(char *)(unaff_EBP + 0x20) == '\0') {
    (**(code **)(iVar9 + 0x20))();
    *(undefined4 *)(unaff_EBP + -0x14) = *(undefined4 *)(unaff_EBP + 0x20);
    p_Var8 = (_String_base *)STL_String_Insert(this,unaff_EBP + -0xd0);
    *(undefined1 *)(unaff_EBP + -4) = 6;
    uVar6 = extraout_EDX_00;
  }
  else {
    (**(code **)(iVar9 + 0x24))();
    *(undefined4 *)(unaff_EBP + -0x14) = *(undefined4 *)(unaff_EBP + 0x20);
    p_Var8 = (_String_base *)Runtime_ReallocBlock(this,unaff_EBP + -0xd0);
    *(undefined1 *)(unaff_EBP + -4) = 5;
    uVar6 = extraout_EDX;
  }
  PowerUp_ProcessThunderstrike((_String_base *)(unaff_EBP + -0x7c),uVar6,p_Var8,0,0xffffffff);
  String_Reset(unaff_EBP + -0xd0,extraout_EDX_01,'\x01');
  *(undefined4 *)(unaff_EBP + -0x80) = 0xf;
  String_SetLength((void *)(unaff_EBP + -0x98),0);
  uVar6 = *(uint *)(*(int *)(unaff_EBP + 0x18) + 0xc);
  *(undefined1 *)(unaff_EBP + -4) = 7;
  if ((uVar6 & 8) != 0) {
    p_Var8 = (_String_base *)Resource_FreeResource(this,unaff_EBP + -0xd0);
    *(undefined1 *)(unaff_EBP + -4) = 8;
    PowerUp_ProcessThunderstrike
              ((_String_base *)(unaff_EBP + -0x98),extraout_EDX_02,p_Var8,0,0xffffffff);
    *(undefined1 *)(unaff_EBP + -4) = 7;
    String_Reset(unaff_EBP + -0xd0,extraout_EDX_03,'\x01');
  }
  bVar3 = false;
  uVar11 = 0;
  uVar6 = 0;
  do {
    cVar1 = *(char *)(unaff_EBP + -0x14 + uVar6);
    if (cVar1 == ' ') {
      bVar3 = true;
    }
    else if (cVar1 == '$') {
      uVar11 = uVar11 + *(int *)(unaff_EBP + -0x84);
    }
    else if (cVar1 == '+') {
      uVar11 = uVar11 + *(int *)(unaff_EBP + -0x68);
    }
    else if (cVar1 == 'v') {
      uVar12 = *(uint *)(unaff_EBP + 0x14);
      if (uVar12 < *(uint *)(unaff_EBP + 0x38)) {
        iVar9 = 0;
      }
      else {
        iVar9 = (uVar12 - *(int *)(unaff_EBP + 0x38)) + 1;
      }
      uVar11 = uVar11 + (uint)(uVar12 != 0) + *(int *)(unaff_EBP + 0x38) + iVar9;
    }
    uVar6 = uVar6 + 1;
  } while (uVar6 < 4);
  uVar6 = *(uint *)(*(int *)(unaff_EBP + 0x18) + 0x14);
  if (((int)uVar6 < 1) || (uVar6 <= uVar11)) {
    iVar9 = 0;
  }
  else {
    iVar9 = uVar6 - uVar11;
  }
  uVar6 = *(uint *)(*(int *)(unaff_EBP + 0x18) + 0xc) & 0x1c0;
  *(int *)(unaff_EBP + 0x20) = iVar9;
  *(uint *)(unaff_EBP + -0x60) = uVar6;
  if ((uVar6 != 0x40) && ((uVar6 != 0x100 || (!bVar3)))) {
    *(undefined4 *)(unaff_EBP + -0x1c) = *(undefined4 *)(unaff_EBP + 0xc);
    *(undefined4 *)(unaff_EBP + -0x18) = *(undefined4 *)(unaff_EBP + 0x10);
    for (; iVar9 != 0; iVar9 = iVar9 + -1) {
      Character_OutputValidator((void *)(unaff_EBP + -0x1c),(byte)*(undefined4 *)(unaff_EBP + 0x1c))
      ;
    }
    *(undefined4 *)(unaff_EBP + 0x20) = 0;
    *(undefined4 *)(unaff_EBP + 0xc) = *(undefined4 *)(unaff_EBP + -0x1c);
    *(undefined4 *)(unaff_EBP + 0x10) = *(undefined4 *)(unaff_EBP + -0x18);
  }
  uVar11 = *(uint *)(unaff_EBP + 0x10);
  uVar10 = *(undefined4 *)(unaff_EBP + 0xc);
  uVar12 = 0;
  do {
    cVar1 = *(char *)(unaff_EBP + -0x14 + uVar12);
    if (cVar1 == ' ') {
      if (uVar6 != 0x100) goto LAB_004f9781;
      iVar9 = *(int *)(unaff_EBP + 0x20);
      *(undefined4 *)(unaff_EBP + -0x44) = uVar10;
      *(uint *)(unaff_EBP + -0x40) = uVar11;
      for (; iVar9 != 0; iVar9 = iVar9 + -1) {
        Character_OutputValidator
                  ((void *)(unaff_EBP + -0x44),(byte)*(undefined4 *)(unaff_EBP + 0x1c));
      }
      uVar10 = *(undefined4 *)(unaff_EBP + -0x44);
      uVar11 = *(uint *)(unaff_EBP + -0x40);
      *(undefined4 *)(unaff_EBP + 0x20) = 0;
LAB_004f977b:
      *(undefined4 *)(unaff_EBP + 0xc) = uVar10;
      *(uint *)(unaff_EBP + 0x10) = uVar11;
    }
    else {
      if (cVar1 == '$') {
        pbVar13 = *(byte **)(unaff_EBP + -0x94);
        if (*(uint *)(unaff_EBP + -0x80) < 0x10) {
          pbVar13 = (byte *)(unaff_EBP + -0x94);
        }
        *(undefined4 *)(unaff_EBP + -0x34) = uVar10;
        *(uint *)(unaff_EBP + -0x30) = uVar11;
        if (*(int *)(unaff_EBP + -0x84) != 0) {
          iVar9 = *(int *)(unaff_EBP + -0x84);
          do {
            Character_OutputValidator((void *)(unaff_EBP + -0x34),*pbVar13);
            pbVar13 = pbVar13 + 1;
            iVar9 = iVar9 + -1;
          } while (iVar9 != 0);
        }
        uVar10 = *(undefined4 *)(unaff_EBP + -0x34);
        uVar11 = *(uint *)(unaff_EBP + -0x30);
        goto LAB_004f977b;
      }
      if (cVar1 == '+') {
        if (*(int *)(unaff_EBP + -0x68) != 0) {
          pbVar13 = *(byte **)(unaff_EBP + -0x78);
          if (*(uint *)(unaff_EBP + -100) < 0x10) {
            pbVar13 = (byte *)(unaff_EBP + -0x78);
          }
          bVar5 = *pbVar13;
          *(undefined4 *)(unaff_EBP + -0x4c) = uVar10;
          *(uint *)(unaff_EBP + -0x48) = uVar11;
          Character_OutputValidator((void *)(unaff_EBP + -0x4c),bVar5);
          uVar10 = *(undefined4 *)(unaff_EBP + -0x4c);
          uVar11 = *(uint *)(unaff_EBP + -0x48);
          goto LAB_004f977b;
        }
      }
      else if (cVar1 == 'v') {
        if (*(int *)(unaff_EBP + 0x14) == 0) {
          pbVar13 = *(byte **)(unaff_EBP + 0x28);
          if (*(uint *)(unaff_EBP + 0x3c) < 0x10) {
            pbVar13 = (byte *)(unaff_EBP + 0x28);
          }
          iVar9 = *(int *)(unaff_EBP + 0x38);
          *(undefined4 *)(unaff_EBP + -0x1c) = uVar10;
          *(uint *)(unaff_EBP + -0x18) = uVar11;
          for (; iVar9 != 0; iVar9 = iVar9 + -1) {
            Character_OutputValidator((void *)(unaff_EBP + -0x1c),*pbVar13);
            pbVar13 = pbVar13 + 1;
          }
          uVar10 = *(undefined4 *)(unaff_EBP + -0x1c);
          uVar11 = *(uint *)(unaff_EBP + -0x18);
        }
        else if (*(uint *)(unaff_EBP + 0x14) < *(uint *)(unaff_EBP + 0x38)) {
          pbVar13 = *(byte **)(unaff_EBP + 0x28);
          if (*(uint *)(unaff_EBP + 0x3c) < 0x10) {
            pbVar13 = (byte *)(unaff_EBP + 0x28);
          }
          *(undefined4 *)(unaff_EBP + -0x2c) = uVar10;
          *(uint *)(unaff_EBP + -0x28) = uVar11;
          for (iVar9 = *(uint *)(unaff_EBP + 0x38) - *(int *)(unaff_EBP + 0x14); iVar9 != 0;
              iVar9 = iVar9 + -1) {
            Character_OutputValidator((void *)(unaff_EBP + -0x2c),*pbVar13);
            pbVar13 = pbVar13 + 1;
          }
          *(undefined4 *)(unaff_EBP + 0xc) = *(undefined4 *)(unaff_EBP + -0x2c);
          *(undefined4 *)(unaff_EBP + 0x10) = *(undefined4 *)(unaff_EBP + -0x28);
          bVar5 = (**(code **)(**(int **)(unaff_EBP + -0x20) + 4))();
          Character_OutputValidator((void *)(unaff_EBP + 0xc),bVar5);
          iVar9 = *(int *)(unaff_EBP + 0x28);
          if (*(uint *)(unaff_EBP + 0x3c) < 0x10) {
            iVar9 = unaff_EBP + 0x28;
          }
          iVar14 = *(int *)(unaff_EBP + 0x14);
          pbVar13 = (byte *)((iVar9 - iVar14) + *(int *)(unaff_EBP + 0x38));
          *(undefined4 *)(unaff_EBP + -0x54) = *(undefined4 *)(unaff_EBP + 0xc);
          *(undefined4 *)(unaff_EBP + -0x50) = *(undefined4 *)(unaff_EBP + 0x10);
          for (; iVar14 != 0; iVar14 = iVar14 + -1) {
            Character_OutputValidator((void *)(unaff_EBP + -0x54),*pbVar13);
            pbVar13 = pbVar13 + 1;
          }
          uVar10 = *(undefined4 *)(unaff_EBP + -0x54);
          uVar11 = *(uint *)(unaff_EBP + -0x50);
        }
        else {
          Character_OutputValidator((void *)(unaff_EBP + 0xc),0x30);
          bVar5 = (**(code **)(**(int **)(unaff_EBP + -0x20) + 4))();
          Character_OutputValidator((void *)(unaff_EBP + 0xc),bVar5);
          *(undefined4 *)(unaff_EBP + -0x3c) = *(undefined4 *)(unaff_EBP + 0xc);
          *(undefined4 *)(unaff_EBP + -0x38) = *(undefined4 *)(unaff_EBP + 0x10);
          for (iVar9 = *(int *)(unaff_EBP + 0x14) - *(int *)(unaff_EBP + 0x38); iVar9 != 0;
              iVar9 = iVar9 + -1) {
            Character_OutputValidator((void *)(unaff_EBP + -0x3c),0x30);
          }
          pbVar13 = *(byte **)(unaff_EBP + 0x28);
          if (*(uint *)(unaff_EBP + 0x3c) < 0x10) {
            pbVar13 = (byte *)(unaff_EBP + 0x28);
          }
          iVar9 = *(int *)(unaff_EBP + 0x38);
          *(undefined4 *)(unaff_EBP + -0x5c) = *(undefined4 *)(unaff_EBP + -0x3c);
          *(undefined4 *)(unaff_EBP + -0x58) = *(undefined4 *)(unaff_EBP + -0x38);
          for (; iVar9 != 0; iVar9 = iVar9 + -1) {
            Character_OutputValidator((void *)(unaff_EBP + -0x5c),*pbVar13);
            pbVar13 = pbVar13 + 1;
          }
          uVar10 = *(undefined4 *)(unaff_EBP + -0x5c);
          uVar11 = *(uint *)(unaff_EBP + -0x58);
        }
        goto LAB_004f977b;
      }
    }
LAB_004f9781:
    uVar12 = uVar12 + 1;
    if (3 < uVar12) {
      uVar6 = *(uint *)(unaff_EBP + -0x68);
      if (1 < uVar6) {
        pbVar13 = *(byte **)(unaff_EBP + -0x78);
        if (*(uint *)(unaff_EBP + -100) < 0x10) {
          pbVar13 = (byte *)(unaff_EBP + -0x78);
        }
        *(undefined4 *)(unaff_EBP + 0xc) = uVar10;
        *(uint *)(unaff_EBP + 0x10) = uVar11;
        while (uVar6 = uVar6 - 1, uVar6 != 0) {
          pbVar13 = pbVar13 + 1;
          Character_OutputValidator((void *)(unaff_EBP + 0xc),*pbVar13);
        }
        uVar10 = *(undefined4 *)(unaff_EBP + 0xc);
        uVar11 = *(uint *)(unaff_EBP + 0x10);
      }
      iVar9 = *(int *)(unaff_EBP + 0x20);
      *(undefined4 *)(*(int *)(unaff_EBP + 0x18) + 0x14) = 0;
      *(undefined4 *)(unaff_EBP + 0xc) = uVar10;
      *(uint *)(unaff_EBP + 0x10) = uVar11;
      for (; iVar9 != 0; iVar9 = iVar9 + -1) {
        Character_OutputValidator((void *)(unaff_EBP + 0xc),(byte)*(undefined4 *)(unaff_EBP + 0x1c))
        ;
        uVar11 = extraout_EDX_04;
      }
      puVar2 = *(undefined4 **)(unaff_EBP + 8);
      *puVar2 = *(undefined4 *)(unaff_EBP + 0xc);
      puVar2[1] = *(undefined4 *)(unaff_EBP + 0x10);
      String_Reset(unaff_EBP + -0x98,uVar11,'\x01');
      String_Reset(unaff_EBP + -0x7c,extraout_EDX_05,'\x01');
      String_Reset(unaff_EBP + -0xb4,extraout_EDX_06,'\x01');
      String_Reset(unaff_EBP + 0x24,extraout_EDX_07,'\x01');
      ExceptionList = *(void **)(unaff_EBP + -0xc);
      Exception_SetMessage
                ((void *)(*(uint *)(unaff_EBP + -0x10) ^ *(uint *)(unaff_EBP + 4)),puVar15,unaff_EDI
                );
      return;
    }
    uVar6 = *(uint *)(unaff_EBP + -0x60);
  } while( true );
}


