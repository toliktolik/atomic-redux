/*
 * Function: Memory_ReferenceCounter
 * Address: 004145af
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void Memory_ReferenceCounter(void)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  ios_base *piVar4;
  ios_base *extraout_ECX;
  undefined4 *extraout_EDX;
  undefined4 *puVar5;
  int unaff_EBP;
  int *unaff_EDI;
  ulonglong uVar6;
  
  iVar3 = *unaff_EDI;
  puVar5 = *(undefined4 **)(unaff_EBP + -0x14);
  *(undefined4 *)(unaff_EBP + -4) = 0;
  piVar4 = (ios_base *)(*(int *)(iVar3 + 4) + (int)unaff_EDI);
  if (puVar5 != (undefined4 *)0x0) {
    uVar2 = *(uint *)(piVar4 + 4) | (uint)puVar5;
    if (*(int *)(piVar4 + 0x28) == 0) {
      uVar2 = uVar2 | 4;
    }
    std::ios_base::clear(piVar4,uVar2,false);
    piVar4 = extraout_ECX;
    puVar5 = extraout_EDX;
  }
  *(undefined4 *)(unaff_EBP + -4) = 3;
  uVar6 = Thunk_System_Initialize(piVar4,puVar5);
  if ((char)uVar6 == '\0') {
    piVar1 = *(int **)(unaff_EBP + -0x2c);
    iVar3 = *(int *)(*piVar1 + 4);
    if ((*(byte *)(iVar3 + 0xc + (int)piVar1) & 2) != 0) {
      uVar2 = 0;
      if ((*(byte *)((int)piVar1 + iVar3 + 4) & 6) == 0) {
        iVar3 = (**(code **)(**(int **)((int)piVar1 + iVar3 + 0x28) + 0x2c))();
        if (iVar3 == -1) {
          uVar2 = 4;
        }
      }
      piVar4 = (ios_base *)(*(int *)(*piVar1 + 4) + (int)piVar1);
      if (uVar2 != 0) {
        uVar2 = *(uint *)(piVar4 + 4) | uVar2;
        if (*(int *)(piVar4 + 0x28) == 0) {
          uVar2 = uVar2 | 4;
        }
        std::ios_base::clear(piVar4,uVar2,false);
      }
    }
  }
  *(undefined4 *)(unaff_EBP + -4) = 0xffffffff;
  iVar3 = *(int *)(*(int *)(**(int **)(unaff_EBP + -0x2c) + 4) + 0x28 +
                  (int)*(int **)(unaff_EBP + -0x2c));
  if (iVar3 != 0) {
    Threading_LeaveCriticalSectionFromPointer((undefined4 *)(iVar3 + 4));
  }
  ExceptionList = *(void **)(unaff_EBP + -0xc);
  return;
}


