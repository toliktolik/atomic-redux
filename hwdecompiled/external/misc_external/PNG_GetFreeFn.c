/*
 * Function: PNG_GetFreeFn
 * Address: 004c5380
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


int * __cdecl PNG_GetFreeFn(int *param_1)

{
  int *piVar1;
  int *piVar2;
  int iVar3;
  int iVar4;
  int in_EAX;
  int *piVar5;
  int *unaff_EDI;
  
  piVar1 = (int *)*unaff_EDI;
  piVar2 = piVar1;
  while( true ) {
    if (piVar2 == (int *)0x0) {
      return (int *)0x0;
    }
    piVar5 = piVar2 + 2;
    if (in_EAX <= *piVar5) break;
    piVar2 = (int *)piVar2[3];
    in_EAX = in_EAX - *piVar5;
  }
  if (in_EAX == 0) {
    return (int *)0x0;
  }
  iVar3 = piVar2[2];
  if (in_EAX < iVar3) {
    iVar4 = piVar2[1];
    piVar5 = (int *)PNG_GetErrorPtr(*(int *)(*piVar2 + 0xc));
    *unaff_EDI = (int)piVar5;
    *piVar5 = *piVar2;
    *(int *)(*unaff_EDI + 4) = iVar4 + in_EAX;
    *(int *)(*unaff_EDI + 8) = iVar3 - in_EAX;
    *(int *)(*unaff_EDI + 0xc) = piVar2[3];
    PNG_SetWarningCallback();
    if ((param_1 != (int *)0x0) && (piVar2 == (int *)*param_1)) {
      *param_1 = *unaff_EDI;
    }
    piVar2[2] = in_EAX;
    piVar2[3] = 0;
    return piVar1;
  }
  if (piVar2[3] != 0) {
    *unaff_EDI = piVar2[3];
    piVar2[3] = 0;
    return piVar1;
  }
  *param_1 = 0;
  *unaff_EDI = 0;
  return piVar1;
}


