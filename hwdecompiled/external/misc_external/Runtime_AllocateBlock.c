/*
 * Function: Runtime_AllocateBlock
 * Address: 004f8943
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void Runtime_AllocateBlock(void)

{
  char cVar1;
  byte bVar2;
  int *this;
  bool bVar3;
  undefined1 uVar4;
  char cVar5;
  facet *this_00;
  locale *plVar6;
  facet *pfVar7;
  undefined4 uVar8;
  int iVar9;
  _String_base *p_Var10;
  char *pcVar11;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint uVar12;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint extraout_EDX_07;
  uint extraout_EDX_08;
  uint extraout_EDX_09;
  uint extraout_EDX_10;
  uint extraout_EDX_11;
  uint extraout_EDX_12;
  uint extraout_EDX_13;
  uint extraout_EDX_14;
  uint extraout_EDX_15;
  uint extraout_EDX_16;
  uint extraout_EDX_17;
  uint extraout_EDX_18;
  uint extraout_EDX_19;
  uint extraout_EDX_20;
  uint extraout_EDX_21;
  uint extraout_EDX_22;
  uint extraout_EDX_23;
  uint extraout_EDX_24;
  uint extraout_EDX_25;
  uint extraout_EDX_26;
  uint extraout_EDX_27;
  uint extraout_EDX_28;
  uint extraout_EDX_29;
  uint extraout_EDX_30;
  uint extraout_EDX_31;
  uint extraout_EDX_32;
  uint extraout_EDX_33;
  uint extraout_EDX_34;
  uint extraout_EDX_35;
  undefined4 *unaff_EBX;
  int iVar13;
  char *pcVar14;
  int unaff_EBP;
  undefined4 *in_stack_fffffe90;
  
  Assembly_BitShiftLocking();
  *(uint *)(unaff_EBP + -0x10) = DAT_00569f5c ^ *(uint *)(unaff_EBP + 4);
  *(undefined4 *)(unaff_EBP + -0x4c) = 0;
  SexyWidget_ProcessInput(*(void **)(unaff_EBP + 0x18),(int *)(unaff_EBP + -0x24));
  if (*(char *)(unaff_EBP + 0x14) == '\0') {
    *(undefined4 *)(unaff_EBP + -4) = 1;
    this_00 = Runtime_FinalizeHeap();
  }
  else {
    *(undefined4 *)(unaff_EBP + -4) = 0;
    this_00 = Runtime_ValidateHeap();
  }
  *(undefined4 *)(unaff_EBP + -4) = 0xffffffff;
  *(facet **)(unaff_EBP + -0x28) = this_00;
  SmartPointer_Destructor((uint *)(unaff_EBP + -0x24));
  plVar6 = (locale *)
           SexyWidget_ProcessInput(*(void **)(unaff_EBP + 0x18),(int *)(unaff_EBP + -0x90));
  *(undefined4 *)(unaff_EBP + -4) = 2;
  pfVar7 = Memory_CopyImageBuffer(plVar6);
  *(facet **)(unaff_EBP + -0x1c) = pfVar7;
  SmartPointer_Destructor((uint *)(unaff_EBP + -0x90));
  *(undefined1 *)(unaff_EBP + 0x17) = 0;
  *(undefined1 *)(unaff_EBP + -0x11) = 0;
  *(undefined4 *)(unaff_EBP + -0x50) = 0xf;
  String_SetLength((void *)(unaff_EBP + -0x68),0);
  *(undefined4 *)(unaff_EBP + -4) = 3;
  *(undefined4 *)(unaff_EBP + -0xa0) = 0xf;
  String_SetLength((void *)(unaff_EBP + -0xb8),0);
  iVar13 = *(int *)this_00;
  *(undefined1 *)(unaff_EBP + -4) = 4;
  (**(code **)(iVar13 + 0x24))(unaff_EBP + -0x8c);
  this = *(int **)(unaff_EBP + 0xc);
  *(undefined4 *)(unaff_EBP + -0x20) = 0;
  uVar12 = extraout_EDX;
  do {
    if (3 < *(uint *)(unaff_EBP + -0x20)) break;
    iVar13 = *(int *)(unaff_EBP + -0x20);
    cVar1 = *(char *)(unaff_EBP + -0x8c + iVar13);
    if (cVar1 == ' ') {
      if (iVar13 != 3) {
        while (uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10)),
              uVar12 = extraout_EDX_28, (char)uVar8 == '\0') {
          if ((char)this[1] == '\0') {
            Graphics_BindTexture(this);
            uVar12 = extraout_EDX_27;
          }
          if ((*(byte *)(*(int *)(*(int *)(unaff_EBP + -0x1c) + 0x10) +
                        (uint)*(byte *)((int)this + 5) * 2) & 0x48) == 0) break;
          Graphics_SetViewport(this);
        }
      }
      goto LAB_004f901e;
    }
    if (cVar1 == '$') {
      Resource_FreeResource(this_00,unaff_EBP + -0x84);
      bVar2 = *(byte *)(*(int *)(unaff_EBP + 0x18) + 0xc);
      *(undefined1 *)(unaff_EBP + -4) = 5;
      if ((((bVar2 & 8) == 0) && (iVar13 == 3)) && (*(uint *)(unaff_EBP + -0x54) < 2)) {
        uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
        if ((char)uVar8 == '\0') {
          if ((char)this[1] == '\0') {
            Graphics_BindTexture(this);
          }
          pcVar14 = *(char **)(unaff_EBP + -0x80);
          if (*(uint *)(unaff_EBP + -0x6c) < 0x10) {
            pcVar14 = (char *)(unaff_EBP + -0x80);
          }
          if (*(char *)((int)this + 5) == *pcVar14) goto LAB_004f8f72;
        }
        PowerUp_ProcessFlakCannon((void *)(unaff_EBP + -0x84),0,0xffffffff);
      }
LAB_004f8f72:
      pcVar14 = *(char **)(unaff_EBP + -0x80);
      if (*(uint *)(unaff_EBP + -0x6c) < 0x10) {
        pcVar14 = (char *)(unaff_EBP + -0x80);
      }
      while (uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10)),
            uVar12 = extraout_EDX_26, (char)uVar8 == '\0') {
        iVar13 = *(int *)(unaff_EBP + -0x80);
        if (*(uint *)(unaff_EBP + -0x6c) < 0x10) {
          iVar13 = unaff_EBP + -0x80;
        }
        if (pcVar14 == (char *)(iVar13 + *(int *)(unaff_EBP + -0x70))) break;
        if ((char)this[1] == '\0') {
          Graphics_BindTexture(this);
          uVar12 = extraout_EDX_25;
        }
        if (*(char *)((int)this + 5) != *pcVar14) break;
        pcVar14 = pcVar14 + 1;
        Graphics_SetViewport(this);
      }
      iVar13 = *(int *)(unaff_EBP + -0x80);
      if (*(uint *)(unaff_EBP + -0x6c) < 0x10) {
        iVar13 = unaff_EBP + -0x80;
      }
      if (pcVar14 != (char *)(iVar13 + *(int *)(unaff_EBP + -0x70))) {
        *(undefined1 *)(unaff_EBP + 0x17) = 1;
      }
      iVar13 = unaff_EBP + -0x84;
LAB_004f8e43:
      *(undefined1 *)(unaff_EBP + -4) = 4;
      String_Reset(iVar13,uVar12,'\x01');
      uVar12 = extraout_EDX_16;
    }
    else if (cVar1 == '+') {
      uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
      uVar12 = extraout_EDX_09;
      if ((char)uVar8 != '\0') goto LAB_004f901e;
      iVar13 = STL_String_Insert(this_00,unaff_EBP + -0xf0);
      iVar13 = *(int *)(iVar13 + 0x14);
      *(undefined1 *)(unaff_EBP + -4) = 6;
      uVar12 = extraout_EDX_10;
      if (iVar13 == 0) {
LAB_004f8e00:
        bVar3 = false;
      }
      else {
        iVar13 = STL_String_Insert(this_00,unaff_EBP + -0x128);
        uVar12 = *(uint *)(iVar13 + 0x18);
        *(undefined1 *)(unaff_EBP + -4) = 7;
        if (uVar12 < 0x10) {
          pcVar14 = (char *)(iVar13 + 4);
        }
        else {
          pcVar14 = *(char **)(iVar13 + 4);
        }
        uVar12 = extraout_EDX_11;
        if ((char)this[1] == '\0') {
          Graphics_BindTexture(this);
          uVar12 = extraout_EDX_12;
        }
        cVar1 = *(char *)((int)this + 5);
        cVar5 = *pcVar14;
        String_Reset(unaff_EBP + -0x128,uVar12,'\x01');
        uVar12 = extraout_EDX_13;
        if (cVar5 != cVar1) goto LAB_004f8e00;
        bVar3 = true;
      }
      *(undefined1 *)(unaff_EBP + -4) = 4;
      String_Reset(unaff_EBP + -0xf0,uVar12,'\x01');
      if (bVar3) {
        Graphics_SetViewport(this);
        p_Var10 = (_String_base *)STL_String_Insert(this_00,unaff_EBP + -0x160);
        *(undefined1 *)(unaff_EBP + -4) = 8;
        PowerUp_ProcessThunderstrike
                  ((_String_base *)(unaff_EBP + -0x68),extraout_EDX_14,p_Var10,0,0xffffffff);
        iVar13 = unaff_EBP + -0x160;
        uVar12 = extraout_EDX_15;
        goto LAB_004f8e43;
      }
      iVar13 = Runtime_ReallocBlock(this_00,unaff_EBP + -0x144);
      iVar13 = *(int *)(iVar13 + 0x14);
      *(undefined1 *)(unaff_EBP + -4) = 9;
      uVar12 = extraout_EDX_17;
      if (iVar13 == 0) {
LAB_004f8eb5:
        bVar3 = false;
      }
      else {
        iVar13 = Runtime_ReallocBlock(this_00,unaff_EBP + -0x10c);
        uVar12 = *(uint *)(iVar13 + 0x18);
        *(undefined1 *)(unaff_EBP + -4) = 10;
        if (uVar12 < 0x10) {
          pcVar14 = (char *)(iVar13 + 4);
        }
        else {
          pcVar14 = *(char **)(iVar13 + 4);
        }
        uVar12 = extraout_EDX_18;
        if ((char)this[1] == '\0') {
          Graphics_BindTexture(this);
          uVar12 = extraout_EDX_19;
        }
        cVar1 = *(char *)((int)this + 5);
        cVar5 = *pcVar14;
        String_Reset(unaff_EBP + -0x10c,uVar12,'\x01');
        uVar12 = extraout_EDX_20;
        if (cVar5 != cVar1) goto LAB_004f8eb5;
        bVar3 = true;
      }
      *(undefined1 *)(unaff_EBP + -4) = 4;
      String_Reset(unaff_EBP + -0x144,uVar12,'\x01');
      uVar12 = extraout_EDX_21;
      if (bVar3) {
        Graphics_SetViewport(this);
        p_Var10 = (_String_base *)Runtime_ReallocBlock(this_00,unaff_EBP + -0x17c);
        *(undefined1 *)(unaff_EBP + -4) = 0xb;
        PowerUp_ProcessThunderstrike
                  ((_String_base *)(unaff_EBP + -0x68),extraout_EDX_22,p_Var10,0,0xffffffff);
        *(undefined1 *)(unaff_EBP + -4) = 4;
        String_Reset(unaff_EBP + -0x17c,extraout_EDX_23,'\x01');
        *(undefined1 *)(unaff_EBP + -0x11) = 1;
        uVar12 = extraout_EDX_24;
      }
    }
    else {
      if (cVar1 != 'v') goto LAB_004f901e;
      iVar13 = *(int *)this_00;
      *(undefined4 *)(unaff_EBP + -0x18) = 0;
      uVar8 = (**(code **)(iVar13 + 0x1c))();
      *(undefined4 *)(unaff_EBP + -0x48) = uVar8;
      Runtime_FreeBlock(this_00,unaff_EBP + -0xd4);
      pcVar14 = *(char **)(unaff_EBP + -0xd0);
      *(undefined1 *)(unaff_EBP + -4) = 0xc;
      if (*(uint *)(unaff_EBP + -0xbc) < 0x10) {
        pcVar14 = (char *)(unaff_EBP + -0xd0);
      }
      if (*pcVar14 < '\x01') {
        while (uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10)), (char)uVar8 == '\0')
        {
          if ((char)this[1] == '\0') {
            Graphics_BindTexture(this);
          }
          if (((uint)(int)*(char *)(*(int *)(*(int *)(unaff_EBP + -0x1c) + 0x10) +
                                   (uint)*(byte *)((int)this + 5) * 2) >> 2 & 1) == 0) break;
          if ((char)this[1] == '\0') {
            Graphics_BindTexture(this);
          }
          iVar13 = *this;
          iVar9 = this[1];
          Graphics_SetViewport(this);
          *(int *)(unaff_EBP + -0x9c) = iVar13;
          *(int *)(unaff_EBP + -0x98) = iVar9;
          if ((char)iVar9 == '\0') {
            Graphics_BindTexture((int *)(unaff_EBP + -0x9c));
          }
          Memory_AllocateSound
                    ((_String_base *)(unaff_EBP + -0xb8),1,
                     SUB41(*(undefined4 *)(unaff_EBP + -0x97),0));
        }
      }
      else {
        uVar4 = (**(code **)(*(int *)this_00 + 8))();
        iVar13 = 0;
        *(undefined1 *)(unaff_EBP + 0xf) = uVar4;
        Database_GetLastError
                  ((_String_base *)(unaff_EBP + -0x44),extraout_EDX_00,1,(_String_base)0x0);
        *(undefined1 *)(unaff_EBP + -4) = 0xd;
        uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
        if ((char)uVar8 == '\0') {
          do {
            if ((char)this[1] == '\0') {
              Graphics_BindTexture(this);
            }
            if (((uint)(int)*(char *)(*(int *)(*(int *)(unaff_EBP + -0x1c) + 0x10) +
                                     (uint)*(byte *)((int)this + 5) * 2) >> 2 & 1) == 0) {
              iVar9 = *(int *)(unaff_EBP + -0x40);
              if (*(uint *)(unaff_EBP + -0x2c) < 0x10) {
                iVar9 = unaff_EBP + -0x40;
              }
              if ((*(char *)(iVar9 + iVar13) == '\0') || (*(char *)(unaff_EBP + 0xf) == '\0'))
              break;
              if ((char)this[1] == '\0') {
                Graphics_BindTexture(this);
              }
              if (*(char *)((int)this + 5) != *(char *)(unaff_EBP + 0xf)) break;
              Memory_AllocateSound((_String_base *)(unaff_EBP + -0x44),1,(_String_base)0x0);
              iVar13 = iVar13 + 1;
            }
            else {
              if ((char)this[1] == '\0') {
                Graphics_BindTexture(this);
              }
              *(undefined1 *)(unaff_EBP + -0x88) = *(undefined1 *)((int)this + 5);
              Memory_AllocateSound
                        ((_String_base *)(unaff_EBP + -0xb8),1,
                         SUB41(*(undefined4 *)(unaff_EBP + -0x88),0));
              iVar9 = *(int *)(unaff_EBP + -0x40);
              if (*(uint *)(unaff_EBP + -0x2c) < 0x10) {
                iVar9 = unaff_EBP + -0x40;
              }
              if (*(char *)(iVar9 + iVar13) != '\x7f') {
                iVar9 = *(int *)(unaff_EBP + -0x40);
                if (*(uint *)(unaff_EBP + -0x2c) < 0x10) {
                  iVar9 = unaff_EBP + -0x40;
                }
                *(char *)(iVar9 + iVar13) = *(char *)(iVar9 + iVar13) + '\x01';
              }
            }
            Graphics_SetViewport(this);
            uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
          } while ((char)uVar8 == '\0');
          if (iVar13 != 0) {
            iVar9 = *(int *)(unaff_EBP + -0x40);
            if (*(uint *)(unaff_EBP + -0x2c) < 0x10) {
              iVar9 = unaff_EBP + -0x40;
            }
            if (*(char *)(iVar9 + iVar13) < '\x01') {
              *(undefined1 *)(unaff_EBP + 0x17) = 1;
            }
            else {
              iVar13 = iVar13 + 1;
            }
          }
        }
        pcVar14 = *(char **)(unaff_EBP + -0xd0);
        if (*(uint *)(unaff_EBP + -0xbc) < 0x10) {
          pcVar14 = (char *)(unaff_EBP + -0xd0);
        }
        if (*(char *)(unaff_EBP + 0x17) != '\0') {
LAB_004f8c7b:
          String_Reset(unaff_EBP + -0x44,(uint)pcVar14,'\x01');
          iVar13 = unaff_EBP + -0xd4;
          uVar12 = extraout_EDX_01;
          goto LAB_004f8e43;
        }
        while ((iVar13 != 0 && (cVar1 = *pcVar14, cVar1 != '\x7f'))) {
          iVar13 = iVar13 + -1;
          if (iVar13 != 0) {
            iVar9 = *(int *)(unaff_EBP + -0x40);
            if (*(uint *)(unaff_EBP + -0x2c) < 0x10) {
              iVar9 = unaff_EBP + -0x40;
            }
            if (cVar1 == *(char *)(iVar9 + iVar13)) goto LAB_004f8c56;
LAB_004f8c77:
            *(undefined1 *)(unaff_EBP + 0x17) = 1;
            goto LAB_004f8c7b;
          }
LAB_004f8c56:
          if (iVar13 == 0) {
            pcVar11 = *(char **)(unaff_EBP + -0x40);
            if (*(uint *)(unaff_EBP + -0x2c) < 0x10) {
              pcVar11 = (char *)(unaff_EBP + -0x40);
            }
            if (cVar1 < *pcVar11) goto LAB_004f8c77;
          }
          if ('\0' < pcVar14[1]) {
            pcVar14 = pcVar14 + 1;
          }
        }
        *(undefined1 *)(unaff_EBP + -4) = 0xc;
        String_Reset(unaff_EBP + -0x44,(uint)pcVar14,'\x01');
      }
      uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
      uVar12 = extraout_EDX_02;
      if ((char)uVar8 == '\0') {
        if ((char)this[1] == '\0') {
          Graphics_BindTexture(this);
        }
        cVar1 = *(char *)((int)this + 5);
        cVar5 = (**(code **)(**(int **)(unaff_EBP + -0x28) + 4))();
        uVar12 = extraout_EDX_03;
        if (cVar1 != cVar5) goto LAB_004f8d47;
        Graphics_SetViewport(this);
        uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
        uVar12 = extraout_EDX_04;
        if ((char)uVar8 != '\0') goto LAB_004f8d47;
        iVar13 = *(int *)(unaff_EBP + -0x48);
        do {
          if ((char)this[1] == '\0') {
            Graphics_BindTexture(this);
            uVar12 = extraout_EDX_05;
          }
          if (((uint)(int)*(char *)(*(int *)(*(int *)(unaff_EBP + -0x1c) + 0x10) +
                                   (uint)*(byte *)((int)this + 5) * 2) >> 2 & 1) == 0) break;
          if (*(int *)(unaff_EBP + -0x18) < iVar13) {
            if ((char)this[1] == '\0') {
              Graphics_BindTexture(this);
            }
            *(undefined1 *)(unaff_EBP + -0x4c) = *(undefined1 *)((int)this + 5);
            Memory_AllocateSound
                      ((_String_base *)(unaff_EBP + -0xb8),1,
                       SUB41(*(undefined4 *)(unaff_EBP + -0x4c),0));
            *(int *)(unaff_EBP + -0x18) = *(int *)(unaff_EBP + -0x18) + 1;
          }
          Graphics_SetViewport(this);
          uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10));
          uVar12 = extraout_EDX_06;
        } while ((char)uVar8 == '\0');
      }
      else {
LAB_004f8d47:
        iVar13 = *(int *)(unaff_EBP + -0x48);
      }
      if (*(int *)(unaff_EBP + -0xa4) == 0) {
        *(undefined1 *)(unaff_EBP + 0x17) = 1;
      }
      else if (*(int *)(unaff_EBP + -0x18) < iVar13) {
        iVar13 = iVar13 - *(int *)(unaff_EBP + -0x18);
        do {
          Memory_AllocateSound((_String_base *)(unaff_EBP + -0xb8),1,(_String_base)0x30);
          iVar13 = iVar13 + -1;
          uVar12 = extraout_EDX_07;
        } while (iVar13 != 0);
      }
      *(undefined1 *)(unaff_EBP + -4) = 4;
      String_Reset(unaff_EBP + -0xd4,uVar12,'\x01');
      this_00 = *(facet **)(unaff_EBP + -0x28);
      uVar12 = extraout_EDX_08;
    }
LAB_004f901e:
    *(int *)(unaff_EBP + -0x20) = *(int *)(unaff_EBP + -0x20) + 1;
  } while (*(char *)(unaff_EBP + 0x17) == '\0');
  if (*(char *)(unaff_EBP + 0x17) == '\0') {
    if (1 < *(uint *)(unaff_EBP + -0x54)) {
      pcVar14 = *(char **)(unaff_EBP + -100);
      if (*(uint *)(unaff_EBP + -0x50) < 0x10) {
        pcVar14 = (char *)(unaff_EBP + -100);
      }
      while (uVar8 = Graphics_LoadTexture(this,*(int **)(unaff_EBP + 0x10)),
            uVar12 = extraout_EDX_30, (char)uVar8 == '\0') {
        iVar13 = *(int *)(unaff_EBP + -100);
        if (*(uint *)(unaff_EBP + -0x50) < 0x10) {
          iVar13 = unaff_EBP + -100;
        }
        pcVar14 = pcVar14 + 1;
        if (pcVar14 == (char *)(*(int *)(unaff_EBP + -0x54) + iVar13)) break;
        if ((char)this[1] == '\0') {
          Graphics_BindTexture(this);
          uVar12 = extraout_EDX_29;
        }
        if (*(char *)((int)this + 5) != *pcVar14) break;
        Graphics_SetViewport(this);
      }
      iVar13 = *(int *)(unaff_EBP + -100);
      if (*(uint *)(unaff_EBP + -0x50) < 0x10) {
        iVar13 = unaff_EBP + -100;
      }
      if (pcVar14 != (char *)(iVar13 + *(int *)(unaff_EBP + -0x54))) goto LAB_004f909b;
    }
    if (*(char *)(unaff_EBP + -0x11) != '\0') {
      UI_ShowOptionsMenu((_String_base *)(unaff_EBP + -0xb8),0,1,(_String_base)0x2d);
      uVar12 = extraout_EDX_32;
    }
  }
  else {
LAB_004f909b:
    PowerUp_ProcessFlakCannon((void *)(unaff_EBP + -0xb8),0,0xffffffff);
    uVar12 = extraout_EDX_31;
  }
  String_Reset(*(int *)(unaff_EBP + 8),uVar12,'\0');
  PowerUp_ProcessThunderstrike
            (*(_String_base **)(unaff_EBP + 8),extraout_EDX_33,(_String_base *)(unaff_EBP + -0xb8),0
             ,0xffffffff);
  String_Reset(unaff_EBP + -0xb8,extraout_EDX_34,'\x01');
  String_Reset(unaff_EBP + -0x68,extraout_EDX_35,'\x01');
  ExceptionList = *(void **)(unaff_EBP + -0xc);
  Exception_SetMessage
            ((void *)(*(uint *)(unaff_EBP + -0x10) ^ *(uint *)(unaff_EBP + 4)),unaff_EBX,
             in_stack_fffffe90);
  return;
}


