/*
 * Function: Algorithm_SetDifference
 * Address: 0045d5b0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Algorithm_SetDifference(int *param_1)

{
  char *pcVar1;
  int *piVar2;
  HWND pHVar3;
  int X;
  undefined4 *puVar4;
  undefined4 uVar5;
  int iVar6;
  char *pcVar7;
  void *pvVar8;
  _String_base *p_Var9;
  int extraout_ECX;
  undefined4 extraout_ECX_00;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  int nHeight;
  int nWidth;
  ulonglong uVar10;
  BOOL bRepaint;
  undefined1 local_a8 [28];
  _String_base local_8c [28];
  _String_base local_70 [28];
  undefined1 local_54 [12];
  int local_48;
  int local_44;
  int local_40;
  int local_3c;
  HWND local_38;
  _String_base local_34 [4];
  uint local_30;
  tagRECT local_28;
  int *local_18;
  char local_11;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_00513af9;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  if ((HWND)param_1[0xc3] != (HWND)0x0) {
    ExceptionList = &local_10;
    SetWindowLongA((HWND)param_1[0xc3],-0x15,0);
    pHVar3 = (HWND)param_1[0xc3];
    param_1[0xc3] = 0;
    DestroyWindow(pHVar3);
    *(undefined4 *)(param_1[0xb7] + 0x10) = 0;
  }
  if ((*(char *)((int)param_1 + 0x491) == '\0') &&
     ((*(char *)((int)param_1 + 0x2fe) == '\0' || ((char)param_1[0xc0] != '\0')))) {
    if ((uint)param_1[0x16] < 0x10) {
      piVar2 = param_1 + 0x11;
    }
    else {
      piVar2 = (int *)param_1[0x11];
    }
    pHVar3 = CreateWindowExA(8,"MainWindow",(LPCSTR)piVar2,0x90000000,0,0,param_1[0x21],
                             param_1[0x22],(HWND)0x0,(HMENU)0x0,DAT_005a33c0,(LPVOID)0x0);
    param_1[0xc3] = (int)pHVar3;
    *(undefined1 *)((int)param_1 + 0x2ff) = 0;
  }
  else {
    local_28.right = param_1[0x21];
    local_28.bottom = param_1[0x22];
    local_28.left = 0;
    local_28.top = 0;
    AdjustWindowRect(&local_28,0x82ca0000,0);
    nWidth = local_28.right - local_28.left;
    nHeight = local_28.bottom - local_28.top;
    SystemParametersInfoA(0x30,0,&local_48,0);
    iVar6 = param_1[0x1f];
    X = 0x40;
    local_18 = (int *)0x40;
    if (iVar6 != -1) {
      X = iVar6;
      if (iVar6 < local_48 + 4) {
        X = local_48 + 4;
      }
      local_18 = (int *)param_1[0x20];
      if (param_1[0x20] < local_44 + 4) {
        local_18 = (int *)(local_44 + 4);
      }
      if (local_40 + -4 <= X + nWidth) {
        X = (local_40 + -4) - nWidth;
      }
      if (local_3c + -4 <= (int)local_18 + nHeight) {
        local_18 = (int *)((local_3c + -4) - nHeight);
      }
    }
    if ((uint)param_1[0x16] < 0x10) {
      piVar2 = param_1 + 0x11;
    }
    else {
      piVar2 = (int *)param_1[0x11];
    }
    iVar6 = (int)local_18;
    local_18 = piVar2;
    local_38 = CreateWindowExA(0,"MainWindow",(LPCSTR)piVar2,0x82ca0000,X,iVar6,nWidth,nHeight,
                               (HWND)0x0,(HMENU)0x0,DAT_005a33c0,(LPVOID)0x0);
    param_1[0xc3] = (int)local_38;
    if (param_1[0x1f] == -1) {
      local_18 = (int *)((local_3c - local_44) - nHeight);
      bRepaint = 0;
      iVar6 = nWidth;
      uVar10 = Math_FloatToUInt64();
      MoveWindow(local_38,((local_40 - local_48) - nWidth) / 2 + local_48,local_44 - (int)uVar10,
                 iVar6,nHeight,bRepaint);
    }
    *(undefined1 *)((int)param_1 + 0x2ff) = 1;
  }
  SetWindowLongA((HWND)param_1[0xc3],-0x15,(LONG)param_1);
  if (param_1[0xca] == 0) {
    local_38 = (HWND)operator_new(0xd00);
    local_8 = 0;
    if (local_38 == (HWND)0x0) {
      puVar4 = (undefined4 *)0x0;
    }
    else {
      puVar4 = Player_InitializePosition(local_38,param_1);
    }
    param_1[0xca] = (int)puVar4;
    local_8 = 0xffffffff;
    local_11 = '\0';
    local_28.bottom = 0xf;
    local_28.right = 0;
    local_30 = local_30 & 0xffffff00;
    pcVar1 = "Is3D";
    do {
      pcVar7 = pcVar1;
      pcVar1 = pcVar7 + 1;
    } while (*pcVar7 != '\0');
    String_Assign(local_34,(_String_base *)&DAT_00531d44,(uint)(pcVar7 + -0x531d44));
    local_8 = 1;
    uVar5 = STL_Vector_Clear(param_1,local_34,&local_11);
    local_8 = 0xffffffff;
    if (0xf < (uint)local_28.bottom) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,local_30);
    }
    if ((char)uVar5 != '\0') {
      if (*(char *)((int)param_1 + 0x547) != '\0') {
        *(undefined1 *)((int)param_1 + 0x547) = 0;
        *(undefined1 *)(param_1 + 0x152) = 1;
      }
      if (local_11 != '\0') {
        *(undefined1 *)(param_1 + 0x152) = 1;
      }
      *(char *)(param_1[0xca] + 0x38) = local_11;
    }
  }
  (**(code **)(*param_1 + 0xb0))();
  iVar6 = DirectXRenderer_Initialize3DGraphics
                    ((void *)param_1[0xca],(HWND)param_1[0xc3],
                     (int *)(uint)*(byte *)((int)param_1 + 0x2ff));
  Threading_InitializeAndSetupMusic((int)param_1);
  if ((*(int *)(param_1[0xca] + 0x34) != 0) &&
     (*(char *)(*(int *)(param_1[0xca] + 0x34) + 0x82) != '\0')) {
    local_28.bottom = 0xf;
    local_28.right = 0;
    local_30 = local_30 & 0xffffff00;
    pcVar1 = "Is3D";
    do {
      pcVar7 = pcVar1;
      pcVar1 = pcVar7 + 1;
    } while (*pcVar7 != '\0');
    String_Assign(local_34,(_String_base *)&DAT_00531d44,(uint)(pcVar7 + -0x531d44));
    local_8 = 2;
    Registry_DeleteGameSettings(param_1,local_34);
    local_8 = 0xffffffff;
    if (0xf < (uint)local_28.bottom) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_30,extraout_EDX);
    }
  }
  if (*(char *)((int)param_1 + 0x2fe) == '\0') {
LAB_0045d9b1:
    if ((iVar6 == 4) || (iVar6 == 5)) {
      *(undefined1 *)((int)param_1 + 0x302) = 1;
      (**(code **)(*param_1 + 0xf0))(1);
      goto LAB_0045da9f;
    }
  }
  else {
    if (iVar6 == 6) {
      if (*(char *)((int)param_1 + 0x302) == '\0') {
        *(undefined1 *)((int)param_1 + 0x301) = 1;
        (**(code **)(*param_1 + 0xf0))(0);
        ExceptionList = local_10;
        return;
      }
      Level_InitializeDictastroika(local_34,"Please set your desktop color depth to 16 bit.");
      local_8 = 3;
      (**(code **)(*param_1 + 0x70))(local_34);
      if ((uint)local_28.bottom < 0x10) {
        Algorithm_EqualRange(param_1,(char *)0x1);
        ExceptionList = local_10;
        return;
      }
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_30,extraout_EDX_00);
    }
    if (*(char *)((int)param_1 + 0x2fe) == '\0') goto LAB_0045d9b1;
  }
  if (iVar6 == 7) {
LAB_0045d9eb:
    DirectDrawRenderer_Initialize(param_1,'\0',1);
    ExceptionList = local_10;
    return;
  }
  if (iVar6 != 0) {
    uVar5 = Compression_GetCompressedSize((int)param_1);
    if ((char)uVar5 != '\0') goto LAB_0045d9eb;
    pvVar8 = System_CreateThread(local_a8,iVar6);
    local_8 = 4;
    p_Var9 = Survival_LoadConfiguration
                       (local_70,(_String_base *)"Failed to initialize DirectDraw: ",(int)pvVar8);
    local_8._0_1_ = 5;
    p_Var9 = Intel_DisplayPopulationData
                       (extraout_ECX_00,extraout_EDX_01,local_8c,p_Var9,
                        (_String_base *)&DAT_00531ca0);
    local_8._0_1_ = 6;
    p_Var9 = Background_ProcessBackgroundLayer
                       (param_1[0xca] + 0xce4,(uint)local_54,(_String_base *)local_54,p_Var9,
                        param_1[0xca] + 0xce4);
    local_8 = CONCAT31(local_8._1_3_,7);
    (**(code **)(*param_1 + 0x70))(p_Var9);
    String_Destructor((int)local_54,extraout_EDX_02);
    String_Destructor((int)local_8c,extraout_EDX_03);
    String_Destructor((int)local_70,extraout_EDX_04);
    local_8 = 0xffffffff;
    String_Destructor((int)local_a8,extraout_EDX_05);
    Algorithm_EqualRange(param_1,(char *)0x1);
  }
LAB_0045da9f:
  if (*(char *)((int)param_1 + 0x453) != '\0') {
    if (*(char *)((int)param_1 + 0x3d1) != '\0') {
      (**(code **)(*param_1 + 0xe0))(1);
    }
    *(undefined1 *)((int)param_1 + 0x453) = 0;
    Threading_CreateThread(param_1);
  }
  uVar5 = SexyWidget_GetRotation(param_1[0xca]);
  *(undefined4 *)(param_1[0xb7] + 0x10) = uVar5;
  UI_Widget_ValidateRender(param_1[0xb7]);
  SetTimer((HWND)param_1[0xc3],100,param_1[0xf9],(TIMERPROC)0x0);
  ExceptionList = local_10;
  return;
}


