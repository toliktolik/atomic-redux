/*
 * Function: GIF_WriteHeader
 * Address: 004d1580
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void GIF_WriteHeader(void)

{
  byte bVar1;
  byte bVar2;
  uint *puVar3;
  char cVar4;
  uint uVar5;
  int iVar6;
  int iVar7;
  int *unaff_EBX;
  byte *pbVar8;
  int *piVar9;
  undefined4 *puVar10;
  int iVar11;
  undefined4 *puVar12;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffec8;
  undefined4 *in_stack_fffffecc;
  uint local_34;
  uint local_30;
  uint local_2c;
  uint local_28;
  byte local_24;
  int local_20;
  int local_1c;
  int local_18;
  undefined4 *local_14;
  byte *local_10;
  int local_c;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  local_14 = (undefined4 *)unaff_EBX[6];
  pbVar8 = (byte *)*local_14;
  iVar11 = local_14[1];
  if (iVar11 == 0) {
    cVar4 = (*(code *)local_14[3])();
    if (cVar4 == '\0') goto LAB_004d189e;
    pbVar8 = (byte *)*local_14;
    iVar11 = local_14[1];
    local_10 = pbVar8;
    local_c = iVar11;
  }
  local_18 = (uint)*pbVar8 << 8;
  iVar11 = iVar11 + -1;
  pbVar8 = pbVar8 + 1;
  if (iVar11 == 0) {
    cVar4 = (*(code *)local_14[3])();
    if (cVar4 == '\0') {
LAB_004d189e:
      Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffec8,in_stack_fffffecc);
      return;
    }
    pbVar8 = (byte *)*local_14;
    iVar11 = local_14[1];
    local_10 = pbVar8;
    local_c = iVar11;
  }
  local_18 = local_18 + (uint)*pbVar8 + -2;
  iVar11 = iVar11 + -1;
  pbVar8 = pbVar8 + 1;
  do {
    if (local_18 < 0x11) {
      if (local_18 != 0) {
        *(undefined4 *)(*unaff_EBX + 0x14) = 0xb;
        (**(code **)*unaff_EBX)();
      }
      local_14[1] = iVar11;
      *local_14 = pbVar8;
      Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffec8,in_stack_fffffecc);
      return;
    }
    if (iVar11 == 0) {
      cVar4 = (*(code *)local_14[3])();
      if (cVar4 == '\0') goto LAB_004d189e;
      pbVar8 = (byte *)*local_14;
      iVar11 = local_14[1];
      local_10 = pbVar8;
      local_c = iVar11;
    }
    bVar2 = *pbVar8;
    uVar5 = (uint)bVar2;
    *(undefined4 *)(*unaff_EBX + 0x14) = 0x50;
    *(uint *)(*unaff_EBX + 0x18) = uVar5;
    iVar11 = iVar11 + -1;
    pbVar8 = pbVar8 + 1;
    (**(code **)(*unaff_EBX + 4))();
    local_34 = local_34 & 0xffffff00;
    local_1c = 0;
    local_20 = 1;
    do {
      puVar10 = local_14;
      iVar7 = local_20;
      if (iVar11 == 0) {
        cVar4 = (*(code *)local_14[3])();
        if (cVar4 == '\0') goto LAB_004d189e;
        iVar11 = puVar10[1];
        pbVar8 = (byte *)*puVar10;
        iVar7 = local_20;
      }
      bVar1 = *pbVar8;
      *(byte *)((int)&local_34 + iVar7) = bVar1;
      iVar11 = iVar11 + -1;
      pbVar8 = pbVar8 + 1;
      local_1c = local_1c + (uint)bVar1;
      local_20 = iVar7 + 1;
      local_10 = pbVar8;
      local_c = iVar11;
    } while (local_20 < 0x11);
    iVar7 = *unaff_EBX;
    local_18 = local_18 + -0x11;
    *(uint *)(iVar7 + 0x18) = local_34 >> 8 & 0xff;
    *(uint *)(iVar7 + 0x1c) = local_34 >> 0x10 & 0xff;
    *(uint *)(iVar7 + 0x20) = local_34 >> 0x18;
    *(uint *)(iVar7 + 0x24) = local_30 & 0xff;
    *(uint *)(iVar7 + 0x28) = local_30 >> 8 & 0xff;
    *(uint *)(iVar7 + 0x2c) = local_30 >> 0x10 & 0xff;
    *(uint *)(iVar7 + 0x30) = local_30 >> 0x18;
    *(uint *)(iVar7 + 0x34) = local_2c & 0xff;
    *(undefined4 *)(*unaff_EBX + 0x14) = 0x56;
    (**(code **)(*unaff_EBX + 4))();
    iVar7 = *unaff_EBX;
    *(uint *)(iVar7 + 0x18) = local_2c >> 8 & 0xff;
    *(uint *)(iVar7 + 0x1c) = local_2c >> 0x10 & 0xff;
    *(uint *)(iVar7 + 0x20) = local_2c >> 0x18;
    *(uint *)(iVar7 + 0x24) = local_28 & 0xff;
    *(uint *)(iVar7 + 0x28) = local_28 >> 8 & 0xff;
    *(uint *)(iVar7 + 0x2c) = local_28 >> 0x10 & 0xff;
    *(uint *)(iVar7 + 0x30) = local_28 >> 0x18;
    *(uint *)(iVar7 + 0x34) = (uint)local_24;
    *(undefined4 *)(*unaff_EBX + 0x14) = 0x56;
    (**(code **)(*unaff_EBX + 4))();
    if ((0x100 < local_1c) || (local_18 < local_1c)) {
      *(undefined4 *)(*unaff_EBX + 0x14) = 8;
      (**(code **)*unaff_EBX)();
    }
    local_20 = 0;
    iVar7 = local_1c;
    if (0 < local_1c) {
      do {
        puVar10 = local_14;
        iVar6 = local_20;
        if (iVar11 == 0) {
          cVar4 = (*(code *)local_14[3])();
          if (cVar4 == '\0') goto LAB_004d189e;
          iVar11 = puVar10[1];
          pbVar8 = (byte *)*puVar10;
          iVar6 = local_20;
          iVar7 = local_1c;
        }
        bVar1 = *pbVar8;
        iVar11 = iVar11 + -1;
        pbVar8 = pbVar8 + 1;
        (&stack0xfffffec8)[iVar6] = bVar1;
        local_c = iVar11;
        local_10 = pbVar8;
        local_20 = iVar6 + 1;
      } while (iVar6 + 1 < iVar7);
    }
    local_18 = local_18 - iVar7;
    if ((bVar2 & 0x10) == 0) {
      iVar11 = uVar5 + 0x28;
    }
    else {
      iVar11 = uVar5 + 0x1c;
      uVar5 = uVar5 - 0x10;
    }
    piVar9 = unaff_EBX + iVar11;
    if (((int)uVar5 < 0) || (3 < (int)uVar5)) {
      *(undefined4 *)(*unaff_EBX + 0x14) = 0x1e;
      *(uint *)(*unaff_EBX + 0x18) = uVar5;
      (**(code **)*unaff_EBX)();
    }
    if (*piVar9 == 0) {
      iVar11 = ZLIB_Uncompress((int)unaff_EBX);
      *piVar9 = iVar11;
    }
    puVar3 = (uint *)*piVar9;
    *puVar3 = local_34;
    puVar3[1] = local_30;
    puVar3[2] = local_2c;
    puVar3[3] = local_28;
    *(byte *)(puVar3 + 4) = local_24;
    puVar10 = (undefined4 *)&stack0xfffffec8;
    puVar12 = (undefined4 *)(*piVar9 + 0x11);
    for (iVar7 = 0x40; iVar11 = local_c, pbVar8 = local_10, iVar7 != 0; iVar7 = iVar7 + -1) {
      *puVar12 = *puVar10;
      puVar10 = puVar10 + 1;
      puVar12 = puVar12 + 1;
    }
  } while( true );
}


