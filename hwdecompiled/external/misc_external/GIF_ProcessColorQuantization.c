/*
 * Function: GIF_ProcessColorQuantization
 * Address: 004d3d90
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 __cdecl GIF_ProcessColorQuantization(uint *param_1,undefined4 *param_2)

{
  uint *puVar1;
  uint *puVar2;
  uint uVar3;
  void *pvVar4;
  int iVar5;
  int *piVar6;
  int iVar7;
  undefined4 extraout_ECX;
  undefined4 extraout_ECX_00;
  int extraout_ECX_01;
  uint uVar8;
  uint extraout_EDX;
  uint local_14;
  uint local_10;
  
  puVar1 = param_1;
  puVar2 = param_1;
  for (iVar7 = 0xd; iVar7 != 0; iVar7 = iVar7 + -1) {
    *puVar2 = 0;
    puVar2 = puVar2 + 1;
  }
  uVar3 = param_2[1];
  local_14 = 0;
  if (0 < (int)uVar3) {
    piVar6 = (int *)param_2[2];
    uVar8 = uVar3;
    do {
      if (0 < *piVar6) {
        local_14 = local_14 + 1;
      }
      piVar6 = piVar6 + 1;
      uVar8 = uVar8 - 1;
    } while (uVar8 != 0);
  }
  param_1[1] = uVar3;
  param_1[2] = local_14;
  *param_1 = *param_2;
  param_1[0xb] = param_2[4];
  param_1[0xc] = param_2[5];
  puVar2 = GIF_OptimizePalette(param_2[2],param_2[1],local_14);
  piVar6 = (int *)&stack0xffffffdc;
  System_LoadLibrary(extraout_ECX);
  if (puVar2 != (uint *)0x0) {
    if (0 < (int)local_14) {
      param_1 = puVar2;
      local_10 = local_14;
      do {
        uVar3 = BitOps_ReverseBits32();
        *param_1 = uVar3;
        *(uint **)(&stack0xffffffdc + -(int)puVar2 + (int)param_1) = param_1;
        param_1 = param_1 + 1;
        local_10 = local_10 - 1;
      } while (local_10 != 0);
    }
    System_GetModuleHandle();
    System_LoadLibrary(extraout_ECX_00);
    pvVar4 = _malloc(local_14 * 4);
    puVar1[5] = (uint)pvVar4;
    iVar5 = 0;
    iVar7 = extraout_ECX_01;
    if (0 < (int)local_14) {
      do {
        iVar7 = *(int *)(&stack0xffffffdc + iVar5 * 4) - (int)puVar2 >> 2;
        *(int *)(&stack0xffffffdc + iVar7 * 4) = iVar5;
        iVar5 = iVar5 + 1;
      } while (iVar5 < (int)local_14);
      if (0 < (int)local_14) {
        do {
          *(undefined4 *)(puVar1[5] + *piVar6 * 4) =
               *(undefined4 *)(((int)puVar2 - (int)&stack0xffffffdc) + (int)piVar6);
          piVar6 = piVar6 + 1;
          local_14 = local_14 - 1;
        } while (local_14 != 0);
        iVar7 = 0;
      }
    }
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(iVar7,(uint)puVar2);
  }
  Memory_CleanupStructure(0,extraout_EDX,param_1);
  return 0xffffffff;
}


