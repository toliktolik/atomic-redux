/*
 * Function: Memory_GarbageCollection
 * Address: 004140d0
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void Memory_GarbageCollection(int *param_1,char *param_2)

{
  char cVar1;
  byte bVar2;
  int *piVar3;
  byte *pbVar4;
  char *pcVar5;
  int iVar6;
  int iVar7;
  uint uVar8;
  undefined1 local_2c [4];
  char local_28;
  int local_24;
  byte local_20;
  undefined3 uStack_1f;
  int local_1c;
  uint local_18;
  undefined1 *local_14;
  void *pvStack_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x5103e0;
  pvStack_10 = ExceptionList;
  local_14 = &stack0xffffffc8;
  local_18 = 0;
  pcVar5 = param_2;
  do {
    cVar1 = *pcVar5;
    pcVar5 = pcVar5 + 1;
  } while (cVar1 != '\0');
  iVar6 = (int)pcVar5 - (int)(param_2 + 1);
  local_1c = *(int *)(*(int *)(*param_1 + 4) + 0x14 + (int)param_1);
  if ((local_1c < 1) || (local_1c <= iVar6)) {
    local_1c = 0;
  }
  else {
    local_1c = local_1c - iVar6;
  }
  ExceptionList = &pvStack_10;
  local_24 = iVar6;
  Stream_Constructor(local_2c,param_1);
  local_8 = 0;
  if (local_28 == '\0') {
    local_18 = 4;
    Memory_PoolManager();
    return;
  }
  local_8 = 1;
  if ((*(uint *)(*(int *)(*param_1 + 4) + 0xc + (int)param_1) & 0x1c0) != 0x40) {
    for (; 0 < local_1c; local_1c = local_1c + -1) {
      piVar3 = *(int **)(*(int *)(*param_1 + 4) + 0x28 + (int)param_1);
      bVar2 = *(byte *)(*(int *)(*param_1 + 4) + 0x30 + (int)param_1);
      _local_20 = CONCAT31(uStack_1f,bVar2);
      uVar8 = *(uint *)piVar3[9];
      if (uVar8 == 0) {
LAB_004141ac:
        uVar8 = (**(code **)(*piVar3 + 4))(bVar2);
      }
      else {
        iVar6 = *(int *)piVar3[0xd];
        if (iVar6 + uVar8 <= uVar8) goto LAB_004141ac;
        *(int *)piVar3[0xd] = iVar6 + -1;
        pbVar4 = *(byte **)piVar3[9];
        *(byte **)piVar3[9] = pbVar4 + 1;
        *pbVar4 = bVar2;
        uVar8 = (uint)bVar2;
      }
      iVar6 = local_24;
      if (uVar8 == 0xffffffff) {
        local_18 = local_18 | 4;
        break;
      }
    }
    if (local_18 != 0) goto LAB_004141f0;
  }
  iVar7 = (**(code **)(**(int **)(*(int *)(*param_1 + 4) + 0x28 + (int)param_1) + 0x1c))
                    (param_2,iVar6);
  if (iVar7 == iVar6) {
    for (; 0 < local_1c; local_1c = local_1c + -1) {
      piVar3 = *(int **)(*(int *)(*param_1 + 4) + 0x28 + (int)param_1);
      bVar2 = *(byte *)(*(int *)(*param_1 + 4) + 0x30 + (int)param_1);
      local_24 = CONCAT31(local_24._1_3_,bVar2);
      uVar8 = *(uint *)piVar3[9];
      if (uVar8 == 0) {
LAB_0041425a:
        uVar8 = (**(code **)(*piVar3 + 4))(bVar2);
      }
      else {
        iVar6 = *(int *)piVar3[0xd];
        if (iVar6 + uVar8 <= uVar8) goto LAB_0041425a;
        *(int *)piVar3[0xd] = iVar6 + -1;
        pbVar4 = *(byte **)piVar3[9];
        *(byte **)piVar3[9] = pbVar4 + 1;
        *pbVar4 = bVar2;
        uVar8 = (uint)bVar2;
      }
      if (uVar8 == 0xffffffff) {
        local_18 = local_18 | 4;
        *(undefined4 *)((int)param_1 + *(int *)(*param_1 + 4) + 0x14) = 0;
        Memory_PoolManager();
        return;
      }
    }
  }
  else {
    local_18 = 4;
  }
LAB_004141f0:
  *(undefined4 *)(*(int *)(*param_1 + 4) + 0x14 + (int)param_1) = 0;
  Memory_PoolManager();
  return;
}


