/*
 * Function: Runtime_MemoryCheck
 * Address: 00503e27
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00503f0b) overlaps instruction at (ram,0x00503f06)
    */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

byte * __fastcall Runtime_MemoryCheck(byte *param_1,byte *param_2)

{
  undefined4 uVar1;
  uint uVar2;
  uint uVar3;
  uint uVar4;
  code *pcVar5;
  ulonglong uVar6;
  uint5 uVar7;
  uint3 uVar8;
  byte *pbVar9;
  int iVar10;
  byte bVar11;
  byte *pbVar12;
  byte *extraout_ECX;
  uint uVar13;
  undefined4 extraout_ECX_00;
  char cVar14;
  undefined2 uVar15;
  int iVar16;
  byte *pbVar17;
  undefined1 *puVar18;
  byte bVar19;
  undefined1 *unaff_EBX;
  byte **ppbVar20;
  byte *unaff_EBP;
  byte *unaff_ESI;
  byte *pbVar21;
  uint *unaff_EDI;
  uint *puVar22;
  char *pcVar23;
  char *pcVar24;
  undefined2 in_ES;
  undefined2 in_CS;
  byte in_CF;
  bool bVar25;
  undefined1 uVar26;
  bool bVar27;
  undefined1 uVar28;
  byte in_AF;
  char in_ZF;
  undefined1 uVar29;
  byte bVar30;
  undefined2 in_FPUControlWord;
  float10 extraout_ST0;
  undefined8 uVar31;
  uint unaff_retaddr;
  byte *pbStack_5747;
  char *pcStack_5743;
  undefined4 uStack_573b;
  undefined1 *puStack_18;
  uint uStack_c;
  byte *pbStack_8;
  byte *pbStack_4;
  
  bVar30 = 0;
  do {
    while( true ) {
      pbVar9 = (byte *)in((short)param_2);
      out((short)param_2,(char)pbVar9);
      pbVar12 = param_1 + -1;
      uVar15 = (undefined2)((uint)pbVar12 >> 0x10);
      if (pbVar12 == (byte *)0x0 || in_ZF != '\0') break;
      iVar16 = CONCAT22((short)((uint)pbVar9 >> 0x10),CONCAT11(0xb,(char)pbVar9));
      iVar10 = iVar16 + 1;
      param_2 = (byte *)(iVar10 >> 0x1f);
      in_ZF = (byte)((byte)((uint)iVar10 >> 8) & (byte)unaff_EDI[iVar16 + -9]) == 0;
      in_CF = 9 < ((byte)iVar10 & 0xf) | in_AF;
      param_1 = (byte *)CONCAT31((int3)(CONCAT22(uVar15,0x3d00) >> 8),0x4a);
      in_AF = in_CF;
    }
    bVar19 = (byte)((uint)pbVar12 >> 8);
    bVar11 = bVar19 + 0x7b;
    bVar25 = 0x84 < bVar19 || CARRY1(bVar11,in_CF);
    pbStack_4 = unaff_EBP;
    if (CONCAT22(uVar15,CONCAT11(bVar11 + in_CF,*unaff_EBX)) == 0) {
      uRamffffffc7 = in_FPUControlWord;
      if ((byte)(bVar11 + in_CF) != '\0') {
        pbVar12 = unaff_ESI + 1;
        pbVar17 = (byte *)0x0;
        unaff_ESI = unaff_EBP;
LAB_00503efd:
        cVar14 = ((char)param_2 - param_2[0x40ce1840]) - bVar25;
        uVar15 = (undefined2)CONCAT31((int3)((uint)param_2 >> 8),cVar14);
        pbVar21 = pbVar9;
        if (cVar14 == '\0') {
LAB_00503f2d:
          pcVar23 = (char *)((int)unaff_EDI + -1);
          uVar8 = (uint3)((uint)pbVar17 >> 8);
          uVar13 = CONCAT31((int3)((uint)pbVar12 >> 8),0xb5);
          puVar18 = (undefined1 *)((int)(int3)(uVar8 & 0xe2fdea) >> 0x17);
          puStack_18 = (undefined1 *)&pbStack_8;
          ppbVar20 = &pbStack_8;
          cVar14 = '\x03';
          pbVar9 = unaff_ESI;
          do {
            pbVar9 = pbVar9 + -4;
            ppbVar20 = ppbVar20 + -1;
            *ppbVar20 = (byte *)*(undefined4 *)pbVar9;
            cVar14 = cVar14 + -1;
          } while ('\0' < cVar14);
          pbVar9 = (byte *)((CONCAT31(uVar8,DAT_0cd32d1c) & 0xe2fdeaff) + 0x25);
          *pbVar9 = *pbVar9 >> 1;
          iVar16 = in(0xf2);
          pbVar9 = (byte *)((uint)unaff_EBX | (uint)pcVar23);
          uVar15 = (undefined2)iVar16;
          uStack_573b = 7;
          pbStack_4 = (byte *)CONCAT22(pbStack_4._2_2_,in_CS);
          bVar25 = false;
          if ((POPCOUNT((uint)puVar18 & 0x8d) & 1U) != 0) {
            pcStack_5743 = (char *)CONCAT22(pcStack_5743._2_2_,in_CS);
            pbStack_8 = unaff_ESI;
            do {
              puVar22 = (uint *)(puVar18 + 0x645bb13d);
              bVar27 = CARRY4(*puVar22,(uint)pbVar21) ||
                       CARRY4((uint)(pbVar21 + *puVar22),(uint)bVar25);
              *puVar22 = (uint)(pbVar21 + *puVar22 + bVar25);
              pbStack_5747 = (byte *)CONCAT22(pbStack_5747._2_2_,in_ES);
              uVar13 = uVar13 - 1;
              if (uVar13 == 0) {
                out((short)iVar16,
                    ((int)uVar13 < 0) * -0x80 | (uVar13 == 0) * '@' | (in_AF & 1) * '\x10' |
                    ((POPCOUNT(uVar13 & 0xff) & 1U) == 0) * '\x04' | bVar27);
                LOCK();
                UNLOCK();
                return pbVar9;
              }
              while( true ) {
                iVar10 = _DAT_3f51dd9e;
                pbVar12 = pbVar9;
                in((short)iVar16);
                if (bVar27) break;
                pbVar9 = pbVar21 + 0x4284fa7e;
                bVar11 = (byte)uVar13 & 0x1f;
                bVar30 = *pbVar9;
                *pbVar9 = *pbVar9 << bVar11;
                bVar25 = (uVar13 & 0x1f) != 0;
                bVar30 = !bVar25 & bVar27 | (bVar25 && (char)(bVar30 << bVar11 - 1) < '\0');
                uVar31 = (*(code *)(iVar10 + 0x3d98a70d))();
                iVar16 = (int)((ulonglong)uVar31 >> 0x20);
                uVar13 = CONCAT22((short)((uint)extraout_ECX_00 >> 0x10),
                                  CONCAT11(((char)((uint)extraout_ECX_00 >> 8) -
                                           (char)((uint)pbVar12 >> 8)) - bVar30,
                                           (char)extraout_ECX_00));
                iVar10 = (int)uVar31 + -1;
                bVar30 = (byte)iVar10 | 0x3e;
                bVar11 = (char)((uint)iVar10 >> 8) + (9 < (bVar30 & 0xf) | in_AF);
                uVar15 = (undefined2)((ulonglong)uVar31 >> 0x20);
                if ((POPCOUNT(bVar30) & 1U) != 0) {
                  out(*pbVar21,uVar15);
                  bVar25 = 9 < ((byte)_DAT_84fe5e87 & 0xf) || (bVar11 & 0x10) != 0;
                  bVar30 = (byte)_DAT_84fe5e87 + bVar25 * '\x06';
                  out(uVar15,CONCAT31((int3)((uint)_DAT_84fe5e87 >> 8),
                                      bVar30 + (0x90 < (bVar30 & 0xf0) |
                                               (bVar11 & 1) != 0 | bVar25 * (0xf9 < bVar30)) * '`'))
                  ;
                    /* WARNING: Bad instruction - Truncating control flow here */
                  halt_baddata();
                }
                out(*(undefined4 *)pbVar21,uVar15);
                in_AF = (bVar11 & 0x10) != 0;
                bVar27 = (bVar11 & 1) != 0;
                *(double *)(uVar13 + 0x3f) =
                     (double)((float10)*(short *)pbVar21 / extraout_ST0 -
                             (float10)*(double *)(iVar16 + 0x5a1e45fb + (int)pbVar21 * 8));
                pbVar9 = (byte *)0xa1ec616c;
                pbVar21 = pbVar21 + 4;
                pbStack_5747 = pbVar12;
                pcStack_5743 = pcVar23;
              }
              pbVar9 = (byte *)CONCAT31((int3)((uint)pbVar12 >> 8),
                                        (byte)pbVar12 - *(byte *)(uVar13 - 0x1d));
              puVar22 = (uint *)(uVar13 + 0x14);
              uVar4 = (uint)((byte)pbVar12 < *(byte *)(uVar13 - 0x1d));
              uVar2 = *puVar22;
              uVar3 = *puVar22;
              *puVar22 = (uVar3 - 0x5f) - uVar4;
              uVar2 = (uint)(uVar2 < 0x5f || uVar3 - 0x5f < uVar4);
              bVar25 = (undefined1 *)0xf1033e63 < &pbStack_5747 ||
                       CARRY4((uint)&stack0x0efc6a55,uVar2);
              puVar18 = &stack0x0efc6a55 + uVar2;
            } while( true );
          }
          bVar11 = 9 < ((byte)_DAT_1932f7fe & 0xf) | in_AF;
          uVar13 = CONCAT31((int3)((uint)_DAT_1932f7fe >> 8),(byte)_DAT_1932f7fe + bVar11 * -6) &
                   0xffffff0f;
          _DAT_036307b4 =
               CONCAT22((short)(uVar13 >> 0x10),
                        CONCAT11((char)((uint)_DAT_1932f7fe >> 8) - bVar11,(char)uVar13));
          iVar16 = _DAT_036307b4 + -0x55ba573c;
          pcVar24 = (char *)((int)unaff_EDI + (uint)bVar30 * -2);
          *pcVar23 = (char)iVar16;
          if (iVar16 < 0) {
            pbVar21[0x77] = (char)pbVar21[0x77] >> 1;
code_r0x00503f11:
            out(uVar15,(char)_DAT_1f5e29cd);
            *pbVar21 = -*pbVar21;
                    /* WARNING: Bad instruction - Truncating control flow here */
            halt_baddata();
          }
        }
        else {
          if ('\0' < (char)((byte)pbVar17 ^ 0xd0)) goto code_r0x00503f11;
          pcVar24 = (char *)((int)unaff_EDI + (uint)bVar30 * -2 + 1);
          *(byte *)unaff_EDI = *pbVar9;
        }
        uVar1 = in(uVar15);
        *(undefined4 *)pcVar24 = uVar1;
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      pbVar9[0xd] = (byte)param_2;
      if (SCARRY1(bVar19,'{') == SCARRY1(bVar11,in_CF)) {
        return unaff_EBP;
      }
      uVar7 = CONCAT14(bVar25,*(uint *)(pbVar9 + -0x50));
      uVar6 = (ulonglong)uVar7 << 0x14;
      *(uint *)(pbVar9 + -0x50) = (uint)(uVar7 >> 0xd) | (uint)uVar6;
      in_CF = (uVar6 & 0x100000000) != 0;
      param_1 = (byte *)0x0;
    }
    else {
      pcVar24 = (char *)((int)unaff_EDI + 0x26);
      in(0x55);
      puVar22 = (uint *)((int)unaff_EDI + -1);
      uVar13 = *puVar22;
      uVar4 = uStack_c + 0xc60e6bbc;
      uVar2 = (uint)(uStack_c < 0x39f19444);
      uVar3 = (int)(unaff_retaddr ^ uVar13) - (int)puVar22;
      iVar16 = uVar3 - uVar2;
      uVar31 = CONCAT44(iVar16,CONCAT22((short)(uStack_c >> 0x10),
                                        CONCAT11(((int)uVar4 < 0) << 7 | (uVar4 == 0) << 6 |
                                                 in_AF << 4 |
                                                 ((POPCOUNT(uVar4 & 0xff) & 1U) == 0) << 2 | 2 |
                                                 uStack_c < 0x39f19444,(char)uStack_c)));
      unaff_EDI = (uint *)((int)unaff_EDI + (uint)bVar30 * -2);
      cVar14 = in((short)iVar16);
      *(char *)puVar22 = cVar14;
      bVar11 = (char)*(undefined6 *)pcVar24 + -0x51 +
               ((uint *)(unaff_retaddr ^ uVar13) < puVar22 || uVar3 < uVar2);
      param_1 = (byte *)CONCAT31((int3)((uint6)*(undefined6 *)pcVar24 >> 8),bVar11);
      pbVar9 = unaff_EBX + 0x23;
      uVar26 = *pbVar9 < bVar11;
      bVar30 = *pbVar9;
      *pbVar9 = *pbVar9 - bVar11;
      uVar29 = *pbVar9 == 0;
      uVar28 = (POPCOUNT(*pbVar9) & 1U) == 0;
      pcVar5 = (code *)swi(4);
      if (SBORROW1(bVar30,bVar11)) {
        uVar31 = (*pcVar5)();
        param_1 = extraout_ECX;
      }
      param_2 = (byte *)((ulonglong)uVar31 >> 0x20);
      bVar30 = 1;
      if ((bool)uVar26 || (bool)uVar29) {
        if (!(bool)uVar28) {
                    /* WARNING: Could not recover jumptable at 0x00503e72. Too many branches */
                    /* WARNING: Treating indirect jump as call */
          pbVar9 = (byte *)(**(code **)(param_1 + 0x1bd64293))();
          return pbVar9;
        }
        goto LAB_00503e87;
      }
      bVar19 = (byte)unaff_EBX ^ *param_1;
      iVar16 = CONCAT31((int3)((uint)unaff_EBX >> 8),bVar19);
      out(0xdb,(int)uVar31);
      pbVar9 = unaff_EBP + -4;
      out(*(undefined4 *)unaff_EBP,(short)((ulonglong)uVar31 >> 0x20));
      pbVar17 = param_2 + 1;
      *pbVar9 = *pbVar9 + (char)((ulonglong)uVar31 >> 8);
      bVar11 = (byte)((uint)unaff_EBX >> 8);
      pbVar21 = unaff_EBP + -8;
      uVar15 = SUB42(pbVar17,0);
      out(*(undefined4 *)pbVar9,uVar15);
      uVar13 = (uint)(bVar11 < *(byte *)(iVar16 + 0x6c));
      unaff_ESI = (byte *)(((int)unaff_EBP - (int)pbVar21) - uVar13);
      pbVar12 = *(byte **)pbVar21;
      pcVar24 = (char *)(iVar16 + 0x5cac7fa);
      *pcVar24 = *pcVar24 + (char)pbVar17 +
                 (unaff_EBP < pbVar21 || (uint)((int)unaff_EBP - (int)pbVar21) < uVar13);
      unaff_EBX = (undefined1 *)
                  CONCAT22((short)((uint)unaff_EBX >> 0x10),CONCAT11((char)param_1,bVar19));
      param_1 = (byte *)CONCAT31((int3)((uint)param_1 >> 8),bVar11);
      pbVar21 = (byte *)((uint)(unaff_EBP + -0xc) & *unaff_EDI);
      bVar11 = (byte)pbVar12;
      in_ES = pbStack_8._0_2_;
      if (-1 < (char)(bVar11 + 0x9e)) {
        pbVar17 = pbVar12 + 0x579230a7;
        if (param_1 != (byte *)0x1) {
          return pbVar17;
        }
        out(uVar15,(char)pbVar17);
        pbVar12 = (byte *)0x0;
        goto LAB_00503f2d;
      }
      if ((POPCOUNT(bVar11 + 0x9e) & 1U) != 0) {
        pbVar9 = pbVar21 + -1;
        out(*pbVar21,uVar15);
        LOCK();
        param_2 = *(byte **)(pbVar12 + 0x42);
        *(byte **)(pbVar12 + 0x42) = pbVar17;
        UNLOCK();
        bVar25 = false;
        *param_2 = *param_2 & bVar19;
        out(0x39,pbVar12);
        pbVar17 = param_1 + -1;
        if (pbVar17 == (byte *)0x0 || *param_2 != 0) {
          out((short)param_2,(char)pbStack_4);
          pcVar5 = (code *)swi(3);
          pbVar9 = (byte *)(*pcVar5)();
          return pbVar9;
        }
        goto LAB_00503efd;
      }
      pbVar9 = (byte *)CONCAT31((int3)((uint)pbVar12 >> 8),-(bVar11 < 0x62));
      in_CF = pbVar9 < param_1 || (uint)((int)pbVar9 - (int)param_1) < (uint)(bVar11 < 0x62);
      param_2 = pbVar17;
      pbVar9 = pbStack_4;
    }
    param_2 = (byte *)CONCAT31((int3)((uint)param_2 >> 8),0xda);
    in_ZF = pbVar9 + 1 == (byte *)0x0;
    unaff_EBP = unaff_ESI;
    unaff_ESI = pbVar9 + 1;
    if (!(bool)in_ZF) {
LAB_00503e87:
      *(uint *)(param_1 + 0x4f926d89) = *(uint *)(param_1 + 0x4f926d89) ^ (uint)param_2;
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
  } while( true );
}


