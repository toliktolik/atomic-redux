/*
 * Function: AudioCodec_DecodeBuffer
 * Address: 004b4970
 * Category: audio
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


uint __fastcall AudioCodec_DecodeBuffer(int param_1,undefined2 param_2,int param_3,int param_4)

{
  undefined4 *puVar1;
  short *psVar2;
  void *pvVar3;
  uint uVar4;
  int iVar5;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  uint extraout_EDX;
  int iVar6;
  undefined8 uVar7;
  longlong lVar8;
  int local_158 [74];
  undefined1 local_30 [4];
  undefined4 local_2c;
  undefined4 local_28;
  int local_24;
  undefined4 local_20;
  undefined4 *local_1c;
  short *local_18;
  undefined4 local_14;
  int local_10;
  int local_c;
  undefined4 local_8;
  
  pvVar3 = (void *)String_AllocateBuffer(*(undefined4 *)(param_4 + 0x18),param_2);
  if (pvVar3 != (void *)0x0) {
    uVar7 = ImageFormat_ReadHeader(pvVar3,local_158,(undefined4 *)0x0,0);
    if ((int)uVar7 < 0) {
      uVar4 = Memory_AllocateBlock(extraout_ECX,(int)((ulonglong)uVar7 >> 0x20));
      return uVar4 & 0xffffff00;
    }
    iVar5 = ImageFormat_GetCompressionType((int)local_158,-1);
    local_14 = CONCAT22(*(ushort *)(iVar5 + 4),1);
    local_10 = *(int *)(iVar5 + 8);
    uVar4 = (int)((uint)*(ushort *)(iVar5 + 4) * 0x10) >> 3;
    local_c = (uVar4 & 0xffff) * local_10;
    local_8 = CONCAT22(0x10,(short)uVar4);
    lVar8 = ImageFormat_GetChannelCount((int)local_158,-1);
    iVar6 = (int)lVar8 * (local_8 & 0xffff);
    local_20 = 0;
    *(int *)(param_1 + 0x408 + param_3 * 4) = iVar6;
    local_1c = &local_14;
    puVar1 = (undefined4 *)(param_1 + 4 + param_3 * 4);
    local_2c = 0x14;
    local_28 = 0x80ea;
    local_24 = iVar6;
    uVar7 = (**(code **)(**(int **)(param_1 + 0x1494) + 0xc))
                      (*(int **)(param_1 + 0x1494),&local_2c,puVar1,0);
    uVar4 = (uint)((ulonglong)uVar7 >> 0x20);
    iVar5 = extraout_ECX_00;
    if ((int)uVar7 == 0) {
      uVar7 = (**(code **)(*(int *)*puVar1 + 0x2c))((int *)*puVar1,0,iVar6,&local_18,&param_4,0,0,0)
      ;
      uVar4 = (uint)((ulonglong)uVar7 >> 0x20);
      iVar5 = extraout_ECX_01;
      iVar6 = param_4;
      psVar2 = local_18;
      if ((int)uVar7 == 0) {
        for (; 0 < iVar6; iVar6 = iVar6 - uVar4) {
          uVar4 = ImageFormat_ApplyCompression
                            (local_30,(int)local_158,psVar2,iVar6,(undefined4 *)local_30);
          if ((uVar4 == 0) || ((int)uVar4 < 0)) break;
          psVar2 = (short *)((int)psVar2 + uVar4);
        }
        (**(code **)(*(int *)*puVar1 + 0x4c))((int *)*puVar1,local_18,param_4,0,0);
        ImageFormat_ConvertRGBToRGBA(extraout_ECX_02,extraout_EDX,local_158);
        return (uint)(iVar6 == 0);
      }
    }
    pvVar3 = (void *)ImageFormat_ConvertRGBToRGBA(iVar5,uVar4,local_158);
  }
  return (uint)pvVar3 & 0xffffff00;
}


