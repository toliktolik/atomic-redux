/*
 * Function: MemoryImage_GenerateColorTable
 * Address: 00471f10
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void * __thiscall MemoryImage_GenerateColorTable(void *this,int param_1)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  uint uVar4;
  uint uVar5;
  uint *puVar6;
  void *pvVar7;
  byte bVar8;
  byte bVar9;
  byte bVar10;
  byte bVar11;
  byte bVar12;
  byte bVar13;
  
  pvVar7 = *(void **)((int)this + 0x34);
  if (pvVar7 == (void *)0x0) {
                    /* WARNING: Load size is inaccurate */
    (**(code **)(*this + 0x50))();
    bVar8 = 0x18 - (char)*(undefined4 *)(param_1 + 0x14);
    bVar9 = 0x10 - (char)*(undefined4 *)(param_1 + 0x18);
    bVar10 = 8 - (char)*(undefined4 *)(param_1 + 0x1c);
    uVar2 = *(uint *)(param_1 + 8);
    uVar3 = *(uint *)(param_1 + 0xc);
    uVar4 = *(uint *)(param_1 + 0x10);
    puVar6 = *(uint **)((int)this + 0x28);
    bVar11 = (byte)*(undefined4 *)(param_1 + 0x28);
    bVar12 = (byte)*(undefined4 *)(param_1 + 0x20);
    bVar13 = (byte)*(undefined4 *)(param_1 + 0x24);
    if (puVar6 == (uint *)0x0) {
                    /* WARNING: Load size is inaccurate */
      puVar6 = (uint *)(**(code **)(*this + 100))();
      pvVar7 = operator_new(*(int *)((int)this + 8) * *(int *)((int)this + 4) * 4);
      param_1 = 0;
      if (0 < *(int *)((int)this + 8) * *(int *)((int)this + 4)) {
        do {
          uVar5 = *puVar6;
          puVar6 = puVar6 + 1;
          iVar1 = (uVar5 >> 0x18) + 1;
          *(uint *)((int)pvVar7 + param_1 * 4) =
               (((uVar5 & 0xff) * iVar1 >> 8) >> (bVar10 & 0x1f)) << (bVar11 & 0x1f) & uVar4 |
               (((uVar5 & 0xff0000) * iVar1 >> 8) >> (bVar8 & 0x1f)) << (bVar12 & 0x1f) & uVar2 |
               (((uVar5 & 0xff00) * iVar1 >> 8) >> (bVar9 & 0x1f)) << (bVar13 & 0x1f) & uVar3 |
               (uVar5 >> 0x18) << 0x18;
          param_1 = param_1 + 1;
        } while (param_1 < *(int *)((int)this + 8) * *(int *)((int)this + 4));
      }
      *(void **)((int)this + 0x34) = pvVar7;
      return pvVar7;
    }
    pvVar7 = operator_new(0x400);
    param_1 = 0;
    do {
      uVar5 = *puVar6;
      puVar6 = puVar6 + 1;
      iVar1 = (uVar5 >> 0x18) + 1;
      *(uint *)((int)pvVar7 + param_1 * 4) =
           (((uVar5 & 0xff) * iVar1 >> 8) >> (bVar10 & 0x1f)) << (bVar11 & 0x1f) & uVar4 |
           (((uVar5 & 0xff0000) * iVar1 >> 8) >> (bVar8 & 0x1f)) << (bVar12 & 0x1f) & uVar2 |
           (((uVar5 & 0xff00) * iVar1 >> 8) >> (bVar9 & 0x1f)) << (bVar13 & 0x1f) & uVar3 |
           (uVar5 >> 0x18) << 0x18;
      param_1 = param_1 + 1;
    } while (param_1 < 0x100);
    *(void **)((int)this + 0x34) = pvVar7;
  }
  return pvVar7;
}


