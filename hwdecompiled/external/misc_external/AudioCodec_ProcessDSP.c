/*
 * Function: AudioCodec_ProcessDSP
 * Address: 004b66c0
 * Category: audio
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall AudioCodec_ProcessDSP(int param_1,undefined2 param_2,int param_3,undefined4 param_4)

{
  undefined4 *puVar1;
  char cVar2;
  byte bVar3;
  int *piVar4;
  char *pcVar5;
  int iVar6;
  undefined4 extraout_ECX;
  int iVar7;
  int extraout_ECX_00;
  undefined4 extraout_ECX_01;
  undefined4 extraout_ECX_02;
  undefined4 extraout_ECX_03;
  undefined4 extraout_ECX_04;
  uint uVar8;
  int extraout_ECX_05;
  int extraout_ECX_06;
  int extraout_ECX_07;
  int extraout_ECX_08;
  undefined2 extraout_DX;
  undefined2 extraout_DX_00;
  undefined2 extraout_DX_01;
  undefined2 extraout_DX_02;
  undefined2 extraout_DX_03;
  undefined4 uVar9;
  DWORD extraout_EDX;
  uint extraout_EDX_00;
  DWORD DVar10;
  undefined4 extraout_EDX_01;
  char *pcVar11;
  bool bVar12;
  undefined8 uVar13;
  undefined6 uVar14;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffe98;
  undefined4 *in_stack_fffffe9c;
  undefined1 local_64 [4];
  _FILETIME local_60;
  undefined1 local_58 [4];
  uint local_54;
  undefined4 local_50;
  undefined4 local_4c;
  undefined4 local_48;
  undefined4 local_44;
  undefined4 *local_40;
  int local_3c;
  uint local_38;
  undefined4 local_34;
  int local_30;
  DWORD local_2c;
  DWORD local_28;
  uint local_24;
  undefined4 local_20;
  undefined4 local_1c;
  uint local_18;
  int local_14;
  char local_10 [4];
  undefined1 local_c;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  local_3c = param_1;
  uVar14 = String_AllocateBuffer(param_1,param_2);
  iVar6 = (int)uVar14;
  if (iVar6 == 0) {
    Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffe98,in_stack_fffffe9c);
    return;
  }
  local_c = 0;
  Memory_GetHeapInfo(extraout_ECX,(short)((uint6)uVar14 >> 0x20));
  iVar7 = 5;
  bVar12 = true;
  pcVar5 = local_10;
  pcVar11 = "RIFF";
  do {
    if (iVar7 == 0) break;
    iVar7 = iVar7 + -1;
    bVar12 = *pcVar5 == *pcVar11;
    pcVar5 = pcVar5 + 1;
    pcVar11 = pcVar11 + 1;
  } while (bVar12);
  if (bVar12) {
    Memory_GetHeapInfo(iVar7,0);
    Memory_GetHeapInfo(local_10,extraout_DX);
    iVar7 = 5;
    uVar9 = 0;
    bVar12 = true;
    pcVar5 = local_10;
    pcVar11 = "WAVE";
    do {
      if (iVar7 == 0) break;
      iVar7 = iVar7 + -1;
      bVar12 = *pcVar5 == *pcVar11;
      pcVar5 = pcVar5 + 1;
      pcVar11 = pcVar11 + 1;
    } while (bVar12);
    if (bVar12) {
      local_18 = 0x10;
      local_38 = 1;
      local_14 = 0x5622;
      bVar3 = *(byte *)(iVar6 + 0xc);
      while ((bVar3 & 0x10) == 0) {
        Memory_GetHeapInfo(iVar7,(short)uVar9);
        uVar13 = Memory_GetHeapInfo(&local_1c,extraout_DX_00);
        if ((int)uVar13 == 0) break;
        local_20 = Memory_CompactHeap(extraout_ECX_00,(int)((ulonglong)uVar13 >> 0x20));
        iVar7 = 5;
        bVar12 = true;
        pcVar5 = local_10;
        pcVar11 = "fmt ";
        do {
          if (iVar7 == 0) break;
          iVar7 = iVar7 + -1;
          bVar12 = *pcVar5 == *pcVar11;
          pcVar5 = pcVar5 + 1;
          pcVar11 = pcVar11 + 1;
        } while (bVar12);
        if (bVar12) {
          Memory_GetHeapInfo(iVar7,0);
          Memory_GetHeapInfo(&local_38,extraout_DX_01);
          Memory_GetHeapInfo(extraout_ECX_01,(short)&local_14);
          Memory_GetHeapInfo(extraout_ECX_02,extraout_DX_02);
          Memory_GetHeapInfo(local_64,extraout_DX_03);
          Memory_GetHeapInfo(extraout_ECX_03,(short)&local_18);
          DVar10 = extraout_EDX;
          if (param_4._2_2_ != 1) break;
        }
        else {
          iVar7 = 5;
          bVar12 = true;
          pcVar5 = local_10;
          pcVar11 = "dep ";
          do {
            if (iVar7 == 0) break;
            iVar7 = iVar7 + -1;
            bVar12 = *pcVar5 == *pcVar11;
            pcVar5 = pcVar5 + 1;
            pcVar11 = pcVar11 + 1;
          } while (bVar12);
          if (bVar12) {
            Memory_GetHeapInfo(&local_24,0);
            if (0xff < (ushort)local_24) {
              local_24 = 0xff;
            }
            Memory_GetHeapInfo(extraout_ECX_04,(short)local_24);
            uVar8 = local_24 & 0xffff;
            (&stack0xfffffe98)[uVar8] = 0;
            Memory_GetHeapInfo(uVar8,(short)&local_2c);
            local_60.dwLowDateTime = 0;
            local_60.dwHighDateTime = 0;
            pcVar5 = &stack0xfffffe98;
            local_40 = (undefined4 *)0xf;
            local_44 = 0;
            local_54 = local_54 & 0xffffff00;
            do {
              cVar2 = *pcVar5;
              pcVar5 = pcVar5 + 1;
            } while (cVar2 != '\0');
            String_Assign(local_58,(_String_base *)&stack0xfffffe98,
                          (int)pcVar5 - (int)&stack0xfffffe99);
            AudioCodec_SetProperties((int)local_58,&local_60);
            if (0xf < local_40) {
                    /* WARNING: Subroutine does not return */
              System_ShutdownHandler(local_54,extraout_EDX_00);
            }
            local_40 = (undefined4 *)0xf;
            local_44 = 0;
            local_54 = local_54 & 0xffffff00;
            if ((local_28 != local_60.dwHighDateTime) ||
               (DVar10 = local_28, local_2c != local_60.dwLowDateTime)) break;
          }
          else {
            iVar7 = 5;
            bVar12 = true;
            pcVar5 = local_10;
            pcVar11 = "data";
            do {
              if (iVar7 == 0) break;
              iVar7 = iVar7 + -1;
              bVar12 = *pcVar5 == *pcVar11;
              pcVar5 = pcVar5 + 1;
              pcVar11 = pcVar11 + 1;
            } while (bVar12);
            DVar10 = 0;
            if (bVar12) {
              *(undefined4 *)(local_3c + 0x408 + param_3 * 4) = local_1c;
              local_30 = local_14;
              iVar6 = (local_38 & 0xffff) * (local_18 & 0xffff);
              uVar8 = (int)(iVar6 + (iVar6 >> 0x1f & 7U)) >> 3;
              local_2c = (uVar8 & 0xffff) * local_14;
              local_44 = 0;
              local_28 = CONCAT22((undefined2)local_18,(short)uVar8);
              puVar1 = (undefined4 *)(local_3c + 4 + param_3 * 4);
              local_48 = local_1c;
              local_40 = &local_34;
              local_34 = CONCAT22((short)local_38,1);
              local_50 = 0x14;
              local_4c = 0x80ea;
              uVar13 = (**(code **)(**(int **)(local_3c + 0x1494) + 0xc))();
              iVar7 = (int)((ulonglong)uVar13 >> 0x20);
              iVar6 = extraout_ECX_06;
              if ((int)uVar13 == 0) {
                piVar4 = (int *)*puVar1;
                uVar13 = (**(code **)(*piVar4 + 0x2c))(piVar4,0,local_1c,&param_3,&param_4,0,0,0);
                iVar7 = (int)((ulonglong)uVar13 >> 0x20);
                iVar6 = extraout_ECX_07;
                if ((int)uVar13 == 0) {
                  uVar13 = Memory_GetHeapInfo(extraout_ECX_07,(short)((ulonglong)uVar13 >> 0x20));
                  local_20 = (undefined4)uVar13;
                  Memory_AllocateBlock(extraout_ECX_08,(int)((ulonglong)uVar13 >> 0x20));
                  piVar4 = (int *)*puVar1;
                  iVar6 = (**(code **)(*piVar4 + 0x4c))(piVar4,param_3,param_4,0,0);
                  if (iVar6 == 0) {
                    Exception_SetMessage
                              ((void *)(local_8 ^ unaff_retaddr),in_stack_fffffe98,in_stack_fffffe9c
                              );
                    return;
                  }
                  break;
                }
              }
              Memory_AllocateBlock(iVar6,iVar7);
              break;
            }
          }
        }
        Memory_DefragmentHeap((char)local_20 + (char)local_1c,DVar10);
        uVar9 = extraout_EDX_01;
        iVar7 = extraout_ECX_05;
        bVar3 = *(byte *)(iVar6 + 0xc);
      }
    }
  }
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffe98,in_stack_fffffe9c);
  return;
}


