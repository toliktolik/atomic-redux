/*
 * Function: Memory_HeapManager
 * Address: 00414380
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void Memory_HeapManager(int *param_1,int param_2)

{
  byte bVar1;
  int *piVar2;
  byte *pbVar3;
  int iVar4;
  uint uVar5;
  undefined1 local_30 [4];
  char local_2c;
  uint local_28;
  uint local_24;
  byte local_20;
  undefined3 uStack_1f;
  int local_1c;
  uint local_18;
  undefined1 *local_14;
  void *pvStack_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x510400;
  pvStack_10 = ExceptionList;
  local_14 = &stack0xffffffc4;
  local_28 = *(uint *)(param_2 + 0x14);
  local_18 = 0;
  uVar5 = *(uint *)(*(int *)(*param_1 + 4) + 0x14 + (int)param_1);
  if (((int)uVar5 < 1) || (uVar5 <= local_28)) {
    local_1c = 0;
  }
  else {
    local_1c = uVar5 - local_28;
  }
  ExceptionList = &pvStack_10;
  Stream_Constructor(local_30,param_1);
  local_8 = 0;
  if (local_2c == '\0') {
    local_18 = 4;
    Memory_ReferenceCounter();
    return;
  }
  local_8 = 1;
  if ((*(uint *)(*(int *)(*param_1 + 4) + 0xc + (int)param_1) & 0x1c0) != 0x40) {
    for (; local_1c != 0; local_1c = local_1c + -1) {
      bVar1 = *(byte *)((int)param_1 + *(int *)(*param_1 + 4) + 0x30);
      _local_20 = CONCAT31(uStack_1f,bVar1);
      piVar2 = *(int **)((int)param_1 + *(int *)(*param_1 + 4) + 0x28);
      uVar5 = *(uint *)piVar2[9];
      if (uVar5 == 0) {
LAB_0041444b:
        uVar5 = (**(code **)(*piVar2 + 4))(bVar1);
      }
      else {
        iVar4 = *(int *)piVar2[0xd];
        if (iVar4 + uVar5 <= uVar5) goto LAB_0041444b;
        *(int *)piVar2[0xd] = iVar4 + -1;
        pbVar3 = *(byte **)piVar2[9];
        *(byte **)piVar2[9] = pbVar3 + 1;
        *pbVar3 = bVar1;
        uVar5 = (uint)bVar1;
      }
      if (uVar5 == 0xffffffff) {
        local_18 = local_18 | 4;
        break;
      }
    }
    if (local_18 != 0) goto LAB_0041456d;
  }
  for (local_24 = 0; local_24 < local_28; local_24 = local_24 + 1) {
    if (*(uint *)(param_2 + 0x18) < 0x10) {
      iVar4 = param_2 + 4;
    }
    else {
      iVar4 = *(int *)(param_2 + 4);
    }
    bVar1 = *(byte *)(iVar4 + local_24);
    _local_20 = CONCAT31(uStack_1f,bVar1);
    piVar2 = *(int **)(*(int *)(*param_1 + 4) + 0x28 + (int)param_1);
    uVar5 = *(uint *)piVar2[9];
    if (uVar5 == 0) {
LAB_004144d8:
      uVar5 = (**(code **)(*piVar2 + 4))(bVar1);
    }
    else {
      iVar4 = *(int *)piVar2[0xd];
      if (iVar4 + uVar5 <= uVar5) goto LAB_004144d8;
      *(int *)piVar2[0xd] = iVar4 + -1;
      pbVar3 = *(byte **)piVar2[9];
      *(byte **)piVar2[9] = pbVar3 + 1;
      *pbVar3 = bVar1;
      uVar5 = (uint)bVar1;
    }
    if (uVar5 == 0xffffffff) {
      local_18 = local_18 | 4;
      break;
    }
  }
  if (local_18 == 0) {
    for (; local_1c != 0; local_1c = local_1c + -1) {
      piVar2 = *(int **)(*(int *)(*param_1 + 4) + 0x28 + (int)param_1);
      bVar1 = *(byte *)((int)param_1 + *(int *)(*param_1 + 4) + 0x30);
      uVar5 = *(uint *)piVar2[9];
      if (uVar5 == 0) {
LAB_00414551:
        uVar5 = (**(code **)(*piVar2 + 4))(bVar1);
      }
      else {
        iVar4 = *(int *)piVar2[0xd];
        if (iVar4 + uVar5 <= uVar5) goto LAB_00414551;
        *(int *)piVar2[0xd] = iVar4 + -1;
        pbVar3 = *(byte **)piVar2[9];
        *(byte **)piVar2[9] = pbVar3 + 1;
        *pbVar3 = bVar1;
        uVar5 = (uint)bVar1;
      }
      if (uVar5 == 0xffffffff) {
        local_18 = local_18 | 4;
        break;
      }
    }
  }
LAB_0041456d:
  *(undefined4 *)(*(int *)(*param_1 + 4) + 0x14 + (int)param_1) = 0;
  Memory_ReferenceCounter();
  return;
}


