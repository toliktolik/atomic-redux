/*
 * Function: _Addfac
 * Address: 004ec31f
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* Library Function - Single Match
    private: void __thiscall std::locale::_Locimp::_Addfac(class std::locale::facet *,unsigned int)
   
   Library: Visual Studio 2003 Release */

void __thiscall std::locale::_Locimp::_Addfac(_Locimp *this,facet *param_1,uint param_2)

{
  uint uVar1;
  int iVar2;
  undefined4 *puVar3;
  int extraout_ECX;
  undefined4 extraout_ECX_00;
  double *extraout_EDX;
  int unaff_EBP;
  uint uVar4;
  
  Assembly_BitShiftLocking();
  Threading_LockSectorByIndex((void *)(unaff_EBP + -0x10),0);
  uVar1 = *(uint *)(unaff_EBP + 0xc);
  *(undefined4 *)(unaff_EBP + -4) = 0;
  if (*(uint *)(extraout_ECX + 0xc) <= uVar1) {
    uVar4 = uVar1 + 1;
    if (uVar4 < 0x28) {
      uVar4 = 0x28;
    }
    iVar2 = Assembly_ComplexControlFlow
                      (extraout_ECX_00,extraout_EDX,*(undefined4 *)(extraout_ECX + 8));
    *(int *)(unaff_EBP + 0xc) = iVar2;
    if (iVar2 == 0) {
      _Nomemory();
    }
    *(undefined4 *)(extraout_ECX + 8) = *(undefined4 *)(unaff_EBP + 0xc);
    while (*(uint *)(extraout_ECX + 0xc) < uVar4) {
      *(undefined4 *)(*(int *)(extraout_ECX + 8) + *(int *)(extraout_ECX + 0xc) * 4) = 0;
      *(int *)(extraout_ECX + 0xc) = *(int *)(extraout_ECX + 0xc) + 1;
    }
  }
  RefCount_Increment(*(int *)(unaff_EBP + 8));
  uVar4 = *(uint *)(uVar1 * 4 + *(int *)(extraout_ECX + 8));
  if (uVar4 != 0) {
    puVar3 = (undefined4 *)RefCount_Decrement(uVar4);
    if (puVar3 != (undefined4 *)0x0) {
      (**(code **)*puVar3)(1);
    }
  }
  iVar2 = *(int *)(extraout_ECX + 8);
  *(undefined4 *)(unaff_EBP + -4) = 0xffffffff;
  *(undefined4 *)(uVar1 * 4 + iVar2) = *(undefined4 *)(unaff_EBP + 8);
  Threading_UnlockSectorByIndex((int *)(unaff_EBP + -0x10));
  ExceptionList = *(void **)(unaff_EBP + -0xc);
  return;
}


