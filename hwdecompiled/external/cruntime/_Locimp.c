/*
 * Function: _Locimp
 * Address: 004ec69a
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* Library Function - Single Match
    private: __thiscall std::locale::_Locimp::_Locimp(class std::locale::_Locimp const &)
   
   Library: Visual Studio 2003 Release */

undefined4 * __thiscall std::locale::_Locimp::_Locimp(_Locimp *this,_Locimp *param_1)

{
  int iVar1;
  int iVar2;
  void *pvVar3;
  undefined4 *extraout_ECX;
  uint extraout_EDX;
  uint extraout_EDX_00;
  int iVar4;
  int unaff_EBP;
  bool bVar5;
  
  Assembly_BitShiftLocking();
  *(undefined4 **)(unaff_EBP + -0x10) = extraout_ECX;
  extraout_ECX[1] = 1;
  iVar1 = *(int *)(unaff_EBP + 8);
  *extraout_ECX = &PTR_RefCount_ConditionalDestructor_005468f4;
  extraout_ECX[2] = 0;
  extraout_ECX[3] = *(undefined4 *)(iVar1 + 0xc);
  extraout_ECX[4] = *(undefined4 *)(iVar1 + 0x10);
  *(undefined1 *)(extraout_ECX + 5) = *(undefined1 *)(iVar1 + 0x14);
  *(undefined4 *)(unaff_EBP + -4) = 0;
  Animation_HandleRareEvents
            ((_String_base *)(extraout_ECX + 6),extraout_EDX,(_String_base *)(iVar1 + 0x18));
  bVar5 = iVar1 == DAT_005a4824;
  *(undefined1 *)(unaff_EBP + -4) = 1;
  if (bVar5) {
    Locale_InitializeStringBuffers();
    *(undefined1 *)(unaff_EBP + -4) = 2;
    Locale_InitializeFacets();
    *(undefined1 *)(unaff_EBP + -4) = 1;
    String_ResetMultipleStrings((int *)(unaff_EBP + -0x84),extraout_EDX_00);
  }
  else {
    Threading_LockSectorByIndex((void *)(unaff_EBP + 8),0);
    iVar4 = extraout_ECX[3];
    *(undefined1 *)(unaff_EBP + -4) = 3;
    if (iVar4 != 0) {
      pvVar3 = _malloc(iVar4 << 2);
      extraout_ECX[2] = pvVar3;
      if (pvVar3 == (void *)0x0) {
        _Nomemory();
      }
      iVar4 = extraout_ECX[3];
      while (iVar4 != 0) {
        iVar4 = iVar4 + -1;
        iVar2 = *(int *)(*(int *)(iVar1 + 8) + iVar4 * 4);
        *(int *)(extraout_ECX[2] + iVar4 * 4) = iVar2;
        if (iVar2 != 0) {
          RefCount_Increment(iVar2);
        }
      }
    }
    *(undefined1 *)(unaff_EBP + -4) = 1;
    Threading_UnlockSectorByIndex((int *)(unaff_EBP + 8));
  }
  ExceptionList = *(void **)(unaff_EBP + -0xc);
  return extraout_ECX;
}


