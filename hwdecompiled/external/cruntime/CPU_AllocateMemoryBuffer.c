/*
 * Function: CPU_AllocateMemoryBuffer
 * Address: 004c58a0
 * Category: memory
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


int __fastcall CPU_AllocateMemoryBuffer(undefined4 param_1,double *param_2,int param_3,int param_4)

{
  double *pdVar1;
  int iVar2;
  undefined4 *puVar3;
  
  puVar3 = *(undefined4 **)(param_3 + 4);
  if (puVar3 == (undefined4 *)0x0) {
    puVar3 = (undefined4 *)PNG_SetErrorCallback(param_1,param_2);
    *(undefined4 **)(param_3 + 8) = puVar3;
    *(undefined4 **)(param_3 + 4) = puVar3;
    return *(int *)*puVar3;
  }
  pdVar1 = (double *)*puVar3;
  iVar2 = puVar3[2];
  if (param_4 <= (*(int *)((int)pdVar1 + 4) - puVar3[1]) - iVar2) {
    return *(int *)pdVar1 + puVar3[1] + iVar2;
  }
  if (iVar2 == 0) {
    PNG_GetWarningPtr(0,pdVar1);
    return (*(undefined4 **)(param_3 + 4))[1] + *(int *)**(undefined4 **)(param_3 + 4);
  }
  puVar3 = (undefined4 *)PNG_SetErrorCallback(iVar2,pdVar1);
  *(undefined4 **)(*(int *)(param_3 + 4) + 0xc) = puVar3;
  *(undefined4 **)(param_3 + 4) = puVar3;
  return *(int *)*puVar3;
}


