/*
 * Function: Buffer_ExpandAndInsert
 * Address: 00413b50
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


int __thiscall Buffer_ExpandAndInsert(void *this,int param_1)

{
  int iVar1;
  int iVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  int *piVar6;
  undefined1 *puVar7;
  undefined4 *puVar8;
  undefined4 *puVar9;
  undefined4 *puVar10;
  uint local_10;
  
  if (param_1 == -1) {
    return 0;
  }
  uVar4 = **(uint **)((int)this + 0x24);
  if (uVar4 != 0) {
    iVar1 = **(int **)((int)this + 0x34);
    if (uVar4 < iVar1 + uVar4) {
      **(int **)((int)this + 0x34) = iVar1 + -1;
      goto LAB_00413cf5;
    }
  }
  if ((*(byte *)((int)this + 0x40) & 2) != 0) {
    return -1;
  }
  if (uVar4 == 0) {
    uVar4 = 0;
  }
  else {
    uVar4 = (**(int **)((int)this + 0x34) - **(int **)((int)this + 0x10)) + uVar4;
  }
  uVar5 = uVar4 >> 1;
  if (uVar5 < 0x20) {
    uVar5 = 0x20;
  }
  puVar8 = (undefined4 *)0x0;
  for (; local_10 = uVar4, uVar5 != 0; uVar5 = uVar5 >> 1) {
    if (uVar4 <= 0x7fffffff - uVar5) {
      if (uVar5 != 0) {
        local_10 = uVar4 + uVar5;
        puVar8 = (undefined4 *)operator_new(local_10);
      }
      break;
    }
  }
  if (uVar4 != 0) {
    puVar9 = (undefined4 *)**(undefined4 **)((int)this + 0x10);
    puVar10 = puVar8;
    for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 = uVar5 - 1) {
      *puVar10 = *puVar9;
      puVar9 = puVar9 + 1;
      puVar10 = puVar10 + 1;
    }
    for (uVar5 = uVar4 & 3; uVar5 != 0; uVar5 = uVar5 - 1) {
      *(undefined1 *)puVar10 = *(undefined1 *)puVar9;
      puVar9 = (undefined4 *)((int)puVar9 + 1);
      puVar10 = (undefined4 *)((int)puVar10 + 1);
    }
  }
  if ((*(byte *)((int)this + 0x40) & 1) != 0) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler((int)*(uint **)((int)this + 0x10),**(uint **)((int)this + 0x10));
  }
  *(uint *)((int)this + 0x40) = *(uint *)((int)this + 0x40) | 1;
  if (uVar4 == 0) {
    *(undefined4 **)((int)this + 0x3c) = puVar8;
    **(undefined4 **)((int)this + 0x14) = puVar8;
    **(undefined4 **)((int)this + 0x24) = puVar8;
    **(uint **)((int)this + 0x34) = local_10;
    if ((*(byte *)((int)this + 0x40) & 4) == 0) {
      **(undefined4 **)((int)this + 0x10) = puVar8;
      **(undefined4 **)((int)this + 0x20) = puVar8;
      **(undefined4 **)((int)this + 0x30) = 1;
    }
    else {
      piVar6 = *(int **)((int)this + 0x10);
LAB_00413c5e:
      *piVar6 = (int)puVar8;
      **(undefined4 **)((int)this + 0x20) = 0;
      **(undefined4 **)((int)this + 0x30) = puVar8;
    }
  }
  else {
    *(undefined1 **)((int)this + 0x3c) =
         (undefined1 *)((int)puVar8 + (*(int *)((int)this + 0x3c) - **(int **)((int)this + 0x10)));
    iVar1 = **(int **)((int)this + 0x10);
    puVar7 = (undefined1 *)((**(int **)((int)this + 0x24) - iVar1) + (int)puVar8);
    **(int **)((int)this + 0x14) = (int)((int)puVar8 + (**(int **)((int)this + 0x14) - iVar1));
    **(undefined4 **)((int)this + 0x24) = puVar7;
    **(undefined4 **)((int)this + 0x34) = (undefined1 *)((int)puVar8 + (local_10 - (int)puVar7));
    piVar6 = *(int **)((int)this + 0x10);
    if ((*(byte *)((int)this + 0x40) & 4) != 0) goto LAB_00413c5e;
    iVar1 = *piVar6;
    iVar2 = **(int **)((int)this + 0x24);
    iVar3 = **(int **)((int)this + 0x20);
    *piVar6 = (int)puVar8;
    puVar7 = (undefined1 *)((iVar3 - iVar1) + (int)puVar8);
    **(undefined4 **)((int)this + 0x20) = puVar7;
    **(int **)((int)this + 0x30) = (iVar2 - (int)puVar7) + 1;
  }
  **(int **)((int)this + 0x34) = **(int **)((int)this + 0x34) + -1;
LAB_00413cf5:
  puVar7 = (undefined1 *)**(int **)((int)this + 0x24);
  **(int **)((int)this + 0x24) = (int)(puVar7 + 1);
  *puVar7 = (char)param_1;
  return param_1;
}


