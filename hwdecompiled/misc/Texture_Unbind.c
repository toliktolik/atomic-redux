/*
 * Function: Texture_Unbind
 * Address: 004b8c60
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Texture_Unbind(undefined4 param_1,undefined2 param_2,int param_3,int param_4)

{
  undefined4 uVar1;
  int iVar2;
  undefined1 *puVar3;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_EDX;
  undefined4 *unaff_EBX;
  undefined4 *puVar4;
  undefined4 *unaff_ESI;
  undefined8 uVar5;
  uint unaff_retaddr;
  code *local_240 [33];
  undefined4 local_1bc [16];
  int local_17c [7];
  undefined4 local_160;
  undefined4 local_15c;
  undefined4 local_158;
  undefined4 local_154;
  undefined1 local_ca;
  int local_14;
  int local_10;
  undefined1 *local_c;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  local_10 = String_AllocateBuffer(param_1,param_2);
  if (local_10 != 0) {
    uVar5 = PNG_InitializeStructures(local_240);
    local_17c[0] = (int)uVar5;
    local_240[0] = Texture_IsPowerOfTwo;
    iVar2 = Assembly_LoopingConstruct(local_1bc,(int)((ulonglong)uVar5 >> 0x20));
    if (iVar2 == 0) {
      PixelFormat_SetAlphaComponent(local_17c,0x3e,0x168);
      local_160 = *(undefined4 *)(param_4 + 4);
      local_15c = *(undefined4 *)(param_4 + 8);
      local_158 = 3;
      local_154 = 2;
      local_ca = 1;
      ColorSpace_LABToRGB(local_17c);
      ColorSpace_RGBToHSL(local_17c,0x50,'\x01');
      PixelFormat_ConvertToGrayscale((int)local_17c,local_10);
      PixelFormat_AdjustContrast(local_17c,'\x01');
      iVar2 = SexyWidget_GetWidth(param_4);
      local_c = (undefined1 *)operator_new(iVar2 * 3);
      puVar4 = *(undefined4 **)(param_4 + 0xc);
      local_14 = 0;
      iVar2 = extraout_ECX_00;
      if (0 < *(int *)(param_4 + 8)) {
        do {
          iVar2 = 0;
          puVar3 = local_c;
          if (0 < *(int *)(param_4 + 4)) {
            do {
              uVar1 = *puVar4;
              *puVar3 = (char)((uint)uVar1 >> 0x10);
              puVar4 = puVar4 + 1;
              puVar3[1] = (char)((uint)uVar1 >> 8);
              puVar3[2] = (char)uVar1;
              iVar2 = iVar2 + 1;
              puVar3 = puVar3 + 3;
            } while (iVar2 < *(int *)(param_4 + 4));
          }
          PixelFormat_AdjustSaturation(local_17c,&local_c,1);
          iVar2 = *(int *)(param_4 + 8);
          local_14 = local_14 + 1;
        } while (local_14 < iVar2);
      }
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(iVar2,(uint)local_c);
    }
    PixelFormat_BlendPixels((int)local_17c);
    Memory_AllocateBlock(extraout_ECX,extraout_EDX);
  }
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),unaff_ESI,unaff_EBX);
  return;
}


