/*
 * Function: Template_GenerateReport
 * Address: 004b1cf0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall Template_GenerateReport(void *this,int param_1,undefined4 param_2)

{
  _String_base _Var1;
  byte bVar2;
  int iVar3;
  HANDLE hFindFile;
  LPCSTR lpFileName;
  BOOL BVar4;
  undefined4 *****pppppuVar5;
  _String_base *p_Var6;
  char *pcVar7;
  int *this_00;
  int *extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  ios_base *this_01;
  int extraout_ECX_02;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint uVar8;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint unaff_EBX;
  uint unaff_ESI;
  uint uVar9;
  undefined8 uVar10;
  uint unaff_retaddr;
  _String_base local_12ec [4096];
  _WIN32_FIND_DATAA local_2ec;
  undefined1 local_1ac [8];
  int local_1a4 [24];
  int local_144;
  undefined **local_140 [13];
  int local_10c;
  uint auStackY_108 [25];
  int local_a4;
  undefined **local_a0 [13];
  int *local_6c;
  _String_base local_68 [4];
  undefined4 ****local_64 [4];
  undefined4 local_54;
  uint local_50;
  undefined1 local_4c [4];
  uint local_48;
  undefined4 local_38;
  uint local_34;
  undefined4 local_30;
  LPCSTR pCVar11;
  char *pcVar12;
  uint uVar13;
  undefined4 *puVar14;
  undefined4 *puVar15;
  
  puVar15 = (undefined4 *)&DAT_00516d0e;
  puVar14 = (undefined4 *)ExceptionList;
  ExceptionList = &stack0xfffffff0;
  System_LoadLibrary(this);
  if (*(uint *)(param_1 + 0x18) < 0x10) {
    iVar3 = param_1 + 4;
  }
  else {
    iVar3 = *(int *)(param_1 + 4);
  }
  local_6c = extraout_ECX;
  STL_Iterator_ArrowOperator(&local_10c,iVar3,1,1);
  if (local_a4 == 0) {
    STL_String_FindLastNotOf((int)local_a0);
    local_a0[0] = &PTR_IOSBase_DestructorWrapper_00531324;
    IOStream_RefCountDestructor((ios_base *)local_a0);
    ExceptionList = puVar14;
  }
  else {
    hFindFile = FindFirstFileA("temp\\tpl*.html",&local_2ec);
    if (hFindFile != (HANDLE)0x0) {
      do {
        local_34 = 0xf;
        local_38 = 0;
        local_48 = local_48 & 0xffffff00;
        pcVar12 = "temp\\";
        do {
          pcVar7 = pcVar12;
          pcVar12 = pcVar7 + 1;
        } while (*pcVar7 != '\0');
        String_Assign(local_4c,(_String_base *)&DAT_00536eb0,(uint)(pcVar7 + -0x536eb0));
        pCVar11 = (LPCSTR)0x4b1de5;
        Intel_DisplayPopulationData
                  (local_2ec.cFileName,(uint)local_4c,(_String_base *)&local_30,
                   (_String_base *)local_4c,(_String_base *)local_2ec.cFileName);
        if (0xf < local_34) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(local_48,extraout_EDX);
        }
        local_34 = 0xf;
        local_38 = 0;
        local_48 = local_48 & 0xffffff00;
        lpFileName = pCVar11;
        if (unaff_ESI < 0x10) {
          lpFileName = &stack0xffffffd4;
        }
        DeleteFileA(lpFileName);
        if (0xf < unaff_ESI) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_00,(uint)pCVar11);
        }
        unaff_ESI = 0xf;
        BVar4 = FindNextFileA(hFindFile,&local_2ec);
      } while (BVar4 != 0);
      FindClose(hFindFile);
    }
    func_0x0050f21a();
    func_0x004fdaed();
    local_30 = 0x4b1e80;
    Sound_SetPosition(local_68,"temp\\tpl%04d.html");
    pppppuVar5 = (undefined4 *****)local_64[0];
    if (local_50 < 0x10) {
      pppppuVar5 = local_64;
    }
    STL_Iterator_ArrowOperator(local_1ac,(int)pppppuVar5,2,1);
    if (local_144 == 0) {
      STL_String_FindLastNotOf((int)local_140);
      local_140[0] = &PTR_IOSBase_DestructorWrapper_00531324;
      IOStream_RefCountDestructor((ios_base *)local_140);
      if (0xf < local_50) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(extraout_ECX_01,extraout_EDX_00);
      }
      local_50 = 0xf;
      local_54 = 0;
      local_64[0] = (undefined4 ****)((uint)local_64[0] & 0xffffff00);
      STL_String_FindLastNotOf((int)local_a0);
      local_a0[0] = &PTR_IOSBase_DestructorWrapper_00531324;
      IOStream_RefCountDestructor((ios_base *)local_a0);
      ExceptionList = puVar14;
    }
    else {
      if ((*(uint *)((int)auStackY_108 + *(int *)(local_10c + 4)) & 1) == 0) {
        do {
          bVar2 = Collision_RectIntersect
                            ((void *)((int)auStackY_108 + *(int *)(local_10c + 4) + -4),10);
          Array_GetElement(&local_10c,local_12ec,0x1000,bVar2);
          p_Var6 = local_12ec;
          local_34 = 0xf;
          local_38 = 0;
          local_48 = local_48 & 0xffffff00;
          do {
            _Var1 = *p_Var6;
            p_Var6 = p_Var6 + 1;
          } while (_Var1 != (_String_base)0x0);
          String_Assign(local_4c,local_12ec,(int)p_Var6 - (int)(local_12ec + 1));
          pcVar12 = (char *)0x4b1fae;
          UI_PowerUp_ProcessStringTemplates
                    (param_2,(uint)local_4c,(_String_base *)&local_30,(_String_base *)local_4c,
                     (void *)param_2);
          if (0xf < local_34) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(local_48,extraout_EDX_01);
          }
          local_34 = 0xf;
          local_38 = 0;
          local_48 = local_48 & 0xffffff00;
          pcVar7 = pcVar12;
          if (unaff_ESI < 0x10) {
            pcVar7 = &stack0xffffffd4;
          }
          this_00 = (int *)Memory_GarbageCollection(local_1a4,pcVar7);
          uVar13 = 10;
          Database_BeginTransaction(this_00,10);
          uVar9 = 0;
          uVar8 = extraout_EDX_02;
          if ((*(byte *)((int)this_00 + *(int *)(*this_00 + 4) + 4) & 6) == 0) {
            uVar13 = 0x4b2011;
            uVar10 = (**(code **)(**(int **)((int)this_00 + *(int *)(*this_00 + 4) + 0x28) + 0x2c))
                               ();
            uVar8 = (uint)((ulonglong)uVar10 >> 0x20);
            if ((int)uVar10 == -1) {
              uVar9 = 4;
            }
          }
          this_01 = (ios_base *)(*(int *)(*this_00 + 4) + (int)this_00);
          if (uVar9 != 0) {
            uVar9 = *(uint *)(this_01 + 4) | uVar9;
            if (*(int *)(this_01 + 0x28) == 0) {
              uVar9 = uVar9 | 4;
            }
            std::ios_base::clear(this_01,uVar9,false);
            uVar8 = extraout_EDX_03;
          }
          if (0xf < uVar13) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler((int)pcVar12,uVar8);
          }
          unaff_ESI = 0xf;
        } while ((*(byte *)((int)auStackY_108 + *(int *)(local_10c + 4)) & 1) == 0);
      }
      Sound_FormatMessage(&local_30,(_String_base *)&local_30,local_68);
      (**(code **)(*local_6c + 0x84))();
      if (0xf < unaff_ESI) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(extraout_ECX_02,extraout_EDX_04);
      }
      STL_String_FindLastNotOf((int)local_140);
      local_140[0] = &PTR_IOSBase_DestructorWrapper_00531324;
      IOStream_RefCountDestructor((ios_base *)local_140);
      if (0xf < local_50) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler((int)local_64[0],extraout_EDX_05);
      }
      local_50 = 0xf;
      local_54 = 0;
      local_64[0] = (undefined4 ****)((uint)local_64[0] & 0xffffff00);
      STL_String_FindLastNotOf((int)local_a0);
      local_a0[0] = &PTR_IOSBase_DestructorWrapper_00531324;
      IOStream_RefCountDestructor((ios_base *)local_a0);
      ExceptionList = puVar14;
    }
  }
  Exception_SetMessage((void *)(unaff_EBX ^ unaff_retaddr),(undefined4 *)ExceptionList,puVar15);
  return;
}


