/*
 * Function: CPU_Instruction51
 * Address: 004cab20
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall CPU_Instruction51(void *this,uint param_1)

{
  uint uVar1;
  uint uVar2;
  uint uVar3;
  undefined4 uVar4;
  char *pcVar5;
  byte bVar6;
  byte *extraout_ECX;
  byte *pbVar7;
  undefined4 extraout_ECX_00;
  undefined4 extraout_ECX_01;
  undefined4 *puVar8;
  undefined4 *extraout_ECX_02;
  undefined4 *extraout_ECX_03;
  undefined4 *extraout_ECX_04;
  undefined4 *extraout_ECX_05;
  byte *pbVar9;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  byte *extraout_EDX_03;
  byte *extraout_EDX_04;
  byte *extraout_EDX_05;
  void *local_8;
  
  uVar2 = param_1;
  pbVar7 = *(byte **)(param_1 + 0xd0);
  pbVar9 = (byte *)(*(int *)(param_1 + 0xe4) + 1);
  *(byte **)(param_1 + 0xe4) = pbVar9;
  if (pbVar7 <= pbVar9) {
    local_8 = this;
    if (*(char *)(param_1 + 0x123) != '\0') {
      *(undefined4 *)(param_1 + 0xe4) = 0;
      CPU_Instruction15(param_1,*(undefined4 **)(param_1 + 0xe8),0,*(int *)(param_1 + 0xd8) + 1);
      pbVar7 = extraout_ECX;
      pbVar9 = extraout_EDX;
      do {
        bVar6 = *(char *)(uVar2 + 0x124) + 1;
        pbVar7 = (byte *)CONCAT31((int3)((uint)pbVar7 >> 8),bVar6);
        *(byte *)(uVar2 + 0x124) = bVar6;
        if (6 < bVar6) goto LAB_004cac14;
        pbVar7 = (byte *)((uint)bVar6 * 4);
        uVar3 = ((*(int *)(uVar2 + 200) - *(int *)(pbVar7 + 0x567d64)) + -1 +
                *(uint *)(pbVar7 + 0x567d80)) / *(uint *)(pbVar7 + 0x567d80);
        *(uint *)(uVar2 + 0xe0) = uVar3;
        pbVar9 = (byte *)((*(byte *)(uVar2 + 0x129) * uVar3 + 7 >> 3) + 1);
        *(byte **)(uVar2 + 0xdc) = pbVar9;
        if ((*(byte *)(uVar2 + 0x70) & 2) != 0) break;
        uVar1 = *(uint *)(pbVar7 + 0x567db8);
        uVar3 = (*(int *)(uVar2 + 0xcc) - *(int *)(pbVar7 + 0x567d9c)) + -1 + uVar1;
        pbVar9 = (byte *)(uVar3 % uVar1);
        *(uint *)(uVar2 + 0xd0) = uVar3 / uVar1;
      } while (*(int *)(uVar2 + 0xe0) == 0);
      if (bVar6 < 7) {
        return;
      }
    }
LAB_004cac14:
    if ((*(byte *)(uVar2 + 0x6c) & 0x20) == 0) {
      puVar8 = (undefined4 *)((int)&param_1 + 3);
      *(undefined4 **)(uVar2 + 0x80) = puVar8;
      *(undefined4 *)(uVar2 + 0x84) = 1;
      while( true ) {
        if (*(int *)(uVar2 + 0x78) == 0) {
          if (*(int *)(uVar2 + 0x10c) == 0) {
            do {
              CPU_Instruction33(puVar8,pbVar9,uVar2,0);
              CPU_Instruction2(extraout_ECX_00,(byte *)&local_8,uVar2,&local_8,4);
              uVar4 = CPU_Instruction24((undefined1 *)&local_8);
              *(undefined4 *)(uVar2 + 0x10c) = uVar4;
              PixelFormat_GetGreenComponent(uVar2);
              CPU_Instruction26(extraout_ECX_01,extraout_EDX_00,uVar2,(byte *)(uVar2 + 0x11c),4);
              pbVar9 = *(byte **)(uVar2 + 0x11c);
              puVar8 = &DAT_00567ce4;
              if (pbVar9 != DAT_00567ce4) {
                CPU_Instruction20(0x567ce4,pbVar9,uVar2,"Not enough image data");
                puVar8 = extraout_ECX_02;
                pbVar9 = extraout_EDX_01;
              }
            } while (*(int *)(uVar2 + 0x10c) == 0);
          }
          uVar3 = *(uint *)(uVar2 + 0x10c);
          pbVar7 = *(byte **)(uVar2 + 0xac);
          *(uint *)(uVar2 + 0x78) = *(uint *)(uVar2 + 0xb0);
          *(byte **)(uVar2 + 0x74) = pbVar7;
          if (uVar3 < *(uint *)(uVar2 + 0xb0)) {
            *(uint *)(uVar2 + 0x78) = uVar3;
          }
          CPU_Instruction26(uVar3,pbVar7,uVar2,pbVar7,*(uint *)(uVar2 + 0x78));
          *(int *)(uVar2 + 0x10c) = *(int *)(uVar2 + 0x10c) - *(int *)(uVar2 + 0x78);
        }
        pbVar7 = CPU_Instruction9((byte *)(uVar2 + 0x74),1);
        pbVar9 = extraout_EDX_02;
        if (pbVar7 == (byte *)0x1) break;
        puVar8 = extraout_ECX_03;
        if (pbVar7 != (byte *)0x0) {
          pcVar5 = *(char **)(uVar2 + 0x8c);
          if (pcVar5 == (char *)0x0) {
            pcVar5 = "Decompression Error";
          }
          CPU_Instruction20((uint)extraout_ECX_03,extraout_EDX_02,uVar2,pcVar5);
          puVar8 = extraout_ECX_04;
          pbVar9 = extraout_EDX_03;
        }
        if (*(int *)(uVar2 + 0x84) == 0) {
          CPU_Instruction20((uint)puVar8,pbVar9,uVar2,"Extra compressed data");
          puVar8 = extraout_ECX_05;
          pbVar9 = extraout_EDX_04;
        }
      }
      if (((*(int *)(uVar2 + 0x84) == 0) || (*(int *)(uVar2 + 0x78) != 0)) ||
         (*(int *)(uVar2 + 0x10c) != 0)) {
        CPU_Instruction20((uint)extraout_ECX_03,extraout_EDX_02,uVar2,"Extra compressed data");
        pbVar9 = extraout_EDX_05;
      }
      pbVar7 = (byte *)(*(uint *)(uVar2 + 0x68) | 8);
      *(byte **)(uVar2 + 0x68) = pbVar7;
      *(uint *)(uVar2 + 0x6c) = *(uint *)(uVar2 + 0x6c) | 0x20;
      *(undefined4 *)(uVar2 + 0x84) = 0;
    }
    if ((*(int *)(uVar2 + 0x10c) != 0) || (*(int *)(uVar2 + 0x78) != 0)) {
      CPU_Instruction20((uint)pbVar7,pbVar9,uVar2,"Extra compression data");
    }
    CPU_Instruction5(uVar2 + 0x74);
    *(uint *)(uVar2 + 0x68) = *(uint *)(uVar2 + 0x68) | 8;
  }
  return;
}


