/*
 * Function: CPU_Instruction42
 * Address: 004c9da0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CPU_Instruction42(uint param_1,byte *param_2,uint param_3,int param_4,byte *param_5)

{
  uint uVar1;
  void *this;
  undefined2 uVar2;
  byte *pbVar3;
  int iVar4;
  int iVar5;
  uint extraout_ECX;
  undefined4 extraout_ECX_00;
  undefined4 extraout_ECX_01;
  undefined4 extraout_ECX_02;
  undefined4 extraout_ECX_03;
  undefined4 extraout_ECX_04;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  byte *extraout_EDX_03;
  undefined2 extraout_var;
  char *pcVar6;
  byte bVar7;
  undefined4 *in_stack_fffffff0;
  undefined4 *in_stack_fffffff4;
  
  this = DAT_00569f5c;
  uVar1 = *(uint *)(param_3 + 0x68);
  if ((uVar1 & 1) == 0) {
    CPU_Instruction20(param_1,param_2,param_3,"Missing IHDR before bKGD");
    param_1 = extraout_ECX;
    param_2 = extraout_EDX;
  }
  else {
    if ((uVar1 & 4) != 0) {
      CPU_Instruction21(param_1,param_2,param_3,"Invalid bKGD after IDAT");
      CPU_Instruction33(extraout_ECX_00,extraout_EDX_00,param_3,(uint)param_5);
      Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
      return;
    }
    if ((*(char *)(param_3 + 0x126) == '\x03') && ((uVar1 & 2) == 0)) {
      CPU_Instruction21(param_1,param_2,param_3,"Missing PLTE before bKGD");
      CPU_Instruction33(param_5,extraout_EDX_01,param_3,(uint)param_5);
      Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
      return;
    }
    if ((param_4 != 0) && ((*(byte *)(param_4 + 8) & 0x20) != 0)) {
      CPU_Instruction21(param_1,param_2,param_3,"Duplicate bKGD chunk");
      CPU_Instruction33(extraout_ECX_01,param_5,param_3,(uint)param_5);
      Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
      return;
    }
  }
  if (*(byte *)(param_3 + 0x126) == 3) {
    pbVar3 = (byte *)0x1;
  }
  else {
    pbVar3 = (byte *)((*(byte *)(param_3 + 0x126) & 2 | 1) << 1);
  }
  if (param_5 != pbVar3) {
    pcVar6 = "Incorrect bKGD chunk length";
LAB_004c9e98:
    CPU_Instruction21(param_1,param_2,param_3,pcVar6);
    CPU_Instruction33(extraout_ECX_02,extraout_EDX_02,param_3,(uint)param_5);
    Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
    return;
  }
  CPU_Instruction26(param_1,param_2,param_3,&stack0xfffffff0,(uint)pbVar3);
  iVar4 = CPU_Instruction33(extraout_ECX_03,extraout_EDX_03,param_3,0);
  if (iVar4 == 0) {
    if (*(byte *)(param_3 + 0x126) == 3) {
      bVar7 = (byte)in_stack_fffffff0;
      param_1 = CONCAT31((int3)((uint)extraout_ECX_04 >> 8),bVar7);
      *(byte *)(param_3 + 0x138) = bVar7;
      if (*(ushort *)(param_4 + 0x14) != 0) {
        param_2 = (byte *)CONCAT22(extraout_var,(ushort)bVar7);
        if (*(ushort *)(param_4 + 0x14) < (ushort)bVar7) {
          pcVar6 = "Incorrect bKGD chunk index value";
          goto LAB_004c9e98;
        }
        iVar4 = ((uint)in_stack_fffffff0 & 0xff) * 3;
        iVar5 = iVar4 + *(int *)(param_3 + 0x114);
        *(ushort *)(param_3 + 0x13a) = (ushort)*(byte *)(iVar4 + *(int *)(param_3 + 0x114));
        *(ushort *)(param_3 + 0x13c) = (ushort)*(byte *)(iVar5 + 1);
        *(ushort *)(param_3 + 0x13e) = (ushort)*(byte *)(iVar5 + 2);
      }
    }
    else {
      if ((*(byte *)(param_3 + 0x126) & 2) == 0) {
        iVar4 = CPU_Instruction25(&stack0xfffffff0);
        uVar2 = (undefined2)iVar4;
        *(undefined2 *)(param_3 + 0x140) = uVar2;
        *(undefined2 *)(param_3 + 0x13c) = uVar2;
        *(undefined2 *)(param_3 + 0x13a) = uVar2;
      }
      else {
        iVar4 = CPU_Instruction25(&stack0xfffffff0);
        *(short *)(param_3 + 0x13a) = (short)iVar4;
        iVar4 = CPU_Instruction25(&stack0xfffffff2);
        *(short *)(param_3 + 0x13c) = (short)iVar4;
        iVar4 = CPU_Instruction25(&stack0xfffffff4);
        uVar2 = (undefined2)iVar4;
      }
      *(undefined2 *)(param_3 + 0x13e) = uVar2;
    }
    PNG_SetBackgroundColor(param_3,param_4,(undefined4 *)(param_3 + 0x138));
  }
  Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
  return;
}


