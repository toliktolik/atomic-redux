/*
 * Function: Database_LogTransaction
 * Address: 0047e230
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Type propagation algorithm not settling */

int * __fastcall Database_LogTransaction(int *param_1)

{
  int iVar1;
  locale *plVar2;
  facet *pfVar3;
  int *piVar4;
  uint uVar5;
  ios_base *this;
  undefined4 *puVar6;
  undefined1 local_40 [4];
  undefined4 local_3c;
  int *local_38;
  char local_34;
  facet *local_30;
  int local_28;
  uint local_24 [2];
  int *local_1c;
  uint local_18;
  undefined1 *local_14;
  void *pvStack_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x5147d0;
  pvStack_10 = ExceptionList;
  local_14 = &stack0xffffffb4;
  local_18 = 0;
  ExceptionList = &pvStack_10;
  local_1c = param_1;
  System_ProcessTaskQueue(&local_38,param_1,0);
  local_8 = 0;
  if (local_34 != '\0') {
    local_24[1] = 0;
    plVar2 = (locale *)
             SexyWidget_ProcessInput
                       ((void *)(*(int *)(*param_1 + 4) + (int)param_1),(int *)local_24);
    local_8._0_1_ = 1;
    pfVar3 = Database_ExecuteCommand(plVar2);
    local_8._0_1_ = 0;
    local_30 = pfVar3;
    if (local_24[0] != 0) {
      Threading_LockSectorByIndex(&local_28,0);
      iVar1 = *(int *)(local_24[0] + 4);
      if ((iVar1 != 0) && (iVar1 != -1)) {
        *(int *)(local_24[0] + 4) = iVar1 + -1;
      }
      puVar6 = (undefined4 *)(local_24[0] & (*(int *)(local_24[0] + 4) != 0) - 1);
      Threading_UnlockSectorByIndex(&local_28);
      if (puVar6 != (undefined4 *)0x0) {
        (**(code **)*puVar6)(1);
      }
    }
    iVar1 = *(int *)(*(int *)(*param_1 + 4) + 0x28 + (int)param_1);
    local_3c = CONCAT31(local_3c._1_3_,iVar1 == 0);
    local_28 = CONCAT31(local_28._1_3_,1);
    local_8 = CONCAT31(local_8._1_3_,2);
    (**(code **)(*(int *)pfVar3 + 0x20))
              (local_40,iVar1,local_3c,0,local_28,*(int *)(*param_1 + 4) + (int)param_1,&local_18,
               local_24 + 1);
    piVar4 = (int *)Database_ProcessTransaction();
    return piVar4;
  }
  this = (ios_base *)(*(int *)(*param_1 + 4) + (int)param_1);
  if (local_18 != 0) {
    uVar5 = *(uint *)(this + 4) | local_18;
    if (*(int *)(this + 0x28) == 0) {
      uVar5 = uVar5 | 4;
    }
    std::ios_base::clear(this,uVar5,false);
  }
  iVar1 = *(int *)(*(int *)(*local_38 + 4) + 0x28 + (int)local_38);
  local_8 = 0xffffffff;
  if (iVar1 != 0) {
    Threading_LeaveCriticalSectionFromPointer((undefined4 *)(iVar1 + 4));
  }
  ExceptionList = pvStack_10;
  return param_1;
}


