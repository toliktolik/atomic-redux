/*
 * Function: Unwind@005133d1
 * Address: 005133d1
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x0051344a) overlaps instruction at (ram,0x00513447)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x0051337a) */
/* WARNING: Removing unreachable block (ram,0x00513385) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_005133d1(uint param_1,int param_2)

{
  int *piVar1;
  uint *puVar2;
  uint uVar3;
  int iVar4;
  byte bVar5;
  bool bVar6;
  byte bVar7;
  undefined1 uVar8;
  int *in_EAX;
  int iVar9;
  undefined2 uVar10;
  uint uVar11;
  byte bVar13;
  int unaff_EBX;
  undefined4 uVar12;
  undefined1 *puVar14;
  uint unaff_EBP;
  byte *unaff_ESI;
  byte *unaff_EDI;
  byte *pbVar15;
  undefined2 in_DS;
  bool in_CF;
  bool in_PF;
  byte in_AF;
  char in_ZF;
  char in_SF;
  byte in_TF;
  byte in_IF;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  undefined1 *unaff_retaddr;
  
  bVar13 = (byte)in_EAX;
  uVar10 = (undefined2)((uint)in_EAX >> 0x10);
  if (!in_PF) {
    *(uint *)(unaff_retaddr + -4) =
         CONCAT22(uVar10,CONCAT11(in_SF << 7 | in_ZF << 6 | in_AF << 4 | in_PF << 2 | 2 | in_CF,
                                  bVar13));
    unaff_EDI[-0x1c] = unaff_EDI[-0x1c] + 1;
    pbVar15 = unaff_ESI + 1;
    bVar13 = *unaff_ESI;
    uVar11 = param_2 + 1;
    *(uint *)(unaff_retaddr + param_2 + -3) =
         *(uint *)(unaff_retaddr + param_2 + -3) | (uint)unaff_EDI;
    iVar9 = CONCAT31((int3)(CONCAT22(uVar10,CONCAT11(bVar13 / 0xf4,bVar13)) >> 8),bVar13 % 0xf4);
    *(int *)(param_1 + 0x44c7d9b7) = *(int *)(param_1 + 0x44c7d9b7) + -0x55;
    bVar13 = (byte)((uint)unaff_EBX >> 8);
    DAT_56635637 = DAT_56635637 ^ bVar13;
    puVar2 = (uint *)(iVar9 + -0x14dc85f);
    uVar3 = *puVar2;
    *puVar2 = *puVar2 - uVar11;
    uVar12 = CONCAT31((int3)((uint)unaff_EBX >> 8),((char)unaff_EBX - bVar13) - (uVar3 < uVar11));
    segment(in_DS,(short)uVar12 + (short)unaff_EDI + -0x2226);
    while( true ) {
      piVar1 = (int *)(iVar9 + -0x62);
      iVar4 = *piVar1;
      *piVar1 = *piVar1 - (int)unaff_EDI;
      uVar10 = (undefined2)uVar11;
      out(*pbVar15,uVar10);
      uVar8 = in(uVar10);
      if (SBORROW4(iVar4,(int)unaff_EDI)) {
        *(uint *)(unaff_retaddr + -4) = CONCAT31((int3)((uint)iVar9 >> 8),uVar8);
        *(uint *)(unaff_retaddr + -8) = param_1;
        *(uint *)(unaff_retaddr + -0xc) = uVar11;
        *(undefined4 *)(unaff_retaddr + -0x10) = uVar12;
        *(undefined1 **)((int)unaff_retaddr + -0x14) = unaff_retaddr;
        *(int *)(unaff_retaddr + -0x18) = unaff_EBX;
        *(byte **)(unaff_retaddr + -0x1c) = pbVar15 + 1;
        *(byte **)(unaff_retaddr + -0x20) = unaff_EDI;
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      *(undefined4 *)(unaff_retaddr + -4) = uVar12;
      out(pbVar15[1],uVar10);
      unaff_EDI = *(byte **)(unaff_retaddr + -4);
      _DAT_909c84be = *(undefined4 *)(unaff_retaddr + 4);
      uVar12 = *(undefined4 *)(unaff_retaddr + 0xc);
      uVar11 = *(uint *)(unaff_retaddr + 0x10);
      unaff_EBX = *(int *)(unaff_retaddr + 0x18);
      param_1 = CONCAT31((int3)((uint)*(undefined4 *)(unaff_retaddr + 0x14) >> 8),0xc1);
      pbVar15 = *(byte **)(unaff_retaddr + 0x1c);
      puVar14 = unaff_retaddr + 0x20;
      uVar8 = in(0x38);
      iVar9 = CONCAT31((int3)((uint)_DAT_909c84be >> 8),uVar8);
      if ((char)uVar12 <= (char)_DAT_909c84be) break;
      unaff_retaddr = unaff_retaddr + 0x20;
      if ((POPCOUNT((char)_DAT_909c84be - (char)uVar12) & 1U) == 0) {
        unaff_retaddr = puVar14;
      }
    }
    *(uint *)(pbVar15 + (int)unaff_EDI * 4) =
         *(uint *)(pbVar15 + (int)unaff_EDI * 4) | (uint)unaff_EDI;
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  out(0x68,bVar13);
  unaff_EDI[-1] = bVar13;
  if (in_CF || unaff_EDI + -1 == (byte *)0x0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  *in_EAX = *in_EAX + 1;
  if (in_CF || *in_EAX == 0) {
    _DAT_6fa67d7f =
         CONCAT22(uVar10,CONCAT11(((char)((uint)in_EAX >> 8) - DAT_9608a735) - in_CF,bVar13));
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  *(char *)(unaff_EBX + -0x37) = *(char *)(unaff_EBX + -0x37) >> ((byte)param_1 & 0x1f);
  do {
    unaff_EBP = unaff_EBP & *(uint *)((int)in_EAX + -0x3b);
    bVar7 = (byte)param_1 & 0x1f;
    bVar13 = *unaff_EDI;
    *unaff_EDI = *unaff_EDI >> bVar7;
    bVar6 = (param_1 & 0x1f) != 0;
  } while ((!bVar6 && unaff_EBP == 0 || bVar6 && *unaff_EDI == 0) ||
           (bVar7 == 1 && (char)bVar13 < '\0') !=
           (!bVar6 && (int)unaff_EBP < 0 || bVar6 && (char)*unaff_EDI < '\0'));
  bVar5 = unaff_ESI[-0x62c8b76];
  unaff_ESI[-0x62c8b76] = ((param_1 & 0x1f) != 0 && (bVar13 >> bVar7 - 1 & 1) != 0) | bVar5 << 1;
  pbVar15 = unaff_EDI + -1;
  if (pbVar15 != (byte *)0x0 && 0 < (int)unaff_EDI) {
    *(uint *)(unaff_retaddr + -4) =
         (uint)(in_NT & 1) * 0x4000 | (uint)SBORROW4((int)unaff_EDI,1) * 0x800 |
         (uint)(in_IF & 1) * 0x200 | (uint)(in_TF & 1) * 0x100 | (uint)((int)pbVar15 < 0) * 0x80 |
         (uint)(pbVar15 == (byte *)0x0) * 0x40 | (uint)(in_AF & 1) * 0x10 |
         (uint)((POPCOUNT((uint)pbVar15 & 0xff) & 1U) == 0) * 4 | (uint)((bVar5 & 0x80) != 0) |
         (uint)(in_ID & 1) * 0x200000 | (uint)(in_VIP & 1) * 0x100000 | (uint)(in_VIF & 1) * 0x80000
         | (uint)(in_AC & 1) * 0x40000;
    File_CloseHandle(param_1);
    return;
  }
  *(undefined4 *)(unaff_retaddr + -4) = 1;
  *(undefined2 *)(unaff_retaddr + -8) = in_DS;
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


