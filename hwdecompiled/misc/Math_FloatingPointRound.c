/*
 * Function: Math_FloatingPointRound
 * Address: 004fbc10
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

float10 __fastcall Math_FloatingPointRound(char *param_1,undefined2 param_2,double param_3)

{
  byte *pbVar1;
  undefined4 uVar2;
  byte bVar3;
  byte bVar5;
  bool bVar6;
  bool bVar7;
  ulonglong uVar8;
  uint uVar9;
  uint5 uVar10;
  char *pcVar11;
  byte bVar12;
  uint in_EAX;
  uint uVar13;
  uint *puVar14;
  char *pcVar15;
  byte bVar16;
  int unaff_EBX;
  int unaff_EBP;
  char *unaff_ESI;
  undefined4 *unaff_EDI;
  bool bVar17;
  ushort in_FPUControlWord;
  float10 in_ST0;
  double dVar18;
  longlong lVar19;
  char *pcVar20;
  byte bVar4;
  
  if (DAT_005a5224 != 0) {
    in_EAX = MXCSR & 0x1f80;
    bVar17 = in_EAX == 0x1f80;
    if (bVar17) {
      in_EAX = (uint)(in_FPUControlWord & 0x7f);
      bVar17 = (in_FPUControlWord & 0x7f) == 0x7f;
    }
    if (bVar17) {
      uVar9 = (uint)((ulonglong)param_3 >> 0x20);
      uVar13 = uVar9 >> 0x14;
      lVar19 = CONCAT44(_UNK_005470d4,_DAT_005470d0 - (uVar9 >> 0x14 & _DAT_00547100));
      if ((uVar13 & 0x800) == 0) {
        if (uVar13 < 0x3ff) {
          return (float10)0;
        }
        if (uVar13 < 0x433) {
          return (float10)(double)(((ulonglong)param_3 >> lVar19) << lVar19);
        }
      }
      else {
        dVar18 = (double)(((ulonglong)param_3 >> lVar19) << lVar19);
        if (uVar13 < 0xbff) {
          return (float10)(double)((-(ulonglong)(param_3 < _DAT_005470f0) | (ulonglong)_DAT_005470f0
                                   ) & _DAT_005470e0);
        }
        if (uVar13 < 0xc33) {
          return (float10)(dVar18 - (double)(-(ulonglong)(param_3 < dVar18) & _DAT_005470c0));
        }
      }
      if (NAN(param_3)) {
        func_0x00503f38(&param_3,&param_3,&param_3,0x3ed);
      }
      return (float10)param_3;
    }
  }
  bVar17 = 0x92 < (byte)in_EAX;
  pcVar11 = (char *)CONCAT31((int3)(in_EAX >> 8),(byte)in_EAX + 0x6d);
  pcVar20 = param_1;
  if (param_1 != (char *)0x0) {
    return in_ST0;
  }
  while( true ) {
    pcVar15 = pcVar11;
    pbVar1 = (byte *)(param_1 + -0x1b);
    bVar3 = *pbVar1;
    bVar12 = (byte)param_1;
    bVar4 = *pbVar1;
    bVar5 = bVar12 + *pbVar1;
    pbVar1 = (byte *)((int)unaff_EDI + unaff_EBP * 2);
    bVar16 = (byte)pcVar15;
    *pbVar1 = *pbVar1 << (bVar16 & 7) | *pbVar1 >> 8 - (bVar16 & 7);
    bVar6 = ((uint)pcVar15 & 0x1f) != 0;
    bVar7 = (bVar16 & 0x1f) != 1;
    if (bVar7 && SCARRY1(bVar12,bVar4) != SCARRY1(bVar5,bVar17) ||
        !bVar7 && (!bVar6 && (CARRY1(bVar12,bVar3) || CARRY1(bVar5,bVar17)) ||
                  bVar6 && (*pbVar1 & 1) != 0) != (char)*pbVar1 < '\0') break;
    puVar14 = (uint *)CONCAT31((int3)((uint)param_1 >> 8),(bVar5 + bVar17) - 0x2c);
    uVar10 = CONCAT14(0x2b < (byte)(bVar5 + bVar17),unaff_EBX);
    uVar8 = (ulonglong)(uVar10 >> (bVar16 & 0x1f)) | (ulonglong)uVar10 << 0x21 - (bVar16 & 0x1f);
    unaff_EBX = CONCAT22((short)(uVar8 >> 0x10),
                         CONCAT11((char)(uVar8 >> 8) + *pcVar20 + ((uVar8 & 0x100000000) != 0),
                                  (char)uVar8));
    *puVar14 = *puVar14 << 10 | *puVar14 >> 0x16;
    bVar17 = (*puVar14 & 1) != 0;
    pcVar11 = _DAT_0874d2b4;
    param_1 = pcVar15;
    unaff_ESI = pcVar20;
    pcVar20 = *(char **)(unaff_EBX + (int)pcVar15 * 4);
  }
  out(*unaff_ESI,param_2);
  uVar2 = in(param_2);
  *unaff_EDI = uVar2;
  *(char **)(pcVar20 + -4) = pcVar20;
  *(int *)(pcVar20 + -8) = unaff_EBP;
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


