/*
 * Function: Unwind@00514760
 * Address: 00514760
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005147b3) overlaps instruction at (ram,0x005147ae)
    */
/* WARNING: Unable to track spacebase fully for stack */

void __fastcall Unwind_00514760(int param_1,undefined2 param_2)

{
  undefined4 *puVar1;
  int *piVar2;
  int iVar3;
  code *pcVar5;
  undefined8 uVar6;
  byte bVar7;
  uint uVar8;
  char cVar9;
  int unaff_EBX;
  undefined2 *puVar10;
  undefined1 *puVar11;
  int unaff_EBP;
  int unaff_ESI;
  char *unaff_EDI;
  undefined2 in_CS;
  undefined2 in_SS;
  byte in_CF;
  bool in_ZF;
  char in_SF;
  char in_OF;
  bool bVar12;
  int iVar4;
  
  if (!in_ZF && in_OF == in_SF) {
    while( true ) {
      piVar2 = (int *)(unaff_EDI + 0x49c5be60);
      iVar3 = *piVar2;
      iVar4 = *piVar2;
      *piVar2 = (iVar4 - (int)unaff_EDI) - (uint)in_CF;
      if (SBORROW4(iVar3,(int)unaff_EDI) == SBORROW4(iVar4 - (int)unaff_EDI,(uint)in_CF)) break;
      out(param_2,(char)unaff_ESI);
      uVar8 = in(0xb);
      in_CF = uVar8 < 0xcbd69978;
      unaff_ESI = uVar8 + 0x34296688;
      LOCK();
      piVar2 = (int *)(param_1 + -0x3a419f41 + unaff_EBX);
      iVar3 = *piVar2;
      *piVar2 = param_1;
      UNLOCK();
      param_1 = iVar3 + -1;
    }
    return;
  }
  bVar7 = in(param_2);
  LOCK();
  puVar1 = (undefined4 *)(CONCAT31((int3)((uint)unaff_ESI >> 8),bVar7) + -0x52483a96);
  puVar11 = (undefined1 *)*puVar1;
  *puVar1 = &stack0xffffffe0;
  UNLOCK();
  cVar9 = (bVar7 | 0xed) - *(char *)(unaff_EBX + -0x450d57b4);
  if (!SBORROW1(bVar7 | 0xed,*(char *)(unaff_EBX + -0x450d57b4))) {
    pcVar5 = (code *)swi(3);
    (*pcVar5)();
    return;
  }
  while( true ) {
    *(char *)(unaff_EBP + -0xdb0cbac) = *(char *)(unaff_EBP + -0xdb0cbac) - cVar9;
    bVar12 = SCARRY4(unaff_EBP,1);
    unaff_EBP = unaff_EBP + 1;
    *(undefined2 *)(puVar11 + -4) = in_CS;
    if (bVar12 == unaff_EBP < 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    uVar6 = rdtsc();
    if (bVar12) break;
    puVar10 = (undefined2 *)(puVar11 + -8);
    puVar11 = puVar11 + -8;
    *puVar10 = in_SS;
    LOCK();
    cVar9 = *unaff_EDI;
    *unaff_EDI = (char)((ulonglong)uVar6 >> 0x28);
    UNLOCK();
  }
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


