/*
 * Function: Unwind@00513c46
 * Address: 00513c46
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00513c5d) overlaps instruction at (ram,0x00513c5c)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */
/* WARNING: Removing unreachable block (ram,0x00513cc6) */

uint __fastcall Unwind_00513c46(int param_1,ushort *param_2)

{
  uint *puVar1;
  char cVar2;
  int iVar3;
  undefined6 uVar4;
  undefined1 *puVar5;
  byte bVar6;
  undefined1 uVar7;
  undefined4 *puVar8;
  int3 iVar10;
  uint uVar9;
  undefined1 *in_EAX;
  undefined2 uVar11;
  int iVar12;
  undefined2 extraout_DX;
  int unaff_EBX;
  int unaff_EBP;
  char *unaff_ESI;
  int unaff_EDI;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 in_DS;
  bool bVar13;
  bool in_ZF;
  undefined1 *puStack_8;
  
  uVar7 = SUB41(unaff_ESI,0);
  uVar11 = (undefined2)((uint)unaff_ESI >> 0x10);
  if (!in_ZF) {
    iVar3 = *(int *)(unaff_EDI + 0x41);
    *unaff_ESI = (*unaff_ESI - (char)((uint)param_2 >> 8)) -
                 ((byte)param_2 < *(byte *)(unaff_EBX + -0x544e187e));
    puStack_8 = &stack0xfffffffc;
    iVar12 = param_1 - (int)param_2;
    param_2 = (ushort *)((uint)param_2 ^ *(uint *)(unaff_ESI + 1));
    iVar12 = iVar12 + -1;
    iVar10 = (int3)((uint)unaff_EBX >> 8);
    if (iVar12 == 0 || param_2 != (ushort *)0x0) {
      return CONCAT31(iVar10,*in_EAX) | 0x21173c00;
    }
    if (unaff_EBP + 1 != 0) {
      bVar13 = 9 < ((byte)unaff_EBX & 0xf) || ((uint)&stack0xfffffffc & 0x10) != 0;
      bVar6 = (byte)unaff_EBX + bVar13 * -6;
      puStack_8 = (undefined1 *)
                  CONCAT31(iVar10,bVar6 + (0x9f < bVar6 | bVar13 * (bVar6 < 6)) * -0x60);
      bVar13 = (POPCOUNT((uint)unaff_ESI & 0xff) & 1U) == 0;
      iVar12 = CONCAT22(uVar11,CONCAT11(0xe1,uVar7));
      puVar8 = (undefined4 *)
               CONCAT22((short)((uint)unaff_EBX >> 0x10),
                        CONCAT11((char)((ushort)puStack_8 % (ushort)(byte)puStack_8[-9]),
                                 (char)((ushort)puStack_8 / (ushort)(byte)puStack_8[-9])));
      if (&puStack_8 < (undefined1 *)(unaff_EDI + iVar3 + 1) || unaff_ESI == (char *)0x0) {
        out(0x97,&puStack_8);
        cVar2 = *(char *)((int)iVar10 >> 0x17);
        puVar5 = (undefined1 *)*puVar8;
        *(undefined2 *)puVar8 = in_CS;
        puVar8[-1] = &puStack_8;
        puVar8[-2] = CONCAT22(0xf970,CONCAT11('\x1e' - cVar2,0x52));
        puVar8[-3] = (char *)((int)iVar10 >> 0x17);
        puVar8[-4] = iVar12;
        puVar8[-5] = puVar8;
        puVar8[-6] = unaff_EBP + 1;
        puVar8[-7] = in_EAX;
        puVar8[-8] = puVar5;
        bVar6 = *(byte *)(iVar12 + ((uint)&puStack_8 & 0xff));
        *puVar5 = *in_EAX;
        *(undefined2 *)(puVar8 + -8) = in_ES;
        out(0xb9,(bVar6 | 0x78) + 0x94);
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      uVar4 = *(undefined6 *)((int)puVar8 + (int)in_EAX * 8 + 0x2d);
      puVar8[-1] = 0x513bd5;
      func_0x32504fb3();
      if (!bVar13) {
        out(*(undefined1 *)uVar4,extraout_DX);
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
LAB_00513c33:
    uVar9 = File_GetSize(iVar12,(short)param_2);
    return uVar9;
  }
  iVar12 = param_1 + -1;
  if (iVar12 == 0) {
    DAT_ff6f9dd1 = uVar7;
    *param_2 = *param_2 - (*param_2 & 3);
  }
  else {
    puVar1 = (uint *)segment(in_DS,(short)unaff_EBX);
    if ((int)(*puVar1 &
             CONCAT22(uVar11,CONCAT11((byte)((uint)unaff_ESI >> 8) | (byte)param_2[0xd0f231d],uVar7)
                     )) < 0) {
      out((short)param_2,uVar7);
      *(undefined4 *)(unaff_EBP + 3) = 0x5b;
      goto LAB_00513c33;
    }
  }
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


