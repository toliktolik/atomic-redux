/*
 * Function: Unwind@005164a0
 * Address: 005164a0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00516596) overlaps instruction at (ram,0x00516593)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_005164a0(char *param_1,byte *param_2)

{
  uint *puVar1;
  int *piVar2;
  char cVar3;
  byte bVar4;
  code *pcVar5;
  undefined6 uVar6;
  byte bVar7;
  byte *in_EAX;
  uint uVar9;
  undefined2 uVar10;
  int extraout_EDX;
  int unaff_EBX;
  undefined4 *puVar11;
  undefined4 *puVar12;
  byte *unaff_ESI;
  char *unaff_EDI;
  char *pcVar13;
  char *pcVar14;
  bool bVar15;
  bool bVar16;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  int in_FPUDataPointer;
  int in_FPUInstructionPointer;
  byte *pbStack_2c;
  int *piStack_28;
  undefined4 uStack_24;
  char cVar8;
  
  bVar16 = false;
  do {
    if (param_1 != (char *)0x0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    puVar11 = (undefined4 *)&DAT_e214be38;
    bVar15 = ((uint)in_EAX & 0x1000) != 0;
    uVar9 = (uint)bRam4792b1b7;
    param_1 = (char *)(uVar9 * 0x100);
    *unaff_ESI = *unaff_ESI & bRam4792b1b7;
  } while ((POPCOUNT(*unaff_ESI) & 1U) == 0);
  piVar2 = (int *)((int)unaff_EDI * 8 + 0x7ab08c84);
  *piVar2 = *piVar2 - unaff_EBX;
  piStack_28 = (int *)(unaff_EBX + 1);
  if ((byte *)0x92c0eee4 < in_EAX) {
    piStack_28 = (int *)CONCAT31((int3)((uint)piStack_28 >> 8),0x9b);
    puVar1 = (uint *)(in_EAX + 0x71);
    *puVar1 = *puVar1 - (int)param_2;
    pcVar13 = unaff_EDI;
    if ((POPCOUNT(*puVar1 & 0xff) & 1U) == 0) goto LAB_0051658e;
    out(0x6c,(char)unaff_EDI);
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  piStack_28[uVar9 * 0x40] = piStack_28[uVar9 * 0x40];
  _DAT_e214be65 = _DAT_e214be65 & (uint)&stack0xffffffe0;
  puVar12 = puVar11;
  if ((int)_DAT_e214be65 < 0) {
    DAT_a5c89192 = (char)in_EAX;
    *unaff_EDI = DAT_a5c89192;
    *(undefined4 *)(unaff_EDI + -1) = *(undefined4 *)unaff_ESI;
    *(char *)(unaff_EBX + 0x47) = *(char *)(unaff_EBX + 0x47) - (char)param_2;
    pcVar5 = (code *)swi(3);
    pbStack_2c = param_2;
    piStack_28 = (int *)param_1;
    (*pcVar5)();
    return;
  }
  do {
    uVar9 = in((short)param_2);
    puVar11 = (undefined4 *)*puVar12;
    bVar16 = (puVar12[1] & 0x400) != 0;
    bVar15 = (puVar12[1] & 0x10) != 0;
    param_1 = param_1 + -1;
    if (param_1 == (char *)0x0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    pcVar13 = (char *)0xb61eae9a;
    in_EAX = unaff_ESI;
    while( true ) {
      uVar6 = *(undefined6 *)pcVar13;
      param_2 = (byte *)uVar6;
      uVar10 = (undefined2)uVar6;
      pcVar14 = pcVar13 + (uint)bVar16 * -8 + 4 + (uint)bVar16 * -2 + 1;
      unaff_ESI = in_EAX + (uint)bVar16 * -8 + 4 + (uint)bVar16 * -2 + 1;
      if (SBORROW1(in_EAX[(uint)bVar16 * -8 + 4],pcVar13[(uint)bVar16 * -8 + 4])) break;
      *(uint *)((int)piStack_28 + -0x70616ccd) =
           *(uint *)((int)piStack_28 + -0x70616ccd) | (uint)piStack_28;
      pcVar13 = (char *)(uVar9 & 0x84003d9);
      *pcVar13 = *pcVar13 - (char)uVar6;
      bVar15 = (bool)(9 < ((byte)pcVar13 & 0xf) | bVar15);
      bVar7 = (byte)pcVar13 + bVar15 * -6;
      bVar4 = 0x9f < bVar7 | unaff_ESI[-0x43] < (byte)((uint)pcVar13 >> 8) | bVar15 * (bVar7 < 6);
      cVar8 = bVar7 + bVar4 * -0x60;
      unaff_EDI = (char *)CONCAT31((int3)((uint)pcVar13 >> 8),cVar8);
      out(0xd5,cVar8);
      *(undefined2 *)(piStack_28 + 0x103aea6c) = in_FPUControlWord;
      *(undefined2 *)(piStack_28 + 0x103aea6d) = in_FPUStatusWord;
      *(undefined2 *)(piStack_28 + 0x103aea6e) = in_FPUTagWord;
      piStack_28[0x103aea71] = in_FPUDataPointer;
      piStack_28[0x103aea6f] = in_FPUInstructionPointer;
      *(undefined2 *)((int)piStack_28 + 0x40eba9c2) = in_FPULastInstructionOpcode;
      param_1 = param_1 + -1;
      if (param_1 != (char *)0x0) {
        uVar9 = puVar11[0x13];
        pcVar13 = pcVar14 + (uint)bVar16 * -2 + 1;
        cVar3 = in(0x73db);
        *pcVar14 = cVar3;
        uVar10 = 0x1b99;
        if ((POPCOUNT(((uint)unaff_ESI | uVar9) & 0xff) & 1U) == 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
          halt_baddata();
        }
        *(int *)(pcVar13 + -0x3b) = *(int *)(pcVar13 + -0x3b) - (int)pcVar13;
code_r0x005165c9:
        *param_1 = cVar8;
        out(uVar10,cVar8);
        unaff_EDI[(uint)bVar16 * -8 + 0x3dca4f3f] =
             unaff_EDI[(uint)bVar16 * -8 + 0x3dca4f3f] & (byte)((uint)piStack_28 >> 8);
        uStack_24 = 0x5165e2;
        pbStack_2c = unaff_ESI;
        func_0x20817c26();
        *(char *)(extraout_EDX + -2) = *(char *)(extraout_EDX + -2) - (char)extraout_EDX;
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      param_1 = (char *)0x19;
      in_EAX = unaff_ESI;
      pcVar13 = pcVar14;
      if (&stack0x00000000 == (undefined1 *)0x1c ||
          (SCARRY4((int)&pbStack_2c,*piStack_28) !=
          SCARRY4((int)&pbStack_2c + *piStack_28,(uint)bVar4)) != (int)&stack0xffffffe4 < 0)
      goto code_r0x005165c9;
LAB_0051658e:
      uVar9 = CONCAT31((int3)((uint)unaff_EDI >> 8),
                       *(undefined1 *)((int)piStack_28 + ((uint)unaff_EDI & 0xff)));
      *(int *)(pcVar13 + -0x5165406d) = *(int *)(pcVar13 + -0x5165406d) - (int)&stack0xffffffe0;
    }
    unaff_ESI[-0x20899ced] = unaff_ESI[-0x20899ced] ^ (byte)((uint)param_1 >> 8);
    puVar12 = puVar11;
  } while( true );
}


