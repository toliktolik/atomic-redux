/*
 * Function: Image_Threshold
 * Address: 0049c430
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void Image_Threshold(undefined4 param_1,int *param_2)

{
  int iVar1;
  int iVar2;
  char *pcVar3;
  char *pcVar4;
  int *piVar5;
  uint *puVar6;
  int *piVar7;
  undefined3 uVar8;
  undefined3 extraout_var;
  int *extraout_ECX;
  undefined3 extraout_var_00;
  int *extraout_ECX_00;
  uint extraout_EDX;
  uint uVar9;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  int *piVar10;
  int *piVar11;
  bool bVar12;
  undefined8 uVar13;
  undefined **local_5c [10];
  undefined1 local_34 [4];
  undefined1 local_30;
  undefined4 local_20;
  undefined4 local_1c;
  void *local_18;
  int *local_14;
  void *pvStack_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  piVar7 = param_2;
  local_8 = 0xffffffff;
  uStack_c = 0x515e68;
  pvStack_10 = ExceptionList;
  ExceptionList = &pvStack_10;
  if (*(char *)((int)param_2 + 0x41) != '\0') {
    local_1c = 0xf;
    local_20 = 0;
    local_30 = 0;
    pcVar3 = "invalid map/set<T> iterator";
    do {
      pcVar4 = pcVar3;
      pcVar3 = pcVar4 + 1;
    } while (*pcVar4 != '\0');
    ExceptionList = &pvStack_10;
    String_Assign(local_34,(_String_base *)"invalid map/set<T> iterator",(uint)(pcVar4 + -0x52a114))
    ;
    local_8 = 0;
    Level_InitializeFrigistan(local_5c,local_34);
    local_5c[0] = &PTR_Level_InitializePetrovakia_00531574;
    CRuntime_CxxThrowException(local_5c,&DAT_0054f69c);
  }
  local_14 = piVar7;
  Math_RotatePoint((int *)&param_2);
  piVar10 = (int *)*piVar7;
  puVar6 = (uint *)(piVar7 + 2);
  uVar9 = extraout_EDX;
  piVar5 = piVar7;
  if (*(char *)((int)piVar10 + 0x41) == '\0') {
    uVar9 = *puVar6;
    if (*(char *)(uVar9 + 0x41) != '\0') goto LAB_0049c4d8;
    puVar6 = (uint *)(param_2 + 2);
    piVar5 = param_2;
  }
  piVar10 = (int *)*puVar6;
LAB_0049c4d8:
  if (piVar5 == piVar7) {
    piVar11 = (int *)piVar7[1];
    uVar13 = CONCAT44(uVar9,piVar11);
    if (*(char *)((int)piVar10 + 0x41) == '\0') {
      piVar10[1] = (int)piVar11;
    }
    if (*(int **)(*(int *)((int)local_18 + 4) + 4) == local_14) {
      *(int **)(*(int *)((int)local_18 + 4) + 4) = piVar10;
    }
    else if ((int *)*piVar11 == local_14) {
      *piVar11 = (int)piVar10;
    }
    else {
      piVar11[2] = (int)piVar10;
    }
    if ((int *)**(int **)((int)local_18 + 4) == local_14) {
      if (*(char *)((int)piVar10 + 0x41) == '\0') {
        uVar13 = Level_CheckCompletion(piVar10);
      }
      uVar9 = (uint)((ulonglong)uVar13 >> 0x20);
      **(undefined4 **)((int)local_18 + 4) = (int)uVar13;
    }
    piVar7 = local_14;
    if (*(int **)(*(int *)((int)local_18 + 4) + 8) == local_14) {
      if (*(char *)((int)piVar10 + 0x41) == '\0') {
        uVar13 = Animation_SetPlane((int)piVar10);
        uVar9 = (uint)((ulonglong)uVar13 >> 0x20);
        piVar7 = *(int **)((int)local_18 + 4);
        piVar7[2] = (int)uVar13;
      }
      else {
        piVar7 = *(int **)((int)local_18 + 4);
        piVar7[2] = (int)piVar11;
      }
    }
  }
  else {
    *(int **)(*piVar7 + 4) = piVar5;
    *piVar5 = *piVar7;
    piVar11 = piVar5;
    if (piVar5 != (int *)piVar7[2]) {
      piVar11 = (int *)piVar5[1];
      if (*(char *)((int)piVar10 + 0x41) == '\0') {
        piVar10[1] = (int)piVar11;
      }
      *piVar11 = (int)piVar10;
      *puVar6 = local_14[2];
      *(int **)(local_14[2] + 4) = piVar5;
    }
    if (*(int **)(*(int *)((int)local_18 + 4) + 4) == local_14) {
      *(int **)(*(int *)((int)local_18 + 4) + 4) = piVar5;
    }
    else {
      piVar7 = (int *)local_14[1];
      if ((int *)*piVar7 == local_14) {
        *piVar7 = (int)piVar5;
      }
      else {
        piVar7[2] = (int)piVar5;
      }
    }
    iVar1 = local_14[1];
    piVar5[1] = iVar1;
    iVar2 = piVar5[0x10];
    piVar7 = (int *)CONCAT31((int3)((uint)iVar1 >> 8),(char)iVar2);
    uVar9 = CONCAT31((int3)((uint)local_18 >> 8),(char)local_14[0x10]);
    *(char *)(piVar5 + 0x10) = (char)local_14[0x10];
    *(char *)(local_14 + 0x10) = (char)iVar2;
  }
  if ((char)local_14[0x10] == '\x01') {
    piVar7 = *(int **)((int)local_18 + 4);
    if (piVar10 != (int *)piVar7[1]) {
      do {
        if ((char)piVar10[0x10] != '\x01') break;
        piVar5 = (int *)*piVar11;
        uVar8 = (undefined3)((uint)piVar7 >> 8);
        if (piVar10 == piVar5) {
          piVar5 = (int *)piVar11[2];
          if ((char)piVar5[0x10] == '\0') {
            *(undefined1 *)(piVar5 + 0x10) = 1;
            *(undefined1 *)(piVar11 + 0x10) = 0;
            Vector_Distance(local_18,(int)piVar11);
            piVar5 = (int *)piVar11[2];
            uVar8 = extraout_var;
          }
          piVar7 = (int *)CONCAT31(uVar8,*(char *)((int)piVar5 + 0x41));
          if (*(char *)((int)piVar5 + 0x41) == '\0') {
            if ((*(char *)(*piVar5 + 0x40) != '\x01') ||
               (piVar7 = (int *)piVar5[2], (char)piVar7[0x10] != '\x01')) {
              if (*(char *)(piVar5[2] + 0x40) == '\x01') {
                *(undefined1 *)(*piVar5 + 0x40) = 1;
                *(undefined1 *)(piVar5 + 0x10) = 0;
                Vector_Add(local_18,piVar5);
                piVar5 = (int *)piVar11[2];
              }
              *(char *)(piVar5 + 0x10) = (char)piVar11[0x10];
              *(undefined1 *)(piVar11 + 0x10) = 1;
              *(undefined1 *)(piVar5[2] + 0x40) = 1;
              Vector_Distance(local_18,(int)piVar11);
              piVar7 = extraout_ECX;
              uVar9 = extraout_EDX_00;
              break;
            }
LAB_0049c68c:
            *(undefined1 *)(piVar5 + 0x10) = 0;
          }
        }
        else {
          if ((char)piVar5[0x10] == '\0') {
            *(undefined1 *)(piVar5 + 0x10) = 1;
            *(undefined1 *)(piVar11 + 0x10) = 0;
            Vector_Add(local_18,piVar11);
            piVar5 = (int *)*piVar11;
            uVar8 = extraout_var_00;
          }
          piVar7 = (int *)CONCAT31(uVar8,*(char *)((int)piVar5 + 0x41));
          if (*(char *)((int)piVar5 + 0x41) == '\0') {
            if ((*(char *)(piVar5[2] + 0x40) == '\x01') &&
               (piVar7 = (int *)*piVar5, (char)piVar7[0x10] == '\x01')) goto LAB_0049c68c;
            if (*(char *)(*piVar5 + 0x40) == '\x01') {
              *(undefined1 *)(piVar5[2] + 0x40) = 1;
              *(undefined1 *)(piVar5 + 0x10) = 0;
              Vector_Distance(local_18,(int)piVar5);
              piVar5 = (int *)*piVar11;
            }
            *(char *)(piVar5 + 0x10) = (char)piVar11[0x10];
            *(undefined1 *)(piVar11 + 0x10) = 1;
            *(undefined1 *)(*piVar5 + 0x40) = 1;
            Vector_Add(local_18,piVar11);
            piVar7 = extraout_ECX_00;
            uVar9 = extraout_EDX_01;
            break;
          }
        }
        uVar9 = *(uint *)((int)local_18 + 4);
        bVar12 = piVar11 != *(int **)(uVar9 + 4);
        piVar10 = piVar11;
        piVar11 = (int *)piVar11[1];
      } while (bVar12);
    }
    *(undefined1 *)(piVar10 + 0x10) = 1;
  }
                    /* WARNING: Subroutine does not return */
  System_ShutdownHandler((int)piVar7,uVar9);
}


