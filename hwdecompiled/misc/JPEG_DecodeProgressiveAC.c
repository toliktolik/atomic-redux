/*
 * Function: JPEG_DecodeProgressiveAC
 * Address: 004df0a0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


uint __cdecl JPEG_DecodeProgressiveAC(int *param_1,int *param_2)

{
  short *psVar1;
  short sVar2;
  uint uVar3;
  undefined4 uVar4;
  int iVar5;
  uint uVar6;
  int iVar7;
  int aiStack_144 [64];
  int local_44;
  uint local_40;
  uint local_3c;
  uint local_38;
  undefined4 local_34;
  undefined4 local_30;
  uint local_2c;
  int local_28;
  int *local_24;
  int local_20;
  int local_1c;
  int local_18;
  int local_14;
  uint local_10;
  int local_c;
  int local_8;
  
  local_18 = param_1[0x5c];
  local_14 = param_1[0x66];
  local_38 = 1 << ((byte)param_1[0x5e] & 0x1f);
  local_3c = -1 << ((byte)param_1[0x5e] & 0x1f);
  if (((param_1[0x3f] != 0) && (*(int *)(local_14 + 0x28) == 0)) &&
     (uVar3 = JPEG_ProcessNewScanlineSequential(), (char)uVar3 == '\0')) {
    return uVar3;
  }
  if (*(char *)(local_14 + 8) == '\0') {
    local_24 = param_1;
    local_34 = *(undefined4 *)param_1[6];
    local_30 = ((undefined4 *)param_1[6])[1];
    local_1c = *param_2;
    local_c = *(int *)(local_14 + 0x14);
    uVar3 = *(uint *)(local_14 + 0xc);
    iVar7 = *(int *)(local_14 + 0x10);
    local_44 = *(int *)(local_14 + 0x3c);
    local_8 = param_1[0x5b];
    local_40 = 0;
    if (local_c == 0) {
      if (local_8 <= local_18) {
        do {
          if (iVar7 < 8) {
            uVar4 = Compression_FillBitBuffer(&local_34,uVar3,iVar7,0);
            if ((char)uVar4 == '\0') goto joined_r0x004df42a;
            uVar3 = local_2c;
            iVar7 = local_28;
            if (7 < local_28) goto LAB_004df187;
            iVar5 = 1;
LAB_004df1b5:
            local_10 = Compression_DecodeHuffmanSymbol(&local_34,uVar3,iVar7,local_44,iVar5);
            uVar3 = local_2c;
            iVar7 = local_28;
            if ((int)local_10 < 0) goto joined_r0x004df42a;
          }
          else {
LAB_004df187:
            uVar6 = (int)uVar3 >> ((char)iVar7 - 8U & 0x1f) & 0xff;
            iVar5 = *(int *)(local_44 + 0x90 + uVar6 * 4);
            if (iVar5 == 0) {
              iVar5 = 9;
              goto LAB_004df1b5;
            }
            local_10 = (uint)*(byte *)(uVar6 + 0x490 + local_44);
            iVar7 = iVar7 - iVar5;
          }
          iVar5 = (int)local_10 >> 4;
          local_10 = local_10 & 0xf;
          local_20 = iVar5;
          if (local_10 == 0) {
            if (iVar5 != 0xf) {
              local_20 = 1 << ((byte)iVar5 & 0x1f);
              local_c = local_20;
              if (iVar5 == 0) goto LAB_004df35e;
              if ((iVar7 < iVar5) &&
                 (uVar4 = Compression_FillBitBuffer(&local_34,uVar3,iVar7,iVar5), uVar3 = local_2c,
                 iVar7 = local_28, (char)uVar4 == '\0')) goto joined_r0x004df42a;
              iVar7 = iVar7 - iVar5;
              local_c = local_c + ((int)uVar3 >> ((byte)iVar7 & 0x1f) & local_20 - 1U);
              goto LAB_004df35e;
            }
            local_10 = 0;
          }
          else {
            if (local_10 != 1) {
              *(undefined4 *)(*param_1 + 0x14) = 0x76;
              (**(code **)(*param_1 + 4))(param_1,0xffffffff);
            }
            if ((iVar7 < 1) &&
               (uVar4 = Compression_FillBitBuffer(&local_34,uVar3,iVar7,1), uVar3 = local_2c,
               iVar7 = local_28, (char)uVar4 == '\0')) goto joined_r0x004df42a;
            iVar7 = iVar7 + -1;
            if (((int)uVar3 >> ((byte)iVar7 & 0x1f) & 1U) == 0) {
              local_10 = local_3c;
            }
            else {
              local_10 = local_38;
            }
          }
          do {
            psVar1 = (short *)(local_1c + (&DAT_00542c30)[local_8] * 2);
            if (*(short *)(local_1c + (&DAT_00542c30)[local_8] * 2) == 0) {
              local_20 = local_20 + -1;
              if (local_20 < 0) break;
            }
            else {
              if ((iVar7 < 1) &&
                 (uVar4 = Compression_FillBitBuffer(&local_34,uVar3,iVar7,1), uVar3 = local_2c,
                 iVar7 = local_28, (char)uVar4 == '\0')) goto joined_r0x004df42a;
              iVar7 = iVar7 + -1;
              if ((((int)uVar3 >> ((byte)iVar7 & 0x1f) & 1U) != 0) &&
                 (sVar2 = *psVar1, (local_38 & (int)sVar2) == 0)) {
                if (sVar2 < 0) {
                  *psVar1 = sVar2 + (short)local_3c;
                }
                else {
                  *psVar1 = sVar2 + (short)local_38;
                }
              }
            }
            local_8 = local_8 + 1;
          } while (local_8 <= local_18);
          if (local_10 != 0) {
            iVar5 = (&DAT_00542c30)[local_8];
            *(short *)(local_1c + iVar5 * 2) = (short)local_10;
            aiStack_144[local_40] = iVar5;
            local_40 = local_40 + 1;
          }
          local_8 = local_8 + 1;
        } while (local_8 <= local_18);
      }
    }
    else {
LAB_004df35e:
      if (local_c != 0) {
        iVar5 = local_14;
        if (local_8 <= local_18) {
          do {
            psVar1 = (short *)(local_1c + (&DAT_00542c30)[local_8] * 2);
            if (*(short *)(local_1c + (&DAT_00542c30)[local_8] * 2) != 0) {
              if ((iVar7 < 1) &&
                 (uVar4 = Compression_FillBitBuffer(&local_34,uVar3,iVar7,1), iVar5 = local_14,
                 uVar3 = local_2c, iVar7 = local_28, (char)uVar4 == '\0')) {
joined_r0x004df42a:
                for (; 0 < (int)local_40; local_40 = local_40 - 1) {
                  *(undefined2 *)(local_1c + aiStack_144[local_40 - 1] * 2) = 0;
                }
                return local_40 & 0xffffff00;
              }
              iVar7 = iVar7 + -1;
              if ((((int)uVar3 >> ((byte)iVar7 & 0x1f) & 1U) != 0) &&
                 ((local_38 & (int)*psVar1) == 0)) {
                uVar6 = local_38;
                if (*psVar1 < 0) {
                  uVar6 = local_3c;
                }
                *psVar1 = *psVar1 + (short)uVar6;
              }
            }
            local_8 = local_8 + 1;
          } while (local_8 <= local_18);
        }
        local_14 = iVar5;
        local_c = local_c + -1;
      }
    }
    *(undefined4 *)param_1[6] = local_34;
    *(undefined4 *)(param_1[6] + 4) = local_30;
    *(uint *)(local_14 + 0xc) = uVar3;
    *(int *)(local_14 + 0x10) = iVar7;
    *(int *)(local_14 + 0x14) = local_c;
  }
  iVar7 = *(int *)(local_14 + 0x28) + -1;
  *(int *)(local_14 + 0x28) = iVar7;
  return CONCAT31((int3)((uint)iVar7 >> 8),1);
}


