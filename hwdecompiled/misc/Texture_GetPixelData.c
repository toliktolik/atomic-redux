/*
 * Function: Texture_GetPixelData
 * Address: 004b8fd0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall Texture_GetPixelData(undefined4 param_1,undefined2 param_2)

{
  int iVar1;
  undefined4 *puVar2;
  uint *puVar3;
  int extraout_ECX;
  byte *pbVar4;
  int extraout_EDX;
  uint uVar5;
  int extraout_EDX_00;
  undefined4 *unaff_EBX;
  undefined4 *unaff_ESI;
  undefined8 uVar6;
  uint unaff_retaddr;
  code *local_288 [33];
  undefined4 local_204 [16];
  int local_1c4;
  int local_1c0;
  uint local_168;
  uint local_164;
  int local_15c;
  uint local_14c;
  undefined4 *local_14;
  uint *local_10;
  int local_c;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  local_c = String_AllocateBuffer(param_1,param_2);
  if (local_c != 0) {
    uVar6 = PNG_InitializeStructures(local_288);
    local_1c4 = (int)uVar6;
    local_288[0] = Texture_IsPowerOfTwo;
    iVar1 = Assembly_LoopingConstruct(local_204,(int)((ulonglong)uVar6 >> 0x20));
    if (iVar1 == 0) {
      PNG_InitializeReadTransform(&local_1c4,0x3e,0x1b0);
      PNG_SetWriteStatus((int)&local_1c4,local_c);
      PNG_CreateWriteStruct(&local_1c4,'\x01');
      PNG_WriteEnd(&local_1c4);
      puVar2 = (undefined4 *)(**(code **)(local_1c0 + 8))(&local_1c4,1,local_15c * local_168,1);
      local_14 = puVar2;
      puVar3 = (uint *)operator_new(local_164 * local_168 * 4);
      local_10 = puVar3;
      if (local_14c < local_164) {
        do {
          PNG_WriteImageData(&local_1c4,puVar2,1);
          pbVar4 = (byte *)*puVar2;
          uVar5 = 0;
          if (local_168 != 0) {
            do {
              *puVar3 = ((*pbVar4 | 0xffffff00) << 8 | (uint)pbVar4[1]) << 8 | (uint)pbVar4[2];
              pbVar4 = pbVar4 + 3;
              puVar3 = puVar3 + 1;
              uVar5 = uVar5 + 1;
              puVar2 = local_14;
            } while (uVar5 < local_168);
          }
        } while (local_14c < local_164);
      }
      puVar3 = local_10;
      puVar2 = (undefined4 *)operator_new(0x10);
      if (puVar2 == (undefined4 *)0x0) {
        iVar1 = 0;
      }
      else {
        iVar1 = Texture_GetFormat(puVar2);
      }
      *(uint *)(iVar1 + 4) = local_168;
      *(uint *)(iVar1 + 8) = local_164;
      *(uint **)(iVar1 + 0xc) = puVar3;
      PNG_WriteInit(&local_1c4);
      PixelFormat_BlendPixels((int)&local_1c4);
      Memory_AllocateBlock(local_c,extraout_EDX_00);
      Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),unaff_ESI,unaff_EBX);
      return;
    }
    PixelFormat_BlendPixels((int)&local_1c4);
    Memory_AllocateBlock(extraout_ECX,extraout_EDX);
  }
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),unaff_ESI,unaff_EBX);
  return;
}


