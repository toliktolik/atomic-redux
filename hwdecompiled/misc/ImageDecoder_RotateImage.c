/*
 * Function: ImageDecoder_RotateImage
 * Address: 004ce040
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl ImageDecoder_RotateImage(uint param_1)

{
  byte bVar1;
  uint uVar2;
  uint extraout_ECX;
  uint uVar3;
  byte *extraout_EDX;
  undefined4 *puVar4;
  char *pcVar5;
  
  uVar3 = *(int *)(param_1 + 0xe4) + 1;
  *(uint *)(param_1 + 0xe4) = uVar3;
  if (*(uint *)(param_1 + 0xd0) <= uVar3) {
    if (*(char *)(param_1 + 0x123) != '\0') {
      *(undefined4 *)(param_1 + 0xe4) = 0;
      if ((*(byte *)(param_1 + 0x70) & 2) == 0) {
        do {
          bVar1 = *(char *)(param_1 + 0x124) + 1;
          *(byte *)(param_1 + 0x124) = bVar1;
          if (6 < bVar1) goto LAB_004ce14e;
          *(uint *)(param_1 + 0xd4) =
               (uint)((*(int *)(param_1 + 200) - (&DAT_00567d64)[bVar1]) + -1 +
                     (&DAT_00567d80)[bVar1]) / (uint)(&DAT_00567d80)[bVar1];
          uVar3 = (uint)((*(int *)(param_1 + 0xcc) - (&DAT_00567d9c)[bVar1]) + -1 +
                        (&DAT_00567db8)[bVar1]) / (uint)(&DAT_00567db8)[bVar1];
          *(uint *)(param_1 + 0xd0) = uVar3;
        } while ((*(int *)(param_1 + 0xd4) == 0) || (uVar3 == 0));
      }
      else {
        bVar1 = *(char *)(param_1 + 0x124) + 1;
        *(byte *)(param_1 + 0x124) = bVar1;
      }
      if (bVar1 < 7) {
        if (*(undefined4 **)(param_1 + 0xe8) == (undefined4 *)0x0) {
          return;
        }
        uVar2 = ((uint)*(byte *)(param_1 + 299) * (uint)*(byte *)(param_1 + 0x128) *
                 *(int *)(param_1 + 200) + 7 >> 3) + 1;
        puVar4 = *(undefined4 **)(param_1 + 0xe8);
        for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 = uVar3 - 1) {
          *puVar4 = 0;
          puVar4 = puVar4 + 1;
        }
        for (uVar2 = uVar2 & 3; uVar2 != 0; uVar2 = uVar2 - 1) {
          *(undefined1 *)puVar4 = 0;
          puVar4 = (undefined4 *)((int)puVar4 + 1);
        }
        return;
      }
    }
LAB_004ce14e:
    do {
      while( true ) {
        uVar3 = PNG_WriteIEND((int *)(param_1 + 0x74),4);
        if ((uVar3 != 0) && (uVar3 != 1)) {
          pcVar5 = *(char **)(param_1 + 0x8c);
          if (pcVar5 == (char *)0x0) {
            pcVar5 = "zlib error";
          }
          CPU_Instruction20(extraout_ECX,extraout_EDX,param_1,pcVar5);
        }
        if ((*(int *)(param_1 + 0x84) != 0) || (uVar3 != 0)) break;
        ImageDecoder_ReadScanline(param_1,*(byte **)(param_1 + 0xac),*(uint *)(param_1 + 0xb0));
        *(undefined4 *)(param_1 + 0x80) = *(undefined4 *)(param_1 + 0xac);
        *(undefined4 *)(param_1 + 0x84) = *(undefined4 *)(param_1 + 0xb0);
      }
    } while (uVar3 != 1);
    if (*(uint *)(param_1 + 0x84) < *(uint *)(param_1 + 0xb0)) {
      ImageDecoder_ReadScanline
                (param_1,*(byte **)(param_1 + 0xac),
                 *(uint *)(param_1 + 0xb0) - *(uint *)(param_1 + 0x84));
    }
    PNG_CompressData((int)(param_1 + 0x74));
  }
  return;
}


