/*
 * Function: CPU_Instruction47
 * Address: 004ca550
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CPU_Instruction47(uint param_1,byte *param_2,uint param_3,int param_4,uint param_5)

{
  int iVar1;
  uint extraout_ECX;
  undefined4 extraout_ECX_00;
  undefined4 extraout_ECX_01;
  undefined4 extraout_ECX_02;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  uint unaff_retaddr;
  undefined4 *in_stack_ffffffe8;
  undefined2 uVar2;
  undefined4 *in_stack_ffffffec;
  byte local_10 [2];
  undefined1 local_e;
  undefined1 local_d;
  undefined1 local_c;
  undefined1 local_b;
  undefined1 local_a;
  uint local_8;
  
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  if ((*(byte *)(param_3 + 0x68) & 1) == 0) {
    CPU_Instruction20(param_1,param_2,param_3,"Out of place tIME chunk");
    param_1 = extraout_ECX;
    param_2 = extraout_EDX;
  }
  else if ((param_4 != 0) && ((*(uint *)(param_4 + 8) & 0x200) != 0)) {
    CPU_Instruction21(param_1,param_2,param_3,"Duplicate tIME chunk");
    CPU_Instruction33(extraout_ECX_01,extraout_EDX_01,param_3,param_5);
    Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_ffffffe8,in_stack_ffffffec);
    return;
  }
  if ((*(uint *)(param_3 + 0x68) & 4) != 0) {
    *(uint *)(param_3 + 0x68) = *(uint *)(param_3 + 0x68) | 8;
  }
  if (param_5 == 7) {
    CPU_Instruction26(local_10,param_2,param_3,local_10,7);
    iVar1 = CPU_Instruction33(extraout_ECX_02,extraout_EDX_02,param_3,0);
    if (iVar1 == 0) {
      in_stack_ffffffec =
           (undefined4 *)
           CONCAT13((char)((uint)in_stack_ffffffec >> 0x18),
                    CONCAT12(local_a,CONCAT11(local_b,local_c)));
      uVar2 = CONCAT11(local_d,local_e);
      iVar1 = CPU_Instruction25(local_10);
      in_stack_ffffffe8 = (undefined4 *)CONCAT22(uVar2,(short)iVar1);
      PNG_SetPixelAspectRatio(param_3,param_4,(undefined4 *)&stack0xffffffe8);
    }
  }
  else {
    CPU_Instruction21(param_1,param_2,param_3,"Incorrect tIME chunk length");
    CPU_Instruction33(extraout_ECX_00,extraout_EDX_00,param_3,param_5);
  }
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_ffffffe8,in_stack_ffffffec);
  return;
}


