/*
 * Function: ImageDecoder_AdjustColors
 * Address: 004ce200
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl ImageDecoder_AdjustColors(uint param_1,int param_2)

{
  int iVar1;
  uint uVar2;
  uint extraout_ECX;
  byte *extraout_EDX;
  char *pcVar3;
  
  *(int *)(param_1 + 0x74) = param_2;
  *(int *)(param_1 + 0x78) = *(int *)(param_1 + 0x104) + 1;
  do {
    uVar2 = PNG_WriteIEND((int *)(param_1 + 0x74),0);
    if (uVar2 != 0) {
      pcVar3 = *(char **)(param_1 + 0x8c);
      if (pcVar3 == (char *)0x0) {
        pcVar3 = "zlib error";
      }
      CPU_Instruction20(extraout_ECX,extraout_EDX,param_1,pcVar3);
    }
    if (*(int *)(param_1 + 0x84) == 0) {
      ImageDecoder_ReadScanline(param_1,*(byte **)(param_1 + 0xac),*(uint *)(param_1 + 0xb0));
      *(undefined4 *)(param_1 + 0x80) = *(undefined4 *)(param_1 + 0xac);
      *(undefined4 *)(param_1 + 0x84) = *(undefined4 *)(param_1 + 0xb0);
    }
  } while (*(int *)(param_1 + 0x78) != 0);
  iVar1 = *(int *)(param_1 + 0xe8);
  if (iVar1 != 0) {
    *(undefined4 *)(param_1 + 0xe8) = *(undefined4 *)(param_1 + 0xec);
    *(int *)(param_1 + 0xec) = iVar1;
  }
  ImageDecoder_RotateImage(param_1);
  uVar2 = *(int *)(param_1 + 0x154) + 1;
  *(uint *)(param_1 + 0x154) = uVar2;
  if ((*(uint *)(param_1 + 0x150) != 0) && (*(uint *)(param_1 + 0x150) <= uVar2)) {
    PNG_CompressImageData(param_1);
  }
  return;
}


