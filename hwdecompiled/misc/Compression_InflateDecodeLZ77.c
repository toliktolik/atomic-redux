/*
 * Function: Compression_InflateDecodeLZ77
 * Address: 004eb640
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 __cdecl
Compression_InflateDecodeLZ77
          (uint param_1,int param_2,int param_3,int param_4,int param_5,int *param_6)

{
  byte bVar1;
  byte bVar2;
  uint uVar3;
  uint uVar4;
  int iVar5;
  uint uVar6;
  uint uVar7;
  uint uVar8;
  uint uVar9;
  undefined1 *puVar10;
  int iVar11;
  byte *pbVar12;
  byte *pbVar13;
  byte *local_14;
  undefined1 *local_10;
  undefined1 *local_c;
  uint local_8;
  
  uVar7 = *(uint *)(param_5 + 0x20);
  local_c = *(undefined1 **)(param_5 + 0x34);
  pbVar12 = (byte *)*param_6;
  local_8 = param_6[1];
  uVar4 = *(uint *)(param_5 + 0x1c);
  if (local_c < *(undefined1 **)(param_5 + 0x30)) {
    local_10 = *(undefined1 **)(param_5 + 0x30) + (-1 - (int)local_c);
  }
  else {
    local_10 = (undefined1 *)(*(int *)(param_5 + 0x2c) - (int)local_c);
  }
  uVar6 = *(uint *)(&DAT_005694c0 + param_1 * 4);
  uVar3 = *(uint *)(&DAT_005694c0 + param_2 * 4);
  local_14 = pbVar12;
  do {
    for (; uVar4 < 0x14; uVar4 = uVar4 + 8) {
      local_8 = local_8 - 1;
      uVar7 = uVar7 | (uint)*pbVar12 << ((byte)uVar4 & 0x1f);
      pbVar12 = pbVar12 + 1;
      local_14 = pbVar12;
    }
    bVar1 = *(byte *)(param_3 + (uVar6 & uVar7) * 8);
    uVar9 = (uint)bVar1;
    iVar11 = param_3 + (uVar6 & uVar7) * 8;
    bVar2 = *(byte *)(iVar11 + 1);
    uVar7 = uVar7 >> (bVar2 & 0x1f);
    if (uVar9 == 0) {
LAB_004eb85a:
      uVar4 = uVar4 - bVar2;
      *local_c = *(undefined1 *)(iVar11 + 4);
      local_c = local_c + 1;
      local_10 = local_10 + -1;
    }
    else {
      uVar4 = uVar4 - *(byte *)(iVar11 + 1);
      while ((bVar1 & 0x10) == 0) {
        if ((uVar9 & 0x40) != 0) {
          if ((uVar9 & 0x20) != 0) {
            uVar6 = param_6[1] - local_8;
            if (uVar4 >> 3 < param_6[1] - local_8) {
              uVar6 = uVar4 >> 3;
            }
            *(uint *)(param_5 + 0x20) = uVar7;
            *(uint *)(param_5 + 0x1c) = uVar4 + uVar6 * -8;
            iVar11 = *param_6;
            param_6[1] = uVar6 + local_8;
            *param_6 = (int)pbVar12 - uVar6;
            param_6[2] = param_6[2] + (((int)pbVar12 - uVar6) - iVar11);
            *(undefined1 **)(param_5 + 0x34) = local_c;
            return 1;
          }
          param_6[6] = (int)"invalid literal/length code";
          goto LAB_004eb93f;
        }
        iVar5 = (*(uint *)(&DAT_005694c0 + uVar9 * 4) & uVar7) + *(int *)(iVar11 + 4);
        bVar1 = *(byte *)(iVar11 + iVar5 * 8);
        uVar9 = (uint)bVar1;
        iVar11 = iVar11 + iVar5 * 8;
        bVar2 = *(byte *)(iVar11 + 1);
        uVar7 = uVar7 >> (bVar2 & 0x1f);
        if (uVar9 == 0) goto LAB_004eb85a;
        uVar4 = uVar4 - *(byte *)(iVar11 + 1);
      }
      uVar9 = uVar9 & 0xf;
      param_1 = (*(uint *)(&DAT_005694c0 + uVar9 * 4) & uVar7) + *(int *)(iVar11 + 4);
      uVar8 = uVar7 >> (sbyte)uVar9;
      for (uVar4 = uVar4 - uVar9; uVar4 < 0xf; uVar4 = uVar4 + 8) {
        local_8 = local_8 - 1;
        uVar8 = uVar8 | (uint)*pbVar12 << ((byte)uVar4 & 0x1f);
        pbVar12 = pbVar12 + 1;
        local_14 = pbVar12;
      }
      iVar11 = param_4 + (uVar3 & uVar8) * 8;
      uVar7 = uVar8 >> (*(byte *)(iVar11 + 1) & 0x1f);
      uVar4 = uVar4 - *(byte *)(iVar11 + 1);
      bVar1 = *(byte *)(param_4 + (uVar3 & uVar8) * 8);
      while ((bVar1 & 0x10) == 0) {
        if ((bVar1 & 0x40) != 0) {
          param_6[6] = (int)"invalid distance code";
LAB_004eb93f:
          uVar6 = param_6[1] - local_8;
          if (uVar4 >> 3 < param_6[1] - local_8) {
            uVar6 = uVar4 >> 3;
          }
          *(uint *)(param_5 + 0x20) = uVar7;
          *(uint *)(param_5 + 0x1c) = uVar4 + uVar6 * -8;
          iVar11 = *param_6;
          param_6[1] = uVar6 + local_8;
          *param_6 = (int)pbVar12 - uVar6;
          param_6[2] = param_6[2] + (((int)pbVar12 - uVar6) - iVar11);
          *(undefined1 **)(param_5 + 0x34) = local_c;
          return 0xfffffffd;
        }
        iVar5 = (*(uint *)(&DAT_005694c0 + (uint)bVar1 * 4) & uVar7) + *(int *)(iVar11 + 4);
        pbVar13 = (byte *)(iVar11 + iVar5 * 8);
        iVar11 = iVar11 + iVar5 * 8;
        uVar7 = uVar7 >> (*(byte *)(iVar11 + 1) & 0x1f);
        uVar4 = uVar4 - *(byte *)(iVar11 + 1);
        bVar1 = *pbVar13;
      }
      uVar9 = bVar1 & 0xf;
      pbVar13 = pbVar12;
      pbVar12 = local_14;
      for (; uVar4 < uVar9; uVar4 = uVar4 + 8) {
        local_8 = local_8 - 1;
        uVar7 = uVar7 | (uint)*pbVar13 << ((byte)uVar4 & 0x1f);
        pbVar13 = pbVar12 + 1;
        pbVar12 = pbVar13;
      }
      uVar8 = (*(uint *)(&DAT_005694c0 + uVar9 * 4) & uVar7) + *(int *)(iVar11 + 4);
      uVar7 = uVar7 >> (sbyte)uVar9;
      local_10 = local_10 + -param_1;
      uVar4 = uVar4 - uVar9;
      if ((uint)((int)local_c - *(int *)(param_5 + 0x28)) < uVar8) {
        uVar8 = (*(int *)(param_5 + 0x28) - (int)local_c) + uVar8;
        puVar10 = (undefined1 *)(*(int *)(param_5 + 0x2c) - uVar8);
        if (uVar8 < param_1) {
          param_1 = param_1 - uVar8;
          do {
            *local_c = *puVar10;
            local_c = local_c + 1;
            puVar10 = puVar10 + 1;
            uVar8 = uVar8 - 1;
          } while (uVar8 != 0);
          puVar10 = *(undefined1 **)(param_5 + 0x28);
        }
      }
      else {
        puVar10 = local_c + -uVar8;
        *local_c = *puVar10;
        local_c[1] = puVar10[1];
        local_c = local_c + 2;
        puVar10 = puVar10 + 2;
        param_1 = param_1 - 2;
      }
      do {
        *local_c = *puVar10;
        local_c = local_c + 1;
        puVar10 = puVar10 + 1;
        param_1 = param_1 - 1;
        local_14 = pbVar12;
      } while (param_1 != 0);
    }
    if ((local_10 < (undefined1 *)0x102) || (local_8 < 10)) {
      uVar6 = param_6[1] - local_8;
      if (uVar4 >> 3 < param_6[1] - local_8) {
        uVar6 = uVar4 >> 3;
      }
      *(uint *)(param_5 + 0x20) = uVar7;
      *(uint *)(param_5 + 0x1c) = uVar4 + uVar6 * -8;
      iVar11 = *param_6;
      param_6[1] = uVar6 + local_8;
      *param_6 = (int)pbVar12 - uVar6;
      param_6[2] = param_6[2] + (((int)pbVar12 - uVar6) - iVar11);
      *(undefined1 **)(param_5 + 0x34) = local_c;
      return 0;
    }
  } while( true );
}


