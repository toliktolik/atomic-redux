/*
 * Function: Unwind@005157b6
 * Address: 005157b6
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x005157d8) overlaps instruction at (ram,0x005157d4)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Stack frame is not setup normally: Input value of stackpointer is not used */
/* WARNING: This function may have set the stack pointer */
/* WARNING: Type propagation algorithm not settling */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

uint Unwind_005157b6(void)

{
  char *pcVar1;
  uint *puVar2;
  undefined2 *puVar3;
  code *pcVar4;
  ushort uVar5;
  int iVar6;
  uint uVar7;
  uint uVar8;
  uint uVar9;
  undefined4 uVar10;
  char *extraout_ECX;
  char *pcVar11;
  int extraout_ECX_00;
  int *extraout_ECX_01;
  byte extraout_DH;
  int extraout_EDX;
  char cVar13;
  byte *pbVar12;
  int extraout_EDX_00;
  byte bVar14;
  int *unaff_EBX;
  undefined1 *puVar15;
  undefined2 *puVar16;
  undefined1 *puVar17;
  undefined1 *puVar18;
  undefined1 *puVar19;
  undefined4 *puVar20;
  undefined2 *puVar21;
  undefined2 *puVar22;
  undefined2 *puVar23;
  uint unaff_EBP;
  uint uVar24;
  byte *unaff_ESI;
  byte *unaff_EDI;
  byte *pbVar25;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 uVar26;
  undefined2 in_SS;
  undefined2 in_DS;
  byte bVar27;
  bool bVar28;
  byte bVar29;
  bool bVar30;
  byte in_AF;
  byte in_TF;
  byte in_IF;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  float10 extraout_ST0;
  undefined8 uVar31;
  
  do {
    pbVar12 = unaff_ESI + 4;
    bVar14 = (byte)unaff_EBX;
    unaff_EBX = (int *)CONCAT22((short)((uint)unaff_EBX >> 0x10),CONCAT11(0xef,bVar14));
    puVar15 = &DAT_9f506f78;
    _DAT_9f506f78 = 0x5157d4;
    iVar6 = func_0x21650230();
    *(int *)(iVar6 + -0x24e36d34) = (int)ROUND(extraout_ST0);
    pcVar4 = (code *)swi(0x56);
    (*pcVar4)();
    bVar27 = CARRY1((byte)((uint)extraout_EDX >> 8),*(byte *)(extraout_EDX + 0x37f57a17));
    *(undefined2 *)(puVar15 + -4) = in_CS;
    in_CS = 0xd7d9;
    puVar16 = (undefined2 *)(puVar15 + -8);
    *(undefined4 *)(puVar15 + -8) = 0x5157ea;
    uVar7 = func_0x6b7cd101();
    bVar29 = extraout_DH - unaff_ESI[(int)extraout_ECX * 2 + -0x5963aad];
    bVar28 = extraout_DH < unaff_ESI[(int)extraout_ECX * 2 + -0x5963aad] || bVar29 < bVar27;
    cVar13 = bVar29 - bVar27;
    uVar9 = CONCAT22((short)(uVar7 >> 0x10),
                     CONCAT11((cVar13 < '\0') << 7 | (cVar13 == '\0') << 6 | in_AF << 4 |
                              ((POPCOUNT(cVar13) & 1U) == 0) << 2 | 2 | bVar28,(char)uVar7));
    pcVar11 = extraout_ECX;
    if (bVar28 || cVar13 == '\0') {
      bVar28 = false;
      *unaff_EDI = *unaff_EDI ^ bVar14;
      bVar30 = (POPCOUNT(*unaff_EDI) & 1U) == 0;
      uVar24 = unaff_EBP;
      unaff_ESI = pbVar12;
      goto code_r0x00515810;
    }
    pbVar25 = unaff_EDI + 1;
    uVar8 = uVar9 | 0xbd39c940;
    *extraout_ECX = *extraout_ECX + -0xe;
    unaff_EDI = unaff_EDI + 2;
    unaff_ESI = unaff_ESI + 5;
    bVar29 = *pbVar12;
    bVar28 = bVar29 < *pbVar25;
    bVar29 = POPCOUNT(bVar29 - *pbVar25);
    while( true ) {
      bVar30 = (bVar29 & 1) == 0;
      if (!bVar30) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      uVar9 = 0x42ba7ced;
      pcVar11 = (char *)CONCAT31((int3)((uint)pcVar11 >> 8),0x30);
      in_DS = *puVar16;
      puVar16 = puVar16 + 2;
      uVar24 = unaff_EBP;
      uVar7 = uVar8;
code_r0x00515810:
      pbVar12 = (byte *)((int)uVar7 >> 0x1f);
      *(char **)((int)puVar16 + -4) = pcVar11;
      unaff_EBP = uVar9;
      puVar18 = (undefined1 *)((int)puVar16 + -4);
      if (bVar30) goto LAB_0051586a;
      pcVar1 = (char *)segment(in_ES,(short)unaff_EBX + (short)unaff_ESI + 0x2b84);
      *pcVar1 = *pcVar1 + -1;
      if (bVar28) break;
      bVar29 = (byte)((uint)unaff_EBX >> 8);
      bVar28 = bVar29 < *pbVar12;
      unaff_EBX = (int *)CONCAT22((short)((uint)unaff_EBX >> 0x10),
                                  CONCAT11(bVar29 - *pbVar12,(char)unaff_EBX));
      puVar17 = (undefined1 *)((int)puVar16 + -8);
      *(undefined2 *)((int)puVar16 + -8) = in_SS;
      while( true ) {
        pcVar11 = (char *)CONCAT22((short)((uint)pcVar11 >> 0x10),CONCAT11(0x4f,(char)pcVar11));
        unaff_EBP = uVar9;
        puVar18 = puVar17;
LAB_0051586a:
        puVar16 = (undefined2 *)(puVar18 + -4);
        puVar17 = puVar18 + -4;
        *(undefined2 *)(puVar18 + -4) = in_CS;
        uVar8 = uVar24 + *unaff_EBX + (uint)bVar28;
        bVar29 = POPCOUNT(uVar8 & 0xff);
        bVar28 = false;
        if (uVar8 != 0) break;
        pcVar11 = pcVar11 + -1;
        if (pcVar11 == (char *)0x0) {
          puVar19 = puVar18 + -5;
          *(int *)unaff_ESI = -*(int *)unaff_ESI;
          bVar29 = 1;
          uVar9 = 0;
          while( true ) {
            out(0x79,(char)uVar9);
            *(undefined2 *)(puVar19 + -4) = in_CS;
            in_CS = 0x5648;
            puVar20 = (undefined4 *)(puVar19 + -8);
            puVar19 = puVar19 + -8;
            *puVar20 = 0x515889;
            uVar31 = func_0xa7c9ff82();
            iVar6 = (int)((ulonglong)uVar31 >> 0x20) + _DAT_ee3d47ce + (uint)bVar29;
            bVar29 = in((short)iVar6);
            *unaff_EDI = bVar29;
            if (iVar6 != 0) {
              *(uint *)(unaff_ESI + iVar6 * 2 + -0x238d6f3c) =
                   *(uint *)(unaff_ESI + iVar6 * 2 + -0x238d6f3c) | 0x9a5f7c93;
              *(undefined2 *)(puVar19 + -4) = in_CS;
              return (uint)uVar31;
            }
            uVar9 = (uint)uVar31 ^ 0xe1;
            bVar14 = (byte)(extraout_ECX_00 + -1);
            if (extraout_ECX_00 + -1 == 0 || (byte)uVar31 != 0xe1) break;
            bVar29 = 0;
            unaff_ESI[-0xbc33421] = unaff_ESI[-0xbc33421] & bVar14;
            unaff_EDI = unaff_EDI + 1;
          }
          uVar5 = (ushort)(byte)(((byte)uVar31 ^ 0xe1) +
                                ((byte)((ulonglong)uVar31 >> 8) & bVar14) * -0x4f);
          *(uint *)(puVar19 + -4) =
               (uint)(in_NT & 1) * 0x4000 | (uint)(in_IF & 1) * 0x200 | (uint)(in_TF & 1) * 0x100 |
               (uint)(uVar5 == 0) * 0x40 | (uint)(in_AF & 1) * 0x10 |
               (uint)((POPCOUNT(uVar5) & 1U) == 0) * 4 | (uint)(in_ID & 1) * 0x200000 |
               (uint)(in_VIP & 1) * 0x100000 | (uint)(in_VIF & 1) * 0x80000 |
               (uint)(in_AC & 1) * 0x40000;
          puVar21 = (undefined2 *)(puVar19 + -8);
          *(undefined4 *)(puVar19 + -8) = 0x5158a3;
          func_0xa5f05071();
          *(undefined1 *)((int)extraout_ECX_01 + extraout_EDX_00 * 8 + 0x72) = 0;
          *(byte *)((unaff_EBP - 0x3b) - *extraout_ECX_01) = *unaff_ESI;
          *puVar21 = in_CS;
          uVar26 = 0x568c;
          puVar22 = puVar21 + -2;
          *(undefined4 *)(puVar21 + -2) = 0x5158b8;
          func_0x810cd19f();
          *puVar22 = uVar26;
          puVar23 = puVar22 + -2;
          *(undefined **)(puVar22 + -2) = &UNK_005158c6;
          func_0x557dc30e();
          uRam4d929dce = (undefined1)unaff_EBP;
          *(undefined4 *)((int)puVar23 + -4) = 0x5158d3;
          uVar10 = func_0x74e9d57c();
          return CONCAT22((short)((uint)uVar10 >> 0x10),
                          (ushort)(byte)uVar10 * (ushort)unaff_ESI[0x22]);
        }
        bVar28 = (byte)((int)uVar7 >> 0x1f) < *unaff_ESI;
        uVar9 = 0;
        uVar24 = unaff_EBP;
      }
    }
    bVar28 = CARRY4((uint)_DAT_4bb6b38e,(uint)pbVar12);
    _DAT_4bb6b38e = _DAT_4bb6b38e + (int)pbVar12;
    bVar30 = _DAT_4bb6b38e == (byte *)0x0;
    puVar3 = (undefined2 *)segment(in_SS,(short)(undefined1 *)((int)puVar16 + -4));
    in_SS = *puVar3;
    *(uint *)(CONCAT22((short)((uint)((int)puVar16 + -4) >> 0x10),
                       (short)(undefined1 *)((int)puVar16 + -4) + 2) + -4) = uVar24;
    unaff_EBP = uVar24;
    if (bVar28 || bVar30) {
      puVar2 = (uint *)segment(in_DS,(short)unaff_ESI);
      return *puVar2;
    }
  } while( true );
}


