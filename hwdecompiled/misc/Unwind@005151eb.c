/*
 * Function: Unwind@005151eb
 * Address: 005151eb
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x005151f5) overlaps instruction at (ram,0x005151f4)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Unable to track spacebase fully for stack */

uint __fastcall Unwind_005151eb(int param_1,int param_2)

{
  uint *puVar1;
  char cVar2;
  uint *puVar3;
  uint *puVar4;
  bool bVar5;
  byte bVar6;
  code *pcVar7;
  char *pcVar8;
  undefined1 uVar9;
  byte bVar10;
  byte bVar11;
  ushort uVar12;
  int in_EAX;
  uint uVar13;
  uint uVar15;
  undefined3 uVar16;
  int iVar17;
  short sVar19;
  int iVar20;
  int unaff_EBX;
  undefined1 *puVar21;
  int unaff_EBP;
  int *piVar22;
  undefined1 *unaff_ESI;
  char *pcVar23;
  char *unaff_EDI;
  char *pcVar24;
  byte in_AF;
  bool in_ZF;
  byte in_SF;
  byte in_OF;
  unkbyte10 in_ST6;
  undefined2 uStack_4;
  char *pcVar14;
  undefined2 uVar18;
  
  if (!in_ZF && in_OF == in_SF) {
    do {
      in_EAX = CONCAT31((int3)((uint)in_EAX >> 8),*unaff_ESI);
      LOCK();
      pcVar23 = *(char **)(in_EAX + 0x3437e0af);
      *(char **)(in_EAX + 0x3437e0af) = unaff_EDI;
      UNLOCK();
      piVar22 = (int *)(param_2 + 0x6f);
      *piVar22 = *piVar22 << 0x12;
      in_OF = in_OF & 1;
      unaff_ESI = unaff_ESI + 1;
      unaff_EDI = pcVar23;
    } while ((bool)in_OF == *piVar22 < 0);
    pcVar7 = (code *)swi(1);
    uVar13 = (*pcVar7)();
    return uVar13;
  }
  *(byte *)(unaff_EBX + -0x14) = *(byte *)(unaff_EBX + -0x14) ^ (byte)((uint)param_2 >> 8);
  uVar13 = param_1 + 1;
  uStack_4 = (undefined2)unaff_EBX;
  pcVar23 = (char *)0x1dbd04e3;
  uVar9 = in(0x99);
  pcVar14 = (char *)CONCAT31((int3)((uint)in_EAX >> 8),uVar9);
  while( true ) {
    piVar22 = (int *)(uVar13 + 0x36);
    *piVar22 = *piVar22 - unaff_EBP;
    iVar17 = *piVar22;
    piVar22 = (int *)(pcVar23 + 0x53);
    bVar11 = (byte)uVar13;
    *piVar22 = *piVar22 >> (bVar11 & 0x1f);
    bVar5 = (uVar13 & 0x1f) != 0;
    if (!bVar5 && iVar17 == 0 || bVar5 && *piVar22 == 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    bVar6 = 9 < ((byte)pcVar14 & 0xf) | in_AF;
    cVar2 = (char)((uint)pcVar14 >> 8);
    puVar4 = (uint *)(unaff_EDI + 4);
    puVar3 = (uint *)(pcVar23 + 5);
    piVar22 = (int *)(unaff_EBP - 1U ^ *puVar3);
    uVar15 = CONCAT31(CONCAT21(cVar2 >> 7,cVar2 + bVar6),*pcVar23) ^ 0xb3e2a5d9;
    *(int *)(uVar15 + 0xc50b6b97) = *(int *)(uVar15 + 0xc50b6b97) + uVar13;
    *(byte *)puVar4 = (byte)*puVar4 & (byte)((uint)unaff_EBX >> 8);
    uVar16 = (undefined3)(uVar15 >> 8);
    bVar10 = in(0x1e);
    puVar1 = (uint *)(CONCAT31(uVar16,bVar10) + -0x25c9712b);
    *puVar1 = *puVar1 >> 1;
    uVar18 = (undefined2)(uVar13 >> 0x10);
    iVar17 = CONCAT22(uVar18,CONCAT11(0xbc,bVar11));
    iVar20 = (CONCAT31((int3)((uint)param_2 >> 8),(char)param_2 + -0x6f) -
             *(int *)((int)piVar22 + 10)) + -1;
    sVar19 = (short)iVar20;
    out(0x3c,bVar10);
    unaff_EBX = unaff_EBX + -1 + CONCAT31(uVar16,bVar10);
    ffree(in_ST6);
    puRam27a589d1 = puVar4;
    if (iVar17 == 0) break;
    unaff_EBP = *piVar22;
    *(undefined2 *)piVar22 = uStack_4;
    param_2 = CONCAT31((int3)((uint)iVar20 >> 8),*(undefined1 *)(unaff_EBX + 0x2bd0eaeb));
    *puVar4 = *puVar3;
    pcVar14 = pcVar23 + 9;
    pcVar8 = unaff_EDI + 8;
    do {
      pcVar24 = pcVar8;
      pcVar23 = pcVar14 + 1;
      cVar2 = *pcVar14;
      pcVar14 = pcVar23;
      pcVar8 = pcVar24 + 1;
    } while (*pcVar24 <= cVar2);
    if (SBORROW1(cVar2,*pcVar24)) {
      puVar21 = (undefined1 *)0x422f6737;
      sVar19 = (short)param_2 + -1;
      uVar12 = (ushort)CONCAT31(uVar16,bVar10) ^ 0x14;
      if (iVar17 != 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      goto LAB_005152d5;
    }
    in_AF = 9 < (bVar10 & 0xf) | bVar6;
    bVar10 = bVar10 + in_AF * '\x06';
    uVar13 = CONCAT22(uVar18,CONCAT11((char)((uint)unaff_EBX >> 8),bVar11)) | 0xbc00;
    pcVar14 = (char *)CONCAT22((short)(uVar15 >> 0x10),
                               (ushort)(byte)(bVar10 + (0x90 < (bVar10 & 0xf0) |
                                                       in_AF * (0xf9 < bVar10)) * '`' +
                                             (char)(uVar15 >> 8) * '\t'));
    unaff_EDI = pcVar24 + 6;
    if (pcVar14 < *(char **)(pcVar24 + 2) || pcVar14 == *(char **)(pcVar24 + 2)) {
      *pcVar14 = *pcVar14 + '\x01';
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
  }
  uVar13 = CONCAT31(uVar16,bVar10 ^ bRam560d8960);
  out(0xbe,uVar13);
  bVar11 = (bVar10 ^ bRam560d8960) + 0x2a;
  uRam6313a706 = (undefined1)unaff_EBX;
  bVar6 = 9 < (bVar11 & 0xf) | bVar6;
  bVar11 = bVar11 + bVar6 * '\x06';
  uRam27a589cd = 0x34;
  puVar21 = (undefined1 *)0x27a589d1;
  pcVar14 = pcVar23 + 6;
  if ((char)(byte)*puVar4 < (char)*puVar3) {
    if ((char)(byte)*puVar4 <= (char)*puVar3) {
      pcVar23[-0x1d2a9bd9] = pcVar23[-0x1d2a9bd9] ^ (byte)((uint)iVar20 >> 8);
      puVar21 = (undefined1 *)0x27a589f1;
      piVar22 = piRam27a589d9;
    }
    DAT_f90d9182 = SUB41(piVar22,0);
    out(0x6b,DAT_f90d9182);
    DAT_e68987fb = DAT_e68987fb << 1;
    *(undefined4 *)(puVar21 + -4) = 0xffffffdb;
    return (uint)piVar22 & 0xdfbeb05c;
  }
  DAT_c7db89d1 = DAT_c7db89d1 |
                 bVar11 + (0x90 < (bVar11 & 0xf0) | 0x789dc3d5 < uVar13 | bVar6 * (0xf9 < bVar11)) *
                          'a' + 0xb8;
  uVar12 = 0x4ce5;
LAB_005152d5:
  DAT_fe699a47 = (undefined1)uVar12;
  *(undefined2 *)(puVar21 + -4) = uStack_4;
  out(*pcVar14,sVar19);
  *(int *)(puVar21 + -8) = (int)(short)uVar12;
  return (int)(short)uVar12;
}


