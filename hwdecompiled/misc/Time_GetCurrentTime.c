/*
 * Function: Time_GetCurrentTime
 * Address: 004d7640
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 __cdecl Time_GetCurrentTime(int *param_1,int *param_2)

{
  int iVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  uint uVar7;
  int iVar8;
  uint local_c;
  
  iVar4 = param_1[0x4e];
  iVar1 = param_1[0x4c];
  iVar2 = param_1[0x57];
  *(undefined4 *)(iVar2 + 0x10) = *(undefined4 *)param_1[6];
  *(undefined4 *)(iVar2 + 0x14) = *(undefined4 *)(param_1[6] + 4);
  if ((param_1[0x2f] != 0) && (*(int *)(iVar2 + 0x44) == 0)) {
    Directory_ListFiles((char)*(undefined4 *)(iVar2 + 0x48));
  }
  iVar5 = param_1[0x4b];
  iVar3 = *param_2;
  param_2 = (int *)0x0;
  if (iVar5 <= iVar1) {
    do {
      iVar6 = (int)*(short *)(iVar3 + (&DAT_00542c30)[iVar5] * 2);
      if (iVar6 == 0) {
        param_2 = (int *)((int)param_2 + 1);
      }
      else {
        if (iVar6 < 0) {
          uVar7 = -iVar6 >> ((byte)iVar4 & 0x1f);
          local_c = ~uVar7;
        }
        else {
          uVar7 = iVar6 >> ((byte)iVar4 & 0x1f);
          local_c = uVar7;
        }
        if (uVar7 == 0) {
          param_2 = (int *)((int)param_2 + 1);
        }
        else {
          if (*(int *)(iVar2 + 0x38) != 0) {
            File_GetDirectory();
          }
          if (0xf < (int)param_2) {
            iVar6 = ((uint)(param_2 + -4) >> 4) + 1;
            param_2 = param_2 + iVar6 * -4;
            do {
              File_GetExtension(*(int *)(iVar2 + 0x34),0xf0);
              iVar6 = iVar6 + -1;
            } while (iVar6 != 0);
          }
          iVar8 = (int)uVar7 >> 1;
          iVar6 = 1;
          if (iVar8 != 0) {
            do {
              iVar8 = iVar8 >> 1;
              iVar6 = iVar6 + 1;
            } while (iVar8 != 0);
            if (10 < iVar6) {
              *(undefined4 *)(*param_1 + 0x14) = 6;
              (**(code **)*param_1)(param_1);
            }
          }
          File_GetExtension(*(int *)(iVar2 + 0x34),(int)param_2 * 0x10 + iVar6);
          File_CopyFile(local_c,iVar6);
          param_2 = (int *)0x0;
        }
      }
      iVar5 = iVar5 + 1;
    } while (iVar5 <= iVar1);
    if ((0 < (int)param_2) &&
       (iVar4 = *(int *)(iVar2 + 0x38) + 1, *(int *)(iVar2 + 0x38) = iVar4, iVar4 == 0x7fff)) {
      File_GetDirectory();
    }
  }
  *(undefined4 *)param_1[6] = *(undefined4 *)(iVar2 + 0x10);
  iVar4 = param_1[6];
  *(undefined4 *)(iVar4 + 4) = *(undefined4 *)(iVar2 + 0x14);
  if (param_1[0x2f] != 0) {
    iVar4 = *(int *)(iVar2 + 0x44);
    if (iVar4 == 0) {
      *(int *)(iVar2 + 0x44) = param_1[0x2f];
      *(uint *)(iVar2 + 0x48) = *(int *)(iVar2 + 0x48) + 1U & 7;
    }
    *(int *)(iVar2 + 0x44) = *(int *)(iVar2 + 0x44) + -1;
  }
  return CONCAT31((int3)((uint)iVar4 >> 8),1);
}


