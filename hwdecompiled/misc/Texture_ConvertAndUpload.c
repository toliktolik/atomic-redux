/*
 * Function: Texture_ConvertAndUpload
 * Address: 0046b280
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Removing unreachable block (ram,0x0046b5c6) */

undefined4 __fastcall Texture_ConvertAndUpload(int *param_1)

{
  char cVar1;
  ushort uVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  undefined4 extraout_EAX;
  uint extraout_EAX_00;
  byte bVar6;
  byte bVar7;
  int iVar12;
  uint *puVar13;
  uint *puVar14;
  undefined4 *puVar15;
  ushort *puVar16;
  ushort *puVar17;
  int *piVar18;
  LPCRITICAL_SECTION lpCriticalSection;
  uint *puVar19;
  int local_d8 [26];
  int local_70;
  uint local_5c;
  uint local_58;
  LPCRITICAL_SECTION local_54;
  uint local_50;
  undefined4 local_4c;
  undefined4 local_48;
  int local_44;
  int local_40;
  uint local_3c;
  undefined4 local_38;
  ushort *local_34;
  uint *local_2c;
  int local_28;
  ushort *local_24;
  uint local_20;
  ushort *local_1c;
  uint *local_18;
  char local_11;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  byte bVar8;
  byte bVar9;
  byte bVar10;
  byte bVar11;
  
  local_8 = 0xffffffff;
  uStack_c = 0x514628;
  local_10 = ExceptionList;
  if (param_1[0x13] != 0) {
    return CONCAT31((int3)((uint)param_1[0x13] >> 8),1);
  }
  ExceptionList = &local_10;
  uVar3 = (**(code **)(*param_1 + 0x50))();
  if (*(char *)((int)param_1 + 0x32) != '\0') {
    ExceptionList = local_10;
    return uVar3 & 0xffffff00;
  }
  *(undefined1 *)((int)param_1 + 0x53) = 1;
  if (param_1[10] != 0) {
    (**(code **)(*param_1 + 100))();
  }
  iVar4 = param_1[2];
  piVar18 = local_d8;
  for (iVar12 = 0x1f; iVar12 != 0; iVar12 = iVar12 + -1) {
    *piVar18 = 0;
    piVar18 = piVar18 + 1;
  }
  local_d8[3] = param_1[1];
  local_d8[0] = 0x7c;
  local_d8[1] = 7;
  lpCriticalSection = (LPCRITICAL_SECTION)(param_1[0x12] + 0x3c);
  local_70 = (-(uint)(*(char *)((int)param_1 + 0x51) != '\0') & 0x3800) + 0x800;
  local_d8[2] = iVar4;
  local_54 = lpCriticalSection;
  EnterCriticalSection(lpCriticalSection);
  local_8 = 0;
  iVar4 = SexyWidget_ApplyRotation((void *)param_1[0x12],local_d8,param_1 + 0x13);
  if ((iVar4 == 0) && (cVar1 = (**(code **)(*param_1 + 0x9c))(), cVar1 != '\0')) {
    iVar4 = param_1[0x12];
    local_40 = 0x18 - *(int *)(iVar4 + 0x14);
    local_28 = 0x10 - *(int *)(iVar4 + 0x18);
    iVar12 = 8 - *(int *)(iVar4 + 0x1c);
    local_4c = *(undefined4 *)(iVar4 + 0x24);
    local_48 = *(undefined4 *)(iVar4 + 0x20);
    local_38 = *(undefined4 *)(iVar4 + 0x28);
    local_3c = param_1[0x2f];
    local_50 = param_1[0x2d];
    puVar16 = (ushort *)param_1[0x2e];
    bVar6 = (byte)local_28;
    local_44 = iVar12;
    local_34 = puVar16;
    if (param_1[0x2c] == 0x10) {
      local_18 = (uint *)param_1[0x20];
      if (local_18 != (uint *)0x0) {
        local_11 = '\x01';
        local_24 = (ushort *)0x0;
        local_20 = 0;
        puVar13 = (uint *)0x0;
        if (param_1[6] != 0) {
          local_24 = (ushort *)operator_new(param_1[1] * param_1[2] * 2);
          puVar16 = (ushort *)(param_1[1] * param_1[2]);
          puVar14 = (uint *)param_1[6];
          local_28 = 0;
          puVar13 = puVar14;
          local_1c = local_24;
          if (0 < (int)puVar16) {
            do {
              uVar3 = *puVar14;
              puVar14 = puVar14 + 1;
              uVar5 = (uVar3 >> ((byte)iVar12 & 0x1f)) << ((byte)local_38 & 0x1f) & local_3c |
                      (uVar3 >> (bVar6 & 0x1f)) << ((byte)local_4c & 0x1f) & (uint)local_34 |
                      (uVar3 >> ((byte)local_40 & 0x1f)) << ((byte)local_48 & 0x1f) & local_50;
              *local_1c = (ushort)uVar5;
              puVar13 = (uint *)CONCAT31((int3)((uint)local_1c >> 8),local_11);
              if ((local_11 != '\0') && (uVar3 >> 0x18 < 0xff)) {
                local_11 = '\0';
                local_20 = uVar5;
              }
              puVar16 = (ushort *)(param_1[1] * param_1[2]);
              local_1c = local_1c + 1;
              local_28 = local_28 + 1;
              iVar12 = local_44;
              local_2c = puVar14;
            } while (local_28 < (int)puVar16);
          }
        }
        puVar14 = local_18;
        if ((*(char *)((int)param_1 + 0x31) == '\0') ||
           (puVar13 = (uint *)param_1[6], puVar13 == (uint *)0x0)) {
          if ((local_24 != (ushort *)0x0) &&
             (iVar4 = 0, puVar13 = puVar14, puVar17 = local_24, 0 < param_1[2])) {
            do {
              iVar12 = 0;
              if (0 < param_1[1]) {
                do {
                  *(ushort *)puVar13 = *puVar17;
                  puVar13 = (uint *)((int)puVar13 + 2);
                  puVar17 = puVar17 + 1;
                  iVar12 = iVar12 + 1;
                } while (iVar12 < param_1[1]);
              }
              puVar16 = (ushort *)param_1[1];
              puVar13 = (uint *)((int)puVar13 + (param_1[0x1b] / 2 - (int)puVar16) * 2);
              iVar4 = iVar4 + 1;
            } while (iVar4 < param_1[2]);
          }
        }
        else {
          iVar4 = 0;
          if (*(char *)((int)param_1 + 0x52) == '\0') {
            puVar16 = local_24;
            if (0 < param_1[1] * param_1[2]) {
              do {
                uVar3 = *puVar13;
                uVar2 = *puVar16;
                puVar13 = puVar13 + 1;
                puVar16 = puVar16 + 1;
                if (((uVar3 & 0xff000000) == 0xff000000) && ((ushort)local_20 == uVar2)) {
                  local_2c = (uint *)operator_new(0x2000);
                  puVar15 = local_2c;
                  for (iVar4 = 0x800; iVar4 != 0; iVar4 = iVar4 + -1) {
                    *puVar15 = 0;
                    puVar15 = puVar15 + 1;
                  }
                  iVar4 = param_1[1] * param_1[2];
                  puVar13 = (uint *)param_1[6];
                  local_28 = 0;
                  puVar16 = local_24;
                  if (0 < iVar4) {
                    do {
                      uVar3 = *puVar13;
                      uVar2 = *puVar16;
                      puVar13 = puVar13 + 1;
                      puVar16 = puVar16 + 1;
                      if (uVar3 >> 0x18 != 0) {
                        local_2c[uVar2 >> 5] = local_2c[uVar2 >> 5] | 1 << ((byte)uVar2 & 0x1f);
                      }
                      iVar4 = param_1[1] * param_1[2];
                      local_28 = local_28 + 1;
                    } while (local_28 < iVar4);
                  }
                  uVar3 = 0;
                  do {
                    if (local_2c[uVar3] != 0xffff) {
                      iVar4 = 0;
                      do {
                        if ((local_2c[uVar3] & 1 << ((byte)iVar4 & 0x1f)) == 0) {
                          local_20 = uVar3 * 0x20 + iVar4;
                          break;
                        }
                        iVar4 = iVar4 + 1;
                      } while (iVar4 < 0x20);
                    }
                    uVar3 = uVar3 + 1;
                    if (0x7ff < (int)uVar3) {
                    /* WARNING: Subroutine does not return */
                      System_ShutdownHandler(iVar4,uVar3);
                    }
                  } while( true );
                }
                iVar4 = iVar4 + 1;
              } while (iVar4 < param_1[1] * param_1[2]);
            }
            puVar19 = (uint *)param_1[6];
            if ((puVar19 != (uint *)0x0) &&
               (local_18 = (uint *)0x0, puVar13 = puVar14, puVar17 = local_24, 0 < param_1[2])) {
              do {
                iVar4 = 0;
                if (0 < param_1[1]) {
                  do {
                    uVar3 = *puVar19;
                    puVar19 = puVar19 + 1;
                    uVar2 = (ushort)local_20;
                    if (0xfe < uVar3 >> 0x18) {
                      uVar2 = *puVar17;
                    }
                    *(ushort *)puVar14 = uVar2;
                    puVar14 = (uint *)((int)puVar14 + 2);
                    puVar17 = puVar17 + 1;
                    iVar4 = iVar4 + 1;
                  } while (iVar4 < param_1[1]);
                }
                puVar16 = (ushort *)param_1[2];
                puVar14 = (uint *)((int)puVar14 + (param_1[0x1b] / 2 - param_1[1]) * 2);
                local_18 = (uint *)((int)local_18 + 1);
                puVar13 = puVar14;
              } while ((int)local_18 < (int)puVar16);
            }
          }
          else {
            local_20 = CONCAT22(local_20._2_2_,*local_24);
            puVar13 = puVar14;
            puVar17 = local_24;
            if (0 < param_1[2]) {
              do {
                iVar12 = 0;
                if (0 < param_1[1]) {
                  do {
                    *(ushort *)puVar13 = *puVar17;
                    puVar13 = (uint *)((int)puVar13 + 2);
                    puVar17 = puVar17 + 1;
                    iVar12 = iVar12 + 1;
                  } while (iVar12 < param_1[1]);
                }
                puVar16 = (ushort *)param_1[1];
                puVar13 = (uint *)((int)puVar13 + (param_1[0x1b] / 2 - (int)puVar16) * 2);
                iVar4 = iVar4 + 1;
              } while (iVar4 < param_1[2]);
            }
          }
        }
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler((int)puVar13,(uint)puVar16);
      }
    }
    else {
      lpCriticalSection = local_54;
      if (param_1[0x2c] != 0x20) goto LAB_0046bb48;
      puVar13 = (uint *)param_1[0x20];
      local_18 = puVar13;
      if (puVar13 != (uint *)0x0) {
        local_11 = '\x01';
        local_20 = 0;
        bVar7 = (byte)iVar12;
        bVar8 = (byte)local_38;
        bVar9 = (byte)local_4c;
        bVar10 = (byte)local_40;
        bVar11 = (byte)local_48;
        if ((*(char *)((int)param_1 + 0x31) == '\0') ||
           (puVar14 = (uint *)param_1[6], puVar14 == (uint *)0x0)) {
          puVar14 = (uint *)param_1[6];
          if ((puVar14 != (uint *)0x0) && (local_20 = 0, local_18 = puVar14, 0 < param_1[2])) {
            do {
              local_1c = (ushort *)0x0;
              puVar14 = puVar13;
              if (0 < param_1[1]) {
                do {
                  local_2c = (uint *)*local_18;
                  local_18 = local_18 + 1;
                  puVar13 = puVar14 + 1;
                  *puVar14 = ((uint)local_2c >> (bVar7 & 0x1f)) << (bVar8 & 0x1f) & local_3c |
                             ((uint)local_2c >> (bVar6 & 0x1f)) << (bVar9 & 0x1f) & (uint)puVar16 |
                             ((uint)local_2c >> (bVar10 & 0x1f)) << (bVar11 & 0x1f) & local_50;
                  local_1c = (ushort *)((int)local_1c + 1);
                  puVar14 = puVar13;
                } while ((int)local_1c < param_1[1]);
              }
              puVar13 = puVar13 + (((int)(param_1[0x1b] + (param_1[0x1b] >> 0x1f & 3U)) >> 2) -
                                  param_1[1]);
              local_20 = local_20 + 1;
            } while ((int)local_20 < param_1[2]);
          }
        }
        else {
          if (*(char *)((int)param_1 + 0x52) == '\0') {
            if (0 < param_1[1] * param_1[2]) {
              local_1c = (ushort *)(param_1[1] * param_1[2]);
              do {
                uVar3 = *puVar14;
                puVar14 = puVar14 + 1;
                if ((local_11 != '\0') && (uVar3 >> 0x18 < 0xff)) {
                  local_11 = '\0';
                  local_20 = uVar3;
                }
                local_1c = (ushort *)((int)local_1c + -1);
              } while (local_1c != (ushort *)0x0);
            }
            puVar14 = (uint *)param_1[6];
            iVar4 = 0;
            if (0 < param_1[1] * param_1[2]) {
              do {
                uVar3 = *puVar14;
                puVar14 = puVar14 + 1;
                if (((uVar3 & 0xff000000) == 0xff000000) && (local_20 == (uVar3 & 0xffffff))) {
                  local_24 = (ushort *)operator_new(0x200000);
                  puVar15 = (undefined4 *)local_24;
                  for (iVar4 = 0x80000; iVar4 != 0; iVar4 = iVar4 + -1) {
                    *puVar15 = 0;
                    puVar15 = puVar15 + 1;
                  }
                  iVar4 = param_1[1] * param_1[2];
                  puVar13 = (uint *)param_1[6];
                  local_1c = (ushort *)0x0;
                  if (0 < iVar4) {
                    do {
                      uVar3 = *puVar13;
                      puVar13 = puVar13 + 1;
                      if (uVar3 >> 0x18 != 0) {
                        *(uint *)((int)local_24 + (uVar3 >> 5 & 0x7ffff) * 4) =
                             *(uint *)((int)local_24 + (uVar3 >> 5 & 0x7ffff) * 4) |
                             1 << ((byte)uVar3 & 0x1f);
                      }
                      iVar4 = (int)local_1c + 1;
                      local_2c = puVar13;
                      local_1c = (ushort *)iVar4;
                    } while (iVar4 < param_1[1] * param_1[2]);
                  }
                  iVar12 = 0;
                  do {
                    if (*(uint *)((int)local_24 + iVar12 * 4) != 0xffff) {
                      iVar4 = 0;
                      do {
                        if ((*(uint *)((int)local_24 + iVar12 * 4) & 1 << ((byte)iVar4 & 0x1f)) == 0
                           ) {
                          local_20 = iVar12 * 0x20 + iVar4;
                          goto LAB_0046b98a;
                        }
                        iVar4 = iVar4 + 1;
                      } while (iVar4 < 0x20);
                    }
                    iVar12 = iVar12 + 1;
                  } while (iVar12 < 0x80000);
LAB_0046b98a:
                    /* WARNING: Subroutine does not return */
                  System_ShutdownHandler(iVar4,(uint)local_24);
                }
                iVar4 = iVar4 + 1;
              } while (iVar4 < param_1[1] * param_1[2]);
            }
            puVar15 = (undefined4 *)param_1[6];
            if ((puVar15 != (undefined4 *)0x0) && (local_1c = (ushort *)0x0, 0 < param_1[2])) {
              do {
                local_18 = (uint *)0x0;
                if (0 < param_1[1]) {
                  do {
                    puVar14 = (uint *)*puVar15;
                    puVar15 = puVar15 + 1;
                    if ((uint)puVar14 >> 0x18 < 0xff) {
                      *puVar13 = local_20;
                    }
                    else {
                      *puVar13 = ((uint)puVar14 >> (bVar7 & 0x1f)) << (bVar8 & 0x1f) & local_3c |
                                 ((uint)puVar14 >> (bVar6 & 0x1f)) << (bVar9 & 0x1f) & (uint)puVar16
                                 | ((uint)puVar14 >> (bVar10 & 0x1f)) << (bVar11 & 0x1f) & local_50;
                      local_2c = puVar14;
                    }
                    puVar13 = puVar13 + 1;
                    local_18 = (uint *)((int)local_18 + 1);
                    local_24 = (ushort *)puVar15;
                  } while ((int)local_18 < param_1[1]);
                }
                puVar13 = puVar13 + (((int)(param_1[0x1b] + (param_1[0x1b] >> 0x1f & 3U)) >> 2) -
                                    param_1[1]);
                local_1c = (ushort *)((int)local_1c + 1);
              } while ((int)local_1c < param_1[2]);
            }
          }
          else {
            uVar3 = *puVar14;
            local_24 = (ushort *)0x0;
            local_20 = (uVar3 >> (bVar7 & 0x1f)) << (bVar8 & 0x1f) & local_3c |
                       (uVar3 >> (bVar6 & 0x1f)) << (bVar9 & 0x1f) & (uint)puVar16 |
                       (uVar3 >> (bVar10 & 0x1f)) << (bVar11 & 0x1f) & local_50;
            local_18 = (uint *)param_1[6];
            if (0 < param_1[2]) {
              do {
                local_1c = (ushort *)0x0;
                puVar14 = puVar13;
                if (0 < param_1[1]) {
                  do {
                    local_2c = (uint *)*local_18;
                    local_18 = local_18 + 1;
                    puVar13 = puVar14 + 1;
                    *puVar14 = ((uint)local_2c >> (bVar7 & 0x1f)) << (bVar8 & 0x1f) & local_3c |
                               ((uint)local_2c >> (bVar6 & 0x1f)) << (bVar9 & 0x1f) & (uint)puVar16
                               | ((uint)local_2c >> (bVar10 & 0x1f)) << (bVar11 & 0x1f) & local_50;
                    local_1c = (ushort *)((int)local_1c + 1);
                    puVar14 = puVar13;
                  } while ((int)local_1c < param_1[1]);
                }
                puVar13 = puVar13 + (((int)(param_1[0x1b] + (param_1[0x1b] >> 0x1f & 3U)) >> 2) -
                                    param_1[1]);
                local_24 = (ushort *)((int)local_24 + 1);
              } while ((int)local_24 < param_1[2]);
            }
          }
          local_5c = local_20;
          local_58 = local_20;
          (**(code **)(*(int *)param_1[0x13] + 0x74))((int *)param_1[0x13],8,&local_5c);
        }
      }
    }
    (**(code **)(*param_1 + 0xa0))();
    LeaveCriticalSection(local_54);
    ExceptionList = local_10;
    return CONCAT31((int3)((uint)extraout_EAX >> 8),1);
  }
LAB_0046bb48:
  LeaveCriticalSection(lpCriticalSection);
  ExceptionList = local_10;
  return extraout_EAX_00 & 0xffffff00;
}


