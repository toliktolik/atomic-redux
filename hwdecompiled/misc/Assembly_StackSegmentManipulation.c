/*
 * Function: Assembly_StackSegmentManipulation
 * Address: 0050241f
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005024d0) overlaps instruction at (ram,0x005024cf)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined4 __fastcall Assembly_StackSegmentManipulation(undefined4 param_1,uint param_2)

{
  undefined4 *puVar1;
  undefined4 uVar2;
  char cVar3;
  uint in_EAX;
  undefined3 uVar5;
  int iVar4;
  int iVar6;
  char *pcVar7;
  undefined4 unaff_EBX;
  int iVar8;
  int unaff_EBP;
  undefined1 *unaff_ESI;
  char *unaff_EDI;
  char *pcVar9;
  undefined2 in_ES;
  undefined2 in_SS;
  bool in_CF;
  undefined4 unaff_retaddr;
  undefined1 auStack_4 [4];
  
  if (!in_CF) {
    puVar1 = (undefined4 *)segment(in_SS,(short)&stack0x00000000);
    uVar2 = *puVar1;
    iVar8 = CONCAT22((short)((uint)&stack0x00000000 >> 0x10),(short)&stack0x00000000 + 4);
    out(*unaff_ESI,(short)uVar2);
    *(char **)(iVar8 + 8) = unaff_EDI;
    *(undefined4 *)(iVar8 + 8) = uVar2;
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  iVar6 = CONCAT22((short)((int)param_1 >> 0x1f),CONCAT11(0xeb,(char)((int)param_1 >> 0x19)));
  if (in_EAX < 0xae6cddf2) {
    *(int *)(unaff_EDI + -0x76) = *(int *)(unaff_EDI + -0x76) << 0x14;
    pcVar9 = unaff_EDI + 1;
    *unaff_EDI = (char)unaff_retaddr;
    *(undefined1 *)((unaff_EBP + 1U ^ param_2) - 0x4a) = 0;
    segment(in_SS,(short)&stack0x00000004);
    param_2 = param_2 & 0xffffffeb;
    iVar6 = iVar6 + 2;
    uVar5 = (undefined3)((uint)unaff_retaddr >> 8);
    cVar3 = (char)unaff_retaddr + -0x6f;
  }
  else {
    pcVar9 = unaff_EDI + 4;
    uVar2 = in((short)param_2);
    *(undefined4 *)unaff_EDI = uVar2;
    iVar4 = in_EAX + 0x28f66042;
    cVar3 = (char)iVar4;
    out(0x99,cVar3);
    uVar5 = (undefined3)((uint)iVar4 >> 8);
    if (0x289cc1cb < in_EAX + 0x5193220e && iVar4 != 0) {
      out(*unaff_ESI,(short)param_2);
      return CONCAT22((short)((uint)iVar4 >> 0x10),
                      (ushort)(byte)(cVar3 + (char)((uint)iVar4 >> 8) * 'q'));
    }
    iVar6 = iVar6 + -1;
    cVar3 = cVar3 + *(char *)(iVar6 + param_2 * 4);
  }
  pcVar7 = (char *)(param_2 - 1);
  *(undefined2 *)(((uint)auStack_4 | 0x551e875f) - 4) = in_ES;
  *pcVar7 = *pcVar7 - (char)((uint)unaff_EBX >> 8);
  _DAT_85074031 = CONCAT31(uVar5,(cVar3 + -0x2a) - CARRY1((byte)pcVar7,*(byte *)(iVar6 + -0x18)));
  *(undefined4 *)pcVar9 = *(undefined4 *)((uint)unaff_ESI & *(uint *)(pcVar9 + 0x57));
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


