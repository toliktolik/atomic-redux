/*
 * Function: CPU_ProcessCompressedData
 * Address: 004c5d80
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


int __thiscall CPU_ProcessCompressedData(void *this,int param_1,undefined4 *param_2)

{
  undefined4 *puVar1;
  char cVar2;
  byte bVar3;
  uint uVar4;
  uint uVar5;
  int iVar6;
  void *pvVar7;
  int iVar8;
  int *piVar9;
  int iVar10;
  undefined4 local_1c [5];
  int local_8;
  
  local_8 = 0;
  CPU_ClearContext4(this,param_2);
  iVar6 = *(int *)(param_1 + 0xc);
  piVar9 = (int *)(param_1 + 8);
  PNG_GetBitDepth(local_1c);
  if (*(int *)(param_1 + 0x14) == 0) {
    if (iVar6 < 0x1b) {
      return local_8;
    }
    cVar2 = PNG_GetFilterMethod(0);
    if ((((cVar2 != 'O') || (cVar2 = PNG_GetFilterMethod(1), cVar2 != 'g')) ||
        (cVar2 = PNG_GetFilterMethod(2), cVar2 != 'g')) ||
       (cVar2 = PNG_GetFilterMethod(3), cVar2 != 'S')) goto LAB_004c5ed1;
    bVar3 = PNG_GetFilterMethod(0x1a);
    *(uint *)(param_1 + 0x14) = bVar3 + 0x1b;
  }
  iVar8 = *(int *)(param_1 + 0x14);
  if (iVar6 < iVar8) {
    return local_8;
  }
  if ((*(int *)(param_1 + 0x18) == 0) && (iVar10 = 0, iVar8 != 0x1b && -1 < iVar8 + -0x1b)) {
    do {
      bVar3 = PNG_GetFilterMethod(iVar10 + 0x1b);
      *(uint *)(param_1 + 0x18) = *(int *)(param_1 + 0x18) + (uint)bVar3;
      iVar10 = iVar10 + 1;
    } while (iVar10 < *(int *)(param_1 + 0x14) + -0x1b);
  }
  if (iVar6 < *(int *)(param_1 + 0x18) + *(int *)(param_1 + 0x14)) {
    return local_8;
  }
  uVar4 = PNG_GetInterlaceMethod(0x16);
  PNG_GetColorType(0x16,0);
  uVar5 = CPU_ProcessMemoryChain
                    (*(int *)(param_1 + 0x14),*piVar9,
                     *(int *)(param_1 + 0x18) + *(int *)(param_1 + 0x14));
  if (uVar4 == uVar5) {
    PNG_GetColorType(0x16,uVar4);
    if (param_2 == (undefined4 *)0x0) {
      iVar6 = PNG_ProcessData(*(int *)(param_1 + 0x18) + *(int *)(param_1 + 0x14));
      *piVar9 = iVar6;
      if (iVar6 == 0) {
        *(undefined4 *)(param_1 + 4) = 0;
      }
    }
    else {
      piVar9 = PNG_GetFreeFn((int *)(param_1 + 4));
      *param_2 = piVar9;
      param_2[1] = *(undefined4 *)(param_1 + 0x14);
      piVar9 = PNG_GetFreeFn((int *)(param_1 + 4));
      param_2[2] = piVar9;
      param_2[3] = *(undefined4 *)(param_1 + 0x18);
    }
    iVar6 = *(int *)(param_1 + 0x18);
    iVar8 = *(int *)(param_1 + 0x14);
    *(undefined4 *)(param_1 + 0x10) = 0;
    *(undefined4 *)(param_1 + 0x14) = 0;
    *(undefined4 *)(param_1 + 0x18) = 0;
    iVar6 = iVar6 + iVar8;
    *(int *)(param_1 + 0xc) = *(int *)(param_1 + 0xc) - iVar6;
    return iVar6;
  }
  PNG_GetColorType(0x16,uVar4);
LAB_004c5ed1:
  *(undefined4 *)(param_1 + 0x14) = 0;
  *(undefined4 *)(param_1 + 0x18) = 0;
  iVar6 = PNG_ProcessData(1);
  *piVar9 = iVar6;
  local_8 = -1;
  do {
    if (iVar6 == 0) {
LAB_004c5f37:
      if (*piVar9 == 0) {
        *(undefined4 *)(param_1 + 4) = 0;
      }
      *(int *)(param_1 + 0xc) = *(int *)(param_1 + 0xc) + local_8;
      return local_8;
    }
    puVar1 = (undefined4 *)*piVar9;
    iVar6 = *(int *)*puVar1;
    iVar8 = puVar1[1];
    pvVar7 = _memchr((void *)(iVar8 + iVar6),0x4f,puVar1[2]);
    if (pvVar7 != (void *)0x0) {
      iVar6 = (int)pvVar7 - (iVar8 + iVar6);
      iVar8 = PNG_ProcessData(iVar6);
      *piVar9 = iVar8;
      local_8 = local_8 - iVar6;
      goto LAB_004c5f37;
    }
    local_8 = local_8 - *(int *)(*piVar9 + 8);
    iVar6 = PNG_ProcessData(*(int *)(*piVar9 + 8));
    *piVar9 = iVar6;
  } while( true );
}


