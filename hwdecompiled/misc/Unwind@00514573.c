/*
 * Function: Unwind@00514573
 * Address: 00514573
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005146f2) overlaps instruction at (ram,0x005146ef)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00514631) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_00514573(int param_1,int param_2,undefined4 param_3,uint param_4)

{
  uint *puVar1;
  longlong lVar2;
  undefined4 uVar3;
  char cVar4;
  uint uVar5;
  code *pcVar6;
  byte bVar7;
  byte bVar14;
  int iVar8;
  int in_EAX;
  undefined3 uVar15;
  uint uVar10;
  uint uVar11;
  uint uVar12;
  uint uVar13;
  int *piVar16;
  int *piVar17;
  undefined2 uVar18;
  int iVar19;
  undefined4 *puVar20;
  undefined1 *puVar21;
  undefined4 *unaff_ESI;
  undefined1 *puVar22;
  undefined4 *unaff_EDI;
  undefined4 *puVar23;
  undefined2 in_CS;
  undefined2 in_SS;
  ushort in_DS;
  bool bVar24;
  bool bVar25;
  byte in_AF;
  byte in_TF;
  byte in_IF;
  bool bVar26;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  unkbyte10 in_ST6;
  unkbyte10 in_ST7;
  byte *unaff_retaddr;
  byte *pbVar27;
  undefined1 uStack_19;
  uint uStack_18;
  undefined1 *puStack_14;
  undefined3 uStack_c;
  undefined1 uStack_9;
  undefined3 uStack_8;
  byte abStack_5 [4];
  undefined1 uStack_1;
  int *piVar9;
  
  bVar26 = false;
  do {
    uVar15 = (undefined3)((uint)in_EAX >> 8);
    bVar7 = (char)in_EAX + 0x24;
    piVar9 = (int *)CONCAT31(uVar15,bVar7);
    iVar19 = param_2 + -1;
    if (iVar19 == 0 || param_2 < 1) {
LAB_005145de_3:
      in(0xe2);
      pcVar6 = (code *)swi(3);
      (*pcVar6)();
      return;
    }
    puVar1 = (uint *)((int)piVar9 + 0x3a05bbf3);
    *puVar1 = *puVar1 | (uint)unaff_ESI;
    piVar16 = (int *)(param_1 + -1);
    piVar17 = piVar16;
    pbVar27 = unaff_retaddr;
    if (piVar16 != (int *)0x0 && *puVar1 != 0) {
LAB_005145d1:
      in_AF = ((uint)piVar9 & 0x1000) != 0;
      in_IF = 0;
      LOCK();
      iVar8 = *(int *)((int)unaff_ESI + 0x438f8d42);
      *(int *)((int)unaff_ESI + 0x438f8d42) = iVar19;
      UNLOCK();
      piVar16 = piVar9;
      piVar9 = piVar17;
      iVar19 = iVar8;
LAB_005145e6:
      out(0xb6,piVar16);
      iVar8 = CONCAT13(abStack_5[3],CONCAT12(abStack_5[2],CONCAT11(abStack_5[1],abStack_5[0])));
      ffree(in_ST6);
      out(*(undefined1 *)((int)unaff_ESI + 1),
          (short)iVar19 + (short)*(undefined4 *)((int)unaff_ESI + -0x570d3a95));
      if ((char)unaff_retaddr < -0x12) {
        if (piVar9 == (int *)0x1 || (byte)((byte)piVar16 | 0xd2) != 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
          halt_baddata();
        }
      }
      else {
        *(int **)(iVar8 + -4) = piVar9;
        *(undefined2 *)(iVar8 + -8) = in_CS;
        func_0xfdae8ffb();
        bVar7 = DAT_bbe0d3d7;
        iVar19 = in(0xd7);
        lVar2 = *(longlong *)(iVar19 + -0x352402a6);
        out(0x34,(char)iVar19);
        iVar19 = CONCAT13(uStack_1,CONCAT12(abStack_5[3],CONCAT11(abStack_5[2],abStack_5[1])));
        if (&stack0x00000000 != (undefined1 *)0x18) goto LAB_005145de_3;
        uVar12 = CONCAT31((int3)((uint)param_3 >> 8),DAT_bbe0d3d7);
        if (SCARRY4((int)&uStack_19,1) == (int)&uStack_18 < 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
          halt_baddata();
        }
        puVar21 = (undefined1 *)0x60;
        if ((POPCOUNT((uint)&uStack_18 & 0xff) & 1U) == 0) {
          pbVar27[uStack_18 * 2 + 0x7e] = pbVar27[uStack_18 * 2 + 0x7e] ^ abStack_5[1];
          *pbVar27 = *pbVar27 << 5;
          swi(4);
          uVar12 = uStack_18;
          if (-1 < (char)*pbVar27) {
            uVar12 = CONCAT22((short)((uint)_uStack_8 >> 0x10),
                              CONCAT11((byte)((uint)_uStack_8 >> 8) | (byte)((uint)pbVar27 >> 8),
                                       0x9a));
            uVar11 = CONCAT31((int3)((uint)pbVar27 >> 8),0xa5);
            if ((POPCOUNT(bVar7 | 0x6e) & 1U) != 0) goto LAB_005146ea;
            piVar9 = (int *)CONCAT31((int3)((uint)iVar19 >> 8),
                                     abStack_5[1] - *(char *)(iVar19 + 0x12));
            iVar19 = *piVar9;
            *(char *)(uVar12 + 0x7e) = *(char *)(uVar12 + 0x7e) + '\x01';
            puVar23 = (undefined4 *)((uint)bVar26 * -2 + -0x74f8759b);
            puVar22 = puStack_14 + (uint)bVar26 * -2 + 1;
            *(short *)((int)piVar9 + -0x32c15d07) = (short)ROUND((float10)lVar2 / (float10)iVar19);
            uVar13 = in(0xd7);
            uVar13 = uVar13 | 0xfe;
            puVar1 = (uint *)((int)puVar23 * 9 + 0x33a421f1);
            uVar5 = *puVar1;
            *puVar1 = *puVar1 + uVar13;
            if (CARRY4(uVar5,uVar13)) {
              puVar20 = (undefined4 *)(uint)in_DS;
              uStack_18 = 0x53f1f231;
              puVar23 = (undefined4 *)0x1c;
              puVar21 = (undefined1 *)0x1c;
              cVar4 = '\x02';
              do {
                puVar20 = puVar20 + -1;
                puVar23 = puVar23 + -1;
                *puVar23 = *puVar20;
                cVar4 = cVar4 + -1;
              } while ('\0' < cVar4);
              *(undefined1 *)(param_4 + 0x9613e99e) = 0;
              piVar9 = (int *)(uVar11 - 0x5c);
              *piVar9 = *piVar9 << 1;
              iVar19 = (uint)(byte)(abStack_5[2] << 1 | abStack_5[2] >> 7) << 8;
              uVar12 = param_4;
              puStack_14 = puVar22;
LAB_005146ea:
              piVar9 = (int *)CONCAT31((int3)((uint)iVar19 >> 8),0x84);
              puVar1 = (uint *)(puVar21 + 0x2e);
              puVar23 = (undefined4 *)(uStack_18 + *puVar1);
              puVar22 = puStack_14 + (uint)bVar26 * -2 + 1;
              out(*puStack_14,(short)piVar9);
              param_4 = (uint)(in_NT & 1) * 0x4000 | (uint)SCARRY4(uStack_18,*puVar1) * 0x800 |
                        (uint)bVar26 * 0x400 | (uint)(in_IF & 1) * 0x200 | (uint)(in_TF & 1) * 0x100
                        | (uint)((int)puVar23 < 0) * 0x80 |
                        (uint)(puVar23 == (undefined4 *)0x0) * 0x40 | (uint)(in_AF & 1) * 0x10 |
                        (uint)((POPCOUNT((uint)puVar23 & 0xff) & 1U) == 0) * 4 |
                        (uint)CARRY4(uStack_18,*puVar1) | (uint)(in_ID & 1) * 0x200000 |
                        (uint)(in_VIP & 1) * 0x100000 | (uint)(in_VIF & 1) * 0x80000 |
                        (uint)(in_AC & 1) * 0x40000;
              uVar13 = uVar11;
            }
            else {
              puVar22[-0x6391dba5] = puVar22[-0x6391dba5] ^ (byte)uVar13;
            }
            while (uVar13 != 0) {
              uVar13 = uVar13 - 1;
              uVar3 = in((short)piVar9);
              *puVar23 = uVar3;
              puVar23 = puVar23 + (uint)bVar26 * -2 + 1;
            }
            out(puVar22[(uint)bVar26 * -8 + 4],(short)piVar9);
            if (*(char *)(param_4 + 0x10b1e478) <= (char)uVar12) {
              out(0xc6,(char)*(undefined4 *)
                              (puVar22 + (uint)bVar26 * -8 + 4 + (uint)bVar26 * -2 + 1));
                    /* WARNING: Bad instruction - Truncating control flow here */
              halt_baddata();
            }
                    /* WARNING: Bad instruction - Truncating control flow here */
            halt_baddata();
          }
        }
        *(char *)(uVar12 + 0x44f0aa08) = *(char *)(uVar12 + 0x44f0aa08) + '\x01';
      }
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    uVar18 = (undefined2)iVar19;
    if ((POPCOUNT(*puVar1 & 0xff) & 1U) != 0) {
      out(uVar18,(char)piVar16);
      goto LAB_005145e6;
    }
    out(uVar18,(char)piVar16);
    pbVar27 = (byte *)0xbbb7ba86;
    LOCK();
    *(char *)(unaff_ESI + 1) = (char)(param_1 + 0x62a8ae9aU);
    uVar11 = param_1 + 0x62a8ae9aU & 0xffffff00;
    UNLOCK();
    abStack_5[1] = (byte)in_SS;
    abStack_5[2] = (byte)((ushort)in_SS >> 8);
    bVar14 = bVar7 - *(byte *)((int)piVar9 + 0x35);
    bVar24 = bVar7 < *(byte *)((int)piVar9 + 0x35) || bVar14 < ((int *)0x9d575164 < piVar16);
    param_1 = CONCAT31(uVar15,bVar14 - ((int *)0x9d575164 < piVar16));
    uVar12 = (uint)bVar26;
    puVar23 = unaff_ESI + (uint)bVar26 * -2 + 1;
    *unaff_EDI = *unaff_ESI;
    while( true ) {
      bVar14 = (byte)(uVar11 >> 8);
      bVar7 = bVar14 + *(byte *)((int)puVar23 + 0x5c9d970d);
      uVar10 = CONCAT31(CONCAT21((short)(uVar11 >> 0x10),bVar7 + bVar24),0xbf);
      uVar5 = (uint)(CARRY1(bVar14,*(byte *)((int)puVar23 + 0x5c9d970d)) || CARRY1(bVar7,bVar24));
      uVar13 = uVar10 + 0xfdc4ea76;
      uVar11 = uVar13 - uVar5;
      puVar1 = (uint *)(param_1 * 3 + -0x5888d3fc);
      bVar24 = CARRY4((uint)abStack_5,*puVar1) ||
               CARRY4((uint)(abStack_5 + *puVar1),(uint)(uVar10 < 0x23b158a || uVar13 < uVar5));
      bVar25 = (POPCOUNT((uint)abStack_5 & 0xff) & 1U) != 0;
      if (bVar25) break;
      in_ST6 = in_ST7;
      if (bVar25) {
        cVar4 = (char)uVar11 + 'F';
        uVar15 = (undefined3)(uVar11 >> 8);
        bVar7 = cVar4 + bVar24;
        piVar17 = (int *)(param_1 + -1);
        if (piVar17 != (int *)0x0 && bVar7 == 0) {
          halt_baddata();
        }
        unaff_ESI = puVar23 + (uint)bVar26 * -2 + 1;
        out(*puVar23,uVar18);
        piVar16 = (int *)CONCAT31(uVar15,bVar7);
        piVar9 = piVar17;
        if (bVar7 == 0 || (SCARRY1((char)uVar11,'F') != SCARRY1(cVar4,bVar24)) != (char)bVar7 < '\0'
           ) goto LAB_005145e6;
        uStack_9 = SUB41(unaff_ESI,0);
        uStack_8 = (undefined3)((uint)unaff_ESI >> 8);
        bVar14 = 9 < (bVar7 & 0xf) | in_AF;
        uVar12 = CONCAT31(uVar15,bVar7 + bVar14 * -6) & 0xffffff0f;
        piVar9 = (int *)CONCAT22((short)(uVar12 >> 0x10),
                                 CONCAT11((char)(uVar11 >> 8) - bVar14,(char)uVar12));
        piVar17 = (int *)((int)piVar17 - *piVar9);
        bVar26 = false;
        unaff_retaddr = (byte *)((uint)unaff_retaddr & 0xff);
        out(uVar18,piVar9);
        puVar1 = (uint *)(iVar19 * 3 + 0x6b915b41);
        *puVar1 = *puVar1 | (uint)unaff_ESI;
        goto LAB_005145d1;
      }
    }
    iVar8 = uVar11 - 1;
    uRambbb7ba76 = 0xbbb7ba8a;
    iRambbb7ba72 = iRambbb7ba86;
    puRambbb7ba6a = unaff_EDI + uVar12 * -2 + 1;
    puRambbb7ba6e = puVar23;
    pbRambbb7ba7a = unaff_retaddr;
    iRambbb7ba7e = iVar19;
    iRambbb7ba82 = param_1;
    iRambbb7ba86 = iVar8;
    *unaff_retaddr = *unaff_retaddr ^ 0x4a;
    in_EAX = CONCAT22((short)((uint)iVar8 >> 0x10),CONCAT11(0x4a,(char)iVar8)) + -0x26001079;
    in_NT = ((uint)puRambbb7ba6a & 0x4000) != 0;
    bVar26 = ((uint)puRambbb7ba6a & 0x400) != 0;
    in_IF = ((uint)puRambbb7ba6a & 0x200) != 0;
    in_TF = ((uint)puRambbb7ba6a & 0x100) != 0;
    in_AF = ((uint)puRambbb7ba6a & 0x10) != 0;
    in_ID = ((uint)puRambbb7ba6a & 0x200000) != 0;
    in_AC = ((uint)puRambbb7ba6a & 0x40000) != 0;
    in_VIP = 0;
    in_VIF = 0;
    param_2 = iVar19;
    unaff_ESI = puVar23;
    unaff_EDI = unaff_EDI + uVar12 * -2 + 1;
    unaff_retaddr = pbVar27;
  } while( true );
}


