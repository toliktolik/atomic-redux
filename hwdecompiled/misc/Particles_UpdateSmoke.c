/*
 * Function: Particles_UpdateSmoke
 * Address: 0041a5b0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __thiscall Particles_UpdateSmoke(void *this,int param_1,undefined4 *param_2)

{
  int iVar1;
  undefined4 uVar2;
  int iVar3;
  undefined4 *puVar4;
  int extraout_ECX;
  uint extraout_EDX;
  int iVar5;
  int iVar6;
  ulonglong uVar7;
  undefined4 *local_18;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_005108e6;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  local_18 = (undefined4 *)operator_new(0x28);
  if (local_18 == (undefined4 *)0x0) {
    local_18 = (undefined4 *)0x0;
  }
  else {
    local_18[3] = 0;
    local_18[4] = 0;
    local_18[5] = 0;
    local_18[7] = 0;
    local_18[8] = 0;
    local_18[9] = 0;
  }
  local_8 = 0xffffffff;
  if (local_18[3] != 0) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX,extraout_EDX);
  }
  local_18[3] = 0;
  local_18[4] = 0;
  local_18[5] = 0;
  if (local_18[7] != 0) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX,extraout_EDX);
  }
  local_18[7] = 0;
  local_18[8] = 0;
  local_18[9] = 0;
  iVar6 = *(int *)((int)this + 0x5c);
  if (*(int *)(iVar6 + 0x146c) == 0) {
    iVar5 = 0;
  }
  else {
    iVar5 = *(int *)(iVar6 + 0x1470) - *(int *)(iVar6 + 0x146c) >> 4;
  }
  iVar3 = param_1;
  if (iVar5 <= param_1) {
    if (*(int *)(iVar6 + 0x146c) == 0) {
      iVar3 = -1;
    }
    else {
      iVar3 = (*(int *)(iVar6 + 0x1470) - *(int *)(iVar6 + 0x146c) >> 4) + -1;
    }
  }
  param_1 = 0;
  iVar3 = iVar3 * 0x10;
  iVar6 = (int)param_2 * 0x28;
  while( true ) {
    iVar5 = *(int *)(iVar3 + 4 + *(int *)(*(int *)((int)this + 0x5c) + 0x146c));
    iVar1 = *(int *)(iVar6 + 0xc + iVar5);
    if (iVar1 == 0) {
      iVar5 = 0;
    }
    else {
      iVar5 = *(int *)(iVar6 + 0x10 + iVar5) - iVar1 >> 2;
    }
    if (iVar5 <= param_1) break;
    puVar4 = (undefined4 *)
             (*(int *)(iVar6 + 0xc +
                      *(int *)(iVar3 + 4 + *(int *)(*(int *)((int)this + 0x5c) + 0x146c))) +
             param_1 * 4);
    iVar5 = local_18[3];
    if ((iVar5 == 0) || ((uint)(local_18[5] - iVar5 >> 2) <= (uint)(local_18[4] - iVar5 >> 2))) {
      Boss_ProcessBattleshipAttack(local_18 + 2,(undefined4 *)local_18[4],(undefined4 *)0x1,puVar4);
    }
    else {
      param_2 = (undefined4 *)local_18[4];
      ArrayInit_4ByteObjects(param_2,1,puVar4);
      local_18[4] = param_2 + 1;
    }
    uVar7 = Math_FloatToUInt64();
    param_2 = (undefined4 *)uVar7;
    iVar5 = local_18[7];
    if ((iVar5 == 0) || ((uint)(local_18[9] - iVar5 >> 2) <= (uint)(local_18[8] - iVar5 >> 2))) {
      Boss_ProcessBattleshipAttack
                (local_18 + 6,(undefined4 *)local_18[8],(undefined4 *)0x1,&param_2);
      param_1 = param_1 + 1;
    }
    else {
      puVar4 = (undefined4 *)local_18[8];
      ArrayInit_4ByteObjects(puVar4,1,&param_2);
      param_1 = param_1 + 1;
      local_18[8] = puVar4 + 1;
    }
  }
  uVar2 = *(undefined4 *)
           (iVar6 + *(int *)(*(int *)(*(int *)((int)this + 0x5c) + 0x146c) + 4 + iVar3));
  *local_18 = uVar2;
  local_18[1] = uVar2;
  puVar4 = (undefined4 *)operator_new(0xc);
  uVar2 = *(undefined4 *)((int)this + 700);
  puVar4[1] = 0;
  puVar4[2] = uVar2;
  *(undefined4 **)(*(int *)((int)this + 700) + 4) = puVar4;
  *puVar4 = local_18;
  *(undefined4 **)((int)this + 700) = puVar4;
  *(int *)((int)this + 0x2c0) = *(int *)((int)this + 0x2c0) + 1;
  ExceptionList = local_10;
  return;
}


