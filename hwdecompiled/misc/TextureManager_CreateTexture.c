/*
 * Function: TextureManager_CreateTexture
 * Address: 004ba940
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void * __thiscall TextureManager_CreateTexture(void *this,void *param_1,void *param_2)

{
  char cVar1;
  ushort uVar2;
  void *pvVar3;
  undefined4 uVar4;
  int iVar5;
  void *this_00;
  void *extraout_ECX;
  undefined4 *puVar6;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  int extraout_EDX_03;
  int extraout_EDX_04;
  int iVar7;
  uint extraout_EDX_05;
  uint uVar8;
  undefined4 local_50 [5];
  undefined4 local_3c [5];
  undefined4 local_28 [5];
  int local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_00517218;
  local_10 = ExceptionList;
  local_14 = 0;
  ExceptionList = &local_10;
  cVar1 = Texture_SetID((int)param_2);
  if (cVar1 == '\0') {
    cVar1 = Texture_SetID((int)this);
    if (cVar1 == '\0') {
      uVar4 = Texture_SetAsRenderTarget(param_2,(int)this);
      if ((char)uVar4 == '\0') {
        Texture_CopyToBuffer(local_28);
        local_8 = 4;
        Graphics_SetTransform((int)param_2);
        iVar5 = Graphics_SetTransform((int)this);
        pvVar3 = extraout_ECX;
        if (iVar5 <= extraout_EDX_03) {
          pvVar3 = param_2;
        }
        local_14 = Graphics_SetTransform((int)pvVar3);
        iVar5 = 0;
        if (0 < local_14) {
          do {
            Texture_SetTarget(this,iVar5);
            uVar2 = Texture_SetTarget(param_2,iVar5);
            iVar7 = extraout_EDX_04 - (uint)uVar2;
            if (iVar7 < 0) {
              iVar7 = iVar7 + 0x10000;
            }
            Texture_GetInternalFormat(local_28,iVar5,(short)iVar7);
            iVar5 = iVar5 + 1;
          } while (iVar5 < local_14);
        }
        Texture_Release((int)local_28);
        TextureManager_Shutdown(param_1,(int)local_28);
        puVar6 = local_28;
        uVar8 = extraout_EDX_05;
      }
      else {
        pvVar3 = TextureManager_CreateTexture(param_2,local_50,this);
        local_8 = 3;
        TextureManager_GetTexture(pvVar3,param_1);
        puVar6 = local_50;
        uVar8 = extraout_EDX_02;
      }
    }
    else {
      pvVar3 = TextureManager_GetTexture(this,local_3c);
      local_8 = 1;
      pvVar3 = TextureManager_OptimizeTextures(pvVar3,local_28,param_2);
      local_8 = CONCAT31(local_8._1_3_,2);
      TextureManager_GetTexture(pvVar3,param_1);
      Texture_Constructor(local_28,extraout_EDX_00);
      puVar6 = local_3c;
      uVar8 = extraout_EDX_01;
    }
  }
  else {
    pvVar3 = TextureManager_GetTexture(this_00,local_28);
    local_8 = 0;
    TextureManager_OptimizeTextures(this,param_1,pvVar3);
    puVar6 = local_28;
    uVar8 = extraout_EDX;
  }
  Texture_Constructor(puVar6,uVar8);
  ExceptionList = local_10;
  return param_1;
}


