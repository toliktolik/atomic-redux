/*
 * Function: Compression_FillBitBuffer
 * Address: 004de270
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 __cdecl
Compression_FillBitBuffer(undefined4 *param_1,uint param_2,int param_3,int param_4)

{
  int *piVar1;
  uint uVar2;
  byte *pbVar3;
  int iVar4;
  
  piVar1 = (int *)param_1[4];
  pbVar3 = (byte *)*param_1;
  iVar4 = param_1[1];
  if (piVar1[0x5f] == 0) {
    if (param_3 < 0x19) {
      do {
        if (iVar4 == 0) {
          uVar2 = (**(code **)(piVar1[6] + 0xc))(piVar1);
          if ((char)uVar2 == '\0') {
LAB_004de310:
            return uVar2 & 0xffffff00;
          }
          pbVar3 = *(byte **)piVar1[6];
          iVar4 = ((undefined4 *)piVar1[6])[1];
        }
        uVar2 = (uint)*pbVar3;
        iVar4 = iVar4 + -1;
        pbVar3 = pbVar3 + 1;
        if (uVar2 == 0xff) {
          do {
            if (iVar4 == 0) {
              uVar2 = (**(code **)(piVar1[6] + 0xc))(piVar1);
              if ((char)uVar2 == '\0') goto LAB_004de310;
              pbVar3 = *(byte **)piVar1[6];
              iVar4 = ((undefined4 *)piVar1[6])[1];
            }
            uVar2 = (uint)*pbVar3;
            iVar4 = iVar4 + -1;
            pbVar3 = pbVar3 + 1;
          } while (uVar2 == 0xff);
          if (uVar2 != 0) {
            piVar1[0x5f] = uVar2;
            goto LAB_004de320;
          }
          uVar2 = 0xff;
        }
        param_2 = param_2 << 8 | uVar2;
        param_3 = param_3 + 8;
      } while (param_3 < 0x19);
    }
  }
  else {
LAB_004de320:
    if (param_3 < param_4) {
      if (*(char *)(piVar1[0x66] + 8) == '\0') {
        *(undefined4 *)(*piVar1 + 0x14) = 0x75;
        (**(code **)(*piVar1 + 4))(piVar1,0xffffffff);
        *(undefined1 *)(piVar1[0x66] + 8) = 1;
      }
      param_2 = param_2 << (0x19U - (char)param_3 & 0x1f);
      param_3 = 0x19;
    }
  }
  param_1[1] = iVar4;
  *param_1 = pbVar3;
  param_1[2] = param_2;
  param_1[3] = param_3;
  return CONCAT31((int3)((uint)param_1 >> 8),1);
}


