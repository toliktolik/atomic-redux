/*
 * Function: Unwind@00513b9e
 * Address: 00513b9e
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00513bce) overlaps instruction at (ram,0x00513bcb)
    */
/* WARNING (jumptable): Unable to track spacebase fully for stack */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */

uint __fastcall Unwind_00513b9e(int param_1,uint param_2)

{
  char cVar1;
  code *pcVar2;
  undefined6 uVar3;
  undefined1 *puVar4;
  byte bVar5;
  undefined2 uVar6;
  ushort uVar7;
  undefined2 uVar12;
  undefined4 *in_EAX;
  int3 iVar11;
  uint uVar10;
  ushort uVar13;
  undefined2 extraout_DX;
  char *pcVar14;
  uint *unaff_EBX;
  char *pcVar15;
  byte *pbVar16;
  uint unaff_EBP;
  undefined4 *unaff_ESI;
  code *UNRECOVERED_JUMPTABLE;
  undefined2 in_ES;
  undefined2 in_CS;
  bool in_CF;
  bool in_PF;
  bool bVar17;
  bool in_ZF;
  char in_SF;
  char in_OF;
  uint unaff_retaddr;
  int iVar8;
  undefined4 *puVar9;
  
  if (in_ZF) {
    if (in_CF || in_ZF) {
code_r0x00513c0d:
      return CONCAT31((int3)((uint)in_EAX >> 8),*(undefined1 *)unaff_ESI) | 0x21173c00;
    }
    uVar12 = (undefined2)((uint)unaff_ESI >> 0x10);
    uVar6 = CONCAT11(0xb9,(char)unaff_ESI);
    unaff_ESI = in_EAX + 1;
    out(*in_EAX,(short)param_2);
    if (in_PF) {
      if (!in_ZF) {
        if (in_OF != in_SF) {
          *unaff_EBX = *unaff_EBX | unaff_EBP;
                    /* WARNING: Could not recover jumptable at 0x00513b4c. Too many branches */
                    /* WARNING: Treating indirect jump as call */
          uVar10 = (*UNRECOVERED_JUMPTABLE)();
          return uVar10;
        }
        pcVar2 = (code *)swi(1);
        uVar10 = (*pcVar2)();
        return uVar10;
      }
      pcVar15 = (char *)(CONCAT22(uVar12,uVar6) + -0x13dee8d6);
      goto code_r0x00513bca;
    }
    in_EAX = (undefined4 *)(CONCAT22(uVar12,uVar6) & 0xffffb1ff);
    *(uint **)UNRECOVERED_JUMPTABLE = unaff_EBX;
    UNRECOVERED_JUMPTABLE = UNRECOVERED_JUMPTABLE + 5;
    *(char *)unaff_EBX = (char)*unaff_EBX - (char)(param_2 >> 8);
    unaff_EBX = (uint *)((int)unaff_EBX + 1);
    uVar10 = param_2 ^ *unaff_EBX;
    param_1 = (param_1 - param_2) + -1;
    if (param_1 == 0 || uVar10 != 0) goto code_r0x00513c0d;
  }
  else {
    in_EAX = (undefined4 *)in(0x4f);
    uVar13 = CONCAT11((&stack0x67a0824f)[unaff_EBP],(char)param_2);
    uVar10 = (uint)uVar13;
    out(uVar13,in_EAX);
  }
  if (unaff_EBP + 1 == 0) {
    uVar10 = File_GetSize(param_1,(short)uVar10);
    return uVar10;
  }
  bVar17 = 9 < ((byte)in_EAX & 0xf) || (unaff_retaddr & 0x10) != 0;
  iVar11 = (int3)((uint)in_EAX >> 8);
  bVar5 = (byte)in_EAX + bVar17 * -6;
  iVar8 = CONCAT31(iVar11,bVar5 + (0x9f < bVar5 | (unaff_retaddr & 1) != 0 | bVar17 * (bVar5 < 6)) *
                                  -0x60);
  pcVar14 = (char *)((int)iVar11 >> 0x17);
  pcVar15 = (char *)((int)unaff_EBX + -1);
  pbVar16 = (byte *)CONCAT22((short)((uint)pcVar15 >> 0x10),CONCAT11(0xe1,(char)pcVar15));
  uVar13 = (ushort)*(byte *)(iVar8 + -9);
  uVar7 = (ushort)iVar8;
  puVar9 = (undefined4 *)
           CONCAT22((short)((uint)in_EAX >> 0x10),
                    CONCAT11((char)(uVar7 % uVar13),(char)(uVar7 / uVar13)));
  if (&stack0x00000000 < UNRECOVERED_JUMPTABLE || pcVar15 == (char *)0x0) {
    out(0x97,&stack0x00000000);
    cVar1 = *pcVar14;
    puVar4 = (undefined1 *)*puVar9;
    *(undefined2 *)puVar9 = in_CS;
    puVar9[-1] = register0x00000010;
    puVar9[-2] = CONCAT22(0xf970,CONCAT11('\x1e' - cVar1,0x52));
    puVar9[-3] = pcVar14;
    puVar9[-4] = pbVar16;
    puVar9[-5] = puVar9;
    puVar9[-6] = unaff_EBP + 1;
    puVar9[-7] = unaff_ESI;
    puVar9[-8] = puVar4;
    bVar5 = *pbVar16;
    *puVar4 = *(undefined1 *)unaff_ESI;
    *(undefined2 *)(puVar9 + -8) = in_ES;
    out(0xb9,(bVar5 | 0x78) + 0x94);
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
code_r0x00513bca:
  bVar17 = (POPCOUNT((uint)pcVar15 & 0xff) & 1U) == 0;
  uVar3 = *(undefined6 *)(&stack0x00000025 + (int)unaff_ESI * 8);
  func_0x32504fb3();
  if (!bVar17) {
    out(*(undefined1 *)uVar3,extraout_DX);
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


