/*
 * Function: Unwind@005107a0
 * Address: 005107a0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x005107a8) overlaps instruction at (ram,0x005107a7)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined8 __fastcall Unwind_005107a0(undefined4 param_1,int *param_2)

{
  uint *puVar1;
  undefined4 *puVar2;
  undefined4 uVar3;
  int iVar4;
  char *pcVar5;
  short sVar6;
  int in_EAX;
  int iVar7;
  byte bVar9;
  int unaff_EBX;
  char *pcVar8;
  uint uVar10;
  uint unaff_EBP;
  byte *unaff_ESI;
  undefined4 *unaff_EDI;
  undefined2 in_ES;
  undefined2 in_DS;
  bool bVar11;
  
  pcVar8 = (char *)(unaff_EBX + -1);
  bVar9 = (byte)((uint)pcVar8 >> 8);
  if ((char)bVar9 < (char)*unaff_ESI) {
    *pcVar8 = (char)((uint)param_1 >> 8);
    *(char *)(unaff_EBX + 0x73bed0cb) = *(char *)(unaff_EBX + 0x73bed0cb) + -0xe;
    return CONCAT44(CONCAT31((int3)((uint)param_2 >> 8),(char)param_2 - bVar9) + -2,
                    (int)(short)(ushort)(byte)((char)in_EAX + (char)((uint)in_EAX >> 8) * -0x71));
  }
  iVar7 = CONCAT31((int3)((uint)param_1 >> 8),((char)param_1 - *pcVar8) - (bVar9 < *unaff_ESI));
  *(char *)(in_EAX + 0x70) = *(char *)(in_EAX + 0x70) + '\x01';
  do {
    uVar10 = (uint)&stack0x00000000 & *(uint *)(unaff_ESI + 0x62880072);
    *(int *)(uVar10 - 4) = in_EAX;
    *(int *)(uVar10 - 8) = iVar7;
    *(int **)(uVar10 - 0xc) = param_2;
    *(char **)(uVar10 - 0x10) = pcVar8;
    *(uint *)(uVar10 - 0x14) = uVar10;
    *(uint *)(uVar10 - 0x18) = unaff_EBP;
    *(byte **)(uVar10 - 0x1c) = unaff_ESI;
    *(undefined4 **)(uVar10 - 0x20) = unaff_EDI;
    *(undefined4 *)(uVar10 - 0x24) = 10;
    in(0x28);
    *(uint *)(uVar10 - 0x28) = uVar10 - 0x24;
    unaff_EBP = unaff_EBP + 1;
    *(undefined2 *)(uVar10 - 0x2c) = in_ES;
    pcVar5 = _DAT_ff488477;
    in(0x6c);
    puVar2 = unaff_EDI + 1;
    *unaff_EDI = pcVar8;
    iVar4 = *param_2;
    param_2 = (int *)CONCAT31((int3)((uint)param_2 >> 8),
                              (byte)param_2 | *(byte *)(unaff_EDI + -0xedb2b9f));
    sVar6 = (ushort)(byte)pcVar8 * (ushort)*(byte *)(iVar7 + -0x7fc02239);
    in_EAX = CONCAT22((short)((uint)pcVar8 >> 0x10),sVar6);
    bVar11 = (char)((ushort)sVar6 >> 8) != '\0';
    if (iVar7 != 1) {
code_r0x005107f6:
      do {
                    /* WARNING: Do nothing block with infinite loop */
      } while( true );
    }
    if (!bVar11) {
      out((short)param_2,(char)sVar6);
      *(undefined2 *)(&DAT_ff488477 + iVar4) = in_ES;
      goto code_r0x005107f6;
    }
    iVar7 = 0;
    pcVar8 = pcVar5;
    unaff_EDI = puVar2;
    if (bVar11) {
      *(uint *)(unaff_ESI + -0x22208819) = *(uint *)(unaff_ESI + -0x22208819) | unaff_EBP;
      *(char *)((int)param_2 + -0x4e) = *(char *)((int)param_2 + -0x4e) + '\x01';
      *(int *)(&DAT_ff488477 + iVar4) = in_EAX;
      *(undefined4 *)(iVar4 + -0xb77b8d) = 0;
      *(int **)(iVar4 + -0xb77b91) = param_2;
      *(char **)(iVar4 + -0xb77b95) = pcVar5;
      *(BADSPACEBASE **)(iVar4 + -0xb77b99) = register0x00000010;
      *(uint *)(iVar4 + -0xb77b9d) = unaff_EBP;
      *(byte **)(iVar4 + -0xb77ba1) = unaff_ESI;
      *(undefined4 **)(iVar4 + -0xb77ba5) = puVar2;
      puVar1 = (uint *)((int)param_2 + (int)unaff_ESI * 8 + 0x49);
      *puVar1 = *puVar1 ^ 0xe937fb58;
      *(undefined2 *)(param_2 + -1) = in_ES;
      out(0xca,-((in_EAX + 1U >> 8 & 1) != 0));
      *(undefined2 *)(param_2 + -2) = in_DS;
      uVar3 = in((short)param_2);
      *puVar2 = uVar3;
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
  } while( true );
}


