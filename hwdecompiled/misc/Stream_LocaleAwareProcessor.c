/*
 * Function: Stream_LocaleAwareProcessor
 * Address: 00414760
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


int * __thiscall Stream_LocaleAwareProcessor(void *this,undefined4 param_1)

{
  int iVar1;
  locale *plVar2;
  int *piVar3;
  uint uVar4;
  ios_base *this_00;
  undefined4 *extraout_EDX;
  undefined4 *puVar5;
  uint local_38 [2];
  int local_30;
  char local_2c;
  facet *local_28;
  int local_24;
  uint local_20;
  undefined4 *local_1c;
  void *local_18;
  undefined1 *local_14;
  void *pvStack_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00510440;
  pvStack_10 = ExceptionList;
  local_14 = &stack0xffffffbc;
  local_1c = (undefined4 *)0x0;
  ExceptionList = &pvStack_10;
  local_18 = this;
  Stream_Constructor(&local_30,(int *)this);
  local_8 = 0;
  if (local_2c != '\0') {
                    /* WARNING: Load size is inaccurate */
    plVar2 = (locale *)
             SexyWidget_ProcessInput((void *)(*(int *)(*this + 4) + (int)this),(int *)&local_20);
    local_8._0_1_ = 1;
    local_28 = LocaleFacet_ReferenceManager(plVar2);
    local_8._0_1_ = 0;
    if (local_20 != 0) {
      Threading_LockSectorByIndex(&local_24,0);
      iVar1 = *(int *)(local_20 + 4);
      if ((iVar1 != 0) && (iVar1 != -1)) {
        *(int *)(local_20 + 4) = iVar1 + -1;
      }
      puVar5 = (undefined4 *)(~-(uint)(*(int *)(local_20 + 4) != 0) & local_20);
      Threading_UnlockSectorByIndex(&local_24);
      if (puVar5 != (undefined4 *)0x0) {
        (**(code **)*puVar5)(1);
      }
    }
                    /* WARNING: Load size is inaccurate */
    local_8 = CONCAT31(local_8._1_3_,2);
    iVar1 = *(int *)(*this + 4) + (int)this;
    local_24 = CONCAT31(local_24._1_3_,*(undefined1 *)(*(int *)(*this + 4) + 0x30 + (int)this));
    local_38[0] = local_38[0] & 0xffffff00;
    (**(code **)(*(int *)local_28 + 0x1c))
              (local_38,local_38[0],*(undefined4 *)(iVar1 + 0x28),iVar1,local_24,param_1);
    if ((char)local_38[0] != '\0') {
      local_1c = (undefined4 *)0x4;
      piVar3 = (int *)Stream_ErrorHandlerCleanup();
      return piVar3;
    }
  }
                    /* WARNING: Load size is inaccurate */
  local_8 = 0;
  this_00 = (ios_base *)(*(int *)(*this + 4) + (int)this);
  puVar5 = local_1c;
  if (local_1c != (undefined4 *)0x0) {
    uVar4 = *(uint *)(this_00 + 4) | (uint)local_1c;
    if (*(int *)(this_00 + 0x28) == 0) {
      uVar4 = uVar4 | 4;
    }
    std::ios_base::clear(this_00,uVar4,false);
    puVar5 = extraout_EDX;
  }
  local_8 = 0xffffffff;
  Memory_AllocateParticleSystem(&local_30,puVar5);
  ExceptionList = pvStack_10;
  return (int *)this;
}


