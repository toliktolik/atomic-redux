/*
 * Function: Unwind@0051417d
 * Address: 0051417d
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005141d6) overlaps instruction at (ram,0x005141d4)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

int __fastcall Unwind_0051417d(int param_1,int *param_2)

{
  uint *puVar1;
  byte *pbVar2;
  undefined4 *unaff_00035e80;
  byte bVar3;
  undefined1 uVar4;
  char cVar5;
  short sVar6;
  undefined4 *in_EAX;
  int iVar7;
  undefined3 uVar11;
  undefined2 uVar12;
  undefined4 uVar10;
  undefined2 uVar13;
  byte bVar14;
  undefined4 *unaff_EBX;
  undefined4 *puVar15;
  undefined4 *puVar16;
  undefined4 *unaff_ESI;
  undefined4 *puVar17;
  undefined4 *unaff_EDI;
  undefined2 in_DS;
  bool bVar18;
  byte in_AF;
  bool bVar19;
  bool bVar20;
  undefined4 *unaff_retaddr;
  undefined4 *puVar21;
  undefined4 *puStack_4;
  uint uVar8;
  undefined4 *puVar9;
  
  bVar3 = *(byte *)((int)unaff_ESI + 0x41c8f795);
  bVar14 = (byte)unaff_EBX;
  bVar18 = bVar14 < bVar3;
  bVar20 = SBORROW1(bVar14,bVar3);
  cVar5 = bVar14 - bVar3;
  bVar19 = bVar14 == bVar3;
  puVar9 = unaff_EDI;
  if (!bVar18) goto LAB_005141f5;
  puVar21 = (undefined4 *)((int)unaff_retaddr * 2);
  in_AF = 9 < ((byte)in_EAX & 0xf) | in_AF;
  cVar5 = '\x01';
  puVar9 = (undefined4 *)register0x00000010;
  puVar16 = puVar21;
  do {
    puVar16 = puVar16 + -1;
    puVar9 = puVar9 + -1;
    *puVar9 = *puVar16;
    cVar5 = cVar5 + -1;
    puVar17 = unaff_ESI;
  } while ('\0' < cVar5);
code_r0x0051418e:
  bVar19 = false;
  unaff_ESI = puVar17 + 1;
  puVar9 = (undefined4 *)*puVar17;
  unaff_retaddr = puStack_4;
  puVar16 = (undefined4 *)register0x00000010;
code_r0x00514199:
  in_AF = 9 < ((byte)puVar9 & 0xf) | in_AF;
  bVar3 = (byte)puVar9 + in_AF * -6;
  in_EAX = (undefined4 *)
           CONCAT31((int3)((uint)puVar9 >> 8),
                    bVar3 + (0x9f < bVar3 | bVar19 | in_AF * (bVar3 < 6)) * -0x60);
  unaff_EBX = unaff_retaddr;
  unaff_EDI = (undefined4 *)((int)unaff_EDI + -1);
  do {
    out(*unaff_ESI,(short)param_2);
    *(char *)unaff_EDI = (char)in_EAX;
    uVar4 = in(0x50);
    puVar17 = (undefined4 *)((int)unaff_ESI + 3);
    iVar7 = CONCAT31((int3)((uint)in_EAX >> 8),uVar4) + -1;
    uVar11 = (undefined3)((uint)iVar7 >> 8);
    bVar3 = (char)iVar7 + 0xb3;
    _DAT_f787b54d = CONCAT31(uVar11,bVar3);
    puVar15 = (undefined4 *)*puVar16;
    out((short)param_2,_DAT_f787b54d);
    in_AF = 9 < (bVar3 & 0xf) | in_AF;
    uVar8 = CONCAT31(uVar11,bVar3 + in_AF * -6) & 0xffffff0f;
    uVar12 = (undefined2)(uVar8 >> 0x10);
    bVar3 = (byte)uVar8;
    sVar6 = CONCAT11((char)((uint)iVar7 >> 8) - in_AF,bVar3);
    puVar9 = (undefined4 *)CONCAT22(uVar12,sVar6);
    unaff_EDI = (undefined4 *)puVar16[1];
    puVar16[1] = puVar15;
    *(char *)((int)puVar15 + 0x12324de5) = '\0';
    if (SBORROW1((char)iVar7,'M') != *(char *)((int)puVar15 + 0x12324de5) < '\0')
    goto code_r0x0051418e;
    unaff_EDI = (undefined4 *)((int)unaff_EDI + 1);
    uVar13 = (undefined2)((uint)puVar21 >> 0x10);
    pbVar2 = (byte *)((int)puVar9 + (int)param_2 * 4 + 0xf);
    bVar18 = CARRY1((byte)unaff_EBX,*pbVar2);
    unaff_retaddr = (undefined4 *)(uint)(byte)((byte)unaff_EBX + *pbVar2);
    iVar7 = CONCAT22(uVar13,CONCAT11(0x5e,(char)puVar21)) + -1;
    if (iVar7 == 0) {
      *(undefined2 *)(puVar16 + 1) = *(undefined2 *)(puVar16 + 1);
      uVar10 = CONCAT22(uVar12,sVar6 + (ushort)(puVar15 < unaff_EDI) *
                                       (((ushort)unaff_EDI & 3) - (bVar3 & 3)));
      *puVar16 = uVar10;
      puVar16[-1] = uVar10;
      return (uint)(byte)-(puVar15 < unaff_EDI) << 8;
    }
    puVar21 = (undefined4 *)CONCAT22(uVar13,in_DS);
    do {
      unaff_ESI = (undefined4 *)&DAT_6bfb50b8;
      *(char *)(iVar7 + 0xf30e2db) = *(char *)(iVar7 + 0xf30e2db) + -0x1e + bVar18;
      param_2 = (int *)CONCAT31((int3)((uint)param_2 >> 8),0x1e);
      puVar16 = (undefined4 *)((int)puVar15 - *param_2);
      if ((POPCOUNT((uint)puVar16 & 0xff) & 1U) != 0) {
        puVar1 = (uint *)((int)puVar16 + -0x52a4b2a9);
        bVar19 = CARRY4(*puVar1,(uint)unaff_EDI);
        *puVar1 = *puVar1 + (int)unaff_EDI;
        goto code_r0x00514199;
      }
      param_1 = CONCAT31((int3)((uint)(iVar7 + 1) >> 8),0x97);
      bVar3 = (byte)puVar9;
      bVar18 = bVar3 < 0x53;
      bVar20 = SBORROW1(bVar3,'S');
      cVar5 = bVar3 + 0xad;
      in_EAX = (undefined4 *)CONCAT31((int3)(char)((uint)puVar9 >> 8),cVar5);
      bVar19 = cVar5 == '\0';
      unaff_00035e80 = (undefined4 *)register0x00000010;
      unaff_EBX = unaff_retaddr;
      puVar9 = unaff_EDI;
      unaff_retaddr = puVar21;
LAB_005141f5:
      register0x00000010 = (BADSPACEBASE *)unaff_00035e80;
      puVar16 = unaff_retaddr;
      unaff_EDI = puVar9;
      puVar21 = unaff_retaddr;
      if (bVar20 != cVar5 < '\0') break;
      unaff_EDI = (undefined4 *)*unaff_ESI;
      iVar7 = param_1 + -1;
      if (iVar7 == 0 || !bVar19) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      param_2 = (int *)((int)param_2 + 1);
      in_EAX = puVar9;
      unaff_EBX = unaff_retaddr;
      puVar15 = unaff_retaddr;
      unaff_ESI = unaff_ESI + 1;
    } while (!bVar18 && param_2 != (int *)0x0);
  } while( true );
}


