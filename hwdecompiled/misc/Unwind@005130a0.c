/*
 * Function: Unwind@005130a0
 * Address: 005130a0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005130ae) overlaps instruction at (ram,0x005130ac)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Type propagation algorithm not settling */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_005130a0(undefined4 param_1,undefined4 param_2)

{
  ushort *puVar1;
  int *piVar2;
  char *pcVar3;
  undefined4 uVar4;
  bool bVar5;
  code *pcVar6;
  byte bVar7;
  char cVar8;
  byte bVar9;
  uint in_EAX;
  uint uVar10;
  undefined4 uVar11;
  undefined2 uVar12;
  undefined2 *puVar13;
  int unaff_EBX;
  int iVar14;
  undefined4 *puVar15;
  undefined1 *unaff_ESI;
  undefined4 *unaff_EDI;
  bool bVar16;
  char in_AF;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  undefined4 in_FPUDataPointer;
  undefined4 in_FPUInstructionPointer;
  unkbyte10 extraout_ST0;
  unkbyte10 extraout_ST0_00;
  unkbyte10 in_ST0;
  unkbyte10 extraout_ST1;
  unkbyte10 extraout_ST1_00;
  unkbyte10 in_ST1;
  unkbyte10 in_ST2;
  unkbyte10 in_ST3;
  unkbyte10 in_ST4;
  unkbyte10 in_ST5;
  unkbyte10 in_ST6;
  unkbyte10 in_ST7;
  undefined8 uVar17;
  undefined4 *unaff_retaddr;
  
  while( true ) {
    *(char *)(unaff_EBX + -0x160f81f1) = *(char *)(unaff_EBX + -0x160f81f1) + '=';
    iVar14 = unaff_EDI[-0xb];
    puVar15 = (undefined4 *)(*(int *)((int)unaff_EDI + 0x22) * -0x37);
    uVar10 = (in_EAX ^ 0x9b) & 0xffffffa9;
    uVar12 = CONCAT11(0xb1,(char)param_2);
    param_2 = CONCAT22((short)((uint)param_2 >> 0x10),uVar12);
    uVar11 = in(uVar12);
    if (SBORROW4(uVar10,0x3a82b6b7)) {
      unaff_ESI = unaff_ESI + (int)&stack0x00000004;
    }
    else {
      *(undefined2 *)(puVar15 + -0xf18c810) = in_FPUControlWord;
      uVar11 = _DAT_43770101;
      if (SBORROW4((int)&stack0x00000004,1)) {
        pcVar3 = (char *)(iVar14 * -0x229c7b7e + 0x16d3ecff);
        *pcVar3 = (*pcVar3 + 'O') - (uVar10 < 0x3a82b6b7);
        *unaff_retaddr = param_2;
        return;
      }
    }
    iVar14 = CONCAT31((int3)((uint)unaff_EBX >> 8),0xbe) + 1;
    unaff_EDI = unaff_retaddr + 1;
    uVar4 = in(uVar12);
    *unaff_retaddr = uVar4;
    if (iVar14 < 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    bVar9 = (byte)uVar11;
    cVar8 = (char)((uint)iVar14 >> 8);
    unaff_EBX = CONCAT22((short)((uint)iVar14 >> 0x10),CONCAT11(cVar8 - bVar9,(char)iVar14));
    if ((byte)(cVar8 - bVar9) != '\0') break;
    in_EAX = CONCAT31((int3)(CONCAT22((short)((uint)uVar11 >> 0x10),CONCAT11(bVar9 / 0x82,bVar9)) >>
                            8),bVar9 % 0x82);
    unaff_retaddr = puVar15;
  }
  if ((char)bVar9 <= cVar8) {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  bVar7 = in(uVar12);
  uVar17 = CONCAT44(param_2,CONCAT31((int3)((uint)uVar11 >> 8),
                                     *(undefined1 *)(unaff_EBX + (uint)bVar7)));
  pcVar6 = (code *)swi(4);
  if (SBORROW1(cVar8,bVar9)) {
    uVar17 = (*pcVar6)();
    in_ST0 = extraout_ST0;
    in_ST1 = extraout_ST1;
  }
  pcVar6 = (code *)swi(4);
  if (SBORROW4((int)unaff_EDI,1)) {
    uVar17 = (*pcVar6)();
    in_ST0 = extraout_ST0_00;
    in_ST1 = extraout_ST1_00;
  }
  puVar13 = (undefined2 *)((ulonglong)uVar17 >> 0x20);
  *puVar13 = in_FPUControlWord;
  puVar13[2] = in_FPUStatusWord;
  puVar13[4] = in_FPUTagWord;
  *(undefined4 *)(puVar13 + 10) = in_FPUDataPointer;
  *(undefined4 *)(puVar13 + 6) = in_FPUInstructionPointer;
  puVar13[9] = in_FPULastInstructionOpcode;
  *(unkbyte10 *)(puVar13 + 0xe) = in_ST0;
  *(unkbyte10 *)(puVar13 + 0x13) = in_ST1;
  *(unkbyte10 *)(puVar13 + 0x18) = in_ST2;
  *(unkbyte10 *)(puVar13 + 0x1d) = in_ST3;
  *(unkbyte10 *)(puVar13 + 0x22) = in_ST4;
  *(unkbyte10 *)(puVar13 + 0x27) = in_ST5;
  *(unkbyte10 *)(puVar13 + 0x2c) = in_ST6;
  *(unkbyte10 *)(puVar13 + 0x31) = in_ST7;
  piVar2 = puVar15 + -0xd433157;
  iVar14 = *piVar2;
  *piVar2 = -*piVar2;
  bVar9 = (byte)puVar15;
  bVar16 = bVar9 < *(byte *)(unaff_retaddr + -0x11);
  bVar9 = bVar9 - *(byte *)(unaff_retaddr + -0x11);
  bVar5 = bVar9 < (iVar14 != 0);
  cVar8 = bVar9 - (iVar14 != 0);
  if ((!bVar16 && !bVar5) && cVar8 != '\0') {
    DAT_35434cac = cVar8 + ((cVar8 == '\0') << 6 | in_AF << 4 | ((POPCOUNT(cVar8) & 1U) == 0) << 2 |
                            2U | (bVar16 || bVar5)) * '.';
    unaff_ESI[0x65] = unaff_ESI[0x65] ^ (byte)*(undefined4 *)((int)uVar17 + 0x50);
    uVar12 = (undefined2)((ulonglong)uVar17 >> 0x20);
    out(uVar12,DAT_35434cac);
    uVar11 = in(uVar12);
    _DAT_55f22b5b = CONCAT31((int3)((uint)uVar11 >> 8),(byte)uVar11 - 0x38);
    puVar1 = (ushort *)(unaff_ESI + 0x95);
    *puVar1 = *puVar1 + (ushort)((byte)uVar11 < 0x38) *
                        (((ushort)(undefined1 *)((int)unaff_retaddr + 2) & 3) - (*puVar1 & 3));
    _DAT_dc3b0d8e = _DAT_55f22b5b;
    *(undefined1 *)((int)unaff_retaddr + 2) = unaff_ESI[4];
    pcVar6 = (code *)swi(3);
    (*pcVar6)();
    return;
  }
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


