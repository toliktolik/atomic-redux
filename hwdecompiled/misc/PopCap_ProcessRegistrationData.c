/*
 * Function: PopCap_ProcessRegistrationData
 * Address: 004affe0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Type propagation algorithm not settling */

void __fastcall PopCap_ProcessRegistrationData(void *param_1)

{
  char cVar1;
  byte bVar2;
  undefined1 uVar3;
  byte *pbVar4;
  int iVar5;
  _String_base *p_Var6;
  _String_base *p_Var7;
  undefined4 uVar8;
  char *pcVar9;
  uint extraout_ECX;
  undefined4 extraout_ECX_00;
  uint extraout_ECX_01;
  undefined4 extraout_ECX_02;
  uint uVar10;
  int extraout_ECX_03;
  int extraout_ECX_04;
  undefined4 extraout_ECX_05;
  int extraout_ECX_06;
  int extraout_ECX_07;
  int extraout_ECX_08;
  int extraout_ECX_09;
  int extraout_ECX_10;
  int extraout_ECX_11;
  int extraout_ECX_12;
  int extraout_ECX_13;
  int extraout_ECX_14;
  undefined2 extraout_DX;
  int extraout_EDX;
  int iVar11;
  int extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint extraout_EDX_07;
  uint extraout_EDX_08;
  uint extraout_EDX_09;
  uint extraout_EDX_10;
  uint extraout_EDX_11;
  uint extraout_EDX_12;
  uint extraout_EDX_13;
  uint extraout_EDX_14;
  uint extraout_EDX_15;
  char *pcVar13;
  byte *pbVar14;
  bool bVar15;
  undefined8 uVar16;
  undefined6 uVar17;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffd6c;
  undefined4 *in_stack_fffffd70;
  char acStack_195 [13];
  char local_188 [244];
  _String_base local_94 [4];
  uint local_90;
  uint local_7c;
  undefined1 local_78 [4];
  uint local_74;
  undefined4 local_64;
  uint local_60;
  _String_base local_5c [4];
  uint local_58;
  undefined4 local_48;
  uint local_44;
  ushort local_40 [2];
  int local_3c;
  int local_38;
  _String_base local_34 [4];
  uint local_30;
  undefined4 local_20;
  uint local_1c;
  undefined2 local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  undefined3 uVar12;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00516aa3;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  STL_Vector_Assign(param_1);
  if (*(char *)((int)param_1 + 0x491) == '\0') {
    *(undefined4 *)((int)param_1 + 0x678) = 0;
    *(undefined4 *)((int)param_1 + 0x67c) = 0;
    GetWindowsDirectoryA((LPSTR)((int)acStack_195 + 1),0x100);
    pcVar13 = (char *)((int)acStack_195 + 1);
    do {
      pcVar9 = pcVar13;
      pcVar13 = pcVar9 + 1;
    } while (*pcVar9 != '\0');
    if (pcVar9[-1] != '\\') {
      pcVar13 = acStack_195;
      do {
        pcVar9 = pcVar13 + 1;
        pcVar13 = pcVar13 + 1;
      } while (*pcVar9 != '\0');
      *(undefined2 *)pcVar13 = DAT_0053162c;
    }
    pcVar13 = acStack_195;
    do {
      pcVar9 = pcVar13;
      pcVar13 = pcVar9 + 1;
    } while (pcVar9[1] != '\0');
    *(undefined4 *)(pcVar9 + 1) = s_popcinfo_dat_00536ba8._0_4_;
    *(undefined4 *)(pcVar9 + 5) = s_popcinfo_dat_00536ba8._4_4_;
    *(undefined4 *)(pcVar9 + 9) = s_popcinfo_dat_00536ba8._8_4_;
    pcVar9[0xd] = s_popcinfo_dat_00536ba8[0xc];
    uVar17 = String_AllocateBuffer
                       (s_popcinfo_dat_00536ba8._8_4_,
                        (short)CONCAT31(SUB43(s_popcinfo_dat_00536ba8._0_4_,1),
                                        s_popcinfo_dat_00536ba8[0xc]));
    local_3c = (int)uVar17;
    if (local_3c != 0) {
      uVar16 = Memory_GetHeapInfo(local_40,(short)((uint6)uVar17 >> 0x20));
      uVar10 = extraout_ECX;
      while (iVar11 = (int)((ulonglong)uVar16 >> 0x20), (int)uVar16 != 0) {
        if (local_40[0] < 0x100) {
          (&stack0xfffffd6c)[local_40[0]] = 0;
          Memory_GetHeapInfo(uVar10,(short)&stack0xfffffd6c);
          if (*(uint *)((int)param_1 + 0x3c) < 0x10) {
            pbVar14 = (byte *)((int)param_1 + 0x28);
          }
          else {
            pbVar14 = *(byte **)((int)param_1 + 0x28);
          }
          pbVar4 = &stack0xfffffd6c;
          iVar11 = extraout_EDX;
          do {
            bVar2 = *pbVar4;
            uVar12 = (undefined3)((uint)iVar11 >> 8);
            iVar11 = CONCAT31(uVar12,bVar2);
            uVar10 = (uint)bVar2;
            bVar15 = bVar2 < *pbVar14;
            if (bVar2 != *pbVar14) {
LAB_004b0155:
              iVar5 = (1 - (uint)bVar15) - (uint)(bVar15 != 0);
              goto LAB_004b015a;
            }
            if (bVar2 == 0) break;
            bVar2 = pbVar4[1];
            iVar11 = CONCAT31(uVar12,bVar2);
            uVar10 = (uint)bVar2;
            bVar15 = bVar2 < pbVar14[1];
            if (bVar2 != pbVar14[1]) goto LAB_004b0155;
            pbVar4 = pbVar4 + 2;
            pbVar14 = pbVar14 + 2;
          } while (bVar2 != 0);
          iVar5 = 0;
LAB_004b015a:
          if (iVar5 == 0) {
            Memory_GetHeapInfo(&local_18,(short)iVar11);
            *(int *)((int)param_1 + 0x678) = (int)local_18;
            Memory_GetHeapInfo(extraout_ECX_02,local_18);
            uVar10 = (uint)local_18;
            *(uint *)((int)param_1 + 0x67c) = uVar10;
            iVar11 = extraout_EDX_00;
            break;
          }
        }
        Memory_DefragmentHeap((char)uVar10,iVar11);
        uVar16 = Memory_GetHeapInfo(extraout_ECX_00,extraout_DX);
        uVar10 = extraout_ECX_01;
      }
      Memory_AllocateBlock(uVar10,iVar11);
    }
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "ReferId";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"ReferId",(uint)(pcVar9 + -0x536ba0));
  p_Var7 = (_String_base *)((int)param_1 + 0x5a0);
  local_8 = 0;
  STL_Vector_Insert(param_1,local_34,p_Var7);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_03,extraout_EDX_01);
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "ReferId";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"ReferId",(uint)(pcVar9 + -0x536ba0));
  local_8 = 1;
  p_Var6 = HTTP_AddHeader(param_1,local_5c,local_34,(uint)p_Var7);
  local_8 = CONCAT31(local_8._1_3_,2);
  PowerUp_ProcessThunderstrike(p_Var7,extraout_EDX_02,p_Var6,0,0xffffffff);
  if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_04,extraout_EDX_03);
  }
  local_44 = 0xf;
  local_48 = 0;
  local_58 = local_58 & 0xffffff00;
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_30,extraout_EDX_03);
  }
  p_Var6 = Survival_LoadConfiguration
                     (local_94,(_String_base *)"http://www.popcap.com/register.php?theGame=",
                      (int)param_1 + 0x24);
  local_8 = 3;
  p_Var6 = Intel_DisplayPopulationData
                     (local_34,extraout_EDX_04,local_34,p_Var6,(_String_base *)"&referid=");
  local_8._0_1_ = 4;
  p_Var7 = Background_ProcessBackgroundLayer
                     (extraout_ECX_05,(uint)local_5c,local_5c,p_Var6,(int)p_Var7);
  local_8 = CONCAT31(local_8._1_3_,5);
  PowerUp_ProcessThunderstrike
            ((_String_base *)((int)param_1 + 0x338),extraout_EDX_05,p_Var7,0,0xffffffff);
  if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_06,extraout_EDX_06);
  }
  local_44 = 0xf;
  local_48 = 0;
  local_58 = local_58 & 0xffffff00;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_30,extraout_EDX_06);
  }
  local_1c = 0xf;
  local_20 = 0;
  uVar10 = local_30 >> 8;
  local_30 = uVar10 << 8;
  local_8 = 0xffffffff;
  if (0xf < local_7c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_06,local_90);
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = uVar10 << 8;
  pcVar13 = "RegisterLink";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"RegisterLink",(uint)(pcVar9 + -0x536b64));
  local_8 = 6;
  STL_Vector_Insert(param_1,local_34,(void *)((int)param_1 + 0x338));
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_30,extraout_EDX_07);
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "DontUpdate";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"DontUpdate",(uint)(pcVar9 + -0x536b58));
  local_8 = 7;
  uVar8 = STL_Vector_Erase(param_1,local_34,&local_38);
  local_18 = CONCAT11((char)uVar8,(undefined1)local_18);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_30,extraout_EDX_08);
  }
  if ((char)uVar8 != '\0') {
    *(bool *)((int)param_1 + 0x5fd) = local_38 != 0;
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "DownloadId";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"DownloadId",(uint)(pcVar9 + -0x536b4c));
  local_8 = 8;
  uVar8 = STL_Vector_Erase(param_1,local_34,&local_38);
  local_18 = CONCAT11((char)uVar8,(undefined1)local_18);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_07,local_30);
  }
  if ((char)uVar8 != '\0') {
    *(int *)((int)param_1 + 0x5d8) = local_38;
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "Variation";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"Variation",(uint)(pcVar9 + -0x536b40));
  local_8 = 9;
  STL_Vector_Insert(param_1,local_34,(void *)((int)param_1 + 0x5bc));
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_08,extraout_EDX_09);
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "TimesPlayed";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"TimesPlayed",(uint)(pcVar9 + -0x536b34));
  local_8 = 10;
  uVar8 = STL_Vector_Erase(param_1,local_34,&local_38);
  local_18 = CONCAT11((char)uVar8,(undefined1)local_18);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_09,extraout_EDX_10);
  }
  if ((char)uVar8 != '\0') {
    if (*(char *)((int)param_1 + 0x491) == '\0') {
      if (*(int *)((int)param_1 + 0x678) != local_38) {
        *(undefined4 *)((int)param_1 + 0x678) = 100;
      }
    }
    else {
      *(int *)((int)param_1 + 0x678) = local_38;
    }
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "TimesExecuted";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"TimesExecuted",(uint)(pcVar9 + -0x536b24));
  local_8 = 0xb;
  uVar8 = STL_Vector_Erase(param_1,local_34,&local_38);
  local_18 = CONCAT11((char)uVar8,(undefined1)local_18);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_10,local_30);
  }
  if ((char)uVar8 != '\0') {
    if (*(char *)((int)param_1 + 0x491) == '\0') {
      if (*(int *)((int)param_1 + 0x67c) != local_38) {
        *(undefined4 *)((int)param_1 + 0x67c) = 100;
      }
    }
    else {
      *(int *)((int)param_1 + 0x67c) = local_38;
    }
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "LastVerCheckQueryTime";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"LastVerCheckQueryTime",(uint)(pcVar9 + -0x536b0c));
  local_8 = 0xc;
  uVar8 = STL_Vector_Erase(param_1,local_34,&local_38);
  local_18 = CONCAT11((char)uVar8,(undefined1)local_18);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_30,extraout_EDX_11);
  }
  if ((char)uVar8 == '\0') {
    Threading_WaitInfinite();
    *(int *)((int)param_1 + 0x5f8) = local_3c;
  }
  else {
    *(int *)((int)param_1 + 0x5f8) = local_38;
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "RegName";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"RegName",(uint)(pcVar9 + -0x536b04));
  local_8 = 0xd;
  cVar1 = STL_Vector_Insert(param_1,local_34,(_String_base *)((int)param_1 + 0x63c));
  local_18 = CONCAT11(cVar1,(undefined1)local_18);
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_11,extraout_EDX_12);
  }
  if (cVar1 != '\0') {
    PowerUp_ProcessThunderstrike
              ((_String_base *)((int)param_1 + 0x620),extraout_EDX_12,
               (_String_base *)((int)param_1 + 0x63c),0,0xffffffff);
  }
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "RegCode";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"RegCode",(uint)(pcVar9 + -0x536afc));
  local_8 = 0xe;
  STL_Vector_Insert(param_1,local_34,(byte *)((int)param_1 + 0x658));
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_12,local_30);
  }
  bVar2 = Registration_EncryptAndValidateUserCode
                    ((int)param_1 + 0x63c,(byte *)((int)param_1 + 0x658));
  *(byte *)((int)param_1 + 0x674) = *(byte *)((int)param_1 + 0x674) | bVar2;
  local_1c = 0xf;
  local_20 = 0;
  local_30 = local_30 & 0xffffff00;
  pcVar13 = "RegisterLink";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_34,(_String_base *)"RegisterLink",(uint)(pcVar9 + -0x536b64));
  local_8 = 0xf;
  p_Var7 = HTTP_AddHeader(param_1,local_5c,local_34,(uint)((int)param_1 + 0x338));
  local_8 = CONCAT31(local_8._1_3_,0x10);
  PowerUp_ProcessThunderstrike
            ((_String_base *)((int)param_1 + 0x338),extraout_EDX_13,p_Var7,0,0xffffffff);
  if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_13,local_58);
  }
  local_44 = 0xf;
  local_48 = 0;
  local_58 = local_58 & 0xffffff00;
  local_8 = 0xffffffff;
  if (0xf < local_1c) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_13,extraout_EDX_14);
  }
  local_60 = 0xf;
  local_64 = 0;
  local_74 = local_74 & 0xffffff00;
  pcVar13 = "DontUpdate";
  do {
    pcVar9 = pcVar13;
    pcVar13 = pcVar9 + 1;
  } while (*pcVar9 != '\0');
  String_Assign(local_78,(_String_base *)"DontUpdate",(uint)(pcVar9 + -0x536b58));
  local_8 = 0x11;
  uVar3 = HTTP_DecodeURL(param_1,local_78,*(undefined1 *)((int)param_1 + 0x5fd));
  *(undefined1 *)((int)param_1 + 0x5fd) = uVar3;
  if (0xf < local_60) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX_14,extraout_EDX_15);
  }
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_fffffd6c,in_stack_fffffd70);
  return;
}


