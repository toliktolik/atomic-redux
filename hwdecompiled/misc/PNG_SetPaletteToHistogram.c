/*
 * Function: PNG_SetPaletteToHistogram
 * Address: 004c4700
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl PNG_SetPaletteToHistogram(int param_1,int param_2,int param_3,int param_4)

{
  char *pcVar1;
  char cVar2;
  undefined4 *puVar3;
  int iVar4;
  undefined4 *puVar5;
  void *pvVar6;
  int *piVar7;
  uint uVar8;
  uint uVar9;
  int iVar10;
  char *pcVar11;
  undefined4 *puVar12;
  int *piVar13;
  
  if (((param_1 != 0) && (param_2 != 0)) && (param_4 != 0)) {
    iVar10 = *(int *)(param_2 + 0x34);
    iVar4 = *(int *)(param_2 + 0x30) + param_4;
    if (iVar10 < iVar4) {
      puVar3 = *(undefined4 **)(param_2 + 0x38);
      if (puVar3 == (undefined4 *)0x0) {
        *(int *)(param_2 + 0x34) = param_4 + 8;
        *(undefined4 *)(param_2 + 0x30) = 0;
        pvVar6 = CPU_Instruction12(param_1,(param_4 + 8) * 0x10);
        *(void **)(param_2 + 0x38) = pvVar6;
      }
      else {
        iVar4 = iVar4 + 8;
        *(int *)(param_2 + 0x34) = iVar4;
        puVar5 = (undefined4 *)CPU_Instruction12(param_1,iVar4 * 0x10);
        uVar8 = iVar10 << 4;
        *(undefined4 **)(param_2 + 0x38) = puVar5;
        puVar12 = puVar3;
        for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 = uVar9 - 1) {
          *puVar5 = *puVar12;
          puVar12 = puVar12 + 1;
          puVar5 = puVar5 + 1;
        }
        for (iVar10 = 0; iVar10 != 0; iVar10 = iVar10 + -1) {
          *(undefined1 *)puVar5 = *(undefined1 *)puVar12;
          puVar12 = (undefined4 *)((int)puVar12 + 1);
          puVar5 = (undefined4 *)((int)puVar5 + 1);
        }
        CPU_Instruction13(param_1,uVar8,param_1,(int)puVar3);
      }
    }
    if (0 < param_4) {
      piVar13 = (int *)(param_3 + 8);
      param_1 = param_4;
      do {
        piVar7 = (int *)(*(int *)(param_2 + 0x30) * 0x10 + *(int *)(param_2 + 0x38));
        if (*piVar13 == 0) {
          *piVar13 = (int)&DAT_0052c7cf;
        }
        pcVar11 = (char *)*piVar13;
        if (*pcVar11 == '\0') {
          piVar7[3] = 0;
          *piVar7 = -1;
        }
        else {
          pcVar1 = pcVar11 + 1;
          do {
            cVar2 = *pcVar11;
            pcVar11 = pcVar11 + 1;
          } while (cVar2 != '\0');
          piVar7[3] = (int)pcVar11 - (int)pcVar1;
          *piVar7 = piVar13[-2];
        }
        piVar7[2] = *piVar13;
        piVar7[1] = piVar13[-1];
        piVar13 = piVar13 + 4;
        param_1 = param_1 + -1;
        *(int *)(param_2 + 0x30) = *(int *)(param_2 + 0x30) + 1;
      } while (param_1 != 0);
    }
  }
  return;
}


