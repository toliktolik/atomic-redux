/*
 * Function: Unwind@00516ff9
 * Address: 00516ff9
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x0051701f) overlaps instruction at (ram,0x0051701e)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00517054) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_00516ff9(uint *param_1,byte *param_2,undefined1 *param_3)

{
  char *pcVar1;
  char cVar2;
  uint uVar3;
  char cVar4;
  short sVar5;
  code *pcVar6;
  uint uVar7;
  byte *in_EAX;
  byte *pbVar8;
  uint unaff_EBX;
  int unaff_EBP;
  undefined1 *unaff_ESI;
  undefined1 *puVar9;
  uint *unaff_EDI;
  ushort in_DS;
  undefined2 in_GS;
  undefined1 in_CF;
  bool bVar10;
  bool bVar11;
  undefined2 in_FPUControlWord;
  undefined2 uVar12;
  undefined2 in_FPUStatusWord;
  undefined2 uVar13;
  undefined2 in_FPUTagWord;
  undefined2 uVar14;
  undefined2 in_FPULastInstructionOpcode;
  undefined2 uVar15;
  undefined4 in_FPUDataPointer;
  undefined4 uVar16;
  undefined4 in_FPUInstructionPointer;
  undefined4 uVar17;
  float10 in_ST0;
  float10 fVar18;
  float10 in_ST1;
  float10 fVar19;
  float10 in_ST2;
  float10 fVar20;
  float10 in_ST3;
  float10 fVar21;
  float10 in_ST4;
  float10 fVar22;
  float10 in_ST5;
  float10 fVar23;
  float10 in_ST6;
  float10 fVar24;
  float10 in_ST7;
  ushort unaff_retaddr;
  
  while( true ) {
    LOCK();
    puVar9 = *(undefined1 **)(param_2 + 0x11);
    *(undefined1 **)(param_2 + 0x11) = unaff_ESI;
    UNLOCK();
    pbVar8 = (byte *)CONCAT22((short)((uint)param_2 >> 0x10),CONCAT11(0x53,(char)param_2));
    param_2 = pbVar8;
    uVar12 = in_FPUControlWord;
    uVar13 = in_FPUStatusWord;
    uVar14 = in_FPUTagWord;
    uVar15 = in_FPULastInstructionOpcode;
    uVar16 = in_FPUDataPointer;
    uVar17 = in_FPUInstructionPointer;
    fVar18 = in_ST0;
    fVar19 = in_ST1;
    fVar20 = in_ST2;
    fVar21 = in_ST3;
    fVar22 = in_ST4;
    fVar23 = in_ST5;
    fVar24 = in_ST6;
    if (!(bool)in_CF) {
      while( true ) {
        unaff_EBX = 0xe4c50d2b;
        bVar10 = (unaff_retaddr & 0x40) != 0;
        bVar11 = (unaff_retaddr & 1) != 0;
        if (bVar10) {
          *(undefined2 *)pbVar8 = in_GS;
          pcVar6 = (code *)swi(1);
          (*pcVar6)();
          return;
        }
        param_1 = (uint *)((int)param_1 + -1);
        if (param_1 != (uint *)0x0 && bVar10) break;
        uVar3 = (uint)bVar11;
        bVar11 = CARRY4((uint)unaff_EDI,(uint)unaff_EDI);
        bVar10 = SCARRY4((int)unaff_EDI,(int)unaff_EDI);
        uVar7 = (int)unaff_EDI * 2;
        unaff_EDI = (uint *)(uVar7 + uVar3);
        unaff_EBP = (int)_DAT_be6a9e40;
        *unaff_EDI = *unaff_EDI << 0xe |
                     (uint)(CONCAT14((unaff_EDI == (uint *)0x0 ||
                                     (bVar10 != SCARRY4(uVar7,uVar3)) != (int)unaff_EDI < 0) &&
                                     (bVar11 || CARRY4(uVar7,uVar3)),*unaff_EDI) >> 0x13);
        puVar9 = param_3;
      }
      sVar5 = ((ushort)puVar9 & 3) - ((ushort)param_1 & 3);
      param_1 = (uint *)CONCAT22((short)((uint)param_1 >> 0x10),
                                 (ushort)param_1 + (ushort)bVar11 * sVar5);
      uVar12 = 0x37f;
      uVar13 = 0;
      uVar14 = 0xffff;
      uVar16 = 0;
      uVar17 = 0;
      uVar15 = 0;
      uVar3 = *param_1;
      uRamadc41f0c = in_FPUControlWord;
      uRamadc41f10 = in_FPUStatusWord;
      uRamadc41f14 = in_FPUTagWord;
      uRamadc41f18 = in_FPUInstructionPointer;
      uRamadc41f1e = in_FPULastInstructionOpcode;
      uRamadc41f20 = in_FPUDataPointer;
      fRamadc41f28 = in_ST0;
      fRamadc41f32 = in_ST1;
      fRamadc41f3c = in_ST2;
      fRamadc41f46 = in_ST3;
      fRamadc41f50 = in_ST4;
      fRamadc41f5a = in_ST5;
      fRamadc41f64 = in_ST6;
      fRamadc41f6e = in_ST7;
      *param_1 = *param_1 << 1 | (uint)((int)uVar3 < 0);
      if ((int)uVar3 >= 0 && sVar5 < 1) {
        pcVar6 = (code *)swi(1);
        (*pcVar6)();
        return;
      }
      fVar18 = (float10)*(int *)pbVar8;
      param_2 = (byte *)CONCAT31(0x58fad8,*(byte *)(unaff_EBP + -0x19) | 0xcb);
      in_EAX = pbVar8;
      fVar19 = in_ST0;
      fVar20 = in_ST1;
      fVar21 = in_ST2;
      fVar22 = in_ST3;
      fVar23 = in_ST4;
      fVar24 = in_ST5;
      in_ST7 = in_ST6;
    }
    unaff_EDI = (uint *)((uint)unaff_EDI | *param_1);
    *(uint *)((int)unaff_EDI + -0x1b) = *(uint *)((int)unaff_EDI + -0x1b) ^ unaff_EBX;
    _DAT_0a02db66 = _DAT_0a02db66 & unaff_EBX;
    bVar11 = SCARRY4(unaff_EBP,1);
    unaff_EBP = unaff_EBP + 1;
    out(0x92,in_EAX);
    if (bVar11 == unaff_EBP < 0) break;
    unaff_EBX = 0x1fa6a224;
    pbVar8 = puVar9 + 5;
    in_CF = CARRY1(*pbVar8,(byte)param_1);
    *pbVar8 = *pbVar8 + (byte)param_1;
    param_1 = (uint *)((int)param_1 + -1);
    if (param_1 == (uint *)0x0 || *pbVar8 != 0) goto code_r0x0051701c;
    in_EAX = (byte *)CONCAT31((int3)((uint)in_EAX >> 8),0x18);
    unaff_ESI = puVar9;
    in_FPUControlWord = uVar12;
    in_FPUStatusWord = uVar13;
    in_FPUTagWord = uVar14;
    in_FPULastInstructionOpcode = uVar15;
    in_FPUDataPointer = uVar16;
    in_FPUInstructionPointer = uVar17;
    in_ST0 = fVar18;
    in_ST1 = fVar19;
    in_ST2 = fVar20;
    in_ST3 = fVar21;
    in_ST4 = fVar22;
    in_ST5 = fVar23;
    in_ST6 = fVar24;
    unaff_retaddr = in_DS;
  }
  unaff_EDI = (uint *)((int)unaff_EDI + 1);
code_r0x0051701c:
  out(*puVar9,(short)param_2);
  bVar11 = (byte)unaff_EDI < *in_EAX;
  pcVar1 = puVar9 + 0x1e;
  cVar2 = *pcVar1;
  cVar4 = *pcVar1 + (char)unaff_EBX;
  *pcVar1 = cVar4 + bVar11;
  if ((SCARRY1(cVar2,(char)unaff_EBX) != SCARRY1(cVar4,bVar11)) == *pcVar1 < '\0') {
    *(double *)(param_2 + 0x44) = (double)fVar18;
    unaff_EDI[-1] = 0xf;
    unaff_EDI[-2] = (uint)(unaff_EDI + -1);
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  *(int *)(puVar9 + 1) = unaff_EBP;
  pcVar6 = (code *)swi(3);
  (*pcVar6)();
  return;
}


