/*
 * Function: Unwind@005120f0
 * Address: 005120f0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00512122) overlaps instruction at (ram,0x0051211e)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_005120f0(int param_1,uint param_2)

{
  char *pcVar1;
  uint *puVar2;
  char cVar3;
  code *pcVar4;
  byte bVar5;
  undefined4 uVar6;
  undefined4 in_EAX;
  int *piVar7;
  char extraout_CH;
  int extraout_ECX;
  int extraout_EDX;
  int unaff_EBX;
  undefined1 *puVar8;
  undefined1 *puVar9;
  int unaff_EBP;
  undefined4 *unaff_ESI;
  char *unaff_EDI;
  undefined2 in_CS;
  undefined2 uVar10;
  undefined2 in_SS;
  byte in_CF;
  bool bVar11;
  char in_PF;
  byte in_AF;
  char in_ZF;
  char in_SF;
  byte in_TF;
  byte in_IF;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  float10 in_ST0;
  int iStack_85f8;
  
  if (param_1 != 1 && in_ZF == '\0') {
    if (param_1 == 2 || in_ZF == '\0') {
      cVar3 = in((short)param_2);
      *unaff_EDI = cVar3;
      pcVar4 = (code *)swi(3);
      (*pcVar4)();
      return;
    }
    uVar6 = in(0xcc);
    *(undefined4 *)(iStack_85f8 + -4) = uVar6;
    return;
  }
  puVar2 = (uint *)segment(in_SS,(short)unaff_EBP + (short)unaff_EDI + -0x394c);
  bVar11 = (*puVar2 & 1) != 0;
  *puVar2 = *puVar2 >> 1 | (uint)in_CF << 0x1f;
  piVar7 = (int *)CONCAT22((short)((uint)in_EAX >> 0x10),
                           CONCAT11(in_SF << 7 | in_ZF << 6 | in_AF << 4 | in_PF << 2 | 2 | bVar11,
                                    (char)in_EAX));
  if (param_1 + -2 == 0) {
    *piVar7 = *piVar7 + 0x2b + (uint)bVar11;
    if (*piVar7 < 0) {
      in(0x82);
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    *(byte *)(unaff_ESI + 0x3cccf29) = *(byte *)(unaff_ESI + 0x3cccf29) & (byte)(param_2 >> 8);
    *(int *)((int)unaff_ESI + 0x318e056e) = (int)in_ST0;
    in((short)param_2);
  }
  else {
    *(uint *)(param_2 - 0x14) = *(uint *)(param_2 - 0x14) ^ param_2;
  }
  *(byte *)(unaff_EBP + 0x501614b6) =
       *(byte *)(unaff_EBP + 0x501614b6) >> ((byte)(param_1 + -2) & 0x1f);
  uVar10 = 0x2998;
  puVar8 = &DAT_8145ab1c;
  _DAT_8145ab1c = 0x512125;
  _DAT_8145ab20 = in_CS;
  func_0xc7b25d66();
  pcVar1 = (char *)(unaff_EBX + 0x68);
  *pcVar1 = *pcVar1 + '\x01';
  if (*pcVar1 < '\0') {
    if (extraout_ECX != 0) {
      *(byte *)(extraout_EDX + -0x1f585fa1) =
           *(byte *)(extraout_EDX + -0x1f585fa1) & (byte)((uint)unaff_EBX >> 8);
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    while( true ) {
      *(undefined2 *)(puVar8 + -4) = uVar10;
      uVar10 = 0x55d4;
      puVar9 = puVar8 + -8;
      *(undefined4 *)(puVar8 + -8) = 0x5121a0;
      bVar5 = func_0xdd70401b();
      if ((char)(bVar5 | 0x2a) < '\0') break;
      puVar8 = puVar9 + -4;
      *(undefined1 **)(puVar9 + -4) = puVar9;
      *(undefined4 *)unaff_EDI = *unaff_ESI;
      unaff_EDI = unaff_EDI + 5;
      in(0xf0);
      unaff_ESI = unaff_ESI + 1;
    }
    *unaff_EDI = *unaff_EDI + extraout_CH;
    bVar5 = bVar5 | 0x6f;
    *(uint *)(puVar9 + -4) =
         (uint)(in_NT & 1) * 0x4000 | (uint)(in_IF & 1) * 0x200 | (uint)(in_TF & 1) * 0x100 |
         (uint)((char)bVar5 < '\0') * 0x80 | (uint)(bVar5 == 0) * 0x40 | (uint)(in_AF & 1) * 0x10 |
         (uint)((POPCOUNT(bVar5) & 1U) == 0) * 4 | (uint)(in_ID & 1) * 0x200000 |
         (uint)(in_VIP & 1) * 0x100000 | (uint)(in_VIF & 1) * 0x80000 | (uint)(in_AC & 1) * 0x40000;
    *(undefined1 **)(puVar9 + -4) = puVar9;
    pcVar4 = (code *)swi(3);
    (*pcVar4)();
    return;
  }
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


