/*
 * Function: Unwind@005127e0
 * Address: 005127e0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00512750) overlaps instruction at (ram,0x0051274f)
    */
/* WARNING (jumptable): Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */

undefined4 __thiscall Unwind_005127e0(void *this)

{
  unkbyte10 Var1;
  undefined1 *puVar2;
  uint uVar3;
  ushort uVar4;
  byte bVar5;
  char cVar6;
  undefined3 uVar8;
  undefined4 uVar7;
  byte *in_EAX;
  code *UNRECOVERED_JUMPTABLE;
  undefined4 extraout_ECX;
  int iVar9;
  int extraout_ECX_00;
  undefined2 uVar10;
  uint uVar11;
  byte *unaff_EBX;
  uint *puVar12;
  byte *pbVar13;
  uint *unaff_ESI;
  uint *puVar14;
  uint *puVar15;
  undefined4 *puVar16;
  uint *puVar17;
  uint *unaff_EDI;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 in_SS;
  undefined2 uVar18;
  undefined2 in_GS;
  bool bVar19;
  byte bVar20;
  char cVar21;
  bool bVar22;
  undefined2 in_FPUControlWord;
  unkbyte10 extraout_ST0;
  unkbyte10 extraout_ST0_00;
  unkbyte10 in_ST0;
  undefined8 uVar23;
  uint *unaff_retaddr;
  undefined4 in_stack_0000001c;
  uint *in_stack_fffffffc;
  
  bVar20 = 0;
  if (this == (void *)0x1) {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
code_r0x0051276f:
  puVar12 = (uint *)0xdc7e07a4;
  *(undefined1 **)(unaff_EBX + 0x25b06d68) = &stack0x00000000 + *(int *)(unaff_EBX + 0x25b06d68);
  Var1 = to_bcd(in_ST0);
  *(unkbyte10 *)(in_EAX + 0x4c + (int)unaff_EDI) = Var1;
  uVar18 = SUB42(unaff_retaddr,0);
  while( true ) {
    *unaff_EBX = *unaff_EBX ^ 0x7b;
    bVar19 = false;
    UNRECOVERED_JUMPTABLE = (code *)swi(0x11);
    uVar23 = (*UNRECOVERED_JUMPTABLE)();
    UNRECOVERED_JUMPTABLE = (code *)uVar23;
    bVar22 = SCARRY4((int)&stack0x0000001c + 3,1);
    unaff_EDI = (uint *)(unaff_EBX + -0x1c0fc29a);
    if (bVar19 || &stack0x00000000 == (undefined1 *)0xffffffe0) {
      *(int *)((int)unaff_ESI + 0x1b) =
           (*(int *)((int)unaff_ESI + 0x1b) - (int)&stack0x00000020) - (uint)bVar19;
                    /* WARNING: Could not recover jumptable at 0x005127a1. Too many branches */
                    /* WARNING: Treating indirect jump as call */
      uVar7 = (*UNRECOVERED_JUMPTABLE)();
      return uVar7;
    }
    iVar9 = extraout_ECX_00;
    in_ST0 = extraout_ST0_00;
    puVar15 = unaff_EDI;
    if (&stack0x00000000 != (undefined1 *)0xffffffe0 && bVar22 == (int)&stack0x00000020 < 0) break;
    if (!bVar22) {
      puVar17 = (uint *)0x5abae77d;
      in_stack_0000001c = CONCAT22(in_stack_0000001c._2_2_,in_ES);
      uRam3eab2503 = in_FPUControlWord;
      *(byte *)((int)unaff_ESI + 0x46) = *(byte *)((int)unaff_ESI + 0x46) ^ 0xdc;
      uVar11 = CONCAT31((int3)((ulonglong)uVar23 >> 0x28),(char)((ulonglong)uVar23 >> 8));
      *(undefined2 *)(unaff_EBX + -0x16) = in_SS;
      bVar20 = 1;
      pbVar13 = (byte *)((CONCAT22((short)((ulonglong)uVar23 >> 0x10),
                                   CONCAT11((char)((ulonglong)uVar23 >> 0x20),(char)uVar23)) ^
                         uVar11) + 0xb8c07f75);
      bVar5 = *pbVar13;
      uVar4 = (ushort)bVar5 << 3;
      *pbVar13 = (byte)uVar4 | bVar5 >> 6;
      bVar19 = (uVar4 & 0x100) != 0;
      puVar15 = unaff_ESI;
      unaff_ESI = in_stack_fffffffc;
      goto code_r0x005127f7;
    }
  }
  do {
    unaff_retaddr = puVar15;
    in_stack_0000001c = (undefined4)uVar23;
    puVar16 = (undefined4 *)CONCAT22((short)((uint)unaff_EDI >> 0x10),in_GS);
    unaff_EDI = (uint *)((int)puVar16 + 5);
    *(char *)(puVar16 + 1) = (char)*unaff_ESI;
    in_EAX = (byte *)((int)puVar12 + -1);
    uVar8 = (undefined3)((uint)UNRECOVERED_JUMPTABLE >> 8);
    uVar10 = (undefined2)((ulonglong)uVar23 >> 0x20);
    if (UNRECOVERED_JUMPTABLE < (code *)*puVar16 || iVar9 + 1 == 0) {
      unaff_EBX = unaff_EBX + *(int *)(in_EAX + (int)((ulonglong)uVar23 >> 0x20));
      if ((int)unaff_EBX < 0) break;
      uVar8 = (undefined3)((uint)in_EAX >> 8);
      bVar5 = in(uVar10);
    }
    else {
      bVar5 = 0x26;
      if (SCARRY4(iVar9,1)) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
    }
    cVar6 = bVar5 - 0x27;
    in_EAX = (byte *)CONCAT31(uVar8,cVar6);
    if (bVar5 < 0x27 || cVar6 == '\0') break;
    if (cVar6 != '\0' && '&' < (char)bVar5) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    pbVar13 = unaff_EBX + 0x24;
    bVar5 = *pbVar13;
    *pbVar13 = -*pbVar13;
    if ((char)*pbVar13 < '\0') {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    unaff_EBX = unaff_EBX + -1;
    puVar2 = (undefined1 *)((int)unaff_ESI + 2);
    unaff_ESI = (uint *)((int)unaff_ESI + 3);
    out(*puVar2,uVar10);
    iVar9 = CONCAT31(uVar8,-(bVar5 != 0));
    cVar21 = SBORROW4(iVar9,1);
    cVar6 = iVar9 + -1 < 0;
    bVar19 = iVar9 == 1;
    puVar15 = (uint *)CONCAT22((short)((uint)unaff_retaddr >> 0x10),in_CS);
    in_CS = 0x816f;
    in_stack_fffffffc = (uint *)0x512749;
    uVar23 = func_0x8fb10fd0();
    UNRECOVERED_JUMPTABLE = (code *)uVar23;
    iVar9 = CONCAT31((int3)((uint)extraout_ECX >> 8),0xcd);
    if (bVar19 || cVar21 != cVar6) {
      UNRECOVERED_JUMPTABLE = (code *)swi(3);
      uVar7 = (*UNRECOVERED_JUMPTABLE)();
      return uVar7;
    }
    uVar11 = (uint)((ulonglong)uVar23 >> 0x20) & *(uint *)((int)puVar16 + 0x83);
    uVar23 = CONCAT44(uVar11,in_stack_0000001c);
    puVar12 = unaff_retaddr;
    in_ST0 = extraout_ST0;
    if (-1 < (int)uVar11) goto LAB_005127b2;
  } while( true );
  *(int *)(in_EAX + -0x6e3dba5b) = *(int *)(in_EAX + -0x6e3dba5b) << ((byte)(iVar9 + 1) & 0x1f);
  out(0xfb,(char)in_EAX);
  unaff_ESI = (uint *)((int)unaff_ESI + 1);
  goto code_r0x0051276f;
code_r0x005127f7:
  unaff_EBX = unaff_EBX + -1;
  pbVar13 = (byte *)((int)puVar12 + (-(uint)bVar19 - *(int *)((int)puVar17 + uVar11 * 2 + 0x7e)));
  puVar16 = (undefined4 *)&stack0x00009ca7;
  unaff_retaddr = (uint *)&stack0x00009ca7;
  puVar12 = (uint *)&stack0x00009ca7;
  cVar6 = '\x1e';
  do {
    pbVar13 = pbVar13 + -4;
    puVar16 = puVar16 + -1;
    *puVar16 = *(undefined4 *)pbVar13;
    cVar6 = cVar6 + -1;
  } while ('\0' < cVar6);
  cVar6 = (char)uVar11 + '$';
  UNRECOVERED_JUMPTABLE = (code *)in(0x1d);
  unaff_EDI = puVar17 + (uint)bVar20 * -2 + 1;
  puVar14 = puVar15 + (uint)bVar20 * -2 + 1;
  *puVar17 = *puVar15;
  if ((SCARRY1((char)uVar11,'$') != SCARRY1(cVar6,'\0')) == cVar6 < '\0') {
code_r0x00512818:
    UNRECOVERED_JUMPTABLE = (code *)swi(3);
    uVar7 = (*UNRECOVERED_JUMPTABLE)();
    return uVar7;
  }
  in_stack_fffffffc = unaff_ESI;
  if (((uint)UNRECOVERED_JUMPTABLE & 0x7590c0fd) != 0) {
LAB_005127b2:
    uVar11 = uVar11 - *(int *)((int)unaff_ESI + 0x5e80ff7d);
    uVar3 = *unaff_EDI;
    if (&stack0x00000000 == (undefined1 *)0xffffffe4 ||
        SCARRY4((int)&stack0x00000000,*unaff_EDI) != (int)&stack0x0000001c < 0) {
      *UNRECOVERED_JUMPTABLE = (code)~(byte)*UNRECOVERED_JUMPTABLE;
      LOCK();
      *(char *)((CONCAT22((short)((uint)UNRECOVERED_JUMPTABLE >> 0x10),
                          (ushort)(byte)((byte)UNRECOVERED_JUMPTABLE +
                                        (char)((uint)UNRECOVERED_JUMPTABLE >> 8) * -0x1b)) +
                -0x25d27ca5) - (uint)CARRY4((uint)&stack0x00000000,uVar3)) =
           (char)((uint)unaff_EBX >> 8);
      UNLOCK();
      goto code_r0x00512818;
    }
    if ((byte)((byte)*unaff_EDI & (byte)UNRECOVERED_JUMPTABLE) == 0) {
      return (int)(CONCAT44(uVar11,UNRECOVERED_JUMPTABLE) /
                  (ulonglong)*(uint *)((int)unaff_ESI + 0x71));
    }
    *(undefined2 *)((int)unaff_ESI * 2 + 0x6a) = uVar18;
    puVar12 = unaff_retaddr;
    puVar14 = unaff_ESI;
    unaff_ESI = in_stack_fffffffc;
  }
  bVar19 = false;
  puVar15 = puVar14;
  puVar17 = unaff_EDI;
  goto code_r0x005127f7;
}


