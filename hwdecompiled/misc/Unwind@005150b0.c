/*
 * Function: Unwind@005150b0
 * Address: 005150b0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005150f2) overlaps instruction at (ram,0x005150f0)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00515104) */
/* WARNING: Removing unreachable block (ram,0x00515155) */

void __fastcall Unwind_005150b0(int param_1,undefined4 param_2,undefined4 param_3,int param_4)

{
  undefined1 *puVar1;
  code *pcVar2;
  undefined1 uVar3;
  byte bVar4;
  uint uVar5;
  int iVar6;
  uint *puVar7;
  int extraout_ECX;
  int iVar8;
  int extraout_ECX_00;
  undefined2 uVar9;
  undefined4 uVar10;
  undefined4 extraout_EDX;
  undefined4 *unaff_EBX;
  int iVar11;
  int unaff_EBP;
  undefined4 *unaff_ESI;
  undefined4 *puVar12;
  undefined1 *unaff_EDI;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 in_SS;
  char cVar13;
  char cVar14;
  byte in_AF;
  char in_SF;
  char in_OF;
  undefined8 in_MM6;
  undefined8 uVar15;
  undefined4 unaff_retaddr;
  
  cVar13 = '\x01';
  if (in_OF != in_SF) {
    pcVar2 = (code *)swi(0xff);
    uVar15 = (*pcVar2)();
    uVar10 = (undefined4)((ulonglong)uVar15 >> 0x20);
    cVar13 = (char)uVar15 + 'B' + cVar13;
    iVar6 = CONCAT31((int3)((ulonglong)uVar15 >> 8),cVar13);
    iVar8 = extraout_ECX + -1;
    if (iVar8 != 0 && cVar13 != '\0') {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    *(undefined2 *)(unaff_EDI + 0x5a) = in_CS;
    if (-1 < cVar13) {
      puVar12 = unaff_ESI + 1;
      out(*unaff_ESI,(short)((ulonglong)uVar15 >> 0x20));
      uVar9 = CONCAT11(0xd3,(char)((ulonglong)uVar15 >> 0x18) >> 7);
      do {
        puVar1 = unaff_EDI + 1;
        uVar3 = in(uVar9);
        *unaff_EDI = uVar3;
        bVar4 = in(uVar9);
        in_AF = 9 < (bVar4 & 0xf) | in_AF;
        uVar5 = CONCAT31((int3)((uint)iVar6 >> 8),bVar4 + in_AF * '\x06') & 0xffffff0f;
        uVar5 = CONCAT22((short)(uVar5 >> 0x10),
                         CONCAT11((char)((uint)iVar6 >> 8) + in_AF,(char)uVar5));
        *(int *)((int)unaff_EBX + (int)puVar12) =
             *(int *)((int)unaff_EBX + (int)puVar12) + unaff_EBP;
        if (unaff_EBP + -1 == 0 || unaff_EBP < 1) {
          puVar7 = (uint *)CONCAT31((int3)(((uint)puVar12 & (uint)unaff_EBX) >> 8),
                                    *(char *)((int)unaff_EBX +
                                             ((uint)puVar12 & (uint)unaff_EBX & 0xff)) + '\x18');
          *puVar7 = *puVar7 & (uint)unaff_EBX;
                    /* WARNING: Bad instruction - Truncating control flow here */
          halt_baddata();
        }
        iVar6 = uVar5 + 0x7f98f0a4;
        puVar12 = (undefined4 *)((int)puVar12 + (uint)(uVar5 < 0x80670f5c) + uVar5 + 0x7f98f0a3);
        in_AF = 9 < ((byte)iVar6 & 0xf) | in_AF;
        iVar6 = (uint)CONCAT21((short)((uint)iVar6 >> 0x10),(char)((uint)iVar6 >> 8) + in_AF) << 8;
        iVar8 = CONCAT22((short)((uint)iVar8 >> 0x10),
                         CONCAT11((byte)((uint)iVar8 >> 8) >> ((byte)iVar8 & 0x1f),(byte)iVar8)) +
                -1;
        unaff_EBP = unaff_EBP + -1;
        unaff_EDI = puVar1;
      } while (iVar8 != 0 && puVar12 == (undefined4 *)0x0);
      uVar3 = in(uVar9);
      *puVar1 = uVar3;
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    do {
      DAT_3555a046 = cVar13;
      puVar12 = unaff_EBX;
      iVar6 = param_4;
      cVar14 = '\x01';
      in(0x3b);
      param_4 = CONCAT22((short)((uint)puVar12 >> 0x10),in_SS);
      uVar10 = in((short)uVar10);
      *puVar12 = uVar10;
      param_3 = 0x5150d4;
      uVar3 = func_0x4d7a6705();
      unaff_EBX = (undefined4 *)((int)puVar12 + 1);
      out(0x14,uVar3);
      uVar10 = extraout_EDX;
      cVar13 = DAT_3555a046;
    } while ((POPCOUNT((uint)unaff_EBX & 0xff) & 1U) == 0);
    iVar11 = CONCAT22((short)((uint)&param_3 >> 0x10),in_ES);
    iVar8 = (CONCAT31((int3)((uint)extraout_ECX_00 >> 8),
                      ((char)extraout_ECX_00 - *(char *)(extraout_ECX_00 + 0x16)) - cVar14) + 1) * 2
    ;
    bVar4 = (byte)iVar8;
    paddsw(in_MM6,*(undefined8 *)((int)puVar12 + 0x1abc3d7e));
    *(undefined4 *)(iVar11 + -4) = 0xe40a6917;
    *(uint *)(iVar11 + -8) =
         CONCAT31((int3)((uint)iVar8 >> 8),bVar4 >> (bVar4 & 7) | bVar4 << 8 - (bVar4 & 7));
    *(undefined4 *)(iVar11 + -0xc) = extraout_EDX;
    *(uint *)(iVar11 + -0x10) =
         CONCAT22((short)((uint)unaff_EBX >> 0x10),
                  CONCAT11((char)((uint)unaff_EBX >> 8) + (char)unaff_EBX,(char)unaff_EBX));
    *(int *)(iVar11 + -0x14) = iVar11;
    *(int *)(iVar11 + -0x18) = iVar6;
    *(undefined4 *)(iVar11 + -0x1c) = unaff_retaddr;
    *(undefined4 **)(iVar11 + -0x20) = puVar12 + 1;
  }
  do {
  } while( true );
}


