/*
 * Function: Resource_LoadImageWithOptions
 * Address: 004a4c20
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 Resource_LoadImageWithOptions(int param_1)

{
  char *pcVar1;
  int iVar2;
  void *this;
  char cVar3;
  undefined4 *puVar4;
  undefined4 uVar5;
  uint uVar6;
  int *piVar7;
  undefined4 uVar8;
  undefined4 uVar9;
  undefined4 *puVar10;
  int extraout_ECX;
  undefined8 uVar11;
  _String_base local_38 [4];
  uint local_34;
  uint local_20;
  undefined4 *local_1c;
  void *local_18;
  void *local_14;
  void *local_10;
  undefined4 uStack_c;
  int local_8;
  
  iVar2 = param_1;
  local_8 = 0xffffffff;
  uStack_c = 0x515b46;
  local_10 = ExceptionList;
  if (((*(int *)(param_1 + 100) != 0) || (*(int *)(param_1 + 0x80) != 0)) ||
     (pcVar1 = (char *)(param_1 + 0x88), param_1._0_1_ = '\x01', *pcVar1 == '\0')) {
    param_1._0_1_ = '\0';
  }
  ExceptionList = &local_10;
  puVar4 = (undefined4 *)Texture_SetPixelData((_String_base *)(iVar2 + 0x20),(char)param_1);
  this = local_14;
  local_8 = 0;
  local_1c = puVar4;
  if (puVar4 == (undefined4 *)0x0) {
    uVar11 = Sound_SetPosition(local_38,"Failed to load image: %s");
    local_8 = CONCAT31(local_8._1_3_,1);
    uVar5 = Sound_Release((int)local_14,(uint)((ulonglong)uVar11 >> 0x20),(_String_base *)uVar11);
    if (0xf < local_20) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,local_34);
    }
    ExceptionList = local_10;
    return uVar5;
  }
  if ((*(int *)(iVar2 + 100) != 0) &&
     (cVar3 = Music_PlayTrack(local_14,iVar2,(int)puVar4), cVar3 == '\0')) {
    local_8 = 0xffffffff;
    uVar6 = (**(code **)*puVar4)(1);
    ExceptionList = local_10;
    return uVar6 & 0xffffff00;
  }
  if ((*(int *)(iVar2 + 0x80) != 0) &&
     (cVar3 = Music_LoadTrack(this,iVar2,(int)puVar4), cVar3 == '\0')) {
    local_8 = 0xffffffff;
    uVar6 = (**(code **)*puVar4)(1);
    ExceptionList = local_10;
    return uVar6 & 0xffffff00;
  }
  local_18 = operator_new(200);
  local_8._0_1_ = 2;
  if (local_18 == (void *)0x0) {
    piVar7 = (int *)0x0;
  }
  else {
    piVar7 = Game_UpdateParticles(local_18,*(int *)(*(int *)((int)this + 0x5c) + 0x328));
  }
  local_18 = (void *)*piVar7;
  local_8 = (uint)local_8._1_3_ << 8;
  uVar5 = SexyWidget_GetHeight((int)puVar4);
  uVar8 = SexyWidget_GetWidth((int)puVar4);
  uVar9 = Graphics_SetTransform((int)puVar4);
  (**(code **)((int)local_18 + 0x5c))(uVar9,uVar8,uVar5);
  *(int **)(iVar2 + 0x4c) = piVar7;
  if ((*(char *)(iVar2 + 0x8c) != '\0') &&
     ((**(code **)(*piVar7 + 0x50))(), *(char *)((int)piVar7 + 0x32) == '\0')) {
    uVar5 = Compression_GetCompressedSize(*(int *)((int)local_14 + 0x5c));
    if ((char)uVar5 == '\0') {
      Graphics_SetTextureFilter(piVar7);
    }
    else {
      *(undefined1 *)(piVar7 + 0x15) = 1;
    }
  }
  if (*(char *)(iVar2 + 0x89) != '\0') {
    if (piVar7[0x13] == 0) {
      (**(code **)(*piVar7 + 0x70))();
    }
    else {
      *(undefined1 *)((int)piVar7 + 0x55) = 1;
    }
  }
  if (*(char *)(iVar2 + 0x8a) != '\0') {
    piVar7[9] = piVar7[9] | 4;
  }
  if (*(char *)(iVar2 + 0x8b) != '\0') {
    piVar7[9] = piVar7[9] | 8;
  }
  if (*(char *)(iVar2 + 0x8d) != '\0') {
    piVar7[9] = piVar7[9] | 1;
  }
  if (*(int *)(iVar2 + 0x98) != 0) {
    local_18 = operator_new(0x30);
    local_8 = CONCAT31(local_8._1_3_,3);
    if (local_18 == (void *)0x0) {
      puVar10 = (undefined4 *)0x0;
    }
    else {
      puVar10 = FileIO_MoveFile(local_18,(undefined4 *)(iVar2 + 0x98));
    }
    piVar7[5] = (int)puVar10;
  }
  piVar7[3] = *(int *)(iVar2 + 0x90);
  piVar7[4] = *(int *)(iVar2 + 0x94);
  local_8 = 0xffffffff;
  uVar5 = (**(code **)*puVar4)(1);
  ExceptionList = local_10;
  return CONCAT31((int3)((uint)uVar5 >> 8),1);
}


