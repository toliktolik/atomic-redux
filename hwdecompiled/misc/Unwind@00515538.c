/*
 * Function: Unwind@00515538
 * Address: 00515538
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x00515574) overlaps instruction at (ram,0x00515573)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x005155de) */
/* WARNING: Removing unreachable block (ram,0x005155df) */
/* WARNING: Removing unreachable block (ram,0x005155e9) */
/* WARNING: Removing unreachable block (ram,0x005155eb) */
/* WARNING: Removing unreachable block (ram,0x00515631) */
/* WARNING: Removing unreachable block (ram,0x005155f3) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

int __fastcall Unwind_00515538(byte *param_1,int param_2)

{
  int *piVar1;
  byte *pbVar2;
  undefined1 uVar3;
  uint uVar4;
  code *pcVar5;
  byte bVar6;
  int in_EAX;
  undefined4 uVar7;
  undefined1 *puVar8;
  uint *puVar9;
  int iVar10;
  int iVar11;
  undefined4 uVar12;
  uint *puVar13;
  uint uVar14;
  undefined1 *puVar15;
  undefined2 *puVar16;
  int unaff_EBP;
  char *unaff_ESI;
  undefined1 *unaff_EDI;
  uint *puVar18;
  undefined2 in_ES;
  undefined2 in_CS;
  byte bVar19;
  bool bVar20;
  float10 in_ST0;
  undefined8 uVar21;
  int unaff_retaddr;
  undefined2 *puVar17;
  
  *(int *)(param_2 + 0x6a) = *(int *)(param_2 + 0x6a) + 0x31;
  puVar18 = (uint *)(unaff_EDI + -1);
  uVar3 = in((short)param_2);
  *unaff_EDI = uVar3;
  *param_1 = *param_1 & 0xde;
  uVar7 = 0x9d7a7308;
  *(int *)(param_1 + -0x543b5f6a) = (int)in_ST0;
  puVar13 = (uint *)((in_EAX >> 0x1f) + 1);
  if (-1 < (int)puVar13) {
    uVar14 = in((short)puVar13);
    *puVar18 = uVar14;
    *unaff_ESI = *unaff_ESI + (char)((uint)param_1 >> 8);
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  pbVar2 = param_1 + (in_EAX >> 0x1f) + -0x56e46beb;
  bVar6 = *pbVar2;
  *pbVar2 = *pbVar2 + 8;
  uVar14 = CONCAT31((int3)((uint)(unaff_retaddr * -0x32) >> 8),
                    ((char)(unaff_retaddr * -0x32) - *param_1) - (0xf7 < bVar6)) ^ *puVar13;
  if ((int)uVar14 < 1) {
    uVar12 = *(undefined4 *)(unaff_retaddr + 1);
    puVar9 = puVar18;
    puVar15 = (undefined1 *)(unaff_retaddr + 5);
    puVar18 = puVar13;
  }
  else {
    if (param_1 != (byte *)0x1 && uVar14 != 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    while( true ) {
      bVar20 = ((uint)puVar13 & 0x400) == 0;
      uVar12 = 0x856c24d0;
      _DAT_43712afb = puVar13;
      *(undefined2 *)(unaff_retaddr + -3) = in_ES;
      puVar9 = puVar13;
      puVar15 = (undefined1 *)(unaff_retaddr + -3);
      if (bVar20) break;
      unaff_ESI = (char *)0x7a699f13;
      uVar12 = *(undefined4 *)(unaff_retaddr + -3);
      if (bVar20) {
        *(uint **)(unaff_retaddr + -3) = puVar13;
        *puVar18 = (uint)puVar13;
        return CONCAT31((int3)((uint)puVar13 >> 8),(char)puVar13 + -0x51) + 1;
      }
      uVar14 = CONCAT22((short)((uint)uVar12 >> 0x10),
                        CONCAT11((char)((uint)uVar12 >> 8) - cRam856c2513,(char)uVar12));
    }
  }
  while( true ) {
    *(uint **)(puVar15 + -4) = puVar9;
    *(undefined4 *)(puVar15 + -8) = uVar12;
    *(uint *)(puVar15 + -0xc) = uVar14;
    *(undefined4 *)(puVar15 + -0x10) = uVar7;
    *(undefined1 **)(puVar15 + -0x14) = puVar15;
    *(int *)(puVar15 + -0x18) = unaff_EBP;
    *(char **)(puVar15 + -0x1c) = unaff_ESI;
    *(uint **)(puVar15 + -0x20) = puVar18;
    puVar8 = (undefined1 *)((int)puVar9 + -0x2a777a83);
    *(uint *)(puVar15 + -0x24) = uVar14;
    out(0x58,(char)puVar8);
    bVar6 = (char)puVar8 + (char)((uint)puVar8 >> 8) * '>';
    if ((POPCOUNT((ushort)bVar6) & 1U) != 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    bVar19 = (byte)uVar12;
    if (puVar9 >= (uint *)0x2a777a83) break;
    uVar7 = CONCAT22((short)((uint)uVar7 >> 0x10),CONCAT11(0x8a,(char)uVar7));
    unaff_EBP = unaff_EBP + -1;
    if ((char)(bVar6 | 0x81) < '\0') {
      puVar9 = (uint *)(CONCAT22((short)((uint)puVar8 >> 0x10),CONCAT11(bVar19,bVar6)) | 0x81);
      puVar17 = (undefined2 *)(puVar15 + -0x28);
      *(int *)(puVar15 + -0x28) = unaff_EBP;
      puVar15 = puVar15 + -0x28;
      if (bVar19 == 0) {
        while( true ) {
          bVar19 = 0;
          *(undefined2 *)((int)puVar17 + -4) = in_CS;
          in_CS = 0x6502;
          puVar16 = (undefined2 *)((int)puVar17 + -8);
          *(undefined4 *)((int)puVar17 + -8) = 0x51562c;
          uVar21 = func_0xdeff31e8();
          pbVar2 = (byte *)((int)uVar21 + 0x5c);
          bVar6 = *pbVar2;
          *pbVar2 = *pbVar2 << 1 | bVar19;
          piVar1 = (int *)((int)puVar18 + -0x7b);
          uVar14 = (uint)((char)bVar6 < '\0');
          iVar10 = *piVar1;
          iVar11 = *piVar1;
          uVar4 = *piVar1 - 1;
          *piVar1 = uVar4 - uVar14;
          if (SBORROW4(iVar11,1) != SBORROW4(uVar4,uVar14)) {
            pcVar5 = (code *)swi(1);
            iVar10 = (*pcVar5)();
            return iVar10;
          }
          unaff_EBP = unaff_EBP + -1;
          iVar11 = CONCAT31((int3)((ulonglong)uVar21 >> 8),DAT_72bce724) + -1;
          if ((iVar10 != 0 && uVar14 <= uVar4) && iVar11 != 0) break;
          puVar17 = puVar16 + 4;
          puVar13 = (uint *)(CONCAT31((int3)((uint)uVar7 >> 8),0x66) + 0x2633f666);
          *puVar13 = *puVar13 ^ (uint)unaff_ESI;
        }
        DAT_9226020b = (undefined1)iVar11;
        out(*unaff_ESI,(short)CONCAT31((int3)((ulonglong)uVar21 >> 0x28),6));
        *puVar16 = in_ES;
        *(int *)(puVar16 + -2) = unaff_EBP;
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
    }
    else {
      puVar9 = *(uint **)(puVar15 + -0x24);
      puVar15 = puVar15 + -0x20;
    }
  }
  pbVar2 = (byte *)(unaff_EBP + -0x57 + (int)puVar18);
  bVar19 = (bVar19 & 0x1f) % 9;
  bVar6 = *pbVar2;
  *pbVar2 = bVar6 << bVar19 | (byte)(CONCAT11(puVar9 < (uint *)0x2a777a83,bVar6) >> 9 - bVar19);
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


