/*
 * Function: IO_HandleSerial
 * Address: 00505479
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x00505480) overlaps instruction at (ram,0x0050547d)
    */
/* WARNING: Control flow encountered bad instruction data */

void __fastcall IO_HandleSerial(uint param_1,undefined4 param_2)

{
  int *piVar1;
  uint *puVar2;
  uint uVar3;
  undefined4 uVar4;
  byte bVar5;
  bool bVar7;
  byte bVar8;
  char cVar9;
  ushort uVar10;
  uint *in_EAX;
  char extraout_CH;
  undefined2 uVar12;
  undefined2 uVar13;
  byte bVar15;
  byte unaff_BL;
  byte bVar16;
  undefined4 *unaff_EBP;
  char *pcVar18;
  char *unaff_ESI;
  uint *puVar19;
  undefined4 *puVar20;
  uint *unaff_EDI;
  bool bVar21;
  char in_AF;
  bool bVar22;
  undefined8 uVar23;
  undefined4 *puVar24;
  undefined4 auStack_c [2];
  undefined1 uStack_4;
  undefined3 uStack_3;
  byte bVar6;
  uint uVar11;
  byte *pbVar14;
  undefined1 *puVar17;
  
  bVar16 = 0;
  pbVar14 = (byte *)CONCAT22((short)((uint)param_2 >> 0x10),(ushort)(byte)param_2);
  if (-1 < (short)(ushort)(byte)param_2) {
    while( true ) {
      bVar15 = (byte)((uint)pbVar14 >> 8);
      if (-1 < (char)(bVar15 - *(char *)((int)unaff_EDI + 0x4d))) {
        return;
      }
      puVar19 = (uint *)((int)in_EAX + 0x16a88eef);
      puVar2 = (uint *)*puVar19;
      *puVar19 = *puVar19 - (int)unaff_EDI;
      bVar5 = *pbVar14;
      bVar6 = *pbVar14;
      uVar13 = CONCAT11(bVar15 + bVar6 + (puVar2 < unaff_EDI),(char)pbVar14);
      pbVar14 = (byte *)CONCAT22((short)((uint)pbVar14 >> 0x10),uVar13);
      pcVar18 = unaff_ESI + (uint)bVar16 * -2 + 1;
      cVar9 = *unaff_ESI;
      _uStack_4 = CONCAT31(0xffffc5,uStack_4);
      bVar8 = (byte)param_1 & 0x1f;
      unaff_ESI = (char *)((uint)pcVar18 >> bVar8);
      bVar7 = (param_1 & 0x1f) != 0;
      bVar22 = (param_1 & 0x1f) != 0;
      bVar21 = !bVar22 && (POPCOUNT((uint)&stack0x00000001 & 0xff) & 1U) == 0 ||
               bVar22 && (POPCOUNT((uint)unaff_ESI & 0xff) & 1U) == 0;
      uVar12 = (undefined2)((uint)unaff_EDI >> 0x10);
      if (bVar21) break;
      cVar9 = cVar9 + 'H';
      uVar11 = CONCAT31((int3)((uint)unaff_EDI >> 8),cVar9);
      puVar19 = (uint *)(uVar11 + 7);
      uVar3 = *puVar19;
      *puVar19 = *puVar19 - 0x27;
      puVar19 = in_EAX + (uint)bVar16 * -2 + 1;
      *in_EAX = uVar11;
      *(uint *)((int)puVar19 + 0x3b) = uVar11;
      uVar10 = (ushort)(byte)(cVar9 + (char)((uint)unaff_EDI >> 8) * -9);
      in_EAX = (uint *)CONCAT22(uVar12,uVar10);
      uVar23 = CONCAT44(pbVar14,in_EAX);
      bVar16 = 1;
      param_1 = param_1 - 1;
      if (param_1 != 0 && uVar10 != 0) {
        while( true ) {
          *puVar19 = (uint)uVar23;
          cVar9 = -0x65;
          puVar20 = (undefined4 *)((int)(puVar19 + (uint)bVar16 * -2 + 1) + (uint)bVar16 * -2 + 1);
          uVar12 = (undefined2)((ulonglong)uVar23 >> 0x20);
          if (SBORROW1((char)uVar23,(char)puVar19[(uint)bVar16 * -2 + 1])) break;
          in_EAX = puVar20 + (uint)bVar16 * -2 + 1;
          uVar4 = in(uVar12);
          *puVar20 = uVar4;
code_r0x005053fc:
          pcVar18 = (char *)((int)((ulonglong)uVar23 >> 0x20) + -0x452b2c56);
          *pcVar18 = *pcVar18 - cVar9;
          puVar19 = in_EAX;
        }
        out(uVar12,(uint)uVar23);
        *puVar20 = *(undefined4 *)unaff_ESI;
        puVar20 = auStack_c + 1;
        cVar9 = '\x19';
        do {
          unaff_EBP = unaff_EBP + -1;
          puVar20 = puVar20 + -1;
          *puVar20 = *unaff_EBP;
          cVar9 = cVar9 + -1;
        } while ('\0' < cVar9);
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      unaff_EBP[-0x305980c] = (int)unaff_EBP + (uint)(0x26 < uVar3) + unaff_EBP[-0x305980c];
      unaff_EBP = (undefined4 *)((int)unaff_EBP + -1);
      unaff_EDI = puVar19;
    }
    if (bVar8 != 1 && SCARRY4((int)&stack0x00000000,1) || bVar8 == 1 && (int)pcVar18 < 0) {
      out(*(undefined4 *)unaff_ESI,uVar13);
      unaff_ESI = (char *)0x920e7270;
      func_0x02cc399c();
      uVar23 = func_0x6d5c4184();
      cVar9 = extraout_CH;
      goto code_r0x005053fc;
    }
    piVar1 = (int *)(CONCAT22(uVar12,CONCAT11((!bVar22 && (int)&stack0x00000001 < 0 ||
                                              bVar22 && (int)unaff_ESI < 0) << 7 |
                                              (!bVar22 &&
                                               &stack0x00000000 == (undefined1 *)0xffffffff ||
                                              bVar22 && unaff_ESI == (char *)0x0) << 6 | in_AF << 4
                                              | bVar21 << 2 | 2U |
                                              (!bVar7 && (CARRY1(bVar15,bVar5) ||
                                                         CARRY1(bVar15 + bVar6,puVar2 < unaff_EDI))
                                              || bVar7 && ((uint)pcVar18 >> bVar8 - 1 & 1) != 0),
                                              cVar9)) + -0x202be9af);
    *piVar1 = *piVar1 - (int)in_EAX;
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  do {
    bVar16 = unaff_BL | (byte)*in_EAX;
    puVar17 = (undefined1 *)(uint)bVar16;
    bVar22 = bVar16 == 0;
    puVar20 = (undefined4 *)&DAT_885d005d;
    while( true ) {
      if (bVar22 || (char)bVar16 < '\0') {
        return;
      }
      unaff_BL = (byte)puVar17 & (byte)((uint)in_EAX >> 8);
      bVar22 = unaff_BL == 0;
      if ((POPCOUNT(unaff_BL) & 1U) != 0) break;
      in_EAX = (uint *)*puVar20;
      puVar17 = (undefined1 *)((int)puVar20 + -0x33d093aa);
      if (!bVar22) {
        return;
      }
      *(char *)(puVar20 + -0x6f19aed) = (char)in_EAX;
      bVar16 = 0;
      unaff_EBP = puVar24._0_1_;
      puVar20 = puVar20 + 1;
    }
    puVar19 = (uint *)((int)unaff_EBP + -0x5ba030be);
    bVar16 = (byte)param_1 & 0x1f;
    *puVar19 = *puVar19 << bVar16 | *puVar19 >> 0x20 - bVar16;
    *(int *)((int)unaff_EDI + 0x3ef23ebf) =
         *(int *)((int)unaff_EDI + 0x3ef23ebf) >> ((byte)param_1 & 0x1f);
    *in_EAX = *in_EAX | (uint)puVar20;
    in_EAX = (uint *)CONCAT22((short)((uint)in_EAX >> 0x10),
                              CONCAT11((char)((short)in_EAX % (short)*(char *)(param_1 - 0x25)),
                                       (char)((short)in_EAX / (short)*(char *)(param_1 - 0x25))));
  } while( true );
}


