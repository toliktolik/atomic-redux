/*
 * Function: Assembly_FloatingPointCalculation
 * Address: 00500e15
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00500ef4) overlaps instruction at (ram,0x00500ef1)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00500eeb) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

ushort __fastcall Assembly_FloatingPointCalculation(uint param_1,uint param_2)

{
  int *piVar1;
  byte *pbVar2;
  code *pcVar3;
  undefined1 uVar4;
  ushort uVar5;
  undefined4 in_EAX;
  uint uVar6;
  uint uVar7;
  int iVar8;
  int extraout_ECX;
  int extraout_ECX_00;
  uint extraout_ECX_01;
  uint extraout_ECX_02;
  byte bVar10;
  undefined2 extraout_DX;
  undefined4 uVar11;
  uint uVar12;
  undefined2 uVar14;
  int iVar13;
  uint uVar15;
  int unaff_EBP;
  int iVar16;
  undefined1 *unaff_ESI;
  undefined1 *puVar17;
  uint uVar18;
  uint *unaff_EDI;
  uint *puVar19;
  uint *puVar20;
  undefined2 in_CS;
  undefined2 in_SS;
  undefined2 in_DS;
  undefined2 uVar21;
  byte in_CF;
  bool bVar22;
  undefined1 uVar23;
  char in_AF;
  undefined1 uVar24;
  char in_SF;
  byte bVar25;
  char in_OF;
  byte bVar26;
  float10 in_ST0;
  float10 extraout_ST0;
  float10 extraout_ST0_00;
  float10 in_ST1;
  float10 extraout_ST1;
  float10 extraout_ST1_00;
  undefined8 uVar27;
  float10 in_ST4;
  float10 in_ST5;
  float10 in_ST6;
  float10 in_ST7;
  undefined4 in_XMM4_Da;
  undefined4 in_XMM4_Db;
  undefined4 in_XMM4_Dc;
  undefined4 in_XMM4_Dd;
  undefined8 uVar28;
  char cStack_25;
  undefined1 uStack_24;
  undefined1 uStack_23;
  undefined1 uStack_22;
  undefined4 uStack_21;
  undefined1 uStack_1d;
  undefined1 *puStack_1c;
  undefined1 *puStack_18;
  undefined1 *puStack_4;
  uint uVar9;
  
  uVar28 = CONCAT44(param_2,&stack0x00000000);
  *(char *)unaff_EDI = (char)in_EAX;
  if (param_1 == 0) {
    pcVar3 = (code *)swi(4);
    iVar16 = 0;
    in_ST4 = in_ST6;
    in_ST5 = in_ST7;
    if (in_OF == '\x01') {
      uVar28 = (*pcVar3)();
      iVar16 = extraout_ECX;
      in_ST4 = in_ST6;
      in_ST5 = in_ST7;
    }
    uVar11 = (undefined4)((ulonglong)uVar28 >> 0x20);
    iVar8 = unaff_EBP + 1;
    bVar10 = -in_CF;
    out(0xdb,bVar10);
    bVar25 = (byte)((ulonglong)uVar28 >> 8);
    *(char *)(unaff_EBP + 0x2ebf9f3c) =
         (*(char *)(unaff_EBP + 0x2ebf9f3c) + -0x1e) - CARRY1(bVar25,bVar25);
    _DAT_8c58576a = _DAT_8c58576a + (int)unaff_EDI + 1;
    puVar20 = (uint *)(unaff_ESI + -0x72);
    in_CF = 0;
    *puVar20 = *puVar20 | (uint)unaff_ESI;
    if ((int)*puVar20 < 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    uVar6 = CONCAT22((short)((ulonglong)uVar28 >> 0x10),
                     (ushort)(byte)((bVar10 ^ 0xdd) + bVar25 * 'X'));
    in_ST6 = in_ST5;
    goto code_r0x00500e4e;
  }
  uVar6 = CONCAT31((int3)((uint)in_EAX >> 8),-in_CF);
  iVar8 = unaff_EBP;
  puVar17 = unaff_ESI;
  unaff_EDI = (uint *)((int)unaff_EDI + 1);
  if (in_OF == in_SF) {
    *(char *)(param_2 + 0x37) = *(char *)(param_2 + 0x37) - (char)((uVar6 | 0x8ab869b0) >> 8);
    uVar6 = (uVar6 | 0x8ab869b0) >> 8 & 0xe50375;
    return (ushort)(byte)(((int)(uVar6 << 8) < 0) << 7 | (uVar6 == 0) << 6 | in_AF << 4) << 8 |
           0x600;
  }
  while (!(bool)in_CF) {
    out(0x34,uVar6);
    puStack_4 = (undefined1 *)0x500e4d;
    _DAT_ea073b8e = uVar6;
    uVar28 = func_0xd63dc19c();
    uVar11 = (undefined4)((ulonglong)uVar28 >> 0x20);
    unaff_ESI = puVar17 + 1;
    uVar6 = CONCAT31((int3)((ulonglong)uVar28 >> 8),*puVar17);
    iVar16 = extraout_ECX_00;
    in_ST4 = in_ST5;
    in_ST5 = in_ST6;
    in_ST6 = in_ST7;
code_r0x00500e4e:
    uVar28 = CONCAT44(uVar11,(uVar6 + 0xf0e46423) - (uint)in_CF);
    piVar1 = (int *)(iVar16 + 0x63e49898);
    uVar6 = (uint)(uVar6 < 0xf1b9bdd || uVar6 + 0xf0e46423 < (uint)in_CF);
    iVar16 = *piVar1;
    iVar13 = *piVar1;
    *piVar1 = (int)(&stack0x00000000 + iVar13 + uVar6);
    pcVar3 = (code *)swi(4);
    if (SCARRY4(iVar16,(int)&stack0x00000000) != SCARRY4((int)(&stack0x00000000 + iVar13),uVar6)) {
      uVar28 = (*pcVar3)();
    }
    in_CF = 0;
    puStack_4 = (undefined1 *)((uint)uVar28 | 0xd400);
    uStack_21._1_3_ = SUB43(unaff_EDI,0);
    uStack_1d = (undefined1)((uint)unaff_EDI >> 0x18);
    pcVar3 = (code *)swi(4);
    in_ST7 = in_ST6;
    puStack_1c = unaff_ESI;
    puStack_18 = (undefined1 *)iVar8;
    if (SBORROW4((int)((ulonglong)uVar28 >> 0x20),1)) {
      (*pcVar3)();
    }
    uStack_24 = (undefined1)in_CS;
    uStack_23 = (undefined1)((ushort)in_CS >> 8);
    in_CS = 0xf386;
    cStack_25 = 0;
    uVar28 = func_0x634401bd();
    param_2 = (uint)((ulonglong)uVar28 >> 0x20);
    uVar6 = (uint)uVar28;
    param_1 = extraout_ECX_01;
    puVar17 = unaff_ESI;
    in_DS = puStack_4._0_2_;
    in_ST0 = extraout_ST0;
    in_ST1 = extraout_ST1;
  }
  puStack_18 = (undefined1 *)&puStack_4;
  uStack_21._1_3_ = SUB43(puVar17,0);
  uStack_1d = (undefined1)((uint)puVar17 >> 0x18);
  uStack_24 = SUB41(unaff_EDI,0);
  uStack_23 = (undefined1)((uint)unaff_EDI >> 8);
  uStack_22 = (undefined1)((uint)unaff_EDI >> 0x10);
  uStack_21._0_1_ = (undefined1)((uint)unaff_EDI >> 0x18);
  out(0xbc,uVar6);
  if ((int)&uStack_24 < 1) {
    uRam4cb81076 = (undefined1)uVar6;
  }
  else {
    *(int *)(param_1 + 0xf4423c23) = (*(int *)(param_1 + 0xf4423c23) - param_1) - (uint)in_CF;
    uVar15 = 0xace06567;
    uVar6 = uVar6 + 1 & 0xffffff40;
    iVar16 = 0x2a089533;
    out(*puVar17,(short)param_2);
    bVar22 = false;
    uVar12 = param_2 | (uint)(puVar17 + 1);
    uVar6 = CONCAT31((int3)(uVar6 >> 8),(char)uVar6 + -0x4a);
    uVar9 = CONCAT13(uStack_22,CONCAT12(uStack_23,CONCAT11(uStack_24,cStack_25)));
    do {
      uVar18 = uVar9;
      cStack_25 = (char)uVar12;
      uStack_24 = (undefined1)(uVar12 >> 8);
      uStack_23 = (undefined1)(uVar12 >> 0x10);
      uStack_22 = (undefined1)(uVar12 >> 0x18);
      uVar7 = CONCAT31((int3)(uVar6 >> 8),(char)(CONCAT11(bVar22,(char)uVar6) >> 1));
      bVar22 = (uVar6 & 1) != 0;
      uVar6 = uVar7;
      uVar9 = uVar12;
    } while (param_1 == 0);
    param_1 = param_1 - 1;
    if (param_1 == 0) {
      if ((int)uVar12 < 0) {
        bVar22 = uVar7 < *unaff_EDI;
      }
      else {
        iVar16 = 0x425595e1;
        uStack_24 = (undefined1)((ushort)in_DS >> 8);
        *(longlong *)((int)unaff_EDI + -0x531f9aea) = (longlong)ROUND(in_ST0);
        in_ST0 = in_ST1;
        in_ST4 = in_ST5;
        in_ST5 = in_ST6;
      }
    }
    bVar10 = (byte)(CONCAT11(bVar22,cStack_25) >> 5) | cStack_25 << 4;
    *(uint *)(uVar7 + 0x59) = *(uint *)(uVar7 + 0x59) ^ uVar18 - 1;
    uVar21 = (undefined2)((uint6)*(undefined6 *)(iVar16 + 0x66) >> 0x20);
    puVar19 = (uint *)*(undefined6 *)(iVar16 + 0x66);
    puVar20 = puVar19 + 1;
    bVar26 = SBORROW4(uVar7,*puVar19);
    bVar25 = (int)(uVar7 - *puVar19) < 0;
    uVar24 = uVar7 == *puVar19;
    uVar23 = 1;
    uVar14 = (undefined2)(uVar12 >> 0x10);
    uVar28 = CONCAT44(CONCAT22(uVar14,CONCAT11(0x80,bVar10)),uVar7);
    puStack_1c = (undefined1 *)iVar8;
    puStack_4 = puVar17;
    if (param_1 == 0) goto LAB_00500f14_1;
    iVar8 = uVar7 + 0xc88f9dbd;
    uVar6 = *puVar20;
    iVar13 = CONCAT22(uVar14,CONCAT11(0x5c,bVar10));
    bVar10 = (byte)((uint)iVar8 >> 8);
    bVar22 = (byte)iVar8 < bVar10;
    uVar9 = CONCAT22((short)((uint)iVar8 >> 0x10),(ushort)(byte)(bVar10 * -0x26 + 0xb4));
    *puVar20 = uVar9;
    puVar20 = (uint *)0x76a2a31c;
    pbVar2 = (byte *)(uVar9 + 0x337374c);
    bVar25 = (byte)((uVar6 & 0xace06567) >> 8);
    bVar10 = *pbVar2 + bVar25;
    uVar23 = CARRY1(*pbVar2,bVar25) || CARRY1(bVar10,bVar22);
    bVar26 = SCARRY1(*pbVar2,bVar25) != SCARRY1(bVar10,bVar22);
    *pbVar2 = bVar10 + bVar22;
    bVar25 = (char)*pbVar2 < '\0';
    uVar24 = *pbVar2 == 0;
    param_1 = CONCAT31((int3)(param_1 >> 8),0x1a) - 1;
    uVar6 = uVar6 & 0xace06567;
    puStack_18 = (undefined1 *)&puStack_4;
    if (param_1 != 0 && !(bool)uVar24) {
      while( true ) {
        uVar27 = SUB108(in_ST5,0);
        uVar12 = param_1 - 1;
        if (uVar12 == 0 || (bool)uVar24 != false) break;
        if (!(bool)uVar24 && bVar26 == bVar25) {
          iVar16 = 0x7f7d88ba;
        }
        bVar10 = (byte)uVar12 & 0x1f;
        uVar15 = (int)uVar6 >> bVar10;
        uVar23 = (uVar12 & 0x1f) != 0 && ((int)uVar6 >> bVar10 - 1 & 1U) != 0;
        bVar26 = bVar10 != 1 & bVar26;
        bVar22 = (uVar12 & 0x1f) != 0;
        param_1 = param_1 - 2;
        if (param_1 != 0 && ((!bVar22 & uVar24) != 0 || bVar22 && uVar15 == 0)) {
          uVar5 = (ushort)(byte)((char)uVar9 + (char)(uVar9 >> 8) * -0x14);
          uVar9 = CONCAT22((short)(uVar9 >> 0x10),uVar5);
          bVar25 = 0;
          uVar24 = uVar5 == 0;
          uVar6 = uVar15;
        }
        else {
          puVar19 = (uint *)((int)puVar20 + -0x20bb3e03);
          uVar6 = (uint)(byte)uVar23;
          uVar9 = *puVar19 - param_1;
          uVar23 = *puVar19 < param_1 || uVar9 < uVar6;
          bVar26 = SBORROW4(*puVar19,param_1) != SBORROW4(uVar9,uVar6);
          *puVar19 = uVar9 - uVar6;
          bVar25 = (int)*puVar19 < 0;
          uVar24 = *puVar19 == 0;
          iVar8 = (uVar18 - 1) * 8;
          *(undefined4 *)(&stack0x38ab1994 + iVar8) = in_XMM4_Da;
          *(undefined4 *)(&stack0x38ab1998 + iVar8) = in_XMM4_Db;
          *(undefined4 *)(&stack0x38ab199c + iVar8) = in_XMM4_Dc;
          *(undefined4 *)(&stack0x38ab19a0 + iVar8) = in_XMM4_Dd;
          uStack_21 = 0x500f0e;
          uVar28 = func_0x0b8f8518();
          uVar27 = SUB108(in_ST4,0);
          if (!(bool)uVar24) goto code_r0x00500f8d;
          uStack_1d = (undefined1)uVar21;
          puStack_1c._0_1_ = (undefined1)((ushort)uVar21 >> 8);
          param_1 = extraout_ECX_02;
          in_ST0 = extraout_ST0_00 * extraout_ST1_00;
          if ((bool)uVar23 || (bool)uVar24) {
            in_ST0 = in_ST5;
          }
LAB_00500f14_1:
          iVar13 = (int)((ulonglong)uVar28 >> 0x20);
          uVar4 = in((short)((ulonglong)uVar28 >> 0x20));
          uVar9 = CONCAT31((int3)((ulonglong)uVar28 >> 8),uVar4);
          uVar6 = uVar15;
        }
      }
      if ((bool)uVar23 || (bool)uVar24) {
        halt_baddata();
      }
      *(short *)(CONCAT31((int3)(uVar12 >> 8),0xec) + -0x34) =
           (short)ROUND(in_ST0 + (float10)*(short *)(iVar13 + 0x3470600c));
      *(undefined4 *)(uVar9 - 4) = 0xda66ee21;
      *(undefined2 *)(iVar16 + 0x36b414bd) = *(undefined2 *)(iVar16 + 0x36b414bd);
code_r0x00500f8d:
      uStack_1d = (undefined1)in_SS;
      puStack_1c._0_1_ = (undefined1)((ushort)in_SS >> 8);
      pcVar3 = (code *)swi(0x6a);
      (*pcVar3)();
      in(extraout_DX);
      psadbw(uVar27,*(undefined8 *)(iVar16 + -0x3281f188));
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
  }
  *(uint *)(param_1 + 0xc5c82c7) = *(uint *)(param_1 + 0xc5c82c7) & param_1;
  LOCK();
  UNLOCK();
  _DAT_610a29e8 = 0x610a296d;
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


