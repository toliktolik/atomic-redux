/*
 * Function: Time_Sleep
 * Address: 004d78d0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 __cdecl Time_Sleep(int param_1,int *param_2)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  int iVar4;
  char *pcVar5;
  int iVar6;
  int aiStack_118 [64];
  int local_18;
  int local_14;
  int local_10;
  int local_c;
  int local_8;
  
  local_c = *(int *)(param_1 + 0x130);
  local_10 = *(undefined4 *)(param_1 + 0x138);
  iVar1 = *(int *)(param_1 + 0x15c);
  *(undefined4 *)(iVar1 + 0x10) = **(undefined4 **)(param_1 + 0x18);
  *(undefined4 *)(iVar1 + 0x14) = *(undefined4 *)(*(int *)(param_1 + 0x18) + 4);
  if ((*(int *)(param_1 + 0xbc) != 0) && (*(int *)(iVar1 + 0x44) == 0)) {
    Directory_ListFiles((char)*(undefined4 *)(iVar1 + 0x48));
  }
  iVar4 = *(int *)(param_1 + 300);
  iVar6 = *param_2;
  local_18 = iVar6;
  local_14 = 0;
  if (iVar4 <= local_c) {
    do {
      iVar2 = (int)*(short *)(iVar6 + (&DAT_00542c30)[iVar4] * 2);
      if (iVar2 < 0) {
        iVar2 = -iVar2;
      }
      iVar2 = iVar2 >> ((byte)local_10 & 0x1f);
      aiStack_118[iVar4] = iVar2;
      if (iVar2 == 1) {
        local_14 = iVar4;
      }
      iVar4 = iVar4 + 1;
    } while (iVar4 <= local_c);
  }
  pcVar5 = (char *)(*(int *)(iVar1 + 0x40) + *(int *)(iVar1 + 0x3c));
  local_8 = *(int *)(param_1 + 300);
  param_2 = (int *)0x0;
  if (local_8 <= local_c) {
    iVar4 = 0;
    do {
      local_10 = aiStack_118[local_8];
      if (aiStack_118[local_8] == 0) {
        param_2 = (int *)((int)param_2 + 1);
      }
      else {
        while ((0xf < (int)param_2 && (local_8 <= local_14))) {
          File_GetDirectory();
          File_GetExtension(*(int *)(iVar1 + 0x34),0xf0);
          param_2 = param_2 + -4;
          File_GetBaseName(pcVar5);
          pcVar5 = *(char **)(iVar1 + 0x40);
          iVar4 = 0;
        }
        if (local_10 < 2) {
          File_GetDirectory();
          File_GetExtension(*(int *)(iVar1 + 0x34),(int)param_2 * 0x10 + 1);
          File_CopyFile((uint)(-1 < *(short *)(local_18 + (&DAT_00542c30)[local_8] * 2)),1);
          File_GetBaseName(pcVar5);
          pcVar5 = *(char **)(iVar1 + 0x40);
          iVar4 = 0;
          param_2 = (int *)0x0;
        }
        else {
          pcVar5[iVar4] = (byte)local_10 & 1;
          iVar4 = iVar4 + 1;
        }
      }
      local_8 = local_8 + 1;
    } while (local_8 <= local_c);
    if ((0 < (int)param_2) || (iVar4 != 0)) {
      iVar6 = *(int *)(iVar1 + 0x38) + 1;
      uVar3 = *(int *)(iVar1 + 0x3c) + iVar4;
      *(int *)(iVar1 + 0x38) = iVar6;
      *(uint *)(iVar1 + 0x3c) = uVar3;
      if ((iVar6 == 0x7fff) || (0x3a9 < uVar3)) {
        File_GetDirectory();
      }
    }
  }
  **(undefined4 **)(param_1 + 0x18) = *(undefined4 *)(iVar1 + 0x10);
  iVar4 = *(int *)(param_1 + 0x18);
  *(undefined4 *)(iVar4 + 4) = *(undefined4 *)(iVar1 + 0x14);
  if (*(int *)(param_1 + 0xbc) != 0) {
    iVar4 = *(int *)(iVar1 + 0x44);
    if (iVar4 == 0) {
      *(int *)(iVar1 + 0x44) = *(int *)(param_1 + 0xbc);
      *(uint *)(iVar1 + 0x48) = *(int *)(iVar1 + 0x48) + 1U & 7;
    }
    *(int *)(iVar1 + 0x44) = *(int *)(iVar1 + 0x44) + -1;
  }
  return CONCAT31((int3)((uint)iVar4 >> 8),1);
}


