/*
 * Function: ImageFormat_SaveBMP
 * Address: 004bbf80
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Removing unreachable block (ram,0x004bc1d2) */

void __fastcall ImageFormat_SaveBMP(undefined4 param_1,double *param_2,int param_3,int param_4)

{
  int *piVar1;
  int in_EAX;
  undefined4 uVar2;
  void *pvVar3;
  int iVar4;
  uint *puVar5;
  uint uVar6;
  undefined4 extraout_ECX;
  void *extraout_ECX_00;
  void *extraout_ECX_01;
  void *extraout_ECX_02;
  int extraout_ECX_03;
  int extraout_ECX_04;
  void *extraout_ECX_05;
  uint extraout_EDX;
  int iVar7;
  bool bVar8;
  longlong lVar9;
  longlong lVar10;
  undefined8 uVar11;
  undefined4 local_54;
  undefined4 local_50;
  undefined4 local_4c;
  undefined4 local_48;
  undefined4 local_44;
  undefined4 local_40;
  undefined4 local_3c;
  undefined4 local_38;
  int local_34;
  undefined4 local_30;
  undefined4 local_2c;
  undefined4 local_28;
  undefined8 local_24;
  undefined8 local_1c;
  undefined8 local_14;
  uint *local_c;
  int local_8;
  
  local_34 = 0;
  local_30 = 0;
  local_2c = 0;
  local_28 = 0;
  uVar2 = Assembly_ComplexControlFlow
                    (*(undefined4 *)(in_EAX + 0x30),param_2,*(undefined4 *)(in_EAX + 0x30));
  *(undefined4 *)(in_EAX + 0x30) = uVar2;
  uVar2 = Assembly_ComplexControlFlow
                    (extraout_ECX,(double *)(*(int *)(in_EAX + 0x1c) << 4),
                     *(undefined4 *)(in_EAX + 0x34));
  *(undefined4 *)(in_EAX + 0x34) = uVar2;
  pvVar3 = _malloc(*(int *)(in_EAX + 0x1c) << 3);
  *(void **)(in_EAX + 0x24) = pvVar3;
  pvVar3 = _malloc(*(int *)(in_EAX + 0x1c) << 4);
  *(void **)(in_EAX + 0x2c) = pvVar3;
  local_8 = 0;
  pvVar3 = extraout_ECX_00;
  if (0 < *(int *)(in_EAX + 0x1c)) {
    do {
      iVar7 = local_8;
      if (local_8 == 0) {
        piVar1 = *(int **)(in_EAX + 0x24);
        *piVar1 = param_3;
        piVar1[1] = param_4;
        ImageFormat_LoadBMP(param_3,param_4);
        lVar10 = local_14;
      }
      else {
        ImageFormat_LoadBMP(*(int *)(*(int *)(in_EAX + 0x20) + local_8 * 8),
                            *(int *)(*(int *)(in_EAX + 0x20) + 4 + local_8 * 8));
        iVar4 = ImageFormat_LoadDDS((undefined4 *)(iVar7 * 0x20 + *(int *)(in_EAX + 0x30)),
                                    (undefined4 *)(iVar7 * 0x10 + *(int *)(in_EAX + 0x34)),
                                    (int *)0x0);
        iVar7 = local_8;
        lVar10 = local_14;
        if (iVar4 < 0) {
          iVar4 = *(int *)(in_EAX + 0x24);
          *(undefined4 *)(iVar4 + local_8 * 8) = 0xffffffff;
          *(undefined4 *)(iVar4 + 4 + local_8 * 8) = 0xffffffff;
        }
        else {
          iVar4 = *(int *)(in_EAX + 0x24);
          *(undefined4 *)(iVar4 + local_8 * 8) = *(undefined4 *)(in_EAX + 8);
          *(undefined4 *)(iVar4 + 4 + local_8 * 8) = *(undefined4 *)(in_EAX + 0xc);
        }
      }
      if ((*(uint *)(*(int *)(in_EAX + 0x24) + iVar7 * 8) &
          *(uint *)(*(int *)(in_EAX + 0x24) + 4 + iVar7 * 8)) != 0xffffffff) {
        pvVar3 = *(void **)(*(int *)(in_EAX + 0x28) + iVar7 * 4);
        local_14._0_4_ = 0;
        local_14._4_4_ = 0;
        local_c = (uint *)0xffffffff;
        CPU_InitializeWithParam(pvVar3,*(undefined4 **)(in_EAX + 0x60),pvVar3);
        local_54 = 0;
        local_50 = 0;
        local_4c = 0;
        local_48 = 0;
        local_44 = 0;
        local_40 = 0;
        local_3c = 0;
        local_38 = 0;
        lVar9 = ImageFormat_LoadJPEG(&local_34,0xffffffff,-1);
        lVar10 = CONCAT44(local_14._4_4_,(uint)local_14);
        if (-1 < lVar9) {
          do {
            iVar4 = CPU_ExecuteInstruction14();
            lVar10 = CONCAT44(local_14._4_4_,(uint)local_14);
            if (iVar4 != *(int *)(*(int *)(in_EAX + 0x28) + iVar7 * 4)) break;
            lVar10 = CPU_ExecuteInstruction6();
            local_24 = lVar10;
            CPU_ValidateAndProcess(*(int **)(in_EAX + 0x60),&local_34);
            iVar4 = CPU_ExecuteWithBufferWrapper(*(void **)(in_EAX + 0x60));
            pvVar3 = extraout_ECX_01;
            while (iVar4 != 0) {
              puVar5 = local_c;
              if (0 < iVar4) {
                puVar5 = (uint *)CPU_ProcessData10(iVar7 * 0x20 + *(int *)(in_EAX + 0x30),&local_54)
                ;
                if (local_c != (uint *)0xffffffff) {
                  uVar6 = (int)local_c + (int)puVar5 >> 2;
                  bVar8 = CARRY4((uint)local_14,uVar6);
                  local_14._0_4_ = (uint)local_14 + uVar6;
                  local_14._4_4_ =
                       local_14._4_4_ + ((int)local_c + (int)puVar5 >> 0x1f) + (uint)bVar8;
                  iVar7 = local_8;
                }
              }
              local_c = puVar5;
              iVar4 = CPU_ExecuteWithBufferWrapper(&local_54);
              pvVar3 = extraout_ECX_02;
            }
            CPU_ClearContext8(pvVar3,&local_54);
            if (local_24 != -1) {
              lVar10 = local_24 - CONCAT44(local_14._4_4_,(uint)local_14);
              break;
            }
            local_54 = 0;
            local_50 = 0;
            local_4c = 0;
            local_48 = 0;
            local_44 = 0;
            local_40 = 0;
            local_3c = 0;
            local_38 = 0;
            lVar9 = ImageFormat_LoadJPEG(&local_34,0xffffffff,-1);
            lVar10 = CONCAT44(local_14._4_4_,(uint)local_14);
          } while ((0 < (int)((ulonglong)lVar9 >> 0x20)) || (-1 < lVar9));
          local_14._4_4_ = (int)((ulonglong)lVar10 >> 0x20);
          if ((local_14._4_4_ < 1) && (lVar10 < 0)) {
            lVar10 = 0;
          }
        }
        local_14._4_4_ = (int)((ulonglong)lVar10 >> 0x20);
        local_14._0_4_ = (uint)lVar10;
        iVar4 = *(int *)(in_EAX + 0x2c);
        *(uint *)(iVar7 * 0x10 + iVar4) = (uint)local_14;
        *(int *)(iVar7 * 0x10 + 4 + iVar4) = local_14._4_4_;
      }
      local_14 = lVar10;
      ImageFormat_LoadBMP(*(int *)(*(int *)(in_EAX + 0x20) + 8 + iVar7 * 8),
                          *(int *)(*(int *)(in_EAX + 0x20) + 0xc + iVar7 * 8));
      local_1c = ImageFormat_LoadPNG(&local_34);
      iVar4 = extraout_ECX_03;
      while (-1 < local_1c) {
        do {
          lVar10 = CPU_ExecuteInstruction6();
          if (lVar10 != -1) {
            local_c = (uint *)(iVar7 * 0x10 + *(int *)(in_EAX + 0x2c));
            uVar11 = CPU_ExecuteInstruction6();
            pvVar3 = (void *)((uint)uVar11 - *local_c);
            local_c[2] = (uint)pvVar3;
            local_c[3] = ((int)((ulonglong)uVar11 >> 0x20) - local_c[1]) -
                         (uint)((uint)uVar11 < *local_c);
            goto LAB_004bc2c2;
          }
          *(undefined4 *)(in_EAX + 8) = (undefined4)local_1c;
          *(undefined4 *)(in_EAX + 0xc) = local_1c._4_4_;
          local_1c = ImageFormat_LoadPNG(&local_34);
          iVar4 = extraout_ECX_04;
        } while (0 < (int)((ulonglong)local_1c >> 0x20));
      }
      CPU_ProcessData4(iVar4,*(uint *)(in_EAX + 0x30),
                       (undefined4 *)(iVar7 * 0x20 + *(uint *)(in_EAX + 0x30)));
      iVar4 = iVar7 * 0x10 + *(int *)(in_EAX + 0x34);
      CPU_ProcessData2(iVar4,extraout_EDX,(int *)iVar4);
      pvVar3 = extraout_ECX_05;
LAB_004bc2c2:
      local_8 = iVar7 + 1;
    } while (local_8 < *(int *)(in_EAX + 0x1c));
  }
  CPU_ClearContext4(pvVar3,&local_34);
  return;
}


