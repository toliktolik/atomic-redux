/*
 * Function: Unwind@00516908
 * Address: 00516908
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x0051690e) overlaps instruction at (ram,0x0051690b)
    */
/* WARNING: Unable to track spacebase fully for stack */

uint __fastcall Unwind_00516908(int param_1)

{
  int iVar1;
  undefined1 *puVar2;
  undefined1 *puVar3;
  byte bVar4;
  byte bVar5;
  byte bVar6;
  byte bVar7;
  char cVar8;
  undefined1 uVar9;
  char cVar10;
  undefined4 in_EAX;
  uint3 uVar11;
  byte bVar12;
  byte bVar13;
  int unaff_EBX;
  int unaff_ESI;
  int unaff_EDI;
  byte in_CF;
  byte in_PF;
  byte in_AF;
  byte in_ZF;
  byte in_SF;
  byte in_TF;
  byte in_IF;
  byte in_OF;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  
  while( true ) {
    bVar4 = in_SF & 1;
    bVar5 = in_ZF & 1;
    bVar6 = in_PF & 1;
    bVar7 = in_CF & 1;
    uVar11 = (uint3)(in_NT & 1) * 0x40 | (uint3)(in_OF & 1) * 8 | (uint3)(in_IF & 1) * 2 |
             (uint3)(in_TF & 1) | (uint3)(in_ID & 1) * 0x2000 | (uint3)(in_VIP & 1) * 0x1000 |
             (uint3)(in_VIF & 1) * 0x800 | (uint3)(in_AC & 1) * 0x400;
    cVar8 = (char)in_EAX + (char)((uint)in_EAX >> 8) * '>';
    cVar10 = cVar8 + -0x60;
    if (SCARRY1(cVar8,-0x60) != cVar10 < '\0') {
      return CONCAT31((int3)((uint)in_EAX >> 8),cVar10) & 0xffff00ff | 0xb77b3db8;
    }
    *(uint *)(unaff_ESI + -0x49587d4d) = *(uint *)(unaff_ESI + -0x49587d4d) >> 3;
    LOCK();
    iVar1 = *(int *)(unaff_EDI + 0x3f586b02);
    *(int *)(unaff_EDI + 0x3f586b02) = unaff_EBX;
    UNLOCK();
    puVar3 = (undefined1 *)(unaff_EDI + 4);
    puVar2 = (undefined1 *)(unaff_ESI + 4);
    unaff_EDI = unaff_EDI + 5;
    unaff_ESI = unaff_ESI + 5;
    *puVar3 = *puVar2;
    bVar13 = (byte)iVar1;
    unaff_EBX = CONCAT22((short)((uint)iVar1 >> 0x10),(ushort)bVar13);
    bVar12 = (byte)((uint)((int)puVar2 * -0x6c99b557) >> 8);
    in_CF = CARRY1(bVar12,bVar13);
    in_OF = SCARRY1(bVar12,bVar13);
    cVar8 = bVar12 + bVar13;
    in_SF = cVar8 < '\0';
    in_ZF = cVar8 == '\0';
    in_PF = (POPCOUNT(cVar8) & 1U) == 0;
    param_1 = param_1 + -1;
    if (param_1 == 0 || (bool)in_ZF) break;
    uVar9 = in(0xbf);
    in_EAX = CONCAT31(uVar11,uVar9);
  }
  return CONCAT31(uVar11,*(undefined1 *)
                          (unaff_EBX +
                          ((uint)bVar4 * 0x80 | (uint)bVar5 * 0x40 | (uint)(in_AF & 1) * 0x10 |
                           (uint)bVar6 * 4 | (uint)bVar7)));
}


