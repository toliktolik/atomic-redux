/*
 * Function: CPU_Instruction38
 * Address: 004c91b0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CPU_Instruction38(uint param_1,byte *param_2,uint param_3,int param_4,uint param_5)

{
  uint uVar1;
  int iVar2;
  uint extraout_ECX;
  undefined4 uVar3;
  undefined4 extraout_ECX_00;
  undefined4 extraout_ECX_01;
  uint extraout_ECX_02;
  undefined4 extraout_ECX_03;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  byte *extraout_EDX_03;
  byte *extraout_EDX_04;
  byte local_8 [4];
  
  uVar1 = *(uint *)(param_3 + 0x68);
  local_8[0] = 0;
  local_8[1] = 0;
  local_8[2] = 0;
  local_8[3] = 0;
  if ((uVar1 & 1) == 0) {
    CPU_Instruction20(param_1,param_2,param_3,"Missing IHDR before sBIT");
    param_1 = extraout_ECX;
    param_2 = extraout_EDX;
  }
  else {
    if ((uVar1 & 4) != 0) {
      CPU_Instruction21(param_1,param_2,param_3,"Invalid sBIT after IDAT");
      CPU_Instruction33(extraout_ECX_01,extraout_EDX_01,param_3,param_5);
      return;
    }
    if ((uVar1 & 2) == 0) {
      if ((param_4 != 0) && ((*(byte *)(param_4 + 8) & 2) != 0)) {
        CPU_Instruction21(param_1,param_2,param_3,"Duplicate sBIT chunk");
        CPU_Instruction33(param_5,extraout_EDX_03,param_3,param_5);
        return;
      }
    }
    else {
      CPU_Instruction21(param_1,param_2,param_3,"Out of place sBIT chunk");
      param_1 = extraout_ECX_02;
      param_2 = extraout_EDX_02;
    }
  }
  uVar3 = CONCAT31((int3)(param_1 >> 8),*(char *)(param_3 + 0x126));
  uVar1 = 3;
  if (*(char *)(param_3 + 0x126) != '\x03') {
    uVar1 = (uint)*(byte *)(param_3 + 0x12a);
  }
  if (param_5 == uVar1) {
    CPU_Instruction26(uVar3,local_8,param_3,local_8,uVar1);
    iVar2 = CPU_Instruction33(extraout_ECX_03,extraout_EDX_04,param_3,0);
    if (iVar2 == 0) {
      *(byte *)(param_3 + 0x17c) = local_8[0];
      if ((*(byte *)(param_3 + 0x126) & 2) == 0) {
        *(byte *)(param_3 + 0x17f) = local_8[0];
        *(byte *)(param_3 + 0x17d) = local_8[0];
        *(byte *)(param_3 + 0x17e) = local_8[0];
        *(byte *)(param_3 + 0x180) = local_8[1];
      }
      else {
        *(byte *)(param_3 + 0x17d) = local_8[1];
        *(byte *)(param_3 + 0x17e) = local_8[2];
        *(byte *)(param_3 + 0x180) = local_8[3];
      }
      PNG_SetModificationTime(param_3,param_4,(undefined4 *)(param_3 + 0x17c));
    }
    return;
  }
  CPU_Instruction21(uVar3,param_2,param_3,"Incorrect sBIT chunk length");
  CPU_Instruction33(extraout_ECX_00,extraout_EDX_00,param_3,param_5);
  return;
}


