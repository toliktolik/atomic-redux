/*
 * Function: Unwind@00516f90
 * Address: 00516f90
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00517054) overlaps instruction at (ram,0x00517050)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00517054) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_00516f90(int param_1,byte *param_2)

{
  byte bVar1;
  char cVar2;
  undefined1 *puVar3;
  uint uVar4;
  char cVar5;
  short sVar6;
  code *pcVar7;
  uint uVar8;
  byte *in_EAX;
  byte bVar9;
  uint *puVar10;
  undefined2 uVar11;
  byte *pbVar12;
  uint unaff_EBX;
  int unaff_EBP;
  undefined1 *unaff_ESI;
  char *pcVar13;
  uint *unaff_EDI;
  undefined2 in_DS;
  undefined2 in_GS;
  char in_ZF;
  bool bVar14;
  bool bVar15;
  bool bVar16;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  undefined4 in_FPUDataPointer;
  undefined4 in_FPUInstructionPointer;
  float10 in_ST0;
  float10 in_ST1;
  float10 in_ST2;
  float10 in_ST3;
  float10 in_ST4;
  float10 in_ST5;
  float10 in_ST6;
  float10 fVar17;
  float10 in_ST7;
  uint uStack_8;
  undefined1 *puStack_4;
  
  bVar15 = false;
  puStack_4 = (undefined1 *)CONCAT22(puStack_4._2_2_,in_DS);
  puVar10 = (uint *)(param_1 + -1);
  if (puVar10 == (uint *)0x0) {
    if (in_ZF != '\0') {
      do {
                    /* WARNING: Do nothing block with infinite loop */
      } while( true );
    }
    pcVar13 = unaff_ESI + 1;
    *pcVar13 = (*pcVar13 + -0x51) - (&puStack_4 < unaff_EDI);
    uVar11 = CONCAT11((byte)((uint)param_2 >> 8) & *(byte *)(unaff_EBX + 0x5dd7870b),(char)param_2);
    out(*pcVar13,uVar11);
    *(int *)(unaff_EBX + 0xeaf58f45) =
         *(int *)(unaff_EBX + 0xeaf58f45) - CONCAT22((short)((uint)param_2 >> 0x10),uVar11);
    *(char *)((int)unaff_EDI + 0x16b5707d) = *(char *)((int)unaff_EDI + 0x16b5707d) + '\x01';
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  while( true ) {
    fVar17 = in_ST6;
    in_ST6 = in_ST5;
    in_ST5 = in_ST4;
    in_ST4 = in_ST3;
    in_ST3 = in_ST2;
    in_ST2 = in_ST1;
    in_ST1 = in_ST0;
    *(uint *)((int)unaff_EDI + -0x1b) = *(uint *)((int)unaff_EDI + -0x1b) ^ unaff_EBX;
    _DAT_0a02db66 = _DAT_0a02db66 & unaff_EBX;
    bVar16 = SCARRY4(unaff_EBP,1);
    unaff_EBP = unaff_EBP + 1;
    out(0x92,in_EAX);
    if (bVar16 == unaff_EBP < 0) break;
    unaff_EBX = 0x1fa6a224;
    pbVar12 = unaff_ESI + 5;
    bVar1 = *pbVar12;
    bVar9 = (byte)puVar10;
    *pbVar12 = *pbVar12 + bVar9;
    puVar10 = (uint *)((int)puVar10 + -1);
    if (puVar10 == (uint *)0x0 || *pbVar12 != 0) goto code_r0x0051701c;
    puStack_4 = (undefined1 *)CONCAT22(puStack_4._2_2_,in_DS);
    LOCK();
    puVar3 = *(undefined1 **)(param_2 + 0x11);
    *(undefined1 **)(param_2 + 0x11) = unaff_ESI;
    UNLOCK();
    pbVar12 = (byte *)CONCAT22((short)((uint)param_2 >> 0x10),CONCAT11(0x53,(char)param_2));
    unaff_ESI = puVar3;
    if (CARRY1(bVar1,bVar9)) {
      unaff_EDI = (uint *)((uint)unaff_EDI | *puVar10);
      bVar15 = false;
      in_EAX = (byte *)CONCAT31((int3)((uint)in_EAX >> 8),0x18);
      param_2 = pbVar12;
      in_ST0 = in_ST1;
      in_ST1 = in_ST2;
      in_ST2 = in_ST3;
      in_ST3 = in_ST4;
      in_ST4 = in_ST5;
      in_ST5 = in_ST6;
      in_ST6 = fVar17;
    }
    else {
      while( true ) {
        unaff_EBX = 0xe4c50d2b;
        bVar15 = (uStack_8 & 0x400) != 0;
        bVar14 = (uStack_8 & 0x40) != 0;
        bVar16 = (uStack_8 & 1) != 0;
        if (bVar14) {
          *(undefined2 *)pbVar12 = in_GS;
          pcVar7 = (code *)swi(1);
          (*pcVar7)();
          return;
        }
        puVar10 = (uint *)((int)puVar10 + -1);
        if (puVar10 != (uint *)0x0 && bVar14) break;
        uVar4 = (uint)bVar16;
        bVar15 = CARRY4((uint)unaff_EDI,(uint)unaff_EDI);
        bVar16 = SCARRY4((int)unaff_EDI,(int)unaff_EDI);
        uVar8 = (int)unaff_EDI * 2;
        unaff_EDI = (uint *)(uVar8 + uVar4);
        unaff_EBP = (int)_DAT_be6a9e40;
        *unaff_EDI = *unaff_EDI << 0xe |
                     (uint)(CONCAT14((unaff_EDI == (uint *)0x0 ||
                                     (bVar16 != SCARRY4(uVar8,uVar4)) != (int)unaff_EDI < 0) &&
                                     (bVar15 || CARRY4(uVar8,uVar4)),*unaff_EDI) >> 0x13);
        unaff_ESI = puStack_4;
      }
      sVar6 = ((ushort)unaff_ESI & 3) - ((ushort)puVar10 & 3);
      puVar10 = (uint *)CONCAT22((short)((uint)puVar10 >> 0x10),
                                 (ushort)puVar10 + (ushort)bVar16 * sVar6);
      uVar4 = *puVar10;
      uRamadc41f0c = in_FPUControlWord;
      uRamadc41f10 = in_FPUStatusWord;
      uRamadc41f14 = in_FPUTagWord;
      uRamadc41f18 = in_FPUInstructionPointer;
      uRamadc41f1e = in_FPULastInstructionOpcode;
      uRamadc41f20 = in_FPUDataPointer;
      fRamadc41f28 = in_ST1;
      fRamadc41f32 = in_ST2;
      fRamadc41f3c = in_ST3;
      fRamadc41f46 = in_ST4;
      fRamadc41f50 = in_ST5;
      fRamadc41f5a = in_ST6;
      fRamadc41f64 = fVar17;
      fRamadc41f6e = in_ST7;
      *puVar10 = *puVar10 << 1 | (uint)((int)uVar4 < 0);
      if ((int)uVar4 >= 0 && sVar6 < 1) {
        pcVar7 = (code *)swi(1);
        (*pcVar7)();
        return;
      }
      param_2 = (byte *)CONCAT31(0x58fad8,*(byte *)(unaff_EBP + -0x19) | 0xcb);
      in_EAX = pbVar12;
      in_FPUControlWord = 0x37f;
      in_FPUStatusWord = 0;
      in_FPUTagWord = 0xffff;
      in_FPULastInstructionOpcode = 0;
      in_FPUDataPointer = 0;
      in_FPUInstructionPointer = 0;
      in_ST0 = (float10)*(int *)pbVar12;
      in_ST7 = fVar17;
    }
  }
  unaff_EDI = (uint *)((int)unaff_EDI + (uint)bVar15 * -2 + 1);
code_r0x0051701c:
  out(*unaff_ESI,(short)param_2);
  bVar16 = (byte)unaff_EDI < *in_EAX;
  pcVar13 = (char *)((int)(unaff_ESI + (uint)bVar15 * -2 + 1) + 0x1d);
  cVar2 = *pcVar13;
  cVar5 = *pcVar13 + (char)unaff_EBX;
  *pcVar13 = cVar5 + bVar16;
  if ((SCARRY1(cVar2,(char)unaff_EBX) != SCARRY1(cVar5,bVar16)) == *pcVar13 < '\0') {
    *(double *)(param_2 + 0x44) = (double)in_ST1;
    unaff_EDI[-1] = 0xf;
    unaff_EDI[-2] = (uint)(unaff_EDI + -1);
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  *(int *)(unaff_ESI + (uint)bVar15 * -2 + 1) = unaff_EBP;
  pcVar7 = (code *)swi(3);
  (*pcVar7)();
  return;
}


