/*
 * Function: String_Replace
 * Address: 004d6450
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __cdecl String_Replace(int *param_1,char param_2,int param_3,int *param_4)

{
  byte bVar1;
  int iVar2;
  char *pcVar3;
  uint uVar4;
  char cVar5;
  int iVar6;
  undefined4 *puVar7;
  uint uVar8;
  int *piVar9;
  int iVar10;
  undefined4 *puVar11;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffae8;
  undefined4 *in_stack_fffffaec;
  char local_114 [260];
  int local_10;
  int local_c;
  uint local_8;
  
  iVar2 = param_3;
  local_8 = DAT_00569f5c ^ unaff_retaddr;
  if ((param_3 < 0) || (3 < param_3)) {
    *(undefined4 *)(*param_1 + 0x14) = 0x32;
    *(int *)(*param_1 + 0x18) = param_3;
    (**(code **)*param_1)(param_1);
  }
  if (param_2 == '\0') {
    param_3 = param_1[param_3 + 0x1a];
  }
  else {
    param_3 = param_1[param_3 + 0x16];
  }
  if (param_3 == 0) {
    *(undefined4 *)(*param_1 + 0x14) = 0x32;
    *(int *)(*param_1 + 0x18) = iVar2;
    (**(code **)*param_1)(param_1);
  }
  if (*param_4 == 0) {
    iVar2 = (**(code **)param_1[1])(param_1,1,0x500);
    *param_4 = iVar2;
  }
  local_c = *param_4;
  param_4 = (int *)0x0;
  local_10 = 1;
  piVar9 = (int *)0x0;
  do {
    iVar2 = local_10;
    bVar1 = *(byte *)(local_10 + param_3);
    uVar8 = (uint)bVar1;
    if (0x100 < (int)(uVar8 + (int)piVar9)) {
      *(undefined4 *)(*param_1 + 0x14) = 8;
      (**(code **)*param_1)(param_1);
    }
    if (uVar8 != 0) {
      cVar5 = (char)iVar2;
      pcVar3 = local_114 + (int)piVar9;
      for (uVar4 = (uint)(bVar1 >> 2); uVar4 != 0; uVar4 = uVar4 - 1) {
        *(uint *)pcVar3 = CONCAT22(CONCAT11(cVar5,cVar5),CONCAT11(cVar5,cVar5));
        pcVar3 = pcVar3 + 4;
      }
      for (uVar4 = uVar8 & 3; uVar4 != 0; uVar4 = uVar4 - 1) {
        *pcVar3 = cVar5;
        pcVar3 = pcVar3 + 1;
      }
      piVar9 = (int *)((int)param_4 + uVar8);
      iVar2 = local_10;
      param_4 = piVar9;
    }
    local_10 = iVar2 + 1;
  } while (iVar2 + 1 < 0x11);
  local_114[(int)piVar9] = '\0';
  iVar10 = 0;
  iVar2 = 0;
  iVar6 = (int)local_114[0];
  if (local_114[0] != '\0') {
    pcVar3 = local_114;
    do {
      cVar5 = *pcVar3;
      while (cVar5 == iVar6) {
        cVar5 = local_114[iVar2 + 1];
        *(int *)(&stack0xfffffae8 + iVar2 * 4) = iVar10;
        iVar2 = iVar2 + 1;
        iVar10 = iVar10 + 1;
      }
      if (1 << ((byte)iVar6 & 0x1f) <= iVar10) {
        *(undefined4 *)(*param_1 + 0x14) = 8;
        (**(code **)*param_1)(param_1);
      }
      pcVar3 = local_114 + iVar2;
      iVar10 = iVar10 << 1;
      iVar6 = iVar6 + 1;
    } while (local_114[iVar2] != '\0');
  }
  puVar7 = (undefined4 *)(local_c + 0x400);
  puVar11 = puVar7;
  for (iVar2 = 0x40; iVar2 != 0; iVar2 = iVar2 + -1) {
    *puVar11 = 0;
    puVar11 = puVar11 + 1;
  }
  iVar2 = 0;
  if (0 < (int)piVar9) {
    do {
      uVar8 = (uint)*(byte *)(param_3 + 0x11 + iVar2);
      if (((int)((-(uint)(param_2 != '\0') & 0xffffff10) + 0xff) < (int)uVar8) ||
         (*(char *)((int)puVar7 + uVar8) != '\0')) {
        *(undefined4 *)(*param_1 + 0x14) = 8;
        (**(code **)*param_1)(param_1);
      }
      cVar5 = local_114[iVar2];
      *(undefined4 *)(local_c + uVar8 * 4) = *(undefined4 *)(&stack0xfffffae8 + iVar2 * 4);
      iVar2 = iVar2 + 1;
      *(char *)((int)puVar7 + uVar8) = cVar5;
    } while (iVar2 < (int)piVar9);
  }
  Exception_SetMessage((void *)(local_8 ^ unaff_retaddr),in_stack_fffffae8,in_stack_fffffaec);
  return;
}


