/*
 * Function: ImageFormat_LoadTGA
 * Address: 004bbbb0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Removing unreachable block (ram,0x004bbcd6) */

undefined4 __cdecl
ImageFormat_LoadTGA(int param_1,undefined4 param_2,undefined4 param_3,void *param_4,int param_5,
                   void *param_6,int param_7,int param_8,int param_9)

{
  int iVar1;
  void *pvVar2;
  int iVar3;
  void *this;
  void *pvVar4;
  int iVar5;
  bool bVar6;
  longlong lVar7;
  longlong lVar8;
  undefined4 local_2c;
  uint local_28;
  undefined4 local_24;
  uint local_20;
  void *local_1c;
  void *local_14;
  int local_10;
  undefined8 local_c;
  
  local_14 = param_6;
  local_10 = param_7;
  local_2c = 0;
  local_28 = 0;
  local_24 = 0;
  local_20 = 0;
  pvVar4 = param_4;
  iVar5 = param_5;
  local_c = CONCAT44(param_7,param_6);
  if ((param_5 <= param_7) &&
     ((lVar8 = CONCAT44(param_7,param_6), param_5 < param_7 ||
      (local_c = CONCAT44(param_7,param_6), lVar8 = CONCAT44(param_7,param_6), param_4 < param_6))))
  {
    do {
      local_c._4_4_ = (int)((ulonglong)lVar8 >> 0x20);
      local_c._0_4_ = (void *)lVar8;
      bVar6 = -1 < (int)((local_c._4_4_ - iVar5) - (uint)((void *)local_c < pvVar4));
      if ((local_c._4_4_ - iVar5 != (uint)((void *)local_c < pvVar4) && bVar6) ||
         ((lVar7 = CONCAT44(iVar5,pvVar4), bVar6 &&
          (lVar7 = CONCAT44(iVar5,pvVar4), 0x3ff < (uint)((int)(void *)local_c - (int)pvVar4))))) {
        local_c = lVar8;
        lVar7 = System_ExitProcess();
        lVar8 = local_c;
      }
      param_5 = (int)((ulonglong)lVar7 >> 0x20);
      param_4 = (void *)lVar7;
      local_c = lVar8;
      ImageFormat_LoadBMP((int)param_4,param_5);
      lVar8 = ImageFormat_LoadJPEG(&local_2c,0xffffffff,-1);
      iVar3 = (int)((ulonglong)lVar8 >> 0x20);
      local_1c = (void *)lVar8;
      if (lVar8 == -0x80) {
        return 0xffffff80;
      }
      if (lVar8 < 0) {
LAB_004bbca1:
        if (-1 < lVar8) {
          local_14 = local_1c;
          local_10 = iVar3;
        }
      }
      else {
        iVar1 = CPU_ExecuteInstruction14();
        if (iVar1 != param_8) goto LAB_004bbca1;
        pvVar4 = (void *)(local_20 + local_28 + (int)local_1c);
        iVar5 = ((int)local_20 >> 0x1f) + ((int)local_28 >> 0x1f) + (uint)CARRY4(local_20,local_28)
                + iVar3 + (uint)CARRY4(local_20 + local_28,(uint)local_1c);
        param_4 = local_1c;
        lVar7 = local_c;
      }
      local_c = lVar7;
      CPU_ClearContext4(param_4,&local_2c);
      lVar8 = local_c;
    } while (CONCAT44(iVar5,pvVar4) < local_c);
  }
  ImageFormat_LoadBMP((int)local_14,local_10);
  lVar8 = ImageFormat_LoadJPEG(&local_2c,0xffffffff,-1);
  if (lVar8 == -0x80) {
    return 0xffffff80;
  }
  if ((param_7 < iVar5) || (((param_7 <= iVar5 && (param_6 <= pvVar4)) || (lVar8 < 0)))) {
    CPU_ClearContext4(&local_2c,&local_2c);
    *(int *)(param_1 + 0x1c) = param_9 + 1;
    pvVar2 = _malloc((param_9 + 1) * 8 + 8);
    *(void **)(param_1 + 0x20) = pvVar2;
    pvVar2 = _malloc(*(int *)(param_1 + 0x1c) << 2);
    iVar3 = *(int *)(param_1 + 0x20);
    *(void **)(param_1 + 0x28) = pvVar2;
    *(void **)(iVar3 + 8 + param_9 * 8) = pvVar4;
    *(int *)(iVar3 + 0xc + param_9 * 8) = iVar5;
  }
  else {
    iVar3 = param_9 + 1;
    iVar5 = CPU_ExecuteInstruction14();
    iVar5 = ImageFormat_LoadTGA(param_1,local_14,local_10,*(void **)(param_1 + 8),
                                *(int *)(param_1 + 0xc),param_6,param_7,iVar5,iVar3);
    CPU_ClearContext4(this,&local_2c);
    if (iVar5 == -0x80) {
      return 0xffffff80;
    }
  }
  iVar5 = *(int *)(param_1 + 0x20);
  *(undefined4 *)(iVar5 + param_9 * 8) = param_2;
  *(undefined4 *)(iVar5 + 4 + param_9 * 8) = param_3;
  *(int *)(*(int *)(param_1 + 0x28) + param_9 * 4) = param_8;
  return 0;
}


