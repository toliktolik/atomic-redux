/*
 * Function: ImageDecoder_ValidateFormat
 * Address: 004cd4a0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall
ImageDecoder_ValidateFormat
          (uint param_1,byte *param_2,uint param_3,int param_4,undefined4 param_5,int param_6,
          undefined4 param_7,int param_8,int param_9,int param_10)

{
  uint uVar1;
  void *this;
  byte bVar2;
  uint extraout_ECX;
  uint extraout_ECX_00;
  uint extraout_ECX_01;
  uint extraout_ECX_02;
  uint extraout_ECX_03;
  uint extraout_ECX_04;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  byte *extraout_EDX_03;
  byte *extraout_EDX_04;
  char cVar3;
  char *pcVar4;
  undefined4 *in_stack_ffffffe8;
  undefined4 *in_stack_ffffffec;
  
  this = DAT_00569f5c;
  switch(param_7) {
  case 0:
    switch(param_6) {
    case 1:
    case 2:
    case 4:
    case 8:
    case 0x10:
switchD_004cd520_caseD_1:
      *(undefined1 *)(param_3 + 0x12a) = 1;
      goto LAB_004cd593;
    default:
      pcVar4 = "Invalid bit depth for grayscale image";
    }
    break;
  default:
    pcVar4 = "Invalid image color type specified";
    break;
  case 2:
    if ((param_6 != 8) && (param_6 != 0x10)) {
      CPU_Instruction20(param_1,param_2,param_3,"Invalid bit depth for RGB image");
      param_1 = extraout_ECX;
      param_2 = extraout_EDX;
    }
    *(undefined1 *)(param_3 + 0x12a) = 3;
    goto LAB_004cd593;
  case 3:
    if (param_6 - 1U < 8) {
      param_1 = (uint)*(byte *)((int)&PTR_caseD_3_004cd7c0 + param_6 + 3);
      switch(param_6) {
      default:
        goto switchD_004cd520_caseD_1;
      case 3:
      case 5:
      case 6:
      case 7:
        break;
      }
    }
    pcVar4 = "Invalid bit depth for paletted image";
    break;
  case 4:
    if ((param_6 != 8) && (param_6 != 0x10)) {
      CPU_Instruction20(param_1,param_2,param_3,"Invalid bit depth for grayscale+alpha image");
      param_1 = extraout_ECX_00;
      param_2 = extraout_EDX_00;
    }
    *(undefined1 *)(param_3 + 0x12a) = 2;
    goto LAB_004cd593;
  case 6:
    if ((param_6 != 8) && (param_6 != 0x10)) {
      CPU_Instruction20(param_1,param_2,param_3,"Invalid bit depth for RGBA image");
      param_1 = extraout_ECX_01;
      param_2 = extraout_EDX_01;
    }
    *(undefined1 *)(param_3 + 0x12a) = 4;
    goto LAB_004cd593;
  }
  CPU_Instruction20(param_1,param_2,param_3,pcVar4);
  param_1 = extraout_ECX_02;
  param_2 = extraout_EDX_02;
LAB_004cd593:
  if (param_8 != 0) {
    CPU_Instruction21(param_1,param_2,param_3,"Invalid compression type specified");
    param_1 = extraout_ECX_03;
    param_2 = extraout_EDX_03;
  }
  if (param_9 != 0) {
    CPU_Instruction21(param_1,param_2,param_3,"Invalid filter type specified");
    param_1 = extraout_ECX_04;
    param_2 = extraout_EDX_04;
  }
  if ((param_10 != 0) && (param_10 != 1)) {
    CPU_Instruction21(param_1,param_2,param_3,"Invalid interlace type specified");
    param_10 = 1;
  }
  *(char *)(param_3 + 0x123) = (char)param_10;
  *(undefined1 *)(param_3 + 0x126) = (undefined1)param_7;
  cVar3 = (char)param_6;
  bVar2 = *(char *)(param_3 + 0x12a) * cVar3;
  *(byte *)(param_3 + 0x129) = bVar2;
  *(int *)(param_3 + 200) = param_4;
  *(int *)(param_3 + 0xd4) = param_4;
  *(char *)(param_3 + 0x127) = cVar3;
  *(undefined4 *)(param_3 + 0xcc) = param_5;
  *(uint *)(param_3 + 0xd8) = (uint)bVar2 * param_4 + 7 >> 3;
  *(char *)(param_3 + 0x128) = cVar3;
  *(char *)(param_3 + 299) = *(char *)(param_3 + 0x12a);
  Renderer_BeginScene(&stack0xffffffe8,param_4);
  Renderer_BeginScene(&stack0xffffffec,param_5);
  ImageDecoder_ProcessHeader(param_3,(byte *)&DAT_00567cdc,&stack0xffffffe8,0xd);
  *(code **)(param_3 + 0x94) = PixelFormat_UnpackPixel;
  *(code **)(param_3 + 0x98) = PixelFormat_GetRedComponent;
  *(uint *)(param_3 + 0x9c) = param_3;
  if (*(char *)(param_3 + 0x125) == '\0') {
    if ((*(char *)(param_3 + 0x126) == '\x03') || (*(byte *)(param_3 + 0x127) < 8)) {
      *(undefined1 *)(param_3 + 0x125) = 8;
    }
    else {
      *(undefined1 *)(param_3 + 0x125) = 0xf8;
    }
  }
  uVar1 = *(uint *)(param_3 + 0x6c);
  if ((uVar1 & 1) == 0) {
    *(uint *)(param_3 + 0xc4) = (uint)(*(char *)(param_3 + 0x125) != '\b');
  }
  if ((uVar1 & 2) == 0) {
    *(undefined4 *)(param_3 + 0xb4) = 0xffffffff;
  }
  if ((uVar1 & 4) == 0) {
    *(undefined4 *)(param_3 + 0xc0) = 8;
  }
  if ((uVar1 & 8) == 0) {
    *(undefined4 *)(param_3 + 0xbc) = 0xf;
  }
  if ((uVar1 & 0x10) == 0) {
    *(undefined4 *)(param_3 + 0xb8) = 8;
  }
  PNG_DecompressData(param_3 + 0x74,*(int *)(param_3 + 0xb4),*(int *)(param_3 + 0xb8),
                     *(int *)(param_3 + 0xbc),*(int *)(param_3 + 0xc0),*(int *)(param_3 + 0xc4),
                     "1.1.3",0x38);
  *(undefined4 *)(param_3 + 0x84) = *(undefined4 *)(param_3 + 0xb0);
  *(undefined4 *)(param_3 + 0x80) = *(undefined4 *)(param_3 + 0xac);
  *(undefined4 *)(param_3 + 0x68) = 1;
  Exception_SetMessage(this,in_stack_ffffffe8,in_stack_ffffffec);
  return;
}


