/*
 * Function: CPU_Instruction48
 * Address: 004ca650
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CPU_Instruction48(uint param_1,byte *param_2,byte *param_3,int param_4,uint param_5)

{
  byte *pbVar1;
  byte bVar2;
  byte *pbVar3;
  byte *pbVar4;
  int iVar5;
  undefined4 *puVar6;
  undefined4 extraout_ECX;
  undefined4 extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  
  pbVar3 = param_3;
  if ((param_3[0x68] & 1) == 0) {
    CPU_Instruction20(param_1,param_2,(int)param_3,"Missing IHDR before tEXt");
  }
  if ((*(uint *)(param_3 + 0x68) & 4) != 0) {
    *(uint *)(param_3 + 0x68) = *(uint *)(param_3 + 0x68) | 8;
  }
  pbVar4 = (byte *)CPU_Instruction12((int)param_3,param_5 + 1);
  CPU_Instruction26(extraout_ECX,extraout_EDX,(uint)param_3,pbVar4,param_5);
  iVar5 = CPU_Instruction33(extraout_ECX_00,extraout_EDX_00,(uint)param_3,0);
  if (iVar5 != 0) {
    CPU_Instruction13(extraout_ECX_01,extraout_EDX_01,(int)param_3,(int)pbVar4);
    return;
  }
  pbVar4[param_5] = 0;
  bVar2 = *pbVar4;
  param_3 = pbVar4;
  while (bVar2 != 0) {
    pbVar1 = param_3 + 1;
    param_3 = param_3 + 1;
    bVar2 = *pbVar1;
  }
  if (param_3 != pbVar4 + param_5) {
    param_3 = param_3 + 1;
  }
  puVar6 = (undefined4 *)CPU_Instruction12((int)pbVar3,0x10);
  *puVar6 = 0xffffffff;
  puVar6[1] = pbVar4;
  puVar6[2] = param_3;
  PNG_SetPaletteToHistogram((int)pbVar3,param_4,(int)puVar6,1);
  CPU_Instruction13(extraout_ECX_02,extraout_EDX_02,(int)pbVar3,(int)puVar6);
  return;
}


