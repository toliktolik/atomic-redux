/*
 * Function: D3D_SetModelViewMatrix
 * Address: 00483ff0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall
D3D_SetModelViewMatrix(void *this,undefined4 *param_1,undefined4 *param_2,undefined4 *param_3)

{
  undefined4 *puVar1;
  uint uVar2;
  int iVar3;
  undefined4 *puVar4;
  undefined4 *puVar5;
  undefined4 uVar6;
  int iVar7;
  uint extraout_EDX;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  puVar4 = param_2;
  local_8 = 0xffffffff;
  puStack_c = &DAT_00514b10;
  local_10 = ExceptionList;
  param_3 = (undefined4 *)*param_3;
  iVar3 = *(int *)((int)this + 4);
  if (iVar3 == 0) {
    uVar2 = 0;
  }
  else {
    uVar2 = *(int *)((int)this + 0xc) - iVar3 >> 2;
  }
  if (param_2 != (undefined4 *)0x0) {
    if (iVar3 == 0) {
      iVar7 = 0;
    }
    else {
      iVar7 = *(int *)((int)this + 8) - iVar3 >> 2;
    }
    if ((undefined4 *)(0x3fffffffU - iVar7) < param_2) {
      ExceptionList = &local_10;
      Memory_ZeroBuffer();
      ExceptionList = local_10;
      return;
    }
    if (iVar3 == 0) {
      iVar7 = 0;
    }
    else {
      iVar7 = *(int *)((int)this + 8) - iVar3 >> 2;
    }
    if (uVar2 < (uint)(iVar7 + (int)param_2)) {
      if (0x3fffffff - (uVar2 >> 1) < uVar2) {
        uVar2 = 0;
      }
      else {
        uVar2 = uVar2 + (uVar2 >> 1);
      }
      if (iVar3 == 0) {
        iVar7 = 0;
      }
      else {
        iVar7 = *(int *)((int)this + 8) - iVar3 >> 2;
      }
      if (uVar2 < (uint)(iVar7 + (int)param_2)) {
        if (iVar3 == 0) {
          iVar3 = 0;
        }
        else {
          iVar3 = *(int *)((int)this + 8) - iVar3 >> 2;
        }
        uVar2 = iVar3 + (int)param_2;
      }
      ExceptionList = &local_10;
      puVar4 = (undefined4 *)operator_new(uVar2 * 4);
      local_8 = 0;
      puVar5 = (undefined4 *)DirectX_ValidateDevice(*(undefined4 **)((int)this + 4),param_1,puVar4);
      ArrayInit_4ByteObjects(puVar5,(int)param_2,&param_3);
      DirectX_ValidateDevice(param_1,*(undefined4 **)((int)this + 8),puVar5 + (int)param_2);
      iVar3 = *(int *)((int)this + 4);
      if (iVar3 == 0) {
        iVar7 = 0;
      }
      else {
        iVar7 = *(int *)((int)this + 8) - iVar3 >> 2;
      }
      if (iVar3 != 0) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(iVar3,extraout_EDX);
      }
      *(undefined4 **)((int)this + 0xc) = puVar4 + uVar2;
      *(undefined4 **)((int)this + 8) = puVar4 + (int)param_2 + iVar7;
      *(undefined4 **)((int)this + 4) = puVar4;
      ExceptionList = local_10;
      return;
    }
    puVar5 = *(undefined4 **)((int)this + 8);
    if ((undefined4 *)((int)puVar5 - (int)param_1 >> 2) < param_2) {
      iVar3 = (int)param_2 * 4;
      ExceptionList = &local_10;
      Database_ValidateResults(param_1,puVar5,param_1 + (int)param_2);
      local_8 = 2;
      Enemy_ProcessBomberLogic
                (*(undefined4 **)((int)this + 8),
                 (int)param_2 - ((int)*(undefined4 **)((int)this + 8) - (int)param_1 >> 2),&param_3)
      ;
      iVar3 = *(int *)((int)this + 8) + iVar3;
      *(int *)((int)this + 8) = iVar3;
      puVar4 = (undefined4 *)(iVar3 + (int)puVar4 * -4);
    }
    else {
      param_2 = puVar5 + -(int)param_2;
      ExceptionList = &local_10;
      uVar6 = Database_ValidateResults(param_2,puVar5,puVar5);
      puVar1 = param_2;
      *(undefined4 *)((int)this + 8) = uVar6;
      param_2 = (undefined4 *)&stack0xffffffcc;
      System_MonitorPerformance(&param_2,(int)param_1,(int)puVar1,puVar5);
      puVar4 = param_1 + (int)puVar4;
    }
    param_2 = (undefined4 *)&stack0xffffffcc;
    System_UpdateResourceCounters(param_1,puVar4,&param_3);
  }
  ExceptionList = local_10;
  return;
}


