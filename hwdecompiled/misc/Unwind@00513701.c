/*
 * Function: Unwind@00513701
 * Address: 00513701
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x005137bd) overlaps instruction at (ram,0x005137bc)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */
/* WARNING: Removing unreachable block (ram,0x005137a7) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_00513701(int param_1,undefined4 param_2)

{
  int iVar1;
  uint *puVar2;
  char cVar3;
  longlong lVar4;
  code *pcVar5;
  char cVar6;
  uint uVar8;
  uint in_EAX;
  undefined1 *puVar9;
  undefined1 *puVar10;
  int iVar11;
  uint3 uVar12;
  uint unaff_EBX;
  undefined1 *puVar13;
  int unaff_EBP;
  uint *puVar14;
  uint *puVar15;
  uint *unaff_EDI;
  undefined2 in_SS;
  undefined2 in_GS;
  int in_GS_OFFSET;
  byte in_CF;
  bool bVar16;
  undefined1 in_PF;
  undefined8 uVar17;
  int unaff_retaddr;
  char cVar7;
  
  while( true ) {
    out(0x37,(char)in_EAX);
    if ((bool)in_PF) {
      *(char *)((int)unaff_EDI + 0x455ecffb) =
           *(char *)((int)unaff_EDI + 0x455ecffb) << ((byte)param_1 & 0x1f);
      pcVar5 = (code *)swi(3);
      (*pcVar5)();
      return;
    }
    bVar16 = in_EAX < 0xcfce3368 || in_EAX + 0x3031cc98 < (uint)in_CF;
    puVar9 = (undefined1 *)((in_EAX + 0x3031cc98) - (uint)in_CF);
    puVar14 = (uint *)*(undefined6 *)(unaff_EBP + -0x26c63085);
    iVar11 = param_1 + -1;
    if (iVar11 == 0 || puVar9 != (undefined1 *)0x0) {
      *(byte *)unaff_EDI = (char)*unaff_EDI << 3 | (byte)(CONCAT11(bVar16,(char)*unaff_EDI) >> 6);
    }
    else {
      cVar7 = (char)(puVar9 + 1);
      cVar3 = cVar7 + -0x19;
      cVar6 = cVar3 + bVar16;
      puVar9 = (undefined1 *)CONCAT31((int3)((uint)(puVar9 + 1) >> 8),cVar6);
      if (cVar6 == '\0' || (SCARRY1(cVar7,-0x19) != SCARRY1(cVar3,bVar16)) != cVar6 < '\0') {
        pcVar5 = (code *)swi(3);
        (*pcVar5)();
        return;
      }
    }
    puVar2 = unaff_EDI + 1;
    puVar15 = puVar14 + 1;
    if (*unaff_EDI < *puVar14) break;
    if (iVar11 != 0) {
      *(char *)puVar2 = (char)puVar9;
      uVar8 = (uint)puVar9 & 0xff;
      while (DAT_6b92f4d3 = (char)uVar8 + 'G', !SCARRY1((char)uVar8,'G')) {
        out(0x83,DAT_6b92f4d3);
        uVar8 = _DAT_23f137e9;
      }
      pcVar5 = (code *)swi(3);
      (*pcVar5)();
      return;
    }
    LOCK();
    *(int *)(unaff_EBP + 0x3f49635) = unaff_retaddr;
    UNLOCK();
    out(*(undefined4 *)((int)puVar14 + 5),(short)param_2);
    param_1 = 0;
    uVar8 = CONCAT31((int3)((uint)puVar9 >> 8),DAT_86e8faf8) ^ 0x273d2900;
    unaff_retaddr = CONCAT22((short)((uint)unaff_retaddr >> 0x10),in_SS);
    in_CF = uVar8 < 0xfc01f222;
    in_EAX = uVar8 + 0x3fe0dde;
    in_PF = (POPCOUNT(in_EAX & 0xff) & 1U) == 0;
    unaff_EDI = puVar2;
  }
  LOCK();
  iVar1 = *(int *)(puVar9 + (int)&stack0x00000000);
  *(int *)(puVar9 + (int)&stack0x00000000) = iVar11;
  UNLOCK();
  if (-1 < (char)((char)puVar9 + -0x17)) {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  unaff_EDI[iVar1 * 2 + 0x5684ac5] = unaff_EDI[iVar1 * 2 + 0x5684ac5] ^ unaff_EBX;
  *(char *)puVar2 = (char)*puVar2 + '\x01';
  if ((char)*puVar2 == '\0') {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  uVar12 = (uint3)((uint)param_2 >> 8) ^
           (uint3)((uint)*(undefined4 *)((int)puVar14 + 0x78eb58b9) >> 8);
  puVar10 = (undefined1 *)CONCAT22((short)((uint)puVar2 >> 0x10),in_GS);
  if (iVar1 == 0) {
    puVar10 = &DAT_72650b0e;
  }
  else {
    puVar15 = (uint *)((uint)puVar15 | *(uint *)(iVar1 + 0x2c));
    if ((int)puVar15 < 1) {
      lVar4 = (longlong)*(int *)((int)puVar15 + 0x35) * -0x16;
      puVar13 = puVar10 + -4;
      *(uint **)(puVar10 + -4) = puVar15;
      if (SBORROW4(CONCAT31(uVar12,0x7b),1)) {
        pcVar5 = (code *)swi(0x94);
        uVar17 = (*pcVar5)();
        puVar14 = (uint *)(in_GS_OFFSET + (int)((ulonglong)uVar17 >> 0x20) + 0x1b);
        *puVar14 = *puVar14 & (uint)uVar17;
        return;
      }
      puVar10 = (undefined1 *)CONCAT31((int3)((uint)&stack0x00000000 >> 8),-((int)lVar4 != lVar4));
      bVar16 = *(undefined1 **)(puVar10 + unaff_retaddr + -0xd) < puVar13;
      goto code_r0x00513845;
    }
  }
  puVar14 = (uint *)(CONCAT31(uVar12,'{' - *(byte *)((int)puVar15 + 0xc5a212bfU)) + -0x2a);
  uVar8 = (uint)(0x7b < *(byte *)((int)puVar15 + 0xc5a212bfU));
  bVar16 = 0xcd79bc6 < *puVar14 || CARRY4(*puVar14 + 0xf3286439,uVar8);
  *puVar14 = *puVar14 + 0xf3286439 + uVar8;
code_r0x00513845:
  uVar8 = *(uint *)(puVar10 + -0x79);
  *(uint *)(puVar10 + -0x79) = uVar8 << 5 | (uint)(CONCAT14(bVar16,uVar8) >> 0x1c);
  *puVar9 = (char)puVar10;
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


