/*
 * Function: Polygon_Rasterize
 * Address: 004716c0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __thiscall Polygon_Rasterize(void *this,int param_1,int param_2,char param_3)

{
  double dVar1;
  int iVar2;
  float fVar3;
  float fVar4;
  double dVar5;
  double dVar6;
  char cVar7;
  void *pvVar8;
  int iVar9;
  int iVar10;
  double *pdVar11;
  void *this_00;
  uint *extraout_ECX;
  int iVar12;
  uint *puVar13;
  int *piVar14;
  uint extraout_EDX;
  int iVar15;
  int *piVar16;
  float10 fVar17;
  ulonglong uVar18;
  int aiStackY_18030 [24579];
  int local_24;
  int *local_20;
  undefined4 uVar19;
  int iVar20;
  int *piVar21;
  int *piVar22;
  
  System_LoadLibrary(this);
  if (param_3 != '\0') {
    iVar2 = **(int **)((int)this_00 + 4);
    Math_FloatToUInt64();
    Math_FloatToUInt64();
    cVar7 = (**(code **)(iVar2 + 4))();
    if (cVar7 != '\0') {
      return;
    }
  }
  iVar2 = *(int *)((int)this_00 + 0x18) + -1 + *(int *)((int)this_00 + 0x10);
  *(int *)((int)this_00 + 0x54) = param_2;
  DAT_0056df30 = param_1;
  _param_3 = 0;
  if (*(int *)((int)this_00 + 0x54) < 1) {
    return;
  }
  local_20 = (int *)operator_new(*(int *)((int)this_00 + 0x54) * 4);
  pvVar8 = operator_new(*(int *)((int)this_00 + 0x54) * 0x18);
  *(void **)((int)this_00 + 0x4c) = pvVar8;
  iVar9 = 0;
  if (0 < *(int *)((int)this_00 + 0x54)) {
    do {
      local_20[iVar9] = iVar9;
      iVar9 = iVar9 + 1;
    } while (iVar9 < *(int *)((int)this_00 + 0x54));
  }
  System_GetModuleHandle();
  *(undefined4 *)((int)this_00 + 0x50) = 0;
  param_2 = 0;
  dVar1 = ((double)*(int *)(DAT_0056df30 + 4 + *local_20 * 8) - _DAT_0052a0e8) +
          (double)*(float *)((int)this_00 + 0xc);
  uVar19 = SUB84(dVar1,0);
  fVar17 = SystemCall_Handler(extraout_ECX,*local_20,dVar1);
  if (fVar17 < (float10)(double)CONCAT44(uVar19,0x4717c8) ==
      (NAN(fVar17) || NAN((float10)(double)CONCAT44(uVar19,0x4717c8)))) {
    SystemCall_Handler((uint *)*local_20,DAT_0056df30,
                       ((double)*(int *)(DAT_0056df30 + 4 + *local_20 * 8) - _DAT_0052a0e8) +
                       (double)*(float *)((int)this_00 + 0xc));
  }
  uVar18 = Math_FloatToUInt64();
  piVar16 = (int *)uVar18;
  dVar1 = ((double)*(int *)(DAT_0056df30 + 4 + local_20[*(int *)((int)this_00 + 0x54) + -1] * 8) -
          _DAT_0052a0e8) + (double)*(float *)((int)this_00 + 0xc);
  uVar19 = SUB84(dVar1,0);
  fVar17 = Math_FloatingPointRound
                     ((char *)local_20[*(int *)((int)this_00 + 0x54) + -1],(short)DAT_0056df30,dVar1
                     );
  if (fVar17 <= (float10)(double)CONCAT44(uVar19,0x47182f)) {
    Math_FloatingPointRound
              ((char *)local_20[*(int *)((int)this_00 + 0x54) + -1],(short)DAT_0056df30,
               ((double)*(int *)(DAT_0056df30 + 4 + local_20[*(int *)((int)this_00 + 0x54) + -1] * 8
                                ) - _DAT_0052a0e8) + (double)*(float *)((int)this_00 + 0xc));
  }
  uVar18 = Math_FloatToUInt64();
  if ((int)piVar16 <= (int)uVar18) {
    do {
      if (param_2 < *(int *)((int)this_00 + 0x54)) {
        dVar1 = (double)(int)piVar16;
        dVar5 = (double)(int)piVar16 + _DAT_0052a0e8;
        do {
          piVar14 = SUB84(dVar1,0);
          iVar9 = local_20[param_2];
          fVar3 = (float)*(int *)(DAT_0056df30 + 4 + iVar9 * 8) + *(float *)((int)this_00 + 0xc);
          if (fVar3 < (float)dVar5 == (fVar3 == (float)dVar5)) break;
          iVar12 = iVar9;
          if (iVar9 < 1) {
            iVar12 = *(int *)((int)this_00 + 0x54);
          }
          iVar12 = iVar12 + -1;
          fVar3 = (float)*(int *)(DAT_0056df30 + 4 + iVar12 * 8) + *(float *)((int)this_00 + 0xc);
          dVar6 = dVar1 - _DAT_0052a0e8;
          fVar4 = (float)dVar6;
          if (fVar3 < fVar4 == (fVar3 == fVar4)) {
            if ((float)dVar5 < fVar3) {
              piVar14 = piVar16;
              Polygon_AddEdge(this_00,iVar12,(int)piVar16);
            }
          }
          else {
            Graphics_EnableDepthTest(this_00,iVar12);
            piVar14 = (int *)iVar12;
          }
          if (iVar9 < *(int *)((int)this_00 + 0x54) + -1) {
            iVar12 = iVar9 + 1;
          }
          else {
            iVar12 = 0;
          }
          fVar3 = (float)*(int *)(DAT_0056df30 + 4 + iVar12 * 8) + *(float *)((int)this_00 + 0xc);
          fVar4 = (float)dVar6;
          if (fVar3 < fVar4 == (fVar3 == fVar4)) {
            if ((float)dVar5 < fVar3) {
              piVar14 = piVar16;
              Polygon_AddEdge(this_00,iVar9,(int)piVar16);
            }
          }
          else {
            Graphics_EnableDepthTest(this_00,iVar9);
            piVar14 = (int *)iVar9;
          }
          dVar1 = (double)CONCAT44((int)((ulonglong)dVar1 >> 0x20),piVar14);
          param_2 = param_2 + 1;
        } while (param_2 < *(int *)((int)this_00 + 0x54));
      }
      local_20 = *(int **)((int)this_00 + 0x4c);
      iVar20 = 0x18;
      local_24 = 0x471978;
      System_GetModuleHandle();
      iVar12 = 0;
      iVar9 = 0;
      if (0 < *(int *)((int)this_00 + 0x50)) {
        puVar13 = (uint *)(_param_3 * 3);
        piVar14 = aiStackY_18030 + _param_3 * 3;
        piVar21 = piVar14;
        do {
          SystemCall_Handler(puVar13,(int)piVar14,
                             *(double *)(iVar12 + *(int *)((int)this_00 + 0x4c)) - _DAT_0052a0e8);
          uVar18 = Math_FloatToUInt64();
          iVar15 = (int)uVar18;
          if ((int)uVar18 < 0x471978) {
            iVar15 = local_24;
          }
          dVar1 = *(double *)(*(char **)((int)this_00 + 0x4c) + iVar12 + 0x18) - _DAT_0052a0e8;
          iVar20 = SUB84(dVar1,0);
          Math_FloatingPointRound(*(char **)((int)this_00 + 0x4c),(short)(uVar18 >> 0x20),dVar1);
          uVar18 = Math_FloatToUInt64();
          piVar14 = (int *)(uVar18 >> 0x20);
          iVar10 = (int)uVar18;
          if (iVar2 < (int)uVar18) {
            iVar10 = iVar2;
          }
          piVar22 = piVar21;
          if ((iVar15 <= iVar10) && (_param_3 < 0x2000)) {
            _param_3 = _param_3 + 1;
            piVar22 = piVar21 + 3;
            *piVar21 = (int)piVar16;
            piVar21[1] = iVar15;
            piVar21[2] = (iVar10 - iVar15) + 1;
            piVar14 = piVar16;
          }
          pdVar11 = (double *)(*(int *)((int)this_00 + 0x4c) + iVar12);
          *pdVar11 = *(double *)(*(int *)((int)this_00 + 0x4c) + 8 + iVar12) + *pdVar11;
          iVar10 = iVar12 + 0x20;
          iVar15 = iVar12 + *(int *)((int)this_00 + 0x4c);
          iVar12 = iVar12 + 0x30;
          *(double *)(iVar15 + 0x18) =
               *(double *)(iVar10 + *(int *)((int)this_00 + 0x4c)) + *(double *)(iVar15 + 0x18);
          puVar13 = *(uint **)((int)this_00 + 0x50);
          iVar9 = iVar9 + 2;
          piVar21 = piVar22;
        } while (iVar9 < (int)puVar13);
      }
      piVar16 = (int *)((int)piVar16 + 1);
    } while ((int)piVar16 <= iVar20);
  }
  (**(code **)(**(int **)((int)this_00 + 4) + 0x18))();
                    /* WARNING: Subroutine does not return */
  System_ShutdownHandler((int)aiStackY_18030,extraout_EDX);
}


