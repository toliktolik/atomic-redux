/*
 * Function: CPU_Instruction41
 * Address: 004c9b90
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CPU_Instruction41(uint param_1,byte *param_2,uint param_3,int param_4,byte *param_5)

{
  char cVar1;
  void *this;
  byte *pbVar2;
  int iVar3;
  uint extraout_ECX;
  uint extraout_ECX_00;
  undefined4 extraout_ECX_01;
  byte *extraout_ECX_02;
  undefined4 extraout_ECX_03;
  undefined4 extraout_ECX_04;
  undefined4 extraout_ECX_05;
  byte *extraout_ECX_06;
  undefined4 extraout_ECX_07;
  undefined4 uVar4;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  byte *extraout_EDX_03;
  byte *pbVar5;
  byte *extraout_EDX_04;
  byte *extraout_EDX_05;
  byte *extraout_EDX_06;
  byte *extraout_EDX_07;
  byte *extraout_EDX_08;
  undefined4 *in_stack_fffffff0;
  undefined4 *in_stack_fffffff4;
  
  this = DAT_00569f5c;
  if ((*(uint *)(param_3 + 0x68) & 1) == 0) {
    CPU_Instruction20(param_1,param_2,param_3,"Missing IHDR before tRNS");
    param_1 = extraout_ECX;
    param_2 = extraout_EDX;
  }
  else {
    if ((*(uint *)(param_3 + 0x68) & 4) != 0) {
      CPU_Instruction21(param_1,param_2,param_3,"Invalid tRNS after IDAT");
      CPU_Instruction33(extraout_ECX_01,extraout_EDX_01,param_3,(uint)param_5);
      Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
      return;
    }
    if ((param_4 != 0) && ((*(byte *)(param_4 + 8) & 0x10) != 0)) {
      CPU_Instruction21(param_1,param_2,param_3,"Duplicate tRNS chunk");
      CPU_Instruction33(param_5,extraout_EDX_02,param_3,(uint)param_5);
      Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
      return;
    }
  }
  cVar1 = *(char *)(param_3 + 0x126);
  if (cVar1 == '\x03') {
    if ((*(byte *)(param_3 + 0x68) & 2) == 0) {
      CPU_Instruction21(param_1,param_2,param_3,"Missing PLTE before tRNS");
      param_1 = extraout_ECX_00;
      param_2 = extraout_EDX_00;
    }
    else {
      param_2 = (byte *)(uint)*(ushort *)(param_3 + 0x118);
      if (param_2 < param_5) goto LAB_004c9cfc;
    }
    if (param_5 != (byte *)0x0) {
      pbVar2 = (byte *)CPU_Instruction12(param_3,(size_t)param_5);
      pbVar5 = (byte *)(*(uint *)(param_3 + 0x6c) | 0x2000);
      *(byte **)(param_3 + 0x188) = pbVar2;
      *(byte **)(param_3 + 0x6c) = pbVar5;
      CPU_Instruction26(extraout_ECX_03,pbVar5,param_3,pbVar2,(uint)param_5);
      *(short *)(param_3 + 0x11a) = (short)param_5;
      uVar4 = extraout_ECX_04;
      pbVar2 = extraout_EDX_04;
      goto LAB_004c9d32;
    }
    CPU_Instruction21(param_1,param_2,param_3,"Zero length tRNS chunk");
    pbVar2 = extraout_ECX_02;
    pbVar5 = extraout_EDX_03;
  }
  else if (cVar1 == '\x02') {
    if (param_5 == (byte *)0x6) {
      CPU_Instruction26(param_1,param_2,param_3,&stack0xfffffff0,6);
      *(undefined2 *)(param_3 + 0x11a) = 1;
      iVar3 = CPU_Instruction25(&stack0xfffffff0);
      *(short *)(param_3 + 0x18e) = (short)iVar3;
      iVar3 = CPU_Instruction25(&stack0xfffffff2);
      *(short *)(param_3 + 400) = (short)iVar3;
      iVar3 = CPU_Instruction25(&stack0xfffffff4);
      *(short *)(param_3 + 0x192) = (short)iVar3;
      uVar4 = extraout_ECX_05;
      pbVar2 = extraout_EDX_05;
LAB_004c9d32:
      iVar3 = CPU_Instruction33(uVar4,pbVar2,param_3,0);
      if (iVar3 == 0) {
        PNG_SetScaleFactors(param_3,param_4,*(int *)(param_3 + 0x188),
                            (uint)*(ushort *)(param_3 + 0x11a),(undefined4 *)(param_3 + 0x18c));
        Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
        return;
      }
      goto LAB_004c9d8d;
    }
LAB_004c9cfc:
    CPU_Instruction21(param_1,param_2,param_3,"Incorrect tRNS chunk length");
    pbVar2 = extraout_ECX_06;
    pbVar5 = extraout_EDX_06;
  }
  else {
    if (cVar1 == '\0') {
      if (param_5 != (byte *)0x2) goto LAB_004c9cfc;
      CPU_Instruction26(&stack0xfffffff0,param_2,param_3,&stack0xfffffff0,2);
      *(undefined2 *)(param_3 + 0x11a) = 1;
      iVar3 = CPU_Instruction25(&stack0xfffffff0);
      *(short *)(param_3 + 0x194) = (short)iVar3;
      uVar4 = extraout_ECX_07;
      pbVar2 = extraout_EDX_07;
      goto LAB_004c9d32;
    }
    CPU_Instruction21(param_1,param_2,param_3,"tRNS chunk not allowed with alpha channel");
    pbVar2 = param_5;
    pbVar5 = extraout_EDX_08;
  }
  CPU_Instruction33(pbVar2,pbVar5,param_3,(uint)param_5);
LAB_004c9d8d:
  Exception_SetMessage(this,in_stack_fffffff0,in_stack_fffffff4);
  return;
}


