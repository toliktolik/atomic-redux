/*
 * Function: PNG_FinalizeImageDecoding
 * Address: 004c35a0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall PNG_FinalizeImageDecoding(void *param_1,byte *param_2,byte *param_3,int param_4)

{
  int *piVar1;
  int iVar2;
  byte *pbVar3;
  void *extraout_ECX;
  int iVar4;
  
  pbVar3 = param_3;
  if ((param_3[0x68] & 4) == 0) {
    CPU_Instruction20((uint)param_1,param_2,(int)param_3,"No IDATs written into file");
    param_1 = extraout_ECX;
  }
  if (param_4 != 0) {
    if (((*(uint *)(param_4 + 8) & 0x200) != 0) && ((*(uint *)(param_3 + 0x6c) & 0x10000) == 0)) {
      ImageDecoder_FlipImage(param_1,param_3,(ushort *)(param_4 + 0x3c));
    }
    iVar4 = 0;
    param_3 = (byte *)0x0;
    if (0 < *(int *)(param_4 + 0x30)) {
      do {
        piVar1 = (int *)(iVar4 + *(int *)(param_4 + 0x38));
        iVar2 = *piVar1;
        if (iVar2 < 0) {
          if (iVar2 == -1) {
            Renderer_Rotate(piVar1[3],(byte *)piVar1[2],pbVar3,(byte *)piVar1[1],(byte *)piVar1[2],
                            piVar1[3]);
            *(undefined4 *)(iVar4 + *(int *)(param_4 + 0x38)) = 0xfffffffd;
          }
        }
        else {
          Renderer_Scale(piVar1[2],(byte *)piVar1[1],pbVar3,(byte *)piVar1[1],(byte *)piVar1[2],
                         piVar1[3],iVar2);
          *(undefined4 *)(iVar4 + *(int *)(param_4 + 0x38)) = 0xfffffffe;
        }
        param_3 = param_3 + 1;
        iVar4 = iVar4 + 0x10;
      } while ((int)param_3 < *(int *)(param_4 + 0x30));
    }
  }
  *(uint *)(pbVar3 + 0x68) = *(uint *)(pbVar3 + 0x68) | 8;
  ImageDecoder_WriteScanline((uint)pbVar3);
  return;
}


