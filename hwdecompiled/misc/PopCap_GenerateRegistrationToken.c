/*
 * Function: PopCap_GenerateRegistrationToken
 * Address: 004b0d30
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall
PopCap_GenerateRegistrationToken(int param_1,uint param_2,uint param_3,_String_base *param_4)

{
  uint uVar1;
  char *pcVar2;
  char cVar3;
  _String_base *p_Var4;
  int iVar5;
  int *piVar6;
  long lVar7;
  undefined4 uVar8;
  int iVar9;
  char *pcVar10;
  int extraout_ECX;
  int extraout_ECX_00;
  undefined4 extraout_ECX_01;
  int extraout_ECX_02;
  int extraout_ECX_03;
  undefined2 extraout_DX;
  int extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  undefined6 uVar11;
  uint unaff_retaddr;
  undefined4 *in_stack_ffffff08;
  undefined4 *in_stack_ffffff0c;
  undefined1 local_bc [20];
  undefined1 local_a8 [44];
  undefined1 local_7c;
  undefined1 local_78 [4];
  uint local_74;
  undefined4 local_64;
  uint local_60;
  undefined1 local_40 [4];
  uint local_3c;
  undefined4 local_2c;
  uint local_28;
  int local_24;
  char local_20;
  undefined4 local_1f;
  undefined4 local_1b;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  uVar1 = param_3;
  local_8 = 0xffffffff;
  puStack_c = &DAT_00516b3f;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  if (*(char *)(param_1 + 0xb3) == '\0') {
    ExceptionList = &local_10;
    p_Var4 = Intel_DisplayPopulationData
                       (local_40,param_2,(_String_base *)local_40,param_4,
                        (_String_base *)&DAT_00536bd8);
    uVar11 = String_AllocateBuffer(*(undefined4 *)(p_Var4 + 0x18),extraout_DX);
    local_24 = (int)uVar11;
    if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,local_3c);
    }
    if (local_24 != 0) {
      Memory_GetHeapInfo(extraout_ECX,(short)((uint6)uVar11 >> 0x20));
      local_7c = 0;
      Memory_AllocateBlock(extraout_ECX_00,extraout_EDX);
      iVar5 = Level_InitializeBlastnya(param_3);
      piVar6 = (int *)operator_new(iVar5 + 4);
      local_1f = 0;
      local_20 = '\0';
      local_1b = 0;
      Assembly_FloatingPointComparison((int *)0x0,PTR_s_5442765_00567800);
      lVar7 = _atol(&local_20);
      *(char *)piVar6 = (char)lVar7;
      *(char *)((int)piVar6 + 1) = (char)((uint)lVar7 >> 8);
      *(char *)((int)piVar6 + 2) = (char)((uint)lVar7 >> 0x10);
      *(char *)((int)piVar6 + 3) = (char)((uint)lVar7 >> 0x18);
      param_3 = 4;
      Level_InitializeFrigistan(uVar1);
      uVar8 = Level_InitializeDictastroika(uVar1);
      cVar3 = (char)uVar8;
      while (cVar3 == '\0') {
        iVar5 = String_ToLowerCase(uVar1);
        Memory_GetHeapInfo(extraout_ECX_01,(short)local_24);
        iVar9 = Windows_ShowWindow();
        if (iVar9 == 0) {
          *(char *)(param_3 + (int)piVar6) = (char)iVar5;
          param_3 = param_3 + 1;
        }
        uVar8 = Level_InitializeDictastroika(uVar1);
        cVar3 = (char)uVar8;
      }
      local_60 = 0xf;
      local_64 = 0;
      local_74 = local_74 & 0xffffff00;
      pcVar2 = "D99BC76AB7B2578738E606F7";
      do {
        pcVar10 = pcVar2;
        pcVar2 = pcVar10 + 1;
      } while (*pcVar10 != '\0');
      String_Assign(local_78,(_String_base *)&DAT_00536bbc,(uint)(pcVar10 + -0x536bbc));
      local_8 = 0;
      TextureManager_CompressTextures(&stack0xffffff08,(int)local_78);
      local_8._0_1_ = 2;
      if (local_60 < 0x10) {
        local_60 = 0xf;
        local_64 = 0;
        local_74 = local_74 & 0xffffff00;
        local_28 = 0xf;
        local_2c = 0;
        local_3c = local_3c & 0xffffff00;
        pcVar2 = "11";
        do {
          pcVar10 = pcVar2;
          pcVar2 = pcVar10 + 1;
        } while (*pcVar10 != '\0');
        String_Assign(local_40,(_String_base *)&DAT_00536adc,(uint)(pcVar10 + -0x536adc));
        local_8._0_1_ = 3;
        TextureManager_CompressTextures(local_a8,(int)local_40);
        local_8._0_1_ = 5;
        if (local_28 < 0x10) {
          local_28 = 0xf;
          local_2c = 0;
          local_3c = local_3c & 0xffffff00;
          TextureManager_CreateAtlas(local_bc,piVar6,param_3,0x5e);
          local_8 = CONCAT31(local_8._1_3_,6);
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(extraout_ECX_03,extraout_EDX_02);
        }
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(extraout_ECX_02,extraout_EDX_01);
      }
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_74,extraout_EDX_00);
    }
    local_24 = 0;
  }
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_ffffff08,in_stack_ffffff0c);
  return;
}


