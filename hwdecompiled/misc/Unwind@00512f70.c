/*
 * Function: Unwind@00512f70
 * Address: 00512f70
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x00512fa7) overlaps instruction at (ram,0x00512fa6)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00512fe9) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined1 * __fastcall Unwind_00512f70(int param_1,undefined2 *param_2)

{
  ushort *puVar1;
  int *piVar2;
  char *pcVar3;
  int iVar4;
  code *pcVar6;
  undefined1 uVar7;
  char cVar8;
  byte bVar9;
  undefined1 *in_EAX;
  undefined3 uVar14;
  undefined1 *puVar10;
  uint uVar12;
  undefined4 uVar13;
  int unaff_EBX;
  int unaff_EBP;
  undefined1 *unaff_ESI;
  undefined1 *unaff_EDI;
  bool bVar15;
  byte in_AF;
  bool bVar16;
  bool bVar17;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  undefined4 in_FPUDataPointer;
  undefined4 in_FPUInstructionPointer;
  unkbyte10 in_ST0;
  unkbyte10 extraout_ST0;
  unkbyte10 in_ST1;
  unkbyte10 extraout_ST1;
  unkbyte10 in_ST2;
  unkbyte10 in_ST3;
  unkbyte10 in_ST4;
  unkbyte10 in_ST5;
  unkbyte10 in_ST6;
  unkbyte10 in_ST7;
  undefined8 uVar18;
  int iVar5;
  uint uVar11;
  
  uVar14 = (undefined3)((uint)in_EAX >> 8);
  if (param_1 != 0) {
    if ((param_1 != 1) && (bVar15 = in_EAX < &DAT_14091534, (int)in_EAX < 0x14091534)) {
      uVar7 = in(0xf8);
      in_EAX = (undefined1 *)CONCAT31(uVar14,uVar7);
      unaff_EDI = unaff_EDI + (-(uint)bVar15 - (int)unaff_ESI);
    }
    puVar10 = in_EAX + -0x8e6071c;
    piVar2 = (int *)(unaff_ESI + 0x65e6be2a);
    iVar4 = *piVar2;
    iVar5 = *piVar2;
    *piVar2 = (iVar5 + 0x7b5733fa) - (uint)((undefined1 *)0x8e6071b < in_EAX);
    if ((SBORROW4(iVar4,-0x7b5733fa) !=
        SBORROW4(iVar5 + 0x7b5733fa,(uint)((undefined1 *)0x8e6071b < in_EAX))) != *piVar2 < 0) {
      LOCK();
      iVar4 = *(int *)(unaff_EDI + -0x30244c58);
      *(undefined1 **)(unaff_EDI + -0x30244c58) = unaff_EDI;
      UNLOCK();
      pcVar3 = (char *)(iVar4 + 0x470434e3);
      *pcVar3 = (*pcVar3 + -0x5c) -
                (0xb5767d37 < (CONCAT31((int3)((uint)puVar10 >> 8),(char)puVar10 + '\'') ^ 0x13));
      do {
                    /* WARNING: Do nothing block with infinite loop */
      } while( true );
    }
    return puVar10;
  }
  bVar17 = SBORROW1((char)in_EAX,-0x72);
  cVar8 = (char)in_EAX + 'r';
  uVar11 = CONCAT31(uVar14,cVar8);
  bVar16 = cVar8 < '\0';
  bVar15 = cVar8 == '\0';
  while (bVar15 || bVar17 != bVar16) {
    while( true ) {
      *(byte *)(unaff_EBX + -0x4ecbc027) = *(byte *)(unaff_EBX + -0x4ecbc027) | (byte)param_2;
      bVar17 = SCARRY4((int)unaff_EDI,1);
      unaff_EDI = unaff_EDI + 1;
      bVar16 = (int)unaff_EDI < 0;
      bVar15 = unaff_EDI == (undefined1 *)0x0;
      out(0xeb,uVar11);
      if (!bVar16) break;
      if (bVar17) {
        *unaff_EDI = *unaff_ESI;
        out((short)param_2,uVar11);
        swi(4);
        *(undefined4 *)(unaff_ESI + 0x49) = 0;
        return *(undefined1 **)(unaff_ESI + 1);
      }
      in_AF = 9 < ((byte)uVar11 & 0xf) | in_AF;
      uVar12 = CONCAT31((int3)(uVar11 >> 8),(byte)uVar11 + in_AF * -6) & 0xffffff0f;
      uVar7 = (undefined1)uVar12;
      uVar11 = CONCAT31((int3)(CONCAT22((short)(uVar12 >> 0x10),
                                        CONCAT11((char)(uVar11 >> 8) - in_AF,uVar7)) >> 8),uVar7) ^
               0xb1;
    }
  }
  pcVar6 = (code *)swi(4);
  if (SBORROW4((int)unaff_EDI,1)) {
    uVar18 = (*pcVar6)();
    param_2 = (undefined2 *)((ulonglong)uVar18 >> 0x20);
    uVar11 = (uint)uVar18;
    in_ST0 = extraout_ST0;
    in_ST1 = extraout_ST1;
  }
  *param_2 = in_FPUControlWord;
  param_2[2] = in_FPUStatusWord;
  param_2[4] = in_FPUTagWord;
  *(undefined4 *)(param_2 + 10) = in_FPUDataPointer;
  *(undefined4 *)(param_2 + 6) = in_FPUInstructionPointer;
  param_2[9] = in_FPULastInstructionOpcode;
  *(unkbyte10 *)(param_2 + 0xe) = in_ST0;
  *(unkbyte10 *)(param_2 + 0x13) = in_ST1;
  *(unkbyte10 *)(param_2 + 0x18) = in_ST2;
  *(unkbyte10 *)(param_2 + 0x1d) = in_ST3;
  *(unkbyte10 *)(param_2 + 0x22) = in_ST4;
  *(unkbyte10 *)(param_2 + 0x27) = in_ST5;
  *(unkbyte10 *)(param_2 + 0x2c) = in_ST6;
  *(unkbyte10 *)(param_2 + 0x31) = in_ST7;
  piVar2 = (int *)(unaff_EBP + -0x350cc55c);
  iVar4 = *piVar2;
  *piVar2 = -*piVar2;
  bVar9 = (byte)unaff_EBP;
  bVar16 = bVar9 < (byte)unaff_EDI[-0x48];
  bVar9 = bVar9 - unaff_EDI[-0x48];
  bVar15 = bVar9 < (iVar4 != 0);
  cVar8 = bVar9 - (iVar4 != 0);
  if ((!bVar16 && !bVar15) && cVar8 != '\0') {
    DAT_35434cac = cVar8 + ((cVar8 == '\0') << 6 | in_AF << 4 | ((POPCOUNT(cVar8) & 1U) == 0) << 2 |
                            2 | (bVar16 || bVar15)) * '.';
    unaff_ESI[0x65] = unaff_ESI[0x65] ^ (byte)*(undefined4 *)(uVar11 + 0x50);
    out((short)param_2,DAT_35434cac);
    uVar13 = in((short)param_2);
    _DAT_55f22b5b = CONCAT31((int3)((uint)uVar13 >> 8),(byte)uVar13 - 0x38);
    puVar1 = (ushort *)(unaff_ESI + 0x95);
    _DAT_dc3b0d8e = _DAT_55f22b5b;
    *puVar1 = *puVar1 + (ushort)((byte)uVar13 < 0x38) *
                        (((ushort)(unaff_EDI + -2) & 3) - (*puVar1 & 3));
    unaff_EDI[-2] = unaff_ESI[4];
    pcVar6 = (code *)swi(3);
    puVar10 = (undefined1 *)(*pcVar6)();
    return puVar10;
  }
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


