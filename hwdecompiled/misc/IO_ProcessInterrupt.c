/*
 * Function: IO_ProcessInterrupt
 * Address: 00505330
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00505255) overlaps instruction at (ram,0x00505250)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x0050528e) */
/* WARNING: Removing unreachable block (ram,0x00505217) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined4 __fastcall IO_ProcessInterrupt(int param_1,undefined4 param_2)

{
  undefined1 uVar1;
  byte bVar2;
  byte bVar3;
  ulonglong uVar4;
  ulonglong uVar5;
  char cVar6;
  code *pcVar7;
  uint uVar8;
  int iVar9;
  undefined4 in_EAX;
  undefined4 uVar10;
  byte bVar12;
  undefined2 uVar11;
  int unaff_EBX;
  undefined4 *puVar13;
  undefined4 *puVar14;
  undefined4 *puVar15;
  undefined4 *unaff_EBP;
  int unaff_ESI;
  int *piVar16;
  undefined1 *unaff_EDI;
  undefined2 in_CS;
  bool in_CF;
  float10 in_ST0;
  
  if (param_1 != 1) {
    pcVar7 = (code *)swi(1);
    uVar10 = (*pcVar7)();
    return uVar10;
  }
  uVar1 = in((short)param_2);
  *unaff_EDI = uVar1;
  if (0 < unaff_ESI) {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  piVar16 = (int *)(unaff_EDI + 2);
  puVar15 = (undefined4 *)*unaff_EBP;
  puVar13 = unaff_EBP + 1;
  puVar14 = puVar15;
  if (!SCARRY4((int)(unaff_EDI + 1),1)) {
    bVar12 = (byte)((uint)param_2 >> 8);
    if (in_CF) {
      bVar2 = *(byte *)(unaff_ESI + 0x1111b5ce);
      bVar3 = bVar12 - *(byte *)(unaff_ESI + 0x1111b5ce);
      uVar11 = CONCAT11(bVar3 - in_CF,(byte)param_2);
      *(undefined2 *)unaff_EBP = in_CS;
      iVar9 = (CONCAT22((short)((uint)in_EAX >> 0x10),
                        (ushort)(byte)((char)in_EAX + (char)((uint)in_EAX >> 8) * -0x2b)) +
              0x730086e0) - (uint)(bVar12 < bVar2 || bVar3 < in_CF);
      *piVar16 = iVar9;
      out(*(undefined4 *)(unaff_ESI + -1),uVar11);
      uVar4 = CONCAT44(CONCAT22((short)((uint)param_2 >> 0x10),uVar11),
                       CONCAT31((int3)((uint)iVar9 >> 8),DAT_5f2fdbf2));
      uVar5 = uVar4 / ZEXT48(puVar15);
      uVar4 = uVar4 % ZEXT48(puVar15);
      uVar10 = in(CONCAT11((char)(uVar4 >> 8) + (char)(uVar5 >> 8) + ((byte)uVar5 < 0xd),(char)uVar4
                          ));
      *(undefined4 *)(unaff_EDI + 7) = uVar10;
      return (int)uVar5;
    }
    if (SBORROW4(unaff_EBX,1)) {
      *(int *)(unaff_EBX + -0x21256e1 + (int)piVar16) = (int)ROUND(in_ST0);
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
    out((short)param_2,(char)piVar16);
    *(undefined4 *)(unaff_EBP[1] + -4) = 0xffffffff;
    uVar8 = CONCAT31((int3)((uint)in_EAX >> 8),0xb5) & 0xffffff05;
    out(0x14,uVar8);
    _DAT_8c540b6d = _DAT_8c540b6d + 1;
    in(CONCAT11(bVar12 - cRam0000005a,(byte)param_2 ^ *(byte *)((uVar8 | 0x8c540b6d) + 0x7189676e)))
    ;
    puVar14 = (undefined4 *)*puVar15;
    puVar13 = puVar15 + 1;
    in_EAX = in(0x71);
  }
  puVar14 = (undefined4 *)((int)puVar14 + -1);
  *(char *)piVar16 = (char)in_EAX;
  puVar15 = (undefined4 *)((int)puVar13 + -4);
  *(undefined4 **)((int)puVar13 + -4) = puVar14;
  cVar6 = '\x1c';
  do {
    puVar14 = puVar14 + -1;
    puVar15 = puVar15 + -1;
    *puVar15 = *puVar14;
    cVar6 = cVar6 + -1;
  } while ('\0' < cVar6);
  *(undefined1 **)((int)puVar13 + -0x78) = (undefined1 *)((int)puVar13 + -4);
  return in_EAX;
}


