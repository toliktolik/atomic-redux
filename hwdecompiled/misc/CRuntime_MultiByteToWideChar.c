/*
 * Function: CRuntime_MultiByteToWideChar
 * Address: 004fa729
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* Library Function - Single Match
    __Mbrtowc_lk
   
   Library: Visual Studio 2003 Release */

undefined4 __fastcall
CRuntime_MultiByteToWideChar
          (uint param_1,int param_2,uint param_3,undefined4 param_4,uint param_5,int param_6,
          undefined4 param_7)

{
  uint *in_EAX;
  uint CodePage;
  int iVar1;
  undefined4 uVar2;
  undefined4 *puVar3;
  uint uVar4;
  int iVar5;
  int extraout_ECX;
  undefined4 extraout_ECX_00;
  undefined4 extraout_ECX_01;
  undefined4 extraout_ECX_02;
  undefined4 extraout_ECX_03;
  int extraout_EDX;
  int extraout_EDX_00;
  LPWSTR unaff_EBX;
  int unaff_EBP;
  byte *unaff_ESI;
  byte *unaff_EDI;
  undefined8 uVar6;
  ulonglong uVar7;
  undefined4 unaff_retaddr;
  
  if ((unaff_ESI == (byte *)0x0) || (param_3 == 0)) {
    return 0;
  }
  if (*unaff_ESI == 0) {
    if (unaff_EBX == (LPWSTR)0x0) {
      return 0;
    }
    *unaff_EBX = L'\0';
    return 0;
  }
  if (in_EAX == (uint *)0x0) {
    uVar6 = func_0x00500cca(param_1,param_1);
    uVar4 = *(uint *)((int)uVar6 + 8);
    uVar7 = Assembly_LongLongProcessing(extraout_ECX,(int *)((ulonglong)uVar6 >> 0x20));
    param_2 = (int)(uVar7 >> 0x20);
    CodePage = (uint)uVar7;
    param_1 = uVar4;
  }
  else {
    uVar4 = *in_EAX;
    CodePage = in_EAX[1];
  }
  if (uVar4 == 0) {
    if (unaff_EBX != (LPWSTR)0x0) {
      *unaff_EBX = (ushort)*unaff_ESI;
    }
    return 1;
  }
  if (*(int *)unaff_EDI == 0) {
    uVar6 = Assembly_ComplexParameterProcessing
                      (uVar4,param_2,param_1,(ushort)CodePage,unaff_EBP,unaff_retaddr,param_3,
                       param_4,param_5,param_6,param_7);
    if ((*(byte *)((int)uVar6 + 1 + (uint)*unaff_ESI * 2) & 0x80) == 0) {
      iVar1 = MultiByteToWideChar(CodePage,9,(LPCSTR)unaff_ESI,1,unaff_EBX,
                                  (uint)(unaff_EBX != (LPWSTR)0x0));
      if (iVar1 != 0) {
        return 1;
      }
      goto LAB_004fa7ba;
    }
    uVar6 = Assembly_ConditionalAdd((uint)*unaff_ESI,(int)((ulonglong)uVar6 >> 0x20));
    if (param_3 < (uint)uVar6) {
      *unaff_EDI = *unaff_ESI;
      return 0xfffffffe;
    }
    uVar6 = Assembly_ConditionalAdd(extraout_ECX_01,(int)((ulonglong)uVar6 >> 0x20));
    iVar1 = (int)((ulonglong)uVar6 >> 0x20);
    uVar2 = extraout_ECX_02;
    if (1 < (int)uVar6) {
      uVar4 = (uint)(unaff_EBX != (LPWSTR)0x0);
      iVar1 = Assembly_ConditionalAdd(extraout_ECX_02,iVar1);
      iVar5 = MultiByteToWideChar(CodePage,9,(LPCSTR)unaff_ESI,iVar1,unaff_EBX,uVar4);
      uVar2 = extraout_ECX_03;
      iVar1 = extraout_EDX_00;
      if (iVar5 != 0) goto LAB_004fa7b0;
    }
    if (unaff_ESI[1] != 0) goto LAB_004fa7b0;
  }
  else {
    unaff_EDI[1] = *unaff_ESI;
    iVar1 = Assembly_ConditionalAdd(uVar4,param_2);
    if ((1 < iVar1) &&
       (iVar1 = MultiByteToWideChar(CodePage,9,(LPCSTR)unaff_EDI,2,unaff_EBX,
                                    (uint)(unaff_EBX != (LPWSTR)0x0)), iVar1 != 0)) {
      unaff_EDI[0] = 0;
      unaff_EDI[1] = 0;
      unaff_EDI[2] = 0;
      unaff_EDI[3] = 0;
      uVar2 = extraout_ECX_00;
      iVar1 = extraout_EDX;
LAB_004fa7b0:
      uVar2 = Assembly_ConditionalAdd(uVar2,iVar1);
      return uVar2;
    }
  }
  unaff_EDI[0] = 0;
  unaff_EDI[1] = 0;
  unaff_EDI[2] = 0;
  unaff_EDI[3] = 0;
LAB_004fa7ba:
  puVar3 = (undefined4 *)System_GetSystemInfo();
  *puVar3 = 0x2a;
  return 0xffffffff;
}


