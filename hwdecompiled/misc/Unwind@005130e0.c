/*
 * Function: Unwind@005130e0
 * Address: 005130e0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_005130e0(int param_1,undefined4 param_2)

{
  ushort *puVar1;
  int *piVar2;
  undefined4 uVar3;
  bool bVar4;
  code *pcVar5;
  byte bVar6;
  char cVar7;
  byte bVar8;
  undefined4 uVar9;
  uint uVar10;
  undefined2 uVar11;
  undefined2 *puVar12;
  int iVar13;
  int unaff_EBX;
  undefined4 *unaff_EBP;
  undefined1 *unaff_ESI;
  undefined4 *puVar14;
  undefined4 *unaff_EDI;
  bool bVar15;
  char in_CF;
  char in_AF;
  undefined1 in_OF;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  undefined4 in_FPUDataPointer;
  undefined4 in_FPUInstructionPointer;
  unkbyte10 extraout_ST0;
  unkbyte10 extraout_ST0_00;
  unkbyte10 in_ST0;
  unkbyte10 extraout_ST1;
  unkbyte10 extraout_ST1_00;
  unkbyte10 in_ST1;
  unkbyte10 in_ST2;
  unkbyte10 in_ST3;
  unkbyte10 in_ST4;
  unkbyte10 in_ST5;
  unkbyte10 in_ST6;
  unkbyte10 in_ST7;
  undefined8 uVar16;
  
  do {
    uVar9 = _DAT_43770101;
    puVar14 = unaff_EDI;
    if ((bool)in_OF) {
      *(char *)(param_1 + 0x16d3ecff) =
           (*(char *)(param_1 + 0x16d3ecff) - (char)((uint)param_2 >> 8)) - in_CF;
      *unaff_EDI = param_2;
      return;
    }
    while( true ) {
      unaff_EDI = unaff_EBP;
      iVar13 = unaff_EBX + 1;
      uVar3 = in((short)param_2);
      *puVar14 = uVar3;
      if (iVar13 < 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      bVar8 = (byte)uVar9;
      cVar7 = (char)((uint)iVar13 >> 8);
      iVar13 = CONCAT22((short)((uint)iVar13 >> 0x10),CONCAT11(cVar7 - bVar8,(char)iVar13));
      if ((byte)(cVar7 - bVar8) != '\0') {
        if ((char)bVar8 <= cVar7) {
                    /* WARNING: Bad instruction - Truncating control flow here */
          halt_baddata();
        }
        bVar6 = in((short)param_2);
        uVar16 = CONCAT44(param_2,CONCAT31((int3)((uint)uVar9 >> 8),
                                           *(undefined1 *)(iVar13 + (uint)bVar6)));
        pcVar5 = (code *)swi(4);
        if (SBORROW1(cVar7,bVar8)) {
          uVar16 = (*pcVar5)();
          in_ST0 = extraout_ST0;
          in_ST1 = extraout_ST1;
        }
        pcVar5 = (code *)swi(4);
        if (SBORROW4((int)(puVar14 + 1),1)) {
          uVar16 = (*pcVar5)();
          in_ST0 = extraout_ST0_00;
          in_ST1 = extraout_ST1_00;
        }
        puVar12 = (undefined2 *)((ulonglong)uVar16 >> 0x20);
        *puVar12 = in_FPUControlWord;
        puVar12[2] = in_FPUStatusWord;
        puVar12[4] = in_FPUTagWord;
        *(undefined4 *)(puVar12 + 10) = in_FPUDataPointer;
        *(undefined4 *)(puVar12 + 6) = in_FPUInstructionPointer;
        puVar12[9] = in_FPULastInstructionOpcode;
        *(unkbyte10 *)(puVar12 + 0xe) = in_ST0;
        *(unkbyte10 *)(puVar12 + 0x13) = in_ST1;
        *(unkbyte10 *)(puVar12 + 0x18) = in_ST2;
        *(unkbyte10 *)(puVar12 + 0x1d) = in_ST3;
        *(unkbyte10 *)(puVar12 + 0x22) = in_ST4;
        *(unkbyte10 *)(puVar12 + 0x27) = in_ST5;
        *(unkbyte10 *)(puVar12 + 0x2c) = in_ST6;
        *(unkbyte10 *)(puVar12 + 0x31) = in_ST7;
        piVar2 = unaff_EDI + -0xd433157;
        iVar13 = *piVar2;
        *piVar2 = -*piVar2;
        bVar8 = (byte)unaff_EDI;
        bVar15 = bVar8 < *(byte *)(puVar14 + -0x11);
        bVar8 = bVar8 - *(byte *)(puVar14 + -0x11);
        bVar4 = bVar8 < (iVar13 != 0);
        cVar7 = bVar8 - (iVar13 != 0);
        if ((!bVar15 && !bVar4) && cVar7 != '\0') {
          DAT_35434cac = cVar7 + ((cVar7 == '\0') << 6 | in_AF << 4 |
                                  ((POPCOUNT(cVar7) & 1U) == 0) << 2 | 2U | (bVar15 || bVar4)) * '.'
          ;
          unaff_ESI[0x65] = unaff_ESI[0x65] ^ (byte)*(undefined4 *)((int)uVar16 + 0x50);
          uVar11 = (undefined2)((ulonglong)uVar16 >> 0x20);
          out(uVar11,DAT_35434cac);
          uVar9 = in(uVar11);
          _DAT_55f22b5b = CONCAT31((int3)((uint)uVar9 >> 8),(byte)uVar9 - 0x38);
          puVar1 = (ushort *)(unaff_ESI + 0x95);
          *puVar1 = *puVar1 + (ushort)((byte)uVar9 < 0x38) *
                              (((ushort)(undefined1 *)((int)puVar14 + 2) & 3) - (*puVar1 & 3));
          _DAT_dc3b0d8e = _DAT_55f22b5b;
          *(undefined1 *)((int)puVar14 + 2) = unaff_ESI[4];
          pcVar5 = (code *)swi(3);
          (*pcVar5)();
          return;
        }
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      unaff_EBX = CONCAT31((int3)((uint)iVar13 >> 8),0xbe);
      unaff_EBP = (undefined4 *)(*(int *)((int)puVar14 + 0x26) * -0x37);
      uVar10 = CONCAT31((int3)(CONCAT22((short)((uint)uVar9 >> 0x10),CONCAT11(bVar8 / 0x82,bVar8))
                              >> 8),bVar8 % 0x82) & 0xffffffa9;
      uVar11 = CONCAT11(0xb1,(char)param_2);
      param_2 = CONCAT22((short)((uint)param_2 >> 0x10),uVar11);
      in_CF = uVar10 < 0x3a82b6b7;
      uVar9 = in(uVar11);
      if (!SBORROW4(uVar10,0x3a82b6b7)) break;
      unaff_ESI = &stack0x00000000 + (int)unaff_ESI;
      puVar14 = unaff_EDI;
    }
    in_OF = SBORROW4((int)&stack0x00000000,1);
    *(undefined2 *)(unaff_EBP + -0xf18c810) = in_FPUControlWord;
  } while( true );
}


