/*
 * Function: Unwind@005161e3
 * Address: 005161e3
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00516203) overlaps instruction at (ram,0x00516202)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

uint * __fastcall Unwind_005161e3(int param_1,int *param_2)

{
  byte *pbVar1;
  int *piVar2;
  uint *puVar3;
  byte bVar4;
  undefined4 *puVar5;
  undefined4 uVar6;
  uint uVar7;
  undefined1 uVar8;
  char cVar10;
  undefined1 *in_EAX;
  undefined3 uVar11;
  undefined4 uVar9;
  int extraout_ECX;
  int iVar12;
  byte bVar14;
  uint *puVar13;
  char cVar15;
  int unaff_EBX;
  int iVar16;
  undefined1 *puVar17;
  undefined4 *puVar18;
  int unaff_EBP;
  uint *unaff_ESI;
  uint *puVar19;
  undefined4 *unaff_EDI;
  char *pcVar20;
  undefined2 in_CS;
  undefined2 in_SS;
  bool bVar21;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  undefined4 in_FPUDataPointer;
  undefined4 in_FPUInstructionPointer;
  unkbyte10 extraout_ST0;
  unkbyte10 extraout_ST1;
  unkbyte10 in_ST2;
  unkbyte10 in_ST3;
  unkbyte10 in_ST4;
  unkbyte10 in_ST5;
  unkbyte10 in_ST6;
  unkbyte10 in_ST7;
  undefined8 uVar22;
  
  iVar16 = unaff_EBX + -1;
  if (param_1 != 0) {
    pbVar1 = (byte *)((int)param_2 + -0x32);
    bVar4 = *pbVar1;
    bVar14 = (byte)((uint)param_2 >> 8);
    *pbVar1 = *pbVar1 - bVar14;
    *param_2 = (*param_2 - unaff_EBP) - (uint)(bVar4 < bVar14);
    uVar8 = in((short)param_2);
    *in_EAX = uVar8;
    iVar16 = CONCAT22((short)((uint)iVar16 >> 0x10),
                      CONCAT11((byte)((uint)iVar16 >> 8) ^
                               *(byte *)(((int)unaff_EDI >> 0x1f) + 0x12b2f5ce),(char)iVar16));
    *(int *)(iVar16 + (int)unaff_ESI) = iVar16;
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  puVar5 = *(undefined4 **)((int)param_2 + -0x11);
  uVar11 = (undefined3)((uint)in_EAX >> 8);
  uVar8 = in(0xea);
  *unaff_EDI = CONCAT31(uVar11,uVar8);
  pcVar20 = (char *)(unaff_EDI + 2);
  puVar19 = unaff_ESI + 1;
  uVar6 = *puVar5;
  puVar18 = puVar5 + 1;
  uVar9 = CONCAT31(uVar11,-(*unaff_ESI < (uint)unaff_EDI[1]));
  uVar22 = CONCAT44(uVar6,uVar9);
  iVar12 = 0;
  if ((int)(*unaff_ESI - unaff_EDI[1]) < 0) {
    while( true ) {
      out((short)uVar6,(byte)uVar9);
      out(0x90,uVar9);
      cVar15 = ((char)iVar16 - cRamffffffb7) - (0xbf < (byte)uVar9);
      _DAT_56b7aa01 = _DAT_56b7aa01 - (int)pcVar20;
      piVar2 = (int *)(CONCAT31((int3)((uint)iVar16 >> 8),cVar15) + -0x5a);
      *piVar2 = *piVar2 << 1;
      iVar16 = CONCAT22((short)((uint)iVar16 >> 0x10),
                        CONCAT11((byte)((uint)iVar16 >> 8) | pcVar20[-0x3985275b],cVar15));
      bVar21 = (int)puVar19 < 0;
      puVar19 = (uint *)((int)puVar19 << 1);
      DAT_aa51a6e6 = (undefined1)(_DAT_5a388d95 & 0xffffff7d);
      uVar9 = CONCAT22((short)((_DAT_5a388d95 & 0xffffff7d) >> 0x10),CONCAT11(0xf6,DAT_aa51a6e6));
      *(undefined2 *)(unaff_EBP + 0x7cb5ee24) = in_CS;
      if (bVar21) break;
      pcVar20 = (char *)0xc67ad8a5;
    }
    puVar17 = &DAT_325d583b;
    _DAT_325d583b = 0x51625b;
    _DAT_325d583f = in_CS;
    uVar22 = func_0xb30410a1();
    *(undefined2 *)(iVar16 + 1) = in_FPUControlWord;
    *(undefined2 *)(iVar16 + 5) = in_FPUStatusWord;
    *(undefined2 *)(iVar16 + 9) = in_FPUTagWord;
    *(undefined4 *)(iVar16 + 0x15) = in_FPUDataPointer;
    *(undefined4 *)(iVar16 + 0xd) = in_FPUInstructionPointer;
    *(undefined2 *)(iVar16 + 0x13) = in_FPULastInstructionOpcode;
    *(unkbyte10 *)(iVar16 + 0x1d) = extraout_ST0;
    *(unkbyte10 *)(iVar16 + 0x27) = extraout_ST1;
    *(unkbyte10 *)(iVar16 + 0x31) = in_ST2;
    *(unkbyte10 *)(iVar16 + 0x3b) = in_ST3;
    *(unkbyte10 *)(iVar16 + 0x45) = in_ST4;
    *(unkbyte10 *)(iVar16 + 0x4f) = in_ST5;
    *(unkbyte10 *)(iVar16 + 0x59) = in_ST6;
    *(unkbyte10 *)(iVar16 + 99) = in_ST7;
    *(undefined4 *)(unaff_EBP + -0x51) = *(undefined4 *)(unaff_EBP + -0x51);
    puVar18 = (undefined4 *)(puVar17 + -4);
    *(int *)(puVar17 + -4) = (int)uVar22;
    iVar12 = extraout_ECX;
    if (extraout_ECX == 0) {
                    /* WARNING: Bad instruction - Truncating control flow here */
      halt_baddata();
    }
  }
  puVar13 = (uint *)((ulonglong)uVar22 >> 0x20);
  puVar3 = (uint *)(unaff_EBP + 0x56);
  bVar21 = (*puVar3 & 1) != 0;
  *puVar3 = *puVar3 >> 1;
  uVar7 = *puVar13;
  cVar10 = (char)((ulonglong)uVar22 >> 8);
  cVar15 = (char)*puVar13 - cVar10;
  *(char *)puVar13 = cVar15 - bVar21;
  if ((SBORROW1((char)uVar7,cVar10) != SBORROW1(cVar15,bVar21)) != (char)*puVar13 < '\0') {
    *(undefined2 *)((int)puVar18 + -4) = in_SS;
    *(char *)uVar22 = *(char *)uVar22 + 'B';
    *(undefined4 *)((int)puVar18 + -4) = 0xc2c55ec8;
    do {
    } while ((*(byte *)((int)puVar13 + 0xade5d8f) & 0xf) != 0);
    *(uint *)(pcVar20 + 4) = *puVar19;
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  *puVar13 = *puVar13 ^ (uint)puVar13;
  *pcVar20 = *pcVar20 - (char)iVar12;
  return puVar19;
}


