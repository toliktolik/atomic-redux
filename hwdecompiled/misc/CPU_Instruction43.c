/*
 * Function: CPU_Instruction43
 * Address: 004c9fc0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CPU_Instruction43(uint param_1,byte *param_2,uint param_3,int param_4,byte *param_5)

{
  uint uVar1;
  void *pvVar2;
  int iVar3;
  uint extraout_ECX;
  undefined4 extraout_ECX_00;
  undefined4 extraout_ECX_01;
  undefined4 extraout_ECX_02;
  uint uVar4;
  byte *extraout_EDX;
  byte *extraout_EDX_00;
  byte *extraout_EDX_01;
  byte *extraout_EDX_02;
  byte *extraout_EDX_03;
  byte *extraout_EDX_04;
  byte *pbVar5;
  int iVar6;
  int iVar7;
  
  uVar1 = param_3;
  uVar4 = *(uint *)(param_3 + 0x68);
  if ((uVar4 & 1) == 0) {
    CPU_Instruction20(param_1,param_2,param_3,"Missing IHDR before hIST");
    param_1 = extraout_ECX;
    param_2 = extraout_EDX;
  }
  else {
    if ((uVar4 & 4) != 0) {
      CPU_Instruction21(param_1,param_2,param_3,"Invalid hIST after IDAT");
      CPU_Instruction33(extraout_ECX_01,extraout_EDX_01,uVar1,(uint)param_5);
      return;
    }
    if ((uVar4 & 2) == 0) {
      CPU_Instruction21(param_1,param_2,param_3,"Missing PLTE before hIST");
      CPU_Instruction33(param_5,extraout_EDX_02,uVar1,(uint)param_5);
      return;
    }
    if ((param_4 != 0) && ((*(byte *)(param_4 + 8) & 0x40) != 0)) {
      CPU_Instruction21(param_1,param_2,param_3,"Duplicate hIST chunk");
      CPU_Instruction33(extraout_ECX_02,param_5,uVar1,(uint)param_5);
      return;
    }
  }
  pbVar5 = param_5;
  if (param_5 == (byte *)((uint)*(ushort *)(uVar1 + 0x118) * 2)) {
    iVar7 = (int)param_5 / 2;
    pvVar2 = CPU_Instruction12(uVar1,iVar7 * 2);
    uVar4 = *(uint *)(uVar1 + 0x6c) | 0x4000;
    iVar6 = 0;
    *(void **)(uVar1 + 500) = pvVar2;
    *(uint *)(uVar1 + 0x6c) = uVar4;
    pbVar5 = extraout_EDX_03;
    if (0 < iVar7) {
      do {
        CPU_Instruction26(uVar4,(byte *)((int)&param_3 + 2),uVar1,(byte *)((int)&param_3 + 2),2);
        iVar3 = CPU_Instruction25((byte *)((int)&param_3 + 2));
        uVar4 = *(uint *)(uVar1 + 500);
        *(short *)(uVar4 + iVar6 * 2) = (short)iVar3;
        iVar6 = iVar6 + 1;
        pbVar5 = extraout_EDX_04;
      } while (iVar6 < iVar7);
    }
    iVar6 = CPU_Instruction33(uVar4,pbVar5,uVar1,0);
    if (iVar6 == 0) {
      PNG_SetSigBits(uVar1,param_4,*(undefined4 *)(uVar1 + 500));
    }
    return;
  }
  CPU_Instruction21(param_1,param_2,uVar1,"Incorrect hIST chunk length");
  CPU_Instruction33(extraout_ECX_00,extraout_EDX_00,uVar1,(uint)pbVar5);
  return;
}


