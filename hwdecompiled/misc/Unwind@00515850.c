/*
 * Function: Unwind@00515850
 * Address: 00515850
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x0051587a) overlaps instruction at (ram,0x00515878)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Type propagation algorithm not settling */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

uint __fastcall Unwind_00515850(char *param_1,byte *param_2)

{
  undefined1 *puVar1;
  char *pcVar2;
  uint *puVar3;
  undefined2 *puVar4;
  code *pcVar5;
  byte bVar6;
  ushort uVar7;
  uint in_EAX;
  uint uVar8;
  undefined4 uVar9;
  char *extraout_ECX;
  int extraout_ECX_00;
  int *extraout_ECX_01;
  byte extraout_DH;
  int extraout_EDX;
  char cVar11;
  int iVar10;
  int extraout_EDX_00;
  short sVar12;
  int *unaff_EBX;
  uint unaff_EBP;
  byte *unaff_ESI;
  byte *pbVar13;
  byte *unaff_EDI;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 uVar14;
  undefined2 uVar15;
  undefined2 in_SS;
  byte bVar16;
  bool in_CF;
  bool bVar17;
  byte bVar18;
  bool bVar19;
  byte in_AF;
  bool in_ZF;
  byte in_TF;
  byte in_IF;
  byte in_NT;
  byte in_AC;
  byte in_VIF;
  byte in_VIP;
  byte in_ID;
  undefined8 uVar20;
  
  if (in_CF || in_ZF) {
    bVar18 = 9 < (DAT_0b95117f & 0xf) | in_AF;
    bVar6 = DAT_0b95117f + bVar18 * '\x06';
    in_EAX = CONCAT31((int3)(in_EAX >> 8),
                      bVar6 + (0x90 < (bVar6 & 0xf0) | in_CF | bVar18 * (0xf9 < bVar6)) * '`');
  }
  else if (in_CF) {
    puVar1 = (undefined1 *)segment(in_SS,(short)unaff_EBP + -0x40e0);
    *puVar1 = (char)((uint)param_1 >> 8);
LAB_00515865:
    bVar6 = (byte)((uint)unaff_EBX >> 8);
    bVar17 = bVar6 < *param_2;
    bVar18 = (byte)unaff_EBX;
    sVar12 = CONCAT11(bVar6 - *param_2,bVar18);
    unaff_EBX = (int *)CONCAT22((short)((uint)unaff_EBX >> 0x10),sVar12);
    uVar15 = in_CS;
    do {
      param_1 = (char *)CONCAT22((short)((uint)param_1 >> 0x10),CONCAT11(0x4f,(char)param_1));
      uVar8 = unaff_EBP;
LAB_0051586a:
      unaff_EBP = in_EAX;
      uVar8 = uVar8 + *unaff_EBX + (uint)bVar17;
      bVar6 = POPCOUNT(uVar8 & 0xff);
      bVar17 = false;
      uVar14 = uVar15;
      if (uVar8 != 0) {
        do {
          bVar19 = (bVar6 & 1) == 0;
          if (!bVar19) {
                    /* WARNING: Bad instruction - Truncating control flow here */
            halt_baddata();
          }
          in_EAX = 0x42ba7ced;
          param_1 = (char *)CONCAT31((int3)((uint)param_1 >> 8),0x30);
          in_CS = uVar15;
          while( true ) {
            param_2 = (byte *)((int)uVar8 >> 0x1f);
            uVar8 = unaff_EBP;
            uVar15 = in_CS;
            if (bVar19) goto LAB_0051586a;
            pcVar2 = (char *)segment(in_ES,sVar12 + (short)unaff_ESI + 0x2b84);
            *pcVar2 = *pcVar2 + -1;
            if (!bVar17) goto LAB_00515865;
            bVar17 = CARRY4((uint)_DAT_4bb6b38e,(uint)param_2);
            _DAT_4bb6b38e = _DAT_4bb6b38e + (int)param_2;
            puVar4 = (undefined2 *)segment(in_SS,(short)&stack0x00000000);
            in_SS = *puVar4;
            if (bVar17 || _DAT_4bb6b38e == (byte *)0x0) {
              puVar3 = (uint *)segment(uVar14,(short)unaff_ESI);
              return *puVar3;
            }
            pcVar5 = (code *)swi(0x56);
            (*pcVar5)();
            bVar16 = CARRY1((byte)((uint)extraout_EDX >> 8),*(byte *)(extraout_EDX + 0x37f57a17));
            uVar15 = 0xd7d9;
            uVar8 = func_0x6b7cd101();
            bVar17 = extraout_DH < unaff_ESI[(int)extraout_ECX * 2 + -0x5963ab1];
            bVar6 = extraout_DH - unaff_ESI[(int)extraout_ECX * 2 + -0x5963ab1];
            cVar11 = bVar6 - bVar16;
            in_EAX = CONCAT22((short)(uVar8 >> 0x10),
                              CONCAT11((cVar11 < '\0') << 7 | (cVar11 == '\0') << 6 | in_AF << 4 |
                                       ((POPCOUNT(cVar11) & 1U) == 0) << 2 | 2 |
                                       (bVar17 || bVar6 < bVar16),(char)uVar8));
            param_1 = extraout_ECX;
            if ((!bVar17 && bVar6 >= bVar16) && cVar11 != '\0') break;
            bVar17 = false;
            *unaff_EDI = *unaff_EDI ^ bVar18;
            bVar19 = (POPCOUNT(*unaff_EDI) & 1U) == 0;
            in_CS = uVar15;
          }
          pbVar13 = unaff_EDI + 1;
          uVar8 = in_EAX | 0xbd39c940;
          *extraout_ECX = *extraout_ECX + -0xe;
          unaff_EDI = unaff_EDI + 2;
          bVar17 = *unaff_ESI < *pbVar13;
          bVar6 = POPCOUNT(*unaff_ESI - *pbVar13);
          unaff_ESI = unaff_ESI + 1;
          uVar14 = in_CS;
        } while( true );
      }
      param_1 = param_1 + -1;
      if (param_1 == (char *)0x0) {
        *(int *)unaff_ESI = -*(int *)unaff_ESI;
        bVar18 = 1;
        uVar8 = 0;
        while( true ) {
          out(0x79,(char)uVar8);
          uVar14 = 0x5648;
          uVar20 = func_0xa7c9ff82(uVar15);
          iVar10 = (int)((ulonglong)uVar20 >> 0x20) + _DAT_ee3d47ce + (uint)bVar18;
          bVar18 = in((short)iVar10);
          *unaff_EDI = bVar18;
          if (iVar10 != 0) {
            *(uint *)(unaff_ESI + iVar10 * 2 + -0x238d6f3c) =
                 *(uint *)(unaff_ESI + iVar10 * 2 + -0x238d6f3c) | 0x9a5f7c93;
            return (uint)uVar20;
          }
          uVar8 = (uint)uVar20 ^ 0xe1;
          bVar6 = (byte)(extraout_ECX_00 + -1);
          if (extraout_ECX_00 + -1 == 0 || (byte)uVar20 != 0xe1) break;
          bVar18 = 0;
          unaff_ESI[-0xbc33421] = unaff_ESI[-0xbc33421] & bVar6;
          unaff_EDI = unaff_EDI + 1;
          uVar15 = uVar14;
        }
        uVar7 = (ushort)(byte)(((byte)uVar20 ^ 0xe1) +
                              ((byte)((ulonglong)uVar20 >> 8) & bVar6) * -0x4f);
        func_0xa5f05071((uint)(in_NT & 1) * 0x4000 | (uint)(in_IF & 1) * 0x200 |
                        (uint)(in_TF & 1) * 0x100 | (uint)(uVar7 == 0) * 0x40 |
                        (uint)(in_AF & 1) * 0x10 | (uint)((POPCOUNT(uVar7) & 1U) == 0) * 4 |
                        (uint)(in_ID & 1) * 0x200000 | (uint)(in_VIP & 1) * 0x100000 |
                        (uint)(in_VIF & 1) * 0x80000 | (uint)(in_AC & 1) * 0x40000);
        *(undefined1 *)((int)extraout_ECX_01 + extraout_EDX_00 * 8 + 0x72) = 0;
        *(byte *)((unaff_EBP - 0x3b) - *extraout_ECX_01) = *unaff_ESI;
        uVar15 = 0x568c;
        func_0x810cd19f(uVar14);
        func_0x557dc30e(uVar15);
        uRam4d929dce = (undefined1)unaff_EBP;
        uVar9 = func_0x74e9d57c();
        return CONCAT22((short)((uint)uVar9 >> 0x10),(ushort)(byte)uVar9 * (ushort)unaff_ESI[0x22]);
      }
      bVar17 = (byte)param_2 < *unaff_ESI;
      in_EAX = 0;
    } while( true );
  }
  out(*(int *)unaff_ESI,(short)param_2);
  return in_EAX;
}


