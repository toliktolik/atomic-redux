/*
 * Function: Unwind@005126e0
 * Address: 005126e0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x005127ea) overlaps instruction at (ram,0x005127e9)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING (jumptable): Unable to track spacebase fully for stack */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */

undefined4 __fastcall Unwind_005126e0(int param_1,undefined4 param_2)

{
  ushort *puVar1;
  undefined1 uVar2;
  unkbyte10 Var3;
  uint uVar4;
  code *pcVar5;
  ushort uVar6;
  byte bVar7;
  char cVar8;
  byte bVar11;
  code *UNRECOVERED_JUMPTABLE;
  undefined3 uVar12;
  undefined4 uVar9;
  undefined1 *puVar10;
  undefined4 extraout_ECX;
  int extraout_ECX_00;
  undefined2 uVar13;
  uint uVar14;
  int iVar15;
  byte *unaff_EBX;
  uint *unaff_EBP;
  byte *pbVar16;
  undefined1 *unaff_ESI;
  undefined4 *puVar17;
  undefined4 *puVar18;
  undefined4 *puVar19;
  undefined4 *unaff_EDI;
  uint *puVar20;
  undefined2 in_ES;
  undefined2 in_CS;
  undefined2 in_SS;
  undefined2 in_DS;
  undefined2 in_GS;
  byte in_CF;
  bool bVar21;
  char cVar22;
  bool bVar23;
  undefined2 in_FPUControlWord;
  unkbyte10 in_ST0;
  unkbyte10 extraout_ST0;
  unkbyte10 extraout_ST0_00;
  undefined8 uVar24;
  uint *unaff_retaddr;
  uint *puVar25;
  undefined4 in_stack_0000001c;
  int aiStack_20 [3];
  undefined1 auStack_14 [4];
  int aiStack_10 [3];
  undefined4 uStack_4;
  
  uVar24 = CONCAT44(param_2,in_stack_0000001c);
  puVar1 = (ushort *)((int)unaff_EBP + 0x2657056f);
  *puVar1 = *puVar1 + (ushort)in_CF * (((ushort)UNRECOVERED_JUMPTABLE & 3) - (*puVar1 & 3));
  bVar21 = false;
  out(*unaff_ESI,(short)param_2);
  puVar17 = (undefined4 *)(unaff_ESI + 1);
  do {
    in_stack_0000001c = (undefined4)uVar24;
    puVar20 = (uint *)((int)unaff_EDI + 1);
    puVar18 = (undefined4 *)((int)puVar17 + 1);
    *(undefined1 *)unaff_EDI = *(undefined1 *)puVar17;
    pbVar16 = (byte *)((int)unaff_EBP + -1);
    uVar12 = (undefined3)((uint)UNRECOVERED_JUMPTABLE >> 8);
    uVar13 = (undefined2)((ulonglong)uVar24 >> 0x20);
    if (bVar21 || param_1 + 1 == 0) {
      unaff_EBX = unaff_EBX + *(int *)(pbVar16 + (int)((ulonglong)uVar24 >> 0x20));
      if (-1 < (int)unaff_EBX) {
        uVar12 = (undefined3)((uint)pbVar16 >> 8);
        bVar7 = in(uVar13);
        goto code_r0x005126f0;
      }
LAB_00512767:
      *(int *)(pbVar16 + -0x6e3dba5b) =
           *(int *)(pbVar16 + -0x6e3dba5b) << ((byte)(param_1 + 1) & 0x1f);
      out(0xfb,(char)pbVar16);
      unaff_EBP = (uint *)0xdc7e07a4;
      *(undefined1 **)(unaff_EBX + 0x25b06d68) = &stack0x00000000 + *(int *)(unaff_EBX + 0x25b06d68)
      ;
      Var3 = to_bcd(in_ST0);
      *(unkbyte10 *)(pbVar16 + 0x4c + (int)puVar20) = Var3;
      in_DS = SUB42(unaff_retaddr,0);
      while( true ) {
        *unaff_EBX = *unaff_EBX ^ 0x7b;
        bVar21 = false;
        pcVar5 = (code *)swi(0x11);
        uVar24 = (*pcVar5)();
        UNRECOVERED_JUMPTABLE = (code *)uVar24;
        bVar23 = SCARRY4((int)&stack0x0000001c + 3,1);
        puVar20 = (uint *)(unaff_EBX + -0x1c0fc29a);
        if (bVar21 || &stack0x00000000 == (undefined1 *)0xffffffe0) {
          puVar17[7] = (puVar17[7] - (int)&stack0x00000020) - (uint)bVar21;
                    /* WARNING: Could not recover jumptable at 0x005127a1. Too many branches */
                    /* WARNING: Treating indirect jump as call */
          uVar9 = (*UNRECOVERED_JUMPTABLE)();
          return uVar9;
        }
        param_1 = extraout_ECX_00;
        in_ST0 = extraout_ST0_00;
        puVar25 = puVar20;
        if (&stack0x00000000 != (undefined1 *)0xffffffe0 && bVar23 == (int)&stack0x00000020 < 0)
        break;
        puVar19 = puVar18;
        if (!bVar23) goto code_r0x005127d1;
      }
    }
    else {
      bVar7 = 0x26;
      if (SCARRY4(param_1,1)) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
code_r0x005126f0:
      cVar8 = bVar7 - 0x27;
      pbVar16 = (byte *)CONCAT31(uVar12,cVar8);
      if (bVar7 < 0x27 || cVar8 == '\0') goto LAB_00512767;
      if (cVar8 != '\0' && '&' < (char)bVar7) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      pbVar16 = unaff_EBX + 0x24;
      bVar7 = *pbVar16;
      *pbVar16 = -*pbVar16;
      if ((char)*pbVar16 < '\0') {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      unaff_EBX = unaff_EBX + -1;
      puVar18 = (undefined4 *)((int)puVar17 + 3);
      out(*(undefined1 *)((int)puVar17 + 2),uVar13);
      iVar15 = CONCAT31(uVar12,-(bVar7 != 0));
      cVar22 = SBORROW4(iVar15,1);
      cVar8 = iVar15 + -1 < 0;
      bVar21 = iVar15 == 1;
      puVar25 = (uint *)CONCAT22((short)((uint)unaff_retaddr >> 0x10),in_CS);
      in_CS = 0x816f;
      uStack_4 = 0x512749;
      uVar24 = func_0x8fb10fd0();
      UNRECOVERED_JUMPTABLE = (code *)uVar24;
      param_1 = CONCAT31((int3)((uint)extraout_ECX >> 8),0xcd);
      if (bVar21 || cVar22 != cVar8) {
        pcVar5 = (code *)swi(3);
        uVar9 = (*pcVar5)();
        return uVar9;
      }
      uVar14 = (uint)((ulonglong)uVar24 >> 0x20) & *(uint *)((int)unaff_EDI + 0x7f);
      uVar24 = CONCAT44(uVar14,in_stack_0000001c);
      unaff_EBP = unaff_retaddr;
      in_ST0 = extraout_ST0;
      if (-1 < (int)uVar14) goto LAB_005127b2;
    }
    puVar17 = (undefined4 *)CONCAT22((short)((uint)puVar20 >> 0x10),in_GS);
    unaff_EDI = puVar17 + 1;
    bVar21 = UNRECOVERED_JUMPTABLE < (code *)*puVar17;
    puVar17 = puVar18;
    unaff_retaddr = puVar25;
  } while( true );
code_r0x005127d1:
  do {
    *(undefined2 *)((int)unaff_EBP * 8 + 0x5abae7e3) = in_FPUControlWord;
    in_stack_0000001c = CONCAT22(in_stack_0000001c._2_2_,in_ES);
    *(byte *)((int)puVar19 + 0x46) = *(byte *)((int)puVar19 + 0x46) ^ 0xdc;
    bVar11 = (byte)((ulonglong)uVar24 >> 8);
    uVar14 = CONCAT31((int3)((ulonglong)uVar24 >> 0x28),bVar11);
    *(undefined2 *)(unaff_EBX + -0x16) = in_SS;
    pbVar16 = (byte *)((CONCAT22((short)((ulonglong)uVar24 >> 0x10),
                                 CONCAT11((char)((ulonglong)uVar24 >> 0x20),(char)uVar24)) ^ uVar14)
                      + 0xb8c07f75);
    bVar7 = *pbVar16;
    uVar6 = (ushort)bVar7 << 3;
    *pbVar16 = (byte)uVar6 | bVar7 >> 6;
    uRam5abae779 = 0xffffff94;
    unaff_EBX = unaff_EBX + -1;
    pbVar16 = (byte *)((int)unaff_EBP +
                      (-(uint)((uVar6 & 0x100) != 0) - *(int *)(uVar14 * 2 + 0x5abae7fb)));
    puVar17 = (undefined4 *)0x5abae775;
    unaff_retaddr = (uint *)0x5abae775;
    unaff_EBP = (uint *)0x5abae775;
    cVar8 = '\x1e';
    pbRam5abae775 = pbVar16;
    do {
      pbVar16 = pbVar16 + -4;
      puVar17 = puVar17 + -1;
      *puVar17 = *(undefined4 *)pbVar16;
      cVar8 = cVar8 + -1;
    } while ('\0' < cVar8);
    uRam5abae6f9 = 0x5abae775;
    uVar24 = CONCAT44(uVar14,0x5aba4aca);
    iRam5abae764 = iRam5abae764 << 0x1a;
    bRam51a673a3 = bRam51a673a3 | bVar11;
    cVar8 = bVar11 + 0x24;
    param_1 = CONCAT22(0x994b,CONCAT11(cVar8,0xdf));
    UNRECOVERED_JUMPTABLE = (code *)in(0x1d);
    puVar20 = (uint *)0x5abae779;
    uRam5abae77d = *puVar19;
    if ((SCARRY1(bVar11,'$') != SCARRY1(cVar8,'\0')) == cVar8 < '\0') goto code_r0x00512818;
    puVar18 = puRam5aba4aca;
    puVar19 = puVar19 + -1;
  } while (((uint)UNRECOVERED_JUMPTABLE & 0x7590c0fd) == 0);
LAB_005127b2:
  iVar15 = uVar14 - *(int *)((int)puVar18 + 0x5e80ff7d);
  uVar14 = *puVar20;
  uVar4 = *puVar20;
  if (&stack0x00000000 + uVar4 == (undefined1 *)0x0 ||
      SCARRY4((int)&stack0x00000000,*puVar20) != (int)(&stack0x00000000 + uVar4) < 0) {
    *UNRECOVERED_JUMPTABLE = (code)~(byte)*UNRECOVERED_JUMPTABLE;
    puVar10 = (undefined1 *)
              ((CONCAT22((short)((uint)UNRECOVERED_JUMPTABLE >> 0x10),
                         (ushort)(byte)((byte)UNRECOVERED_JUMPTABLE +
                                       (char)((uint)UNRECOVERED_JUMPTABLE >> 8) * -0x1b)) +
               -0x25d27ca5) - (uint)CARRY4((uint)&stack0x00000000,uVar14));
    LOCK();
    uVar2 = *puVar10;
    *puVar10 = (char)((uint)unaff_EBX >> 8);
    UNLOCK();
    *(undefined1 **)((int)&uStack_4 + uVar4) = puVar10;
    *(int *)((int)aiStack_10 + uVar4 + 8) = param_1;
    *(int *)((int)aiStack_10 + uVar4 + 4) = iVar15;
    *(uint *)((int)aiStack_10 + uVar4) =
         CONCAT22((short)((uint)unaff_EBX >> 0x10),CONCAT11(uVar2,(char)unaff_EBX));
    *(undefined1 **)(auStack_14 + uVar4) = &stack0x00000000 + uVar4;
    *(uint **)((int)aiStack_20 + uVar4 + 8) = unaff_retaddr;
    *(undefined4 **)((int)aiStack_20 + uVar4 + 4) = puVar18;
    *(uint **)((int)aiStack_20 + uVar4) = puVar20;
code_r0x00512818:
    pcVar5 = (code *)swi(3);
    uVar9 = (*pcVar5)();
    return uVar9;
  }
  uVar24 = CONCAT44(iVar15,(int)&uStack_4 + uVar4);
  *(code **)((int)&uStack_4 + uVar4) = UNRECOVERED_JUMPTABLE;
  if ((byte)((byte)*puVar20 & (byte)UNRECOVERED_JUMPTABLE) == 0) {
    uVar9 = *(undefined4 *)((int)&uStack_4 + uVar4);
    uVar14 = *(uint *)((int)puVar18 + 0x71);
    *(undefined1 **)((int)&uStack_4 + uVar4) = &stack0x00000000 + uVar4;
    return (int)(CONCAT44(iVar15,uVar9) / (ulonglong)uVar14);
  }
  *(undefined2 *)((int)puVar18 * 2 + 0x6a) = in_DS;
  unaff_EBP = unaff_retaddr;
  puVar19 = puVar18;
  goto code_r0x005127d1;
}


