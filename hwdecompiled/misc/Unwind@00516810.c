/*
 * Function: Unwind@00516810
 * Address: 00516810
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00516848) overlaps instruction at (ram,0x00516846)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_00516810(int param_1,undefined6 *param_2)

{
  int iVar1;
  int iVar2;
  byte bVar3;
  uint uVar4;
  uint uVar5;
  byte bVar6;
  code *pcVar7;
  undefined6 uVar8;
  undefined2 *in_EAX;
  byte *pbVar9;
  undefined4 extraout_ECX;
  int iVar10;
  uint uVar11;
  undefined4 unaff_EBX;
  char *pcVar12;
  undefined1 *puVar14;
  undefined1 *puVar15;
  int unaff_EBP;
  int *unaff_ESI;
  int *piVar16;
  uint *unaff_EDI;
  int *piVar17;
  int *piVar18;
  char cVar19;
  undefined2 in_FPUControlWord;
  undefined2 in_FPUStatusWord;
  undefined2 in_FPUTagWord;
  undefined2 in_FPULastInstructionOpcode;
  undefined4 in_FPUDataPointer;
  undefined4 in_FPUInstructionPointer;
  unkbyte10 in_ST0;
  unkbyte10 in_ST1;
  unkbyte10 in_ST2;
  unkbyte10 in_ST3;
  unkbyte10 in_ST4;
  unkbyte10 in_ST5;
  unkbyte10 in_ST6;
  unkbyte10 in_ST7;
  undefined8 uVar20;
  int iStack_4;
  byte bVar13;
  
  uVar11 = *unaff_EDI;
  uVar4 = *unaff_EDI;
  puVar14 = &stack0x00000000 + uVar4;
  *(undefined4 *)((int)&iStack_4 + uVar4) = 0xffffffb2;
  uVar8 = *param_2;
  bVar3 = *(byte *)(unaff_EBP + 0x1b);
  bVar13 = (byte)((uint)unaff_EBX >> 8);
  bVar6 = bVar13 + *(byte *)(unaff_EBP + 0x1b);
  pcVar12 = (char *)CONCAT22((short)((uint)unaff_EBX >> 0x10),
                             CONCAT11(bVar6 + CARRY4((uint)&stack0x00000000,uVar11),(char)unaff_EBX)
                            );
  _DAT_54a553da = in_EAX;
  *(char *)unaff_EDI = (char)*unaff_ESI;
  *in_EAX = in_FPUControlWord;
  in_EAX[2] = in_FPUStatusWord;
  in_EAX[4] = in_FPUTagWord;
  *(undefined4 *)(in_EAX + 10) = in_FPUDataPointer;
  *(undefined4 *)(in_EAX + 6) = in_FPUInstructionPointer;
  in_EAX[9] = in_FPULastInstructionOpcode;
  *(unkbyte10 *)(in_EAX + 0xe) = in_ST0;
  *(unkbyte10 *)(in_EAX + 0x13) = in_ST1;
  *(unkbyte10 *)(in_EAX + 0x18) = in_ST2;
  *(unkbyte10 *)(in_EAX + 0x1d) = in_ST3;
  *(unkbyte10 *)(in_EAX + 0x22) = in_ST4;
  *(unkbyte10 *)(in_EAX + 0x27) = in_ST5;
  *(unkbyte10 *)(in_EAX + 0x2c) = in_ST6;
  *(unkbyte10 *)(in_EAX + 0x31) = in_ST7;
  iVar10 = CONCAT22((short)((uint6)uVar8 >> 0x10),
                    CONCAT11(((char)((uint6)uVar8 >> 8) - *pcVar12) -
                             (CARRY1(bVar13,bVar3) ||
                             CARRY1(bVar6,CARRY4((uint)&stack0x00000000,uVar11))),(char)uVar8));
  uVar11 = iVar10 + 1;
  piVar17 = (int *)((int)unaff_EDI + 1);
  do {
    piVar16 = unaff_ESI;
    piVar18 = piVar17;
    if (param_1 == 0) break;
    param_1 = param_1 + -1;
    piVar18 = piVar17 + 1;
    piVar16 = unaff_ESI + 1;
    iVar2 = *piVar17;
    iVar1 = *unaff_ESI;
    unaff_ESI = piVar16;
    piVar17 = piVar18;
  } while (iVar1 != iVar2);
  *(byte *)(unaff_EBP + 0x61) = *(byte *)(unaff_EBP + 0x61) ^ (byte)(uVar11 >> 8);
  pbVar9 = (byte *)(int)(short)in_EAX;
  *pbVar9 = *pbVar9 ^ (byte)in_EAX;
  uVar5 = *(uint *)(iVar10 + 0x7e);
  cVar19 = uVar5 < uVar11;
  if ((POPCOUNT(uVar5 - uVar11 & 0xff) & 1U) != 0) {
    puVar14 = *(undefined1 **)((int)&iStack_4 + uVar4);
    *(byte **)(puVar14 + -4) = pbVar9;
  }
  puVar15 = puVar14 + -4;
  pcVar7 = (code *)swi(0x5e);
  uVar20 = (*pcVar7)();
  *(undefined4 *)(puVar15 + -4) = 0x2f7e5492;
  XACQUIRE();
  LOCK();
  *(undefined4 *)(pcVar12 + 0x5871149b) = extraout_ECX;
  UNLOCK();
  piVar17 = (int *)(((CONCAT31((int3)((ulonglong)uVar20 >> 8),-cVar19) ^ 0xde6e4f1f) - 0x65) +
                   (int)((ulonglong)uVar20 >> 0x20) * 2);
  *piVar17 = (int)(pcVar12 + *piVar17);
  *piVar18 = *piVar16;
                    /* WARNING: Bad instruction - Truncating control flow here */
  halt_baddata();
}


