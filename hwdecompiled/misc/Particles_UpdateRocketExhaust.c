/*
 * Function: Particles_UpdateRocketExhaust
 * Address: 0041b340
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Particles_UpdateRocketExhaust(void *param_1)

{
  int iVar1;
  void *this;
  int iVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  int *piVar6;
  float10 fVar7;
  float10 fVar8;
  int iVar9;
  undefined4 *puVar10;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x5108bb;
  local_10 = ExceptionList;
  if ((NAN(*(double *)((int)param_1 + 0x88)) || NAN(_DAT_0052a0c0)) !=
      (*(double *)((int)param_1 + 0x88) == _DAT_0052a0c0)) {
    if (*(char *)((int)param_1 + 0x327) == '\0') {
      iVar9 = *(int *)(*(int *)((int)param_1 + 0x5c) + 0x960);
    }
    else {
      iVar9 = *(int *)((int)param_1 + 0x17c) / 12000;
    }
    ExceptionList = &local_10;
    iVar1 = Collision_HandleEnemyHit();
    if ((((iVar1 % 0x96 == 0) && (*(int *)((int)param_1 + 0x178) == 0)) &&
        (*(int *)((int)param_1 + 0x1bc) == 0)) &&
       ((*(int *)((int)param_1 + 300) == 0 && (*(int *)(*(int *)((int)param_1 + 0x2fc) + 0x14) == 0)
        ))) {
      *(undefined4 *)((int)param_1 + 0x178) = 1000;
      *(uint *)((int)param_1 + 0x178) =
           (-(uint)(*(char *)((int)param_1 + 0x327) != '\0') & 0xfffffe70) + 1000;
      iVar1 = Particles_UpdateSparks((int)param_1);
      if (-1 < iVar1) {
        this = operator_new(0x98);
        local_8 = 0;
        if (this != (void *)0x0) {
          Particle_InitializeSparks(this,(int)param_1,iVar1);
        }
        local_8 = 0xffffffff;
      }
    }
    *(undefined4 *)((int)param_1 + 0x2b8) = *(undefined4 *)((int)param_1 + 0x2b4);
    while (iVar1 = *(int *)(*(int *)((int)param_1 + 0x2b8) + 4), iVar1 != 0) {
      *(int *)((int)param_1 + 0x2b8) = iVar1;
      if (*(int *)((int)param_1 + 0x2c0) == 0) {
        piVar6 = (int *)0x0;
      }
      else {
        piVar6 = (int *)**(undefined4 **)((int)param_1 + 0x2b8);
      }
      for (uVar5 = 0; (piVar6[3] != 0 && (uVar5 < (uint)(piVar6[4] - piVar6[3] >> 2)));
          uVar5 = uVar5 + 1) {
        iVar1 = *piVar6;
        iVar2 = piVar6[1] / *(int *)(piVar6[7] + uVar5 * 4);
        fVar7 = (float10)iVar1 / (float10)iVar2;
        fVar8 = (float10)(iVar1 / iVar2);
        if (((NAN(fVar8) || NAN(fVar7)) != (fVar8 == fVar7)) && (0 < iVar1)) {
          SexyWidget_HandleMouseEvents(param_1,*(undefined4 *)(piVar6[3] + uVar5 * 4));
        }
      }
      if (*piVar6 == 0) {
        iVar1 = *(int *)((int)param_1 + 0x2b8);
        if (iVar1 != *(int *)((int)param_1 + 0x2b4)) {
          if (iVar1 == *(int *)((int)param_1 + 700)) {
            *(undefined4 *)((int)param_1 + 700) = *(undefined4 *)(iVar1 + 8);
          }
          uVar5 = *(uint *)(iVar1 + 8);
          *(undefined4 *)(uVar5 + 4) = *(undefined4 *)(iVar1 + 4);
          iVar9 = *(int *)(*(int *)((int)param_1 + 0x2b8) + 4);
          if (iVar9 != 0) {
            uVar5 = *(uint *)(*(int *)((int)param_1 + 0x2b8) + 8);
            *(uint *)(iVar9 + 8) = uVar5;
          }
          iVar1 = **(int **)((int)param_1 + 0x2b8);
          if (iVar1 == 0) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(iVar9,uVar5);
          }
          if (*(int *)(iVar1 + 0x1c) != 0) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(iVar9,uVar5);
          }
          *(undefined4 *)(iVar1 + 0x1c) = 0;
          *(undefined4 *)(iVar1 + 0x20) = 0;
          *(undefined4 *)(iVar1 + 0x24) = 0;
          if (*(int *)(iVar1 + 0xc) != 0) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(iVar9,uVar5);
          }
          *(undefined4 *)(iVar1 + 0xc) = 0;
          *(undefined4 *)(iVar1 + 0x10) = 0;
          *(undefined4 *)(iVar1 + 0x14) = 0;
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(iVar9,uVar5);
        }
      }
      else {
        *piVar6 = *piVar6 + -1;
        *(undefined4 *)((int)param_1 + 0x1d0) = 500;
      }
    }
    if (*(int *)((int)param_1 + 0x1d0) == 0) {
      iVar1 = *(int *)((int)param_1 + 0x5c);
      if ((*(int *)(iVar1 + 0x960) == 0) && (*(int *)((int)param_1 + 0x17c) < 2000)) {
        puVar10 = (undefined4 *)0x0;
        iVar9 = 0;
      }
      else {
        if (*(int *)(iVar1 + 0x146c) == 0) {
          iVar2 = 0;
        }
        else {
          iVar2 = *(int *)(iVar1 + 0x1470) - *(int *)(iVar1 + 0x146c) >> 4;
        }
        iVar3 = iVar9;
        if (iVar2 <= iVar9) {
          if (*(int *)(iVar1 + 0x146c) == 0) {
            iVar3 = 0;
          }
          else {
            iVar3 = *(int *)(iVar1 + 0x1470) - *(int *)(iVar1 + 0x146c) >> 4;
          }
          iVar3 = iVar3 + -1;
        }
        iVar2 = iVar3 * 0x10 + *(int *)(iVar1 + 0x146c);
        iVar1 = *(int *)(iVar2 + 4);
        if (iVar1 == 0) {
          uVar5 = 0;
        }
        else {
          uVar5 = (*(int *)(iVar2 + 8) - iVar1) / 0x28;
        }
        uVar4 = Collision_HandleEnemyHit();
        puVar10 = (undefined4 *)(uVar4 % uVar5);
      }
      Particles_UpdateSmoke(param_1,iVar9,puVar10);
    }
    else {
      *(int *)((int)param_1 + 0x1d0) = *(int *)((int)param_1 + 0x1d0) + -1;
    }
    if ((*(int *)((int)param_1 + 0x200) == *(int *)((int)param_1 + 0x1bc)) &&
       (100 < *(int *)((int)param_1 + 0x1d0))) {
      *(undefined4 *)((int)param_1 + 0x1d0) = 100;
    }
  }
  ExceptionList = local_10;
  return;
}


