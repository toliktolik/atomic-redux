/*
 * Function: Unwind@00516fc1
 * Address: 00516fc1
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Control flow encountered bad instruction data */
/* WARNING: Instruction at (ram,0x00516ff6) overlaps instruction at (ram,0x00516ff2)
    */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: Removing unreachable block (ram,0x00517054) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall Unwind_00516fc1(int param_1,byte *param_2)

{
  char *pcVar1;
  char cVar2;
  uint uVar3;
  char cVar4;
  short sVar5;
  code *pcVar6;
  uint uVar7;
  undefined1 in_AL;
  byte *pbVar8;
  uint *puVar9;
  byte *pbVar10;
  uint unaff_EBX;
  int unaff_EBP;
  undefined1 *unaff_ESI;
  undefined1 *puVar11;
  undefined1 *puVar12;
  undefined1 *unaff_EDI;
  uint *puVar13;
  undefined1 *puVar14;
  undefined2 in_GS;
  undefined1 in_CF;
  bool bVar15;
  bool bVar16;
  undefined2 in_FPUControlWord;
  undefined2 uVar17;
  undefined2 in_FPUStatusWord;
  undefined2 uVar18;
  undefined2 in_FPUTagWord;
  undefined2 uVar19;
  undefined2 in_FPULastInstructionOpcode;
  undefined2 uVar20;
  undefined4 in_FPUDataPointer;
  undefined4 uVar21;
  undefined4 in_FPUInstructionPointer;
  undefined4 uVar22;
  float10 in_ST0;
  float10 fVar23;
  float10 in_ST1;
  float10 fVar24;
  float10 in_ST2;
  float10 fVar25;
  float10 in_ST3;
  float10 fVar26;
  float10 in_ST4;
  float10 fVar27;
  float10 in_ST5;
  float10 fVar28;
  float10 in_ST6;
  float10 fVar29;
  float10 in_ST7;
  
  *unaff_EDI = in_AL;
  puVar14 = unaff_EDI + 2;
  unaff_EDI[1] = *unaff_ESI;
  puVar9 = (uint *)(param_1 + -1);
  puVar11 = unaff_ESI + 1;
  if (puVar9 == (uint *)0x0) {
    return;
  }
  while( true ) {
    puVar13 = (uint *)0x25495fe5;
    DAT_25495fe4 = in((short)param_2);
    unaff_EBX = unaff_EBX + 1;
    out((short)param_2,(char)puVar14);
    LOCK();
    puVar12 = *(undefined1 **)(param_2 + 0x11);
    *(undefined1 **)(param_2 + 0x11) = puVar11;
    UNLOCK();
    pbVar10 = (byte *)CONCAT22((short)((uint)param_2 >> 0x10),CONCAT11(0x53,(char)param_2));
    pbVar8 = (byte *)0x1e9fd818;
    param_2 = pbVar10;
    uVar17 = in_FPUControlWord;
    uVar18 = in_FPUStatusWord;
    uVar19 = in_FPUTagWord;
    uVar20 = in_FPULastInstructionOpcode;
    uVar21 = in_FPUDataPointer;
    uVar22 = in_FPUInstructionPointer;
    fVar23 = in_ST0;
    fVar24 = in_ST1;
    fVar25 = in_ST2;
    fVar26 = in_ST3;
    fVar27 = in_ST4;
    fVar28 = in_ST5;
    fVar29 = in_ST6;
    if (!(bool)in_CF) {
      while( true ) {
        unaff_EBX = 0xe4c50d2b;
        bVar15 = ((uint)puVar14 & 0x40) != 0;
        bVar16 = ((uint)puVar14 & 1) != 0;
        if (bVar15) {
          *(undefined2 *)pbVar10 = in_GS;
          pcVar6 = (code *)swi(1);
          (*pcVar6)();
          return;
        }
        puVar9 = (uint *)((int)puVar9 + -1);
        if (puVar9 != (uint *)0x0 && bVar15) break;
        uVar3 = (uint)bVar16;
        bVar16 = CARRY4((uint)puVar13,(uint)puVar13);
        bVar15 = SCARRY4((int)puVar13,(int)puVar13);
        uVar7 = (int)puVar13 * 2;
        puVar13 = (uint *)(uVar7 + uVar3);
        unaff_EBP = (int)_DAT_be6a9e40;
        *puVar13 = *puVar13 << 0xe |
                   (uint)(CONCAT14((puVar13 == (uint *)0x0 ||
                                   (bVar15 != SCARRY4(uVar7,uVar3)) != (int)puVar13 < 0) &&
                                   (bVar16 || CARRY4(uVar7,uVar3)),*puVar13) >> 0x13);
        puVar12 = puVar11;
      }
      sVar5 = ((ushort)puVar12 & 3) - ((ushort)puVar9 & 3);
      puVar9 = (uint *)CONCAT22((short)((uint)puVar9 >> 0x10),
                                (ushort)puVar9 + (ushort)bVar16 * sVar5);
      uVar17 = 0x37f;
      uVar18 = 0;
      uVar19 = 0xffff;
      uVar21 = 0;
      uVar22 = 0;
      uVar20 = 0;
      uVar3 = *puVar9;
      uRamadc41f0c = in_FPUControlWord;
      uRamadc41f10 = in_FPUStatusWord;
      uRamadc41f14 = in_FPUTagWord;
      uRamadc41f18 = in_FPUInstructionPointer;
      uRamadc41f1e = in_FPULastInstructionOpcode;
      uRamadc41f20 = in_FPUDataPointer;
      fRamadc41f28 = in_ST0;
      fRamadc41f32 = in_ST1;
      fRamadc41f3c = in_ST2;
      fRamadc41f46 = in_ST3;
      fRamadc41f50 = in_ST4;
      fRamadc41f5a = in_ST5;
      fRamadc41f64 = in_ST6;
      fRamadc41f6e = in_ST7;
      *puVar9 = *puVar9 << 1 | (uint)((int)uVar3 < 0);
      if ((int)uVar3 >= 0 && sVar5 < 1) {
        pcVar6 = (code *)swi(1);
        (*pcVar6)();
        return;
      }
      fVar23 = (float10)*(int *)pbVar10;
      param_2 = (byte *)CONCAT31(0x58fad8,*(byte *)(unaff_EBP + -0x19) | 0xcb);
      pbVar8 = pbVar10;
      fVar24 = in_ST0;
      fVar25 = in_ST1;
      fVar26 = in_ST2;
      fVar27 = in_ST3;
      fVar28 = in_ST4;
      fVar29 = in_ST5;
      in_ST7 = in_ST6;
    }
    puVar14 = (undefined1 *)((uint)puVar13 | *puVar9);
    *(uint *)(puVar14 + -0x1b) = *(uint *)(puVar14 + -0x1b) ^ unaff_EBX;
    _DAT_0a02db66 = _DAT_0a02db66 & unaff_EBX;
    bVar16 = SCARRY4(unaff_EBP,1);
    unaff_EBP = unaff_EBP + 1;
    out(0x92,pbVar8);
    if (bVar16 == unaff_EBP < 0) break;
    unaff_EBX = 0x1fa6a224;
    pbVar10 = puVar12 + 5;
    in_CF = CARRY1(*pbVar10,(byte)puVar9);
    *pbVar10 = *pbVar10 + (byte)puVar9;
    puVar9 = (uint *)((int)puVar9 + -1);
    puVar11 = puVar12;
    in_FPUControlWord = uVar17;
    in_FPUStatusWord = uVar18;
    in_FPUTagWord = uVar19;
    in_FPULastInstructionOpcode = uVar20;
    in_FPUDataPointer = uVar21;
    in_FPUInstructionPointer = uVar22;
    in_ST0 = fVar23;
    in_ST1 = fVar24;
    in_ST2 = fVar25;
    in_ST3 = fVar26;
    in_ST4 = fVar27;
    in_ST5 = fVar28;
    in_ST6 = fVar29;
    if (puVar9 == (uint *)0x0 || *pbVar10 != 0) {
code_r0x0051701c:
      out(*puVar12,(short)param_2);
      bVar16 = (byte)puVar14 < *pbVar8;
      pcVar1 = puVar12 + 0x1e;
      cVar2 = *pcVar1;
      cVar4 = *pcVar1 + (char)unaff_EBX;
      *pcVar1 = cVar4 + bVar16;
      if ((SCARRY1(cVar2,(char)unaff_EBX) != SCARRY1(cVar4,bVar16)) == *pcVar1 < '\0') {
        *(double *)(param_2 + 0x44) = (double)fVar23;
        *(undefined4 *)(puVar14 + -4) = 0xf;
        *(undefined1 **)(puVar14 + -8) = puVar14 + -4;
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
      *(int *)(puVar12 + 1) = unaff_EBP;
      pcVar6 = (code *)swi(3);
      (*pcVar6)();
      return;
    }
  }
  puVar14 = puVar14 + 1;
  goto code_r0x0051701c;
}


