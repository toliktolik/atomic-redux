/*
 * Function: D3D_SetProjectionMatrix
 * Address: 00483cf0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 * __thiscall
D3D_SetProjectionMatrix(void *this,undefined4 *param_1,undefined4 *param_2,undefined4 *param_3)

{
  undefined4 *puVar1;
  undefined4 *puVar2;
  undefined4 uVar3;
  undefined4 *puVar4;
  uint uVar5;
  int iVar6;
  int iVar7;
  uint uVar8;
  undefined4 *puVar9;
  undefined4 local_20;
  undefined4 local_1c;
  undefined4 *local_18;
  undefined1 *local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  puVar9 = param_2;
  puVar1 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &DAT_00514b00;
  local_10 = ExceptionList;
  local_20 = *param_3;
  local_1c = param_3[1];
  iVar7 = *(int *)((int)this + 4);
  local_18 = (undefined4 *)param_3[2];
  local_14 = &stack0xffffffd4;
  if (iVar7 == 0) {
    uVar5 = 0;
    puVar4 = local_18;
  }
  else {
    iVar6 = *(int *)((int)this + 0xc) - iVar7;
    puVar4 = (undefined4 *)(iVar6 * 0x2aaaaaab);
    uVar5 = iVar6 / 0xc;
  }
  if (param_2 != (undefined4 *)0x0) {
    if (iVar7 == 0) {
      iVar6 = 0;
    }
    else {
      iVar6 = (*(int *)((int)this + 8) - iVar7) / 0xc;
    }
    if ((undefined4 *)(0x15555555U - iVar6) < param_2) {
      ExceptionList = &local_10;
      local_14 = &stack0xffffffd4;
      puVar1 = (undefined4 *)Memory_ZeroBuffer();
      ExceptionList = local_10;
      return puVar1;
    }
    if (iVar7 == 0) {
      iVar6 = 0;
    }
    else {
      iVar6 = (*(int *)((int)this + 8) - iVar7) / 0xc;
    }
    if (uVar5 < (uint)(iVar6 + (int)param_2)) {
      if (0x15555555 - (uVar5 >> 1) < uVar5) {
        uVar5 = 0;
      }
      else {
        uVar5 = uVar5 + (uVar5 >> 1);
      }
      if (iVar7 == 0) {
        iVar7 = 0;
      }
      else {
        iVar7 = (*(int *)((int)this + 8) - iVar7) / 0xc;
      }
      ExceptionList = &local_10;
      local_14 = &stack0xffffffd4;
      if (uVar5 < (uint)(iVar7 + (int)param_2)) {
        ExceptionList = &local_10;
        local_14 = &stack0xffffffd4;
        iVar7 = DataBuffer_GetCount((int)this);
        uVar5 = iVar7 + (int)puVar9;
      }
      param_3 = (undefined4 *)operator_new(uVar5 * 0xc);
      local_8 = 0;
      param_2 = (undefined4 *)DirectX_ResetDevice(*(undefined4 **)((int)this + 4),param_1,param_3);
      System_HandleSystemMessage(param_2,(int)puVar9,&local_20);
      DirectX_ResetDevice(param_1,*(undefined4 **)((int)this + 8),param_2 + (int)puVar9 * 3);
      iVar7 = *(int *)((int)this + 4);
      if (iVar7 == 0) {
        uVar8 = 0;
      }
      else {
        uVar8 = (*(int *)((int)this + 8) - iVar7) / 0xc;
      }
      if (iVar7 != 0) {
                    /* WARNING: Subroutine does not return */
        System_ShutdownHandler(iVar7,uVar8);
      }
      *(undefined4 **)((int)this + 0xc) = param_3 + uVar5 * 3;
      *(undefined4 **)((int)this + 8) = param_3 + ((int)puVar9 + uVar8) * 3;
      *(undefined4 **)((int)this + 4) = param_3;
      ExceptionList = local_10;
      return param_3;
    }
    param_3 = *(undefined4 **)((int)this + 8);
    if ((undefined4 *)(((int)param_3 - (int)param_1) / 0xc) < param_2) {
      puVar2 = (undefined4 *)((int)param_2 * 0xc + (int)param_1);
      ExceptionList = &local_10;
      param_1 = (undefined4 *)((int)param_2 * 0xc);
      puVar4 = param_3;
      param_3 = (undefined4 *)&stack0xffffffc8;
      local_14 = &stack0xffffffd4;
      Database_FetchResults(puVar1,puVar4,puVar2);
      local_8 = 2;
      Database_BeginTransaction
                (*(undefined4 **)((int)this + 8),
                 (int)puVar9 - ((int)*(undefined4 **)((int)this + 8) - (int)puVar1) / 0xc,&local_20)
      ;
      iVar7 = *(int *)((int)this + 8) + (int)param_1;
      *(int *)((int)this + 8) = iVar7;
      puVar9 = (undefined4 *)(iVar7 - (int)param_1);
    }
    else {
      param_1 = param_3 + (int)param_2 * -3;
      ExceptionList = &local_10;
      uVar3 = Database_FetchResults(param_1,param_3,param_3);
      puVar2 = param_3;
      puVar4 = param_1;
      *(undefined4 *)((int)this + 8) = uVar3;
      param_2 = (undefined4 *)&stack0xffffffd0;
      param_3 = (undefined4 *)&stack0xffffffcc;
      param_1 = (undefined4 *)&stack0xffffffc8;
      System_ProcessMemoryCleanup(&param_1,puVar1,puVar4,puVar2);
      puVar9 = puVar1 + (int)puVar9 * 3;
    }
    param_1 = (undefined4 *)&stack0xffffffc8;
    puVar4 = (undefined4 *)Memory_ClearImageBuffer(puVar1,puVar9,&local_20);
  }
  ExceptionList = local_10;
  return puVar4;
}


