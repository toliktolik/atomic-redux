/*
 * Function: Particles_UpdateSparks
 * Address: 0041aa90
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined4 __fastcall Particles_UpdateSparks(int param_1)

{
  int iVar1;
  int *piVar2;
  uint uVar3;
  int iVar4;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  int extraout_ECX_03;
  uint extraout_EDX;
  int iVar5;
  uint uVar6;
  uint uVar7;
  undefined4 uVar8;
  undefined4 *puVar9;
  bool bVar10;
  ulonglong uVar11;
  undefined1 local_34 [4];
  int local_30;
  undefined4 *local_2c;
  int local_28;
  double local_24;
  uint local_1c;
  int local_18;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  puStack_c = &DAT_005108f8;
  local_10 = ExceptionList;
  puVar9 = (undefined4 *)0x0;
  local_30 = 0;
  local_2c = (undefined4 *)0x0;
  local_28 = 0;
  local_8 = 0;
  if (*(char *)(param_1 + 0x327) == '\0') {
    local_18 = *(int *)(*(int *)(param_1 + 0x5c) + 0x960);
  }
  else {
    local_18 = *(int *)(param_1 + 0x17c) / 12000;
  }
  local_14 = 0;
  local_24 = (double)local_18;
  ExceptionList = &local_10;
  do {
    uVar7 = local_14;
    iVar4 = local_14 * 0x30;
    uVar6 = *(uint *)(*(int *)(param_1 + 0x5c) + 0x968 + local_14 * 4);
    local_1c = uVar6;
    if (((local_24 * (double)(&DAT_0052bb40)[local_14 * 6] < (double)(int)uVar6 ==
          (NAN(local_24 * (double)(&DAT_0052bb40)[local_14 * 6]) || NAN((double)(int)uVar6))) ||
        ((double)(&DAT_0052bb40)[local_14 * 6] <= _DAT_0052a0c0)) &&
       (uVar6 != (&DAT_0052bb38)[local_14 * 0xc])) {
      if (local_14 == 0) {
        if (*(int *)(param_1 + 0x1b0) == 0) {
          uVar11 = Collision_HandleEnemyHit();
          uVar6 = (uint)(uVar11 >> 0x20);
          uVar3 = (uint)uVar11 & 0x80000001;
          bVar10 = (uVar11 & 0x80000001) == 0;
          if ((int)uVar3 < 0) {
            bVar10 = (uVar3 - 1 | 0xfffffffe) == 0xffffffff;
          }
          iVar4 = extraout_ECX_01;
          if (bVar10) goto LAB_0041ab54;
        }
      }
      else if ((local_14 != 1) || (*(int *)(param_1 + 0x1b4) == 0)) {
LAB_0041ab54:
        Vector_PushBack_4ByteObjects(local_34,&local_14);
        iVar4 = extraout_ECX;
        uVar6 = extraout_EDX;
        uVar7 = local_14;
        puVar9 = local_2c;
      }
    }
    local_14 = uVar7 + 1;
    if (5 < (int)local_14) {
      if (*(char *)(param_1 + 0x327) != '\0') {
        iVar4 = 0;
        piVar2 = (int *)(*(int *)(param_1 + 0x5c) + 0x980);
        iVar5 = 6;
        do {
          iVar1 = *piVar2;
          piVar2 = piVar2 + 1;
          iVar4 = iVar4 + iVar1;
          iVar5 = iVar5 + -1;
        } while (iVar5 != 0);
        uVar6 = 0;
        if (iVar4 < local_18) {
          local_14 = 0;
          iVar5 = 0x980;
          do {
            if (*(int *)(iVar5 + *(int *)(param_1 + 0x5c)) < 3) {
              local_18 = local_14 + 6;
              if ((local_30 == 0) ||
                 ((uint)(local_28 - local_30 >> 2) <= (uint)((int)puVar9 - local_30 >> 2))) {
                Boss_ProcessBattleshipAttack(local_34,puVar9,(undefined4 *)0x1,&local_18);
                iVar4 = extraout_ECX_02;
                puVar9 = local_2c;
              }
              else {
                ArrayInit_4ByteObjects(puVar9,1,&local_18);
                local_2c = puVar9 + 1;
                iVar4 = extraout_ECX_00;
                puVar9 = local_2c;
              }
            }
            iVar5 = iVar5 + 4;
            uVar6 = local_14 + 1;
            local_14 = uVar6;
          } while (iVar5 < 0x998);
        }
      }
      iVar5 = local_30;
      if ((local_30 == 0) || (uVar7 = (int)puVar9 - local_30 >> 2, uVar7 == 0)) {
        uVar8 = 0xffffffff;
      }
      else {
        uVar6 = Collision_HandleEnemyHit();
        uVar6 = uVar6 % uVar7;
        uVar8 = *(undefined4 *)(iVar5 + uVar6 * 4);
        iVar4 = extraout_ECX_03;
      }
      if (iVar5 == 0) {
        ExceptionList = local_10;
        return uVar8;
      }
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(iVar4,uVar6);
    }
  } while( true );
}


