/*
 * Function: Unwind@00512690
 * Address: 00512690
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Instruction at (ram,0x0051274f) overlaps instruction at (ram,0x0051274d)
    */
/* WARNING: Control flow encountered bad instruction data */
/* WARNING (jumptable): Unable to track spacebase fully for stack */
/* WARNING: Unable to track spacebase fully for stack */
/* WARNING: This function may have set the stack pointer */

int Unwind_00512690(void)

{
  byte *pbVar1;
  uint uVar2;
  code *pcVar3;
  byte bVar4;
  byte bVar5;
  ushort uVar6;
  ushort uVar11;
  undefined3 uVar10;
  int iVar8;
  byte *pbVar9;
  undefined4 extraout_ECX;
  undefined4 extraout_ECX_00;
  int extraout_ECX_01;
  undefined2 uVar12;
  undefined4 extraout_EDX;
  undefined4 *puVar13;
  undefined4 uVar14;
  uint uVar15;
  int iVar16;
  uint *unaff_EBX;
  int *piVar17;
  undefined1 *puVar18;
  int *piVar19;
  undefined4 *puVar20;
  undefined1 *unaff_EBP;
  undefined1 *puVar21;
  int *piVar22;
  int *piVar23;
  uint *unaff_EDI;
  undefined2 in_ES;
  undefined2 uVar24;
  undefined2 in_SS;
  undefined2 in_DS;
  undefined2 in_GS;
  char in_CF;
  undefined1 uVar25;
  byte in_AF;
  undefined1 uVar26;
  bool bVar27;
  char cVar28;
  char cVar29;
  undefined2 in_FPUControlWord;
  unkbyte10 extraout_ST0;
  unkbyte10 Var30;
  unkbyte10 extraout_ST0_00;
  undefined8 uVar31;
  uint *puVar7;
  
  uVar24 = 0xf6c6;
  func_0x8ddb3605();
  piVar17 = (int *)CONCAT31((int3)((uint)extraout_ECX >> 8),((char)extraout_ECX + '\x12') - in_CF);
  puVar13 = (undefined4 *)
            (CONCAT22((short)((uint)extraout_EDX >> 0x10),
                      CONCAT11((char)unaff_EBX,(char)extraout_EDX)) + 1);
  puVar20 = (undefined4 *)*puVar13;
  uVar25 = CARRY4((uint)puVar13,(uint)unaff_EBP);
  uVar26 = (undefined1 *)((int)puVar13 + (int)unaff_EBP) == (undefined1 *)0x0;
  *(undefined2 *)piVar17 = in_ES;
  uVar14 = 0x531fc924;
  pcVar3 = (code *)swi(4);
  if (SCARRY4((int)puVar13,(int)unaff_EBP)) {
    uVar31 = (*pcVar3)();
    uVar14 = (undefined4)((ulonglong)uVar31 >> 0x20);
    register0x00000010 = (BADSPACEBASE *)uVar31;
  }
  if ((bool)uVar25 || (bool)uVar26) {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  uVar10 = (undefined3)((uint)uVar14 >> 8);
  *(undefined2 *)((int)piVar17 + -4) = in_ES;
  puVar7 = (uint *)((int)unaff_EBX + (int)unaff_EBP * 2 + 0x760a04ca);
  uVar15 = *puVar7;
  *puVar7 = uVar15 << 0x17 | (uint)(CONCAT14(uVar25,uVar15) >> 10);
  out((short)CONCAT31(uVar10,0xfa),(char)register0x00000010);
  uVar11 = (ushort)((uint)register0x00000010 >> 0x10);
  uVar6 = CONCAT11(2,(char)register0x00000010);
  puVar7 = (uint *)CONCAT22(uVar11,uVar6);
  uVar15 = CONCAT31(uVar10,0xcc);
  *puVar7 = *puVar7 & uVar15;
  iVar8 = *(int *)((int)piVar17 + -4);
  piVar23 = puVar20 + 1;
  out(*puVar20,(short)uVar15);
  *unaff_EBX = *unaff_EBX >> 0x1a | *unaff_EBX << 6;
  bVar5 = *(byte *)(uVar15 - 0x4c);
  bVar4 = (byte)(uVar6 / bVar5);
  *piVar23 = *piVar23 - iVar8;
  in_AF = 9 < (bVar4 & 0xf) | in_AF;
  uVar15 = CONCAT31((int3)(((uint)uVar11 << 0x10) >> 8),bVar4 + in_AF * '\x06') & 0xffffff0f;
  iVar8 = CONCAT22((short)(uVar15 >> 0x10),
                   CONCAT11((char)(uVar6 % (ushort)bVar5) + in_AF,(char)uVar15));
  if (-1 < *piVar23) {
    return iVar8;
  }
LAB_00512741:
  cVar29 = SBORROW4(iVar8,1);
  cVar28 = iVar8 + -1 < 0;
  bVar27 = iVar8 == 1;
  *(undefined2 *)((int)piVar17 + -4) = uVar24;
  uVar24 = 0x816f;
  piVar19 = (int *)((int)piVar17 + -8);
  *(undefined4 *)((int)piVar17 + -8) = 0x512749;
  uVar31 = func_0x8fb10fd0();
  pbVar9 = (byte *)uVar31;
  iVar8 = CONCAT31((int3)((uint)extraout_ECX_00 >> 8),0xcd);
  if (bVar27 || cVar29 != cVar28) {
    pcVar3 = (code *)swi(3);
    iVar8 = (*pcVar3)();
    return iVar8;
  }
  uVar15 = (uint)((ulonglong)uVar31 >> 0x20) & *(uint *)((int)unaff_EDI + 0x7e);
  uVar31 = CONCAT44(uVar15,pbVar9);
  piVar22 = piVar23;
  Var30 = extraout_ST0;
  if (-1 < (int)uVar15) goto LAB_005127b2;
  do {
    iVar16 = (int)((ulonglong)uVar31 >> 0x20);
    puVar7 = (uint *)CONCAT22((short)((uint)unaff_EDI >> 0x10),in_GS);
    unaff_EDI = (uint *)((int)puVar7 + 5);
    piVar23 = (int *)((int)piVar22 + 1);
    *(char *)(puVar7 + 1) = (char)*piVar22;
    puVar21 = unaff_EBP + -1;
    uVar10 = (undefined3)((ulonglong)uVar31 >> 8);
    uVar12 = (undefined2)((ulonglong)uVar31 >> 0x20);
    if ((uint)uVar31 < *puVar7 || iVar8 + 1 == 0) {
      unaff_EBX = (uint *)((int)unaff_EBX + *(int *)(puVar21 + iVar16));
      if (-1 < (int)unaff_EBX) {
        uVar10 = (undefined3)((uint)puVar21 >> 8);
        bVar5 = in(uVar12);
        goto code_r0x005126f0;
      }
    }
    else {
      bVar5 = 0x26;
      if (SCARRY4(iVar8,1)) {
                    /* WARNING: Bad instruction - Truncating control flow here */
        halt_baddata();
      }
code_r0x005126f0:
      cVar28 = bVar5 - 0x27;
      puVar21 = (undefined1 *)CONCAT31(uVar10,cVar28);
      if (0x26 < bVar5 && cVar28 != '\0') break;
    }
    *(int *)(puVar21 + -0x6e3dba5b) = *(int *)(puVar21 + -0x6e3dba5b) << ((byte)(iVar8 + 1) & 0x1f);
    out(0xfb,(char)puVar21);
    unaff_EBP = (undefined1 *)0xdc7e07a4;
    unaff_EBX[0x96c1b5a] = unaff_EBX[0x96c1b5a] + (int)piVar19;
    Var30 = to_bcd(Var30);
    *(unkbyte10 *)(puVar21 + 0x4c + (int)unaff_EDI) = Var30;
    in_DS = (undefined2)*piVar19;
    *piVar19 = iVar16;
    while( true ) {
      puVar18 = (undefined1 *)0x586188dd;
      *(byte *)unaff_EBX = (byte)*unaff_EBX ^ 0x7b;
      bVar27 = false;
      pcVar3 = (code *)swi(0x11);
      uVar31 = (*pcVar3)();
      pbVar9 = puVar18 + 1;
      unaff_EDI = (uint *)((int)unaff_EBX + -0x1c0fc29a);
      if (bVar27 || puVar18 == (undefined1 *)0xffffffff) {
        piVar22[7] = (piVar22[7] - (int)(puVar18 + 1)) - (uint)bVar27;
                    /* WARNING: Could not recover jumptable at 0x005127a1. Too many branches */
                    /* WARNING: Treating indirect jump as call */
        iVar8 = (*(code *)uVar31)();
        return iVar8;
      }
      if (puVar18 != (undefined1 *)0xffffffff && SCARRY4((int)puVar18,1) == (int)(puVar18 + 1) < 0)
      break;
      if (!SCARRY4((int)puVar18,1)) goto code_r0x005127d1;
    }
    *(code **)(puVar18 + -3) = (code *)uVar31;
    *(int *)(puVar18 + -7) = extraout_ECX_01;
    *(int *)(puVar18 + -0xb) = (int)((ulonglong)uVar31 >> 0x20);
    *(uint **)(puVar18 + -0xf) = unaff_EBX;
    *(undefined1 **)(puVar18 + -0x13) = puVar18 + 1;
    *(undefined4 *)(puVar18 + -0x17) = 0xdc7e07a4;
    *(int **)(puVar18 + -0x1b) = piVar23;
    piVar19 = (int *)(puVar18 + -0x1f);
    *(uint **)(puVar18 + -0x1f) = unaff_EDI;
    iVar8 = extraout_ECX_01;
    piVar22 = piVar23;
    Var30 = extraout_ST0_00;
  } while( true );
  if (cVar28 != '\0' && '&' < (char)bVar5) {
    halt_baddata();
  }
  puVar7 = unaff_EBX + 9;
  uVar15 = *puVar7;
  *(byte *)puVar7 = -(byte)*puVar7;
  if ((char)(byte)*puVar7 < '\0') {
                    /* WARNING: Bad instruction - Truncating control flow here */
    halt_baddata();
  }
  unaff_EBP = (undefined1 *)*piVar19;
  piVar17 = piVar19 + 1;
  unaff_EBX = (uint *)((int)unaff_EBX + -1);
  piVar23 = (int *)((int)piVar22 + 3);
  out(*(undefined1 *)((int)piVar22 + 2),uVar12);
  iVar8 = CONCAT31(uVar10,-((byte)uVar15 != 0));
  goto LAB_00512741;
code_r0x005127d1:
  *(undefined2 *)((int)unaff_EBP * 8 + 0x5abae7e3) = in_FPUControlWord;
  *(undefined2 *)(pbVar9 + -4) = in_ES;
  *(byte *)((int)piVar23 + 0x46) = *(byte *)((int)piVar23 + 0x46) ^ 0xdc;
  bVar4 = (byte)((ulonglong)uVar31 >> 8);
  uVar15 = CONCAT31((int3)((ulonglong)uVar31 >> 0x28),bVar4);
  *(undefined2 *)((int)unaff_EBX + -0x16) = in_SS;
  pbVar9[-0xffffffff00000008] = 0x7d;
  pbVar9[-0xffffffff00000007] = 0xe7;
  pbVar9[-0xffffffff00000006] = 0xba;
  pbVar9[-0xffffffff00000005] = 0x5a;
  pbVar1 = (byte *)((CONCAT22((short)((ulonglong)uVar31 >> 0x10),
                              CONCAT11((char)((ulonglong)uVar31 >> 0x20),(char)uVar31)) ^ uVar15) +
                   0xb8c07f75);
  bVar5 = *pbVar1;
  uVar6 = (ushort)bVar5 << 3;
  *pbVar1 = (byte)uVar6 | bVar5 >> 6;
  iVar16 = *(int *)(pbVar9 + -8);
  *(undefined4 *)(iVar16 + -4) = 0xffffff94;
  unaff_EBX = (uint *)((int)unaff_EBX + -1);
  puVar13 = (undefined4 *)
            (unaff_EBP + (-(uint)((uVar6 & 0x100) != 0) - *(int *)(uVar15 * 2 + 0x5abae7fb)));
  puVar20 = (undefined4 *)(iVar16 + -8);
  unaff_EBP = (undefined1 *)(iVar16 + -8);
  *(undefined4 **)(iVar16 + -8) = puVar13;
  cVar28 = '\x1e';
  do {
    puVar13 = puVar13 + -1;
    puVar20 = puVar20 + -1;
    *puVar20 = *puVar13;
    cVar28 = cVar28 + -1;
  } while ('\0' < cVar28);
  *(int *)(iVar16 + -0x84) = iVar16 + -8;
  uVar31 = CONCAT44(uVar15,iVar16 + -0x9cb3);
  *(int *)(iVar16 + -0x19) = *(int *)(iVar16 + -0x19) << 0x1a;
  *(byte *)(iVar16 + -0x91473da) = *(byte *)(iVar16 + -0x91473da) | bVar4;
  cVar28 = bVar4 + 0x24;
  iVar8 = CONCAT22(0x994b,CONCAT11(cVar28,0xdf));
  pbVar9 = (byte *)in(0x1d);
  unaff_EDI = (uint *)0x5abae779;
  iRam5abae77d = *piVar23;
  if ((SCARRY1(bVar4,'$') != SCARRY1(cVar28,'\0')) == cVar28 < '\0') {
code_r0x00512818:
    pcVar3 = (code *)swi(3);
    iVar8 = (*pcVar3)();
    return iVar8;
  }
  if (((uint)pbVar9 & 0x7590c0fd) == 0) {
    pbVar9 = (undefined1 *)0x6a365c8c;
    unaff_EBP = (undefined1 *)(iVar16 + -8);
    piVar23 = piVar23 + -1;
  }
  else {
    piVar23 = *(int **)(iVar16 + -0x9cb3);
    piVar19 = (int *)(iVar16 + -0x9caf);
LAB_005127b2:
    iVar16 = uVar15 - *(int *)((int)piVar23 + 0x5e80ff7d);
    uVar15 = *unaff_EDI;
    uVar2 = *unaff_EDI;
    if ((undefined1 *)((int)piVar19 + uVar2) == (undefined1 *)0x0 ||
        SCARRY4((int)piVar19,*unaff_EDI) != (int)((int)piVar19 + uVar2) < 0) {
      *pbVar9 = ~*pbVar9;
      puVar21 = (undefined1 *)
                ((CONCAT22((short)((uint)pbVar9 >> 0x10),
                           (ushort)(byte)((byte)pbVar9 + (char)((uint)pbVar9 >> 8) * -0x1b)) +
                 -0x25d27ca5) - (uint)CARRY4((uint)piVar19,uVar15));
      LOCK();
      uVar25 = *puVar21;
      *puVar21 = (char)((uint)unaff_EBX >> 8);
      UNLOCK();
      *(undefined1 **)((int)piVar19 + (uVar2 - 4)) = puVar21;
      *(int *)((int)piVar19 + (uVar2 - 8)) = iVar8;
      *(int *)((int)piVar19 + (uVar2 - 0xc)) = iVar16;
      *(uint *)((int)piVar19 + (uVar2 - 0x10)) =
           CONCAT22((short)((uint)unaff_EBX >> 0x10),CONCAT11(uVar25,(char)unaff_EBX));
      *(undefined1 **)((int)piVar19 + (uVar2 - 0x14)) = (undefined1 *)((int)piVar19 + uVar2);
      *(undefined1 **)((int)piVar19 + (uVar2 - 0x18)) = unaff_EBP;
      *(int **)((int)piVar19 + (uVar2 - 0x1c)) = piVar23;
      *(uint **)((int)piVar19 + (uVar2 - 0x20)) = unaff_EDI;
      goto code_r0x00512818;
    }
    uVar31 = CONCAT44(iVar16,(undefined1 *)((int)piVar19 + (uVar2 - 4)));
    *(byte **)((int)piVar19 + (uVar2 - 4)) = pbVar9;
    if ((byte)((byte)*unaff_EDI & (byte)pbVar9) == 0) {
      uVar14 = *(undefined4 *)((int)piVar19 + (uVar2 - 4));
      uVar15 = *(uint *)((int)piVar23 + 0x71);
      *(undefined1 **)((int)piVar19 + (uVar2 - 4)) = (undefined1 *)((int)piVar19 + uVar2);
      return (int)(CONCAT44(iVar16,uVar14) / (ulonglong)uVar15);
    }
    *(undefined2 *)((int)piVar23 * 2 + 0x6a) = in_DS;
  }
  goto code_r0x005127d1;
}


