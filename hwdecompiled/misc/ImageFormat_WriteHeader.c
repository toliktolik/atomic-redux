/*
 * Function: ImageFormat_WriteHeader
 * Address: 004bcfd0
 * Category: misc
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


undefined4 * __cdecl
ImageFormat_WriteHeader(char *param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  char cVar1;
  undefined4 *puVar2;
  void *pvVar3;
  undefined4 *extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  uint extraout_ECX_02;
  uint uVar4;
  uint extraout_ECX_03;
  uint extraout_ECX_04;
  undefined4 extraout_EDX;
  uint extraout_EDX_00;
  byte *extraout_EDX_01;
  undefined8 uVar5;
  char *pcVar6;
  
  puVar2 = CPU_Instruction10(1);
  if (puVar2 == (undefined4 *)0x0) {
    return (undefined4 *)0x0;
  }
  uVar5 = Assembly_LoopingConstruct(extraout_ECX,extraout_EDX);
  if ((int)uVar5 != 0) {
    CPU_Instruction13(extraout_ECX_00,(uint)((ulonglong)uVar5 >> 0x20),(int)puVar2,puVar2[0x2b]);
    CPU_Instruction11(extraout_ECX_01,extraout_EDX_00,(int)puVar2);
    return (undefined4 *)0x0;
  }
  CPU_Instruction19((int)puVar2,param_2,param_3,param_4);
  uVar4 = extraout_ECX_02;
  if (param_1 == (char *)0x0) {
LAB_004bd046:
    CPU_Instruction20(uVar4,extraout_EDX_01,(int)puVar2,
                      "Incompatible libpng version in application and library");
  }
  else {
    cVar1 = *param_1;
    uVar4 = CONCAT31((int3)(extraout_ECX_02 >> 8),cVar1);
    if ((cVar1 != s_1_0_5_00567cc8[0]) || ((cVar1 == '0' && (param_1[2] < '9')))) goto LAB_004bd046;
  }
  puVar2[0x2c] = 0x2000;
  pvVar3 = CPU_Instruction12((int)puVar2,0x2000);
  puVar2[0x2b] = pvVar3;
  puVar2[0x25] = PixelFormat_UnpackPixel;
  puVar2[0x26] = PixelFormat_GetRedComponent;
  puVar2[0x27] = puVar2;
  uVar5 = CPU_Instruction8((int)(puVar2 + 0x1d),"1.1.3",0x38);
  uVar4 = extraout_ECX_03;
  switch((int)uVar5) {
  case 0:
    goto switchD_004bd0a4_caseD_0;
  case -6:
    pcVar6 = "zlib version error";
    break;
  default:
    pcVar6 = "Unknown zlib error";
    break;
  case -4:
  case -2:
    pcVar6 = "zlib memory error";
  }
  CPU_Instruction20(extraout_ECX_03,(byte *)((ulonglong)uVar5 >> 0x20),(int)puVar2,pcVar6);
  uVar4 = extraout_ECX_04;
switchD_004bd0a4_caseD_0:
  puVar2[0x20] = (byte *)puVar2[0x2b];
  puVar2[0x21] = puVar2[0x2c];
  CPU_Instruction4(uVar4,(byte *)puVar2[0x2b],(uint)puVar2,0,0);
  return puVar2;
}


