/*
 * Function: WaveSystem_LoadWavesXML
 * Address: 0040ba90
 * Category: levels
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall WaveSystem_LoadWavesXML(void *param_1,uint param_2,long param_3)

{
  _String_base _Var1;
  int iVar2;
  char cVar3;
  undefined4 *puVar4;
  _String_base *p_Var5;
  char *pcVar6;
  char *pcVar7;
  int iVar8;
  int iVar9;
  int extraout_ECX;
  char *pcVar10;
  int extraout_ECX_00;
  int extraout_ECX_01;
  int extraout_ECX_02;
  int extraout_ECX_03;
  undefined2 extraout_DX;
  uint extraout_EDX;
  char *extraout_EDX_00;
  char *pcVar11;
  char *extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint uVar12;
  char *extraout_EDX_07;
  char *extraout_EDX_08;
  char *extraout_EDX_09;
  char *extraout_EDX_10;
  char *extraout_EDX_11;
  undefined4 *unaff_ESI;
  byte ****ppppbVar13;
  undefined4 *unaff_EDI;
  byte *pbVar14;
  bool bVar15;
  bool bVar16;
  uint unaff_retaddr;
  _String_base local_138 [4];
  char local_134 [4];
  char local_130 [4];
  char local_12c [2];
  char local_12a;
  int local_118 [9];
  byte ***local_f4 [4];
  char *local_e4;
  uint local_e0;
  undefined1 local_c0 [24];
  undefined1 local_a8 [4];
  int local_a4;
  char *local_94;
  uint local_90;
  undefined1 local_8c [4];
  uint local_88;
  undefined4 local_78;
  uint local_74;
  undefined1 local_70 [4];
  uint local_6c;
  uint local_5c;
  uint local_58;
  undefined1 local_54 [4];
  int local_50;
  int local_4c;
  undefined4 local_48;
  void *local_44;
  long local_40 [2];
  undefined1 local_38 [4];
  int local_34;
  undefined4 *local_30;
  int local_2c;
  undefined1 local_28 [4];
  int local_24;
  undefined4 *local_20;
  int local_1c;
  undefined4 *local_18;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_0050fd54;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  local_44 = param_1;
  Vector_Destructor_16ByteObjects((int)param_1 + 0x1468,param_2);
  local_18 = (undefined4 *)operator_new(0x74);
  local_8 = 0;
  if (local_18 == (undefined4 *)0x0) {
    puVar4 = (undefined4 *)0x0;
  }
  else {
    puVar4 = (undefined4 *)ObjectType1_Constructor(local_18);
  }
  local_18 = puVar4;
  local_8 = 0xffffffff;
  if ((char)param_3 == '\0') {
    local_138[0] = (_String_base)s_data_waves_xml_0052a6ec[0];
    local_138[1] = (_String_base)s_data_waves_xml_0052a6ec[1];
    local_138[2] = (_String_base)s_data_waves_xml_0052a6ec[2];
    local_138[3] = (_String_base)s_data_waves_xml_0052a6ec[3];
    local_134[0] = s_data_waves_xml_0052a6ec[4];
    local_134[1] = s_data_waves_xml_0052a6ec[5];
    local_134[2] = s_data_waves_xml_0052a6ec[6];
    local_134[3] = s_data_waves_xml_0052a6ec[7];
    local_130[0] = s_data_waves_xml_0052a6ec[8];
    local_130[1] = s_data_waves_xml_0052a6ec[9];
    local_130[2] = s_data_waves_xml_0052a6ec[10];
    local_130[3] = s_data_waves_xml_0052a6ec[0xb];
    local_12c[0] = s_data_waves_xml_0052a6ec[0xc];
    local_12c[1] = s_data_waves_xml_0052a6ec[0xd];
    local_12a = s_data_waves_xml_0052a6ec[0xe];
  }
  else {
    Collision_HandleEnemyHit();
    Exception_Release(local_138,"data\\survival%i.xml");
  }
  p_Var5 = local_138;
  local_58 = 0xf;
  local_5c = 0;
  local_6c = local_6c & 0xffffff00;
  do {
    _Var1 = *p_Var5;
    p_Var5 = p_Var5 + 1;
  } while (_Var1 != (_String_base)0x0);
  String_Assign(local_70,local_138,(int)p_Var5 - (int)(local_138 + 1));
  local_8 = 1;
  Image_UpdateTexture((int)puVar4,extraout_DX,(int)local_70);
  local_8 = 0xffffffff;
  if (0xf < local_58) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(extraout_ECX,local_6c);
  }
  WeaponBomb_ProcessBurstingRocket((int)local_118);
  local_50 = 0;
  local_4c = 0;
  local_48 = 0;
  local_34 = 0;
  local_30 = (undefined4 *)0x0;
  local_2c = 0;
  local_24 = 0;
  local_20 = (undefined4 *)0x0;
  local_1c = 0;
  local_8 = 5;
  cVar3 = XML_ParseDocument((int)puVar4,extraout_EDX,local_118);
  pcVar11 = extraout_EDX_00;
  do {
    if (cVar3 == '\0') {
      if (local_18 != (undefined4 *)0x0) {
        (**(code **)*local_18)(1);
      }
      local_8 = 0xffffffff;
      PowerUp_ProcessNuke((int)local_118);
      ExceptionList = local_10;
      Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),unaff_EDI,unaff_ESI);
      return;
    }
    if (local_118[0] == 1) {
      pcVar11 = "evel";
      pcVar10 = "Level";
      do {
        pcVar6 = pcVar10;
        pcVar10 = pcVar6 + 1;
      } while (*pcVar6 != '\0');
      pcVar6 = pcVar6 + -0x52a528;
      if (local_e4 != (char *)0x0) {
        pcVar10 = local_e4;
        if (pcVar6 <= local_e4) {
          pcVar10 = pcVar6;
        }
        ppppbVar13 = (byte ****)local_f4[0];
        if (local_e0 < 0x10) {
          ppppbVar13 = local_f4;
        }
        bVar15 = false;
        pcVar11 = (char *)0x0;
        bVar16 = true;
        pbVar14 = (byte *)"Level";
        do {
          if (pcVar10 == (char *)0x0) break;
          pcVar10 = pcVar10 + -1;
          bVar15 = *(byte *)ppppbVar13 < *pbVar14;
          bVar16 = *(byte *)ppppbVar13 == *pbVar14;
          ppppbVar13 = (byte ****)((int)ppppbVar13 + 1);
          pbVar14 = pbVar14 + 1;
        } while (bVar16);
        if (!bVar16) {
          pcVar11 = (char *)((1 - (uint)bVar15) - (uint)(bVar15 != 0));
        }
        if (pcVar11 != (char *)0x0) goto LAB_0040c179;
      }
      if ((pcVar6 <= local_e4) &&
         (pcVar11 = (char *)(uint)(local_e4 != pcVar6), pcVar11 == (char *)0x0)) {
        cVar3 = XML_ParseDocument((int)local_18,0,local_118);
        pcVar11 = extraout_EDX_01;
        while (cVar3 != '\0') {
          if (local_118[0] == 1) {
            pcVar11 = "ave";
            pcVar10 = "Wave";
            do {
              pcVar6 = pcVar10;
              pcVar10 = pcVar6 + 1;
            } while (*pcVar6 != '\0');
            pcVar6 = pcVar6 + -0x52a6d0;
            if (local_e4 != (char *)0x0) {
              pcVar10 = local_e4;
              if (pcVar6 <= local_e4) {
                pcVar10 = pcVar6;
              }
              ppppbVar13 = (byte ****)local_f4[0];
              if (local_e0 < 0x10) {
                ppppbVar13 = local_f4;
              }
              bVar15 = false;
              pcVar11 = (char *)0x0;
              bVar16 = true;
              pbVar14 = &DAT_0052a6d0;
              do {
                if (pcVar10 == (char *)0x0) break;
                pcVar10 = pcVar10 + -1;
                bVar15 = *(byte *)ppppbVar13 < *pbVar14;
                bVar16 = *(byte *)ppppbVar13 == *pbVar14;
                ppppbVar13 = (byte ****)((int)ppppbVar13 + 1);
                pbVar14 = pbVar14 + 1;
              } while (bVar16);
              if (!bVar16) {
                pcVar11 = (char *)((1 - (uint)bVar15) - (uint)(bVar15 != 0));
              }
              if (pcVar11 != (char *)0x0) goto LAB_0040c11c;
            }
            if (pcVar6 <= local_e4) {
              pcVar11 = (char *)(uint)(local_e4 != pcVar6);
              if (pcVar11 == (char *)0x0) {
                local_a4._1_3_ = (uint3)((uint)local_a4 >> 8);
                local_90 = 0xf;
                pcVar10 = "length";
                do {
                  pcVar7 = pcVar10;
                  pcVar10 = pcVar7 + 1;
                } while (*pcVar7 != '\0');
                local_94 = pcVar11;
                local_a4._0_1_ = local_e4 != pcVar6;
                String_Assign(local_a8,(_String_base *)"length",(uint)(pcVar7 + -0x52a520));
                local_8._0_1_ = 6;
                iVar8 = StringMap_LookupAndConcatenate
                                  (local_c0,(uint)local_a8,(_String_base *)local_a8);
                if (*(uint *)(iVar8 + 0x18) < 0x10) {
                  pcVar11 = (char *)(iVar8 + 4);
                }
                else {
                  pcVar11 = *(char **)(iVar8 + 4);
                }
                local_40[0] = _atol(pcVar11);
                local_8 = CONCAT31(local_8._1_3_,5);
                if (0xf < local_90) {
                    /* WARNING: Subroutine does not return */
                  System_ShutdownHandler(extraout_ECX_00,extraout_EDX_02);
                }
                local_90 = 0xf;
                local_94 = (char *)0x0;
                local_a4 = (uint)local_a4._1_3_ << 8;
                cVar3 = XML_ParseDocument((int)local_18,extraout_EDX_02,local_118);
                uVar12 = local_5c;
                while (cVar3 != '\0') {
                  if (local_118[0] == 1) {
                    pcVar11 = "Craft";
                    do {
                      pcVar10 = pcVar11;
                      pcVar11 = pcVar10 + 1;
                    } while (*pcVar10 != '\0');
                    pcVar10 = pcVar10 + -0x52a4f8;
                    if (local_e4 != (char *)0x0) {
                      pcVar11 = local_e4;
                      if (pcVar10 <= local_e4) {
                        pcVar11 = pcVar10;
                      }
                      ppppbVar13 = (byte ****)local_f4[0];
                      if (local_e0 < 0x10) {
                        ppppbVar13 = local_f4;
                      }
                      bVar15 = false;
                      iVar8 = 0;
                      bVar16 = true;
                      pbVar14 = (byte *)"Craft";
                      do {
                        if (pcVar11 == (char *)0x0) break;
                        pcVar11 = pcVar11 + -1;
                        bVar15 = *(byte *)ppppbVar13 < *pbVar14;
                        bVar16 = *(byte *)ppppbVar13 == *pbVar14;
                        ppppbVar13 = (byte ****)((int)ppppbVar13 + 1);
                        pbVar14 = pbVar14 + 1;
                      } while (bVar16);
                      if (!bVar16) {
                        iVar8 = (1 - (uint)bVar15) - (uint)(bVar15 != 0);
                      }
                      if (iVar8 != 0) goto LAB_0040c059;
                    }
                    if (pcVar10 <= local_e4) {
                      local_5c = (uint)(local_e4 != pcVar10);
                      if (local_5c == 0) {
                        uVar12 = local_6c >> 8;
                        local_6c = CONCAT31((int3)uVar12,local_e4 != pcVar10);
                        local_58 = 0xf;
                        pcVar11 = "id";
                        do {
                          pcVar10 = pcVar11;
                          pcVar11 = pcVar10 + 1;
                        } while (*pcVar10 != '\0');
                        String_Assign(local_70,(_String_base *)&DAT_0052a6cc,
                                      (uint)(pcVar10 + -0x52a6cc));
                        local_8 = CONCAT31(local_8._1_3_,7);
                        iVar8 = StringMap_LookupAndConcatenate
                                          (local_c0,(uint)local_70,(_String_base *)local_70);
                        param_3 = XML_ValidateCraftIDs(local_44,iVar8);
                        puVar4 = local_30;
                        if ((local_34 == 0) ||
                           ((uint)(local_2c - local_34 >> 2) <=
                            (uint)((int)local_30 - local_34 >> 2))) {
                          Boss_ProcessBattleshipAttack(local_38,local_30,(undefined4 *)0x1,&param_3)
                          ;
                          uVar12 = extraout_EDX_04;
                        }
                        else {
                          ArrayInit_4ByteObjects(local_30,1,&param_3);
                          local_30 = puVar4 + 1;
                          uVar12 = extraout_EDX_03;
                        }
                        puVar4 = local_20;
                        iVar8 = local_24;
                        local_8._0_1_ = 5;
                        if (0xf < local_58) {
                    /* WARNING: Subroutine does not return */
                          System_ShutdownHandler(local_6c,uVar12);
                        }
                        local_58 = 0xf;
                        local_74 = 0xf;
                        local_5c = 0;
                        local_6c = local_6c & 0xffffff00;
                        local_78 = 0;
                        local_88 = local_88 & 0xffffff00;
                        pcVar11 = "qty";
                        do {
                          pcVar10 = pcVar11;
                          pcVar11 = pcVar10 + 1;
                        } while (*pcVar10 != '\0');
                        String_Assign(local_8c,(_String_base *)&DAT_0052a6c8,
                                      (uint)(pcVar10 + -0x52a6c8));
                        local_8 = CONCAT31(local_8._1_3_,8);
                        iVar9 = StringMap_LookupAndConcatenate
                                          (local_c0,(uint)local_8c,(_String_base *)local_8c);
                        if (*(uint *)(iVar9 + 0x18) < 0x10) {
                          pcVar11 = (char *)(iVar9 + 4);
                        }
                        else {
                          pcVar11 = *(char **)(iVar9 + 4);
                        }
                        param_3 = _atol(pcVar11);
                        if ((iVar8 == 0) ||
                           ((uint)(local_1c - iVar8 >> 2) <= (uint)((int)puVar4 - iVar8 >> 2))) {
                          Boss_ProcessBattleshipAttack(local_28,puVar4,(undefined4 *)0x1,&param_3);
                          uVar12 = extraout_EDX_06;
                        }
                        else {
                          ArrayInit_4ByteObjects(puVar4,1,&param_3);
                          local_20 = puVar4 + 1;
                          uVar12 = extraout_EDX_05;
                        }
                        local_8 = CONCAT31(local_8._1_3_,5);
                        if (0xf < local_74) {
                    /* WARNING: Subroutine does not return */
                          System_ShutdownHandler(local_88,uVar12);
                        }
                        local_74 = 0xf;
                        local_78 = 0;
                        local_88 = local_88 & 0xffffff00;
                        uVar12 = local_5c;
                      }
                    }
                  }
                  else if (local_118[0] == 2) {
                    pcVar11 = "Wave";
                    do {
                      pcVar10 = pcVar11;
                      pcVar11 = pcVar10 + 1;
                    } while (*pcVar10 != '\0');
                    pcVar10 = pcVar10 + -0x52a6d0;
                    if (local_e4 != (char *)0x0) {
                      pcVar11 = local_e4;
                      if (pcVar10 <= local_e4) {
                        pcVar11 = pcVar10;
                      }
                      ppppbVar13 = (byte ****)local_f4[0];
                      if (local_e0 < 0x10) {
                        ppppbVar13 = local_f4;
                      }
                      bVar15 = false;
                      iVar8 = 0;
                      bVar16 = true;
                      pbVar14 = &DAT_0052a6d0;
                      do {
                        if (pcVar11 == (char *)0x0) break;
                        pcVar11 = pcVar11 + -1;
                        bVar15 = *(byte *)ppppbVar13 < *pbVar14;
                        bVar16 = *(byte *)ppppbVar13 == *pbVar14;
                        ppppbVar13 = (byte ****)((int)ppppbVar13 + 1);
                        pbVar14 = pbVar14 + 1;
                      } while (bVar16);
                      if (!bVar16) {
                        iVar8 = (1 - (uint)bVar15) - (uint)(bVar15 != 0);
                      }
                      if (iVar8 != 0) goto LAB_0040c059;
                    }
                    if ((pcVar10 <= local_e4) && (local_e4 == pcVar10)) break;
                  }
LAB_0040c059:
                  local_5c = uVar12;
                  cVar3 = XML_ParseDocument((int)local_18,(uint)local_118,local_118);
                  uVar12 = local_5c;
                }
                local_5c = uVar12;
                Wave_ProcessEscalation(local_54,local_40);
                if (local_34 != 0) {
                    /* WARNING: Subroutine does not return */
                  System_ShutdownHandler(extraout_ECX_01,(uint)extraout_EDX_07);
                }
                local_34 = 0;
                local_30 = (undefined4 *)0x0;
                local_2c = 0;
                if (local_24 != 0) {
                    /* WARNING: Subroutine does not return */
                  System_ShutdownHandler(extraout_ECX_01,(uint)extraout_EDX_07);
                }
                local_24 = 0;
                local_20 = (undefined4 *)0x0;
                local_1c = 0;
                pcVar11 = extraout_EDX_07;
              }
            }
          }
          else if (local_118[0] == 2) {
            pcVar11 = "evel";
            pcVar10 = "Level";
            do {
              pcVar6 = pcVar10;
              pcVar10 = pcVar6 + 1;
            } while (*pcVar6 != '\0');
            pcVar6 = pcVar6 + -0x52a528;
            if (local_e4 != (char *)0x0) {
              pcVar10 = local_e4;
              if (pcVar6 <= local_e4) {
                pcVar10 = pcVar6;
              }
              ppppbVar13 = (byte ****)local_f4[0];
              if (local_e0 < 0x10) {
                ppppbVar13 = local_f4;
              }
              bVar15 = false;
              pcVar11 = (char *)0x0;
              bVar16 = true;
              pbVar14 = (byte *)"Level";
              do {
                if (pcVar10 == (char *)0x0) break;
                pcVar10 = pcVar10 + -1;
                bVar15 = *(byte *)ppppbVar13 < *pbVar14;
                bVar16 = *(byte *)ppppbVar13 == *pbVar14;
                ppppbVar13 = (byte ****)((int)ppppbVar13 + 1);
                pbVar14 = pbVar14 + 1;
              } while (bVar16);
              if (!bVar16) {
                pcVar11 = (char *)((1 - (uint)bVar15) - (uint)(bVar15 != 0));
              }
              if (pcVar11 != (char *)0x0) goto LAB_0040c11c;
            }
            if ((pcVar6 <= local_e4) &&
               (pcVar11 = (char *)(uint)(local_e4 != pcVar6), pcVar11 == (char *)0x0)) break;
          }
LAB_0040c11c:
          cVar3 = XML_ParseDocument((int)local_18,(uint)pcVar11,local_118);
          pcVar11 = extraout_EDX_08;
        }
        Vector_PushBack_16ByteObjects((void *)((int)local_44 + 0x1468),local_54);
        iVar2 = local_4c;
        iVar8 = extraout_ECX_02;
        pcVar11 = extraout_EDX_09;
        iVar9 = local_50;
        if (local_50 != 0) {
          for (; iVar9 != iVar2; iVar9 = iVar9 + 0x28) {
            DualDataStructure_Clear(iVar9,(uint)pcVar11);
            iVar8 = extraout_ECX_03;
            pcVar11 = extraout_EDX_10;
          }
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(iVar8,(uint)pcVar11);
        }
        local_50 = 0;
        local_4c = 0;
        local_48 = 0;
      }
    }
LAB_0040c179:
    cVar3 = XML_ParseDocument((int)local_18,(uint)pcVar11,local_118);
    pcVar11 = extraout_EDX_11;
  } while( true );
}


