/*
 * Function: PowerUpSystem_ProcessDroppedPowerUps
 * Address: 0042c2b0
 * Category: powerups
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall PowerUpSystem_ProcessDroppedPowerUps(int *param_1)

{
  uint uVar1;
  double dVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  undefined4 uVar7;
  void *this;
  undefined1 *this_00;
  int iVar8;
  int *piVar9;
  ulonglong uVar10;
  int iVar11;
  char cVar12;
  int iVar13;
  int iVar14;
  char cVar15;
  undefined1 uVar16;
  char cVar17;
  int *piVar18;
  _String_base local_74 [4];
  uint local_70;
  undefined4 local_60;
  uint local_5c;
  _String_base local_58 [4];
  uint local_54;
  undefined4 local_44;
  uint local_40;
  int local_3c [4];
  int local_2c [4];
  undefined1 *local_1c;
  void *local_18;
  uint local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  uStack_c = 0x5119ff;
  local_10 = ExceptionList;
  local_14 = 0;
  ExceptionList = &local_10;
  param_1[3] = param_1[2];
  do {
    while( true ) {
      do {
        do {
          while( true ) {
            if (*(int *)(param_1[3] + 4) == 0) {
              ExceptionList = local_10;
              return;
            }
            param_1[3] = *(int *)(param_1[3] + 4);
            if (param_1[5] == 0) {
              piVar9 = (int *)0x0;
            }
            else {
              piVar9 = *(int **)param_1[3];
            }
            *(double *)(piVar9 + 2) = *(double *)(piVar9 + 2) + *(double *)(piVar9 + 6);
            dVar2 = *(double *)(piVar9 + 6) * _DAT_0052c570;
            *(double *)(piVar9 + 6) = dVar2;
            if (*(double *)(piVar9 + 4) < _DAT_0052f6c8 ==
                (NAN(*(double *)(piVar9 + 4)) || NAN(_DAT_0052f6c8))) {
              if (*(int *)(*param_1 + 0x80) == 0) {
                dVar2 = dVar2 - _DAT_0052f6b8;
                *(double *)(piVar9 + 6) = dVar2;
                if (dVar2 < _DAT_0052f6b0 != (NAN(dVar2) || NAN(_DAT_0052f6b0))) {
                  piVar9[6] = 0;
                  piVar9[7] = -0x40100000;
                }
              }
              piVar9[4] = 0;
              piVar9[5] = 0x407c7000;
            }
            else {
              *(double *)(piVar9 + 4) = *(double *)(piVar9 + 8) + *(double *)(piVar9 + 4);
              dVar2 = *(double *)(piVar9 + 8) + _DAT_0052f6c0;
              *(double *)(piVar9 + 8) = dVar2;
              if (_DAT_0052c560 < dVar2) {
                piVar9[8] = 0;
                piVar9[9] = 0x40080000;
              }
            }
            iVar3 = SexyWidget_GetTextureId(*(int *)(*(int *)(*param_1 + 0x5c) + 0x704));
            local_18 = (void *)(-0x140 - iVar3);
            if ((double)(int)local_18 <= *(double *)(piVar9 + 2)) break;
            iVar3 = param_1[3];
            if (iVar3 != param_1[2]) {
              if (iVar3 == param_1[4]) {
                param_1[4] = *(int *)(iVar3 + 8);
              }
              uVar1 = *(uint *)(iVar3 + 4);
              *(uint *)(*(int *)(iVar3 + 8) + 4) = uVar1;
              iVar3 = *(int *)(param_1[3] + 4);
              if (iVar3 != 0) {
                *(undefined4 *)(iVar3 + 8) = *(undefined4 *)(param_1[3] + 8);
              }
              piVar9 = (int *)param_1[3];
              if (*piVar9 == 0) {
                    /* WARNING: Subroutine does not return */
                System_ShutdownHandler((int)piVar9,uVar1);
              }
                    /* WARNING: Subroutine does not return */
              System_ShutdownHandler((int)piVar9,uVar1);
            }
          }
        } while (*(int *)(*param_1 + 0x80) != 0);
        local_18 = *(void **)(*param_1 + 0x5c);
        cVar17 = '\x01';
        cVar15 = '\0';
        iVar14 = 0;
        uVar10 = Math_FloatToUInt64();
        iVar4 = (int)uVar10;
        iVar3 = *(int *)(*param_1 + 0x98);
        uVar10 = Math_FloatToUInt64();
        iVar5 = (int)uVar10;
        iVar8 = *piVar9;
        iVar13 = *(int *)((int)local_18 + 0x6cc);
        cVar12 = '\0';
        iVar11 = 0;
        uVar10 = Math_FloatToUInt64();
        iVar6 = (int)uVar10;
        uVar10 = Math_FloatToUInt64();
        uVar7 = Collision_PixelPerfectDetection
                          (*(void **)((int)local_18 + 0x704),(int)uVar10,iVar6,iVar8,iVar11,cVar12,
                           iVar13,iVar5,iVar3,iVar4,iVar14,cVar15,cVar17);
      } while ((char)uVar7 == '\0');
      iVar3 = *piVar9;
      iVar8 = *(int *)(*param_1 + 0x5c);
      if (iVar3 < 6) break;
      iVar13 = *(int *)(iVar8 + 0x968 + iVar3 * 4);
      if (iVar13 < 3) {
        *(int *)(iVar8 + 0x968 + iVar3 * 4) = iVar13 + 1;
        this_00 = (undefined1 *)operator_new(0x4c);
        local_8 = 4;
        local_1c = this_00;
        if (this_00 != (undefined1 *)0x0) {
          SexyWidget_GetMatrix(local_3c,0);
          Level_InitializeDictastroika(local_74,"?DEFENSE ORBS" + (*piVar9 + -6) * 0x118 + 1);
          iVar3 = *param_1;
          piVar9 = local_3c;
          local_14 = local_14 | 2;
          iVar8 = *(int *)(iVar3 + 0x98) + -0xd;
          uVar16 = 1;
          local_8 = CONCAT31(local_8._1_3_,5);
          uVar10 = Math_FloatToUInt64();
          FloatingText_Constructor(this_00,iVar3,local_74,(int)uVar10,iVar8,uVar16,piVar9);
        }
        local_8 = 0xffffffff;
        if ((local_14 & 2) != 0) {
          local_14 = local_14 & 0xfffffffd;
          if (0xf < local_5c) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(local_14,local_70);
          }
          local_5c = 0xf;
          local_60 = 0;
          local_70 = local_70 & 0xffffff00;
        }
        iVar3 = **(int **)(*param_1 + 0x5c);
        Math_FloatToUInt64();
        goto LAB_0042c795;
      }
LAB_0042c79d:
      LinkedList_PopNode(param_1 + 2);
    }
    piVar18 = (int *)(iVar8 + 0x968 + iVar3 * 4);
    iVar8 = *piVar18;
    if (iVar8 < *(int *)(&DAT_0052ee88 + iVar3 * 0x30)) {
      *piVar18 = iVar8 + 1;
      local_18 = operator_new(0x4c);
      local_8 = 0;
      if (local_18 != (void *)0x0) {
        SexyWidget_GetMatrix(local_2c,0);
        Level_InitializeDictastroika(local_58,"NUKE ACQUIRED" + *piVar9 * 0x30);
        iVar5 = *param_1;
        piVar18 = local_2c;
        local_14 = local_14 | 1;
        iVar3 = *(int *)(iVar5 + 0x98) + -0xd;
        uVar16 = 1;
        local_8 = CONCAT31(local_8._1_3_,1);
        uVar10 = Math_FloatToUInt64();
        iVar13 = 0x42c530;
        FloatingText_Constructor(local_18,iVar5,local_58,(int)uVar10,iVar3,uVar16,piVar18);
      }
      local_8 = 0xffffffff;
      if ((local_14 & 1) != 0) {
        local_14 = local_14 & 0xfffffffe;
        if (0xf < local_40) {
                    /* WARNING: Subroutine does not return */
          System_ShutdownHandler(local_14,local_54);
        }
        local_40 = 0xf;
        local_44 = 0;
        local_54 = local_54 & 0xffffff00;
      }
      if ((((*piVar9 == 0) &&
           (iVar3 = param_1[1],
           (*(byte *)(*(int *)(iVar3 + 0xb40) * 0x60 + *(int *)(iVar3 + 0x148c) + 0x42) & 2) == 0))
          && ((*(byte *)(iVar3 + 0xb3e) & 2) == 0)) &&
         ((*(int *)(iVar3 + 0x958) == 0 && (*(char *)(*param_1 + 0x327) == '\0')))) {
        this = operator_new(0x128);
        local_8 = 3;
        local_18 = this;
        if (this != (void *)0x0) {
          local_1c = &stack0xffffff64;
          Level_InitializeDictastroika
                    (&stack0xffffff64,
                     "Press the right mouse button to detonate nukes! You can see how many you have by the red icons in the upper-left corner of the screen."
                    );
          TipDialog_Constructor(this,param_1[1],iVar13,iVar5);
        }
        local_8 = 0xffffffff;
        (**(code **)(*(int *)param_1[1] + 0x100))();
        *(byte *)(param_1[1] + 0xb3e) = *(byte *)(param_1[1] + 0xb3e) | 2;
      }
    }
    iVar8 = *piVar9;
    if (((iVar8 == 3) || (iVar8 == 4)) || (iVar8 == 5)) {
      iVar3 = **(int **)(*param_1 + 0x5c);
      Math_FloatToUInt64();
LAB_0042c795:
      (**(code **)(iVar3 + 0xb8))();
      goto LAB_0042c79d;
    }
    if (iVar8 != 1) {
      iVar3 = **(int **)(*param_1 + 0x5c);
      if (iVar8 == 2) {
        Math_FloatToUInt64();
      }
      else {
        Math_FloatToUInt64();
      }
      goto LAB_0042c795;
    }
    iVar3 = **(int **)(*param_1 + 0x5c);
    Math_FloatToUInt64();
    (**(code **)(iVar3 + 0xb8))();
    *(undefined4 *)(*param_1 + 0x160) = 0xff;
    LinkedList_PopNode(param_1 + 2);
  } while( true );
}


