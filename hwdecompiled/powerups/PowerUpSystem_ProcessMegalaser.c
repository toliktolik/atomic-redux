/*
 * Function: PowerUpSystem_ProcessMegalaser
 * Address: 0042db00
 * Category: powerups
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void __fastcall PowerUpSystem_ProcessMegalaser(int *param_1,uint *param_2)

{
  double dVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  undefined4 uVar7;
  void *pvVar8;
  uint extraout_ECX;
  uint *extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint uVar9;
  undefined4 *unaff_ESI;
  undefined4 *unaff_EDI;
  float10 fVar10;
  float10 extraout_ST1;
  ulonglong uVar11;
  uint unaff_retaddr;
  int iVar12;
  char cVar13;
  int iVar14;
  int iVar15;
  char cVar16;
  undefined1 uVar17;
  char cVar18;
  int iVar19;
  int *piVar20;
  _String_base local_6c [28];
  char local_50 [28];
  int local_34 [2];
  double local_2c;
  undefined8 local_24;
  undefined8 local_1c;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_00511b6d;
  local_10 = ExceptionList;
  local_1c = (double)(ulonglong)(uint)local_1c;
  dVar1 = *(double *)(param_1 + 2);
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  *(double *)(param_1 + 2) = dVar1 + *(double *)(param_1 + 6);
  local_2c = *(double *)(param_1 + 8) + *(double *)(param_1 + 4);
  *(double *)(param_1 + 4) = local_2c;
  if ((char)param_1[0xc] == '\0') {
    *(double *)(param_1 + 6) = *(double *)(param_1 + 6) * _DAT_0052c570;
    dVar1 = *(double *)(param_1 + 8) + _DAT_0052c838;
    *(double *)(param_1 + 8) = dVar1;
    if (_DAT_0052c620 < dVar1) {
      param_1[8] = 0;
      param_1[9] = 0x3ff80000;
    }
    if (*(double *)(param_1 + 4) <= _DAT_0052c958) {
      iVar19 = param_1[1];
      if (*(int *)(iVar19 + 0x80) == 0) {
        iVar2 = *(int *)(iVar19 + 0x5c);
        cVar18 = '\x01';
        cVar16 = '\0';
        iVar15 = 0;
        uVar11 = Math_FloatToUInt64();
        iVar3 = (int)uVar11;
        iVar19 = *(int *)(iVar19 + 0x98);
        uVar11 = Math_FloatToUInt64();
        iVar4 = (int)uVar11;
        iVar14 = *(int *)(iVar2 + 0x6cc);
        cVar13 = '\0';
        iVar12 = 0;
        uVar11 = Math_FloatToUInt64();
        iVar5 = (int)uVar11;
        uVar11 = Math_FloatToUInt64();
        iVar6 = (int)uVar11;
        uVar11 = Math_FloatToUInt64();
        uVar7 = Collision_PixelPerfectDetection
                          (*(void **)(iVar2 + 0x774),(int)uVar11,iVar6,iVar5,iVar12,cVar13,iVar14,
                           iVar4,iVar19,iVar3,iVar15,cVar16,cVar18);
        if ((char)uVar7 != '\0') {
          iVar19 = **(int **)(param_1[1] + 0x5c);
          Math_FloatToUInt64();
          (**(code **)(iVar19 + 0xb8))();
          Exception_Release(local_50,"MEGALASER %i%% COMPLETE");
          pvVar8 = operator_new(0x4c);
          local_24 = (double)CONCAT44(pvVar8,(undefined4)local_24);
          local_8 = 0;
          uVar9 = extraout_EDX_01;
          if (pvVar8 != (void *)0x0) {
            SexyWidget_GetMatrix(local_34,0);
            Level_InitializeDictastroika(local_6c,local_50);
            iVar4 = param_1[1];
            piVar20 = local_34;
            uVar17 = 1;
            iVar19 = *(int *)(iVar4 + 0x98);
            local_8 = CONCAT31(local_8._1_3_,1);
            local_1c = (double)CONCAT44(1,(uint)local_1c);
            uVar11 = Math_FloatToUInt64();
            iVar14 = 0x42de2e;
            FloatingText_Constructor(pvVar8,iVar4,local_6c,(int)uVar11,iVar19,uVar17,piVar20);
            uVar9 = extraout_EDX_02;
          }
          local_8 = 0xffffffff;
          if (((ulonglong)local_1c & 0x100000000) != 0) {
            String_Destructor((int)local_6c,uVar9);
          }
          iVar19 = *param_1;
          *(undefined1 *)(param_1 + 0xc) = 1;
          if (((((*(byte *)(*(int *)(iVar19 + 0xb40) * 0x60 + *(int *)(iVar19 + 0x148c) + 0x42) & 2)
                 == 0) && ((*(byte *)(iVar19 + 0xb3e) & 8) == 0)) && (*(int *)(iVar19 + 0x958) == 0)
              ) && (*(char *)(param_1[1] + 0x327) == '\0')) {
            pvVar8 = operator_new(0x128);
            local_24 = (double)CONCAT44(pvVar8,(undefined4)local_24);
            local_8 = 3;
            if (pvVar8 != (void *)0x0) {
              local_1c = (double)CONCAT44(&stack0xffffff6c,(uint)local_1c);
              Level_InitializeDictastroika
                        (&stack0xffffff6c,
                         "Collect all four Megalaser parts to activate this amazingly destructive weapon!"
                        );
              TipDialog_Constructor(pvVar8,*param_1,iVar14,iVar4);
            }
            local_8 = 0xffffffff;
            (**(code **)(*(int *)*param_1 + 0x100))();
            *(ushort *)(*param_1 + 0xb3e) = *(ushort *)(*param_1 + 0xb3e) | 8;
          }
        }
      }
    }
    else {
      iVar19 = **(int **)(param_1[1] + 0x5c);
      Math_FloatToUInt64();
      (**(code **)(iVar19 + 0xb8))();
      SexyAppFramework_HandleActivation
                ((void *)param_1[1],param_1[2],param_1[3],param_1[4],param_1[5],0x32,0x32,param_1[6]
                 ,param_1[7],0,0,0.0);
      iVar19 = 0;
      uVar11 = Math_FloatToUInt64();
      Enemy_SpawnWaves((void *)param_1[1],(int)uVar11,iVar19);
      Enemy_Constructor((int *)(param_1[1] + 0x274),extraout_EDX_00,(int *)param_1[0xd]);
    }
  }
  else {
    local_24 = _DAT_0052f9f0 - (dVar1 + *(double *)(param_1 + 6));
    *(double *)(param_1 + 6) = local_24;
    local_1c = _DAT_0052c5a8 - local_2c;
    *(double *)(param_1 + 8) = local_1c;
    Math_ProcessFloatPrecision((uint)param_1,param_2);
    fVar10 = (float10)Math_ProcessFloatPrecision(extraout_ECX,extraout_EDX);
    if ((float10)_DAT_0052c998 < SQRT(fVar10 + extraout_ST1)) {
      fVar10 = (float10)_DAT_0052c998 / SQRT(fVar10 + extraout_ST1);
      *(double *)(param_1 + 6) = (double)((float10)local_24 * fVar10);
      *(double *)(param_1 + 8) = (double)((float10)local_1c * fVar10);
    }
    if (*(double *)(param_1 + 4) < _DAT_0052f9e8 !=
        (NAN(*(double *)(param_1 + 4)) || NAN(_DAT_0052f9e8))) {
      (**(code **)(**(int **)(param_1[1] + 0x5c) + 0xb8))();
      *(int *)(param_1[1] + 0x1a8) = *(int *)(param_1[1] + 0x1a8) + 1;
      pvVar8 = (void *)param_1[1];
      iVar19 = *(int *)((int)pvVar8 + 0x1a8);
      if (iVar19 == 4) {
        *(undefined4 *)((int)pvVar8 + 0x1a8) = 0;
        *(undefined4 *)(param_1[1] + 300) = 3000;
        (**(code **)(**(int **)(param_1[1] + 0x5c) + 0xb8))();
      }
      else {
        uVar11 = Math_FloatToUInt64();
        iVar2 = (int)uVar11;
        uVar11 = Math_FloatToUInt64();
        Game_DisplayScoreChange(pvVar8,iVar19 * 1000,(int)uVar11,iVar2);
      }
      Enemy_Constructor((int *)(param_1[1] + 0x274),param_1[0xd],(int *)param_1[0xd]);
    }
  }
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),unaff_EDI,unaff_ESI);
  return;
}


