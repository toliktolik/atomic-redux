/*
 * Function: WeaponUpgradeScreen_Draw
 * Address: 0040f440
 * Category: weapons
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __thiscall WeaponUpgradeScreen_Draw(void *this,int *param_1)

{
  _String_base _Var1;
  int iVar2;
  uint uVar3;
  uint uVar4;
  int *this_00;
  char *pcVar5;
  _String_base *p_Var6;
  undefined4 *puVar7;
  undefined4 *puVar8;
  undefined4 uVar9;
  char *pcVar10;
  undefined4 *puVar11;
  int extraout_ECX;
  uint extraout_ECX_00;
  uint extraout_EDX;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  int iVar12;
  uint unaff_retaddr;
  int *piVar13;
  undefined1 local_98 [16];
  _String_base local_88 [24];
  undefined1 local_70 [16];
  undefined4 local_60 [4];
  undefined1 local_50 [16];
  undefined1 local_40 [4];
  uint local_3c;
  undefined4 local_2c;
  uint local_28;
  undefined4 local_24;
  undefined4 local_20;
  undefined4 local_1c;
  undefined4 local_18;
  uint local_14;
  void *local_10;
  undefined4 uStack_c;
  undefined4 local_8;
  
  this_00 = param_1;
  local_8 = 0xffffffff;
  uStack_c = 0x510120;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  DrawSprite(*(void **)(*(int *)((int)this + 0x5c) + 0x754),param_1,0,0,'\0',0,0,'\0');
  Graphics_SetProjection(param_1,*(undefined4 *)(*(int *)((int)this + 0x5c) + 0x938));
  if (*(int *)((int)this + 0xa4) < 0) {
    puVar7 = (undefined4 *)SexyWidget_ApplyMatrix(local_50,0xff,0xc0,0x20);
    SexyWidget_SetRectangle(param_1,puVar7);
    local_28 = 0xf;
    local_2c = 0;
    local_3c = local_3c & 0xffffff00;
    pcVar5 = 
    "Select one of the available weapon systems to upgrade now!\n\nYour progress has been saved.";
    do {
      pcVar10 = pcVar5;
      pcVar5 = pcVar10 + 1;
    } while (*pcVar10 != '\0');
    String_Assign(local_40,(_String_base *)
                           "Select one of the available weapon systems to upgrade now!\n\nYour progress has been saved."
                  ,(uint)(pcVar10 + -0x52b928));
    local_8 = 4;
    local_20 = 0x5f;
    local_18 = 0xaa;
LAB_0040f7d9:
                    /* WARNING: Load size is inaccurate */
    iVar12 = *this;
    local_1c = 0x96;
    local_24 = 0xf5;
    uVar9 = (**(code **)(**(int **)(*(int *)((int)this + 0x5c) + 0x938) + 0x10))(0xffffffff);
    (**(code **)(iVar12 + 0x98))(param_1,&local_24,local_40,uVar9);
    uVar3 = extraout_EDX_02;
    uVar4 = extraout_ECX_00;
  }
  else {
    local_28 = 0xf;
    local_2c = 0;
    local_3c = local_3c & 0xffffff00;
    iVar12 = *(int *)((int)this + 0xa4) * 0x118;
    p_Var6 = (_String_base *)("DEFENSE ORBS" + iVar12);
    do {
      _Var1 = *p_Var6;
      p_Var6 = p_Var6 + 1;
    } while (_Var1 != (_String_base)0x0);
    String_Assign(local_40,(_String_base *)("DEFENSE ORBS" + iVar12),
                  (int)p_Var6 - (int)("DEFENSE ORBS" + iVar12 + 1));
    local_8 = 0;
    local_1c = 1;
    local_18 = 2;
    puVar7 = (undefined4 *)SexyWidget_ApplyMatrix(local_60,0,0,0);
    puVar8 = (undefined4 *)SexyWidget_ApplyMatrix(local_70,0xff,0xe0,0x40);
                    /* WARNING: Load size is inaccurate */
    (**(code **)(*this + 0x8c))
              (local_50,param_1,0x69,local_40,*puVar8,puVar8[1],puVar8[2],puVar8[3],*puVar7,
               puVar7[1],puVar7[2],puVar7[3],&local_1c);
    local_8 = 0xffffffff;
    if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(local_3c,extraout_EDX);
    }
    puVar7 = (undefined4 *)SexyWidget_ApplyMatrix(local_50,0xff,0xc0,0x20);
    SexyWidget_SetRectangle(param_1,puVar7);
    local_28 = 0xf;
    local_2c = 0;
    local_3c = local_3c & 0xffffff00;
    iVar12 = *(int *)((int)this + 0xa4) * 0x118;
    p_Var6 = (_String_base *)
             (
             "These orbiting defensive spheres block all enemy ordinance, excluding laser weapons.\n\n"
             + iVar12);
    do {
      _Var1 = *p_Var6;
      p_Var6 = p_Var6 + 1;
    } while (_Var1 != (_String_base)0x0);
    String_Assign(local_40,(_String_base *)
                           (
                           "These orbiting defensive spheres block all enemy ordinance, excluding laser weapons.\n\n"
                           + iVar12),
                  (int)p_Var6 -
                  (int)(
                       "These orbiting defensive spheres block all enemy ordinance, excluding laser weapons.\n\n"
                       + iVar12 + 1));
                    /* WARNING: Load size is inaccurate */
    iVar12 = *this;
    local_24 = 0xf5;
    local_20 = 0x6e;
    local_1c = 0x96;
    local_18 = 0x9b;
    local_8 = 1;
    uVar9 = (**(code **)(**(int **)(*(int *)((int)this + 0x5c) + 0x938) + 0x10))(0xffffffff);
    (**(code **)(iVar12 + 0x98))(param_1,&local_24,local_40,uVar9);
    local_8 = 0xffffffff;
    if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
      System_ShutdownHandler(extraout_ECX,extraout_EDX_00);
    }
    iVar12 = *(int *)(*(int *)((int)this + 0x5c) + 0x980 + *(int *)((int)this + 0xa4) * 4);
    if (iVar12 < 3) {
      if (iVar12 < 1) goto LAB_0040f826;
      Level_InitializeDictastroika
                (local_40,"Next level :\n Additional Orb" + *(int *)((int)this + 0xa4) * 0x118);
      local_8 = 2;
      local_20 = 0xd2;
      local_18 = 0x9b;
      goto LAB_0040f7d9;
    }
    local_28 = 0xf;
    local_2c = 0;
    local_3c = local_3c & 0xffffff00;
    pcVar5 = "M A X E D";
    do {
      pcVar10 = pcVar5;
      pcVar5 = pcVar10 + 1;
    } while (*pcVar10 != '\0');
    String_Assign(local_40,(_String_base *)"M A X E D",(uint)(pcVar10 + -0x52b984));
    local_8 = 3;
    local_1c = 1;
    local_18 = 2;
    puVar7 = (undefined4 *)SexyWidget_ApplyMatrix(local_50,0,0,0);
    puVar8 = (undefined4 *)SexyWidget_ApplyMatrix(local_70,0xff,0xe0,0x40);
                    /* WARNING: Load size is inaccurate */
    (**(code **)(*this + 0x8c))
              (local_60,param_1,0xfa,local_40,*puVar8,puVar8[1],puVar8[2],puVar8[3],*puVar7,
               puVar7[1],puVar7[2],puVar7[3],&local_1c);
    uVar3 = extraout_EDX_01;
    uVar4 = local_3c;
  }
  if (0xf < local_28) {
    local_8 = 0xffffffff;
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(uVar4,uVar3);
  }
LAB_0040f826:
  local_8 = 0xffffffff;
  Exception_Release(local_88,"POINTS REMAINING: %i");
  puVar7 = (undefined4 *)SexyWidget_ApplyMatrix(local_50,0xff,0xff,0xff);
  SexyWidget_SetRectangle(param_1,puVar7);
  Graphics_SetProjection(param_1,*(undefined4 *)(*(int *)((int)this + 0x5c) + 0x92c));
  p_Var6 = local_88;
  local_28 = 0xf;
  local_2c = 0;
  local_3c = local_3c & 0xffffff00;
  do {
    _Var1 = *p_Var6;
    p_Var6 = p_Var6 + 1;
  } while (_Var1 != (_String_base)0x0);
  String_Assign(local_40,local_88,(int)p_Var6 - (int)(local_88 + 1));
  local_8 = 5;
  local_1c = 1;
  local_18 = 2;
  puVar8 = (undefined4 *)SexyWidget_ApplyMatrix(local_50,0,0,0);
  puVar11 = (undefined4 *)SexyWidget_ApplyMatrix(local_70,0,0xff,0);
                    /* WARNING: Load size is inaccurate */
  puVar7 = local_60;
  piVar13 = param_1;
  (**(code **)(*this + 0x8c))
            (puVar7,param_1,0x1d1,local_40,*puVar11,puVar11[1],puVar11[2],puVar11[3],*puVar8,
             puVar8[1],puVar8[2],puVar8[3],&local_1c);
  local_8 = 0xffffffff;
  if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_3c,extraout_EDX_03);
  }
  PowerUpEffects_Render(*(void **)((int)this + 0x98),param_1);
  Tank_RenderWithPowerUps
            (*(void **)((int)this + 0x5c),param_1,0x140,400,
             (*(int *)((int)*(void **)((int)this + 0x5c) + 0x414) % 0x32) / 5);
  param_1 = (int *)((int)this + 0x80);
  iVar12 = 0;
  do {
    if (0 < *param_1) {
      SexyWidget_SetDrawMode(this_00,1);
      SexyWidget_SetColorizeFlag2(this_00,1);
      iVar2 = *param_1;
      puVar8 = (undefined4 *)SexyWidget_ApplyMatrix(local_98,iVar2,iVar2,iVar2);
      SexyWidget_SetRectangle(this_00,puVar8);
      PowerUpEffects_Render(*(void **)((int)this + 0x5c),this_00,iVar12,0x140,400);
      PowerUpEffects_Render(*(void **)((int)this + 0x5c),this_00,iVar12,0x140,400);
      PowerUpEffects_Render(*(void **)((int)this + 0x5c),this_00,iVar12,0x140,400);
      PowerUpEffects_Render(*(void **)((int)this + 0x5c),this_00,iVar12,0x140,400);
      SexyWidget_SetColorizeFlag2(this_00,0);
      SexyWidget_SetDrawMode(this_00,0);
    }
    iVar12 = iVar12 + 1;
    param_1 = param_1 + 1;
  } while (iVar12 < 6);
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),puVar7,piVar13);
  return;
}


