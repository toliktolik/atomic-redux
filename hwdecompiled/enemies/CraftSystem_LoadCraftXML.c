/*
 * Function: CraftSystem_LoadCraftXML
 * Address: 004094e0
 * Category: enemies
 * Generated by Ghidra Bulk Exporter
 */

#include "../heavy_weapon_deluxe.h"


void __fastcall CraftSystem_LoadCraftXML(int param_1)

{
  char cVar1;
  _String_base *p_Var2;
  long lVar3;
  char *pcVar4;
  char *pcVar5;
  int extraout_ECX;
  int extraout_ECX_00;
  int extraout_ECX_01;
  undefined2 extraout_DX;
  uint extraout_EDX;
  int iVar6;
  uint extraout_EDX_00;
  uint extraout_EDX_01;
  uint extraout_EDX_02;
  uint extraout_EDX_03;
  uint extraout_EDX_04;
  uint extraout_EDX_05;
  uint extraout_EDX_06;
  uint extraout_EDX_07;
  uint extraout_EDX_08;
  uint extraout_EDX_09;
  byte ****ppppbVar7;
  byte *pbVar8;
  _String_base *p_Var9;
  undefined4 *puVar10;
  bool bVar11;
  bool bVar12;
  uint unaff_retaddr;
  undefined4 *in_stack_fffffee0;
  undefined4 *in_stack_fffffee4;
  byte ***local_fc [4];
  char *local_ec;
  uint local_e8;
  undefined1 local_c8 [24];
  _String_base local_b0 [4];
  uint local_ac;
  undefined4 local_9c;
  uint local_98;
  undefined1 local_94 [4];
  uint local_90;
  undefined4 local_80;
  uint local_7c;
  undefined1 local_78 [4];
  uint local_74;
  undefined4 local_64;
  uint local_60;
  _String_base local_5c [4];
  uint local_58;
  undefined4 local_48;
  uint local_44;
  _String_base local_40 [4];
  uint local_3c;
  undefined4 local_2c;
  uint local_28;
  int local_24;
  _String_base *local_20;
  char *local_1c;
  undefined4 *local_18;
  uint local_14;
  void *local_10;
  undefined *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &DAT_0050fabc;
  local_10 = ExceptionList;
  local_14 = DAT_00569f5c ^ unaff_retaddr;
  ExceptionList = &local_10;
  local_1c = (char *)operator_new(0x74);
  local_8 = 0;
  if (local_1c == (char *)0x0) {
    local_18 = (undefined4 *)0x0;
  }
  else {
    local_18 = (undefined4 *)ObjectType1_Constructor((undefined4 *)local_1c);
  }
  puVar10 = local_18;
  local_8 = 0xffffffff;
  local_28 = 0xf;
  local_2c = 0;
  local_3c = local_3c & 0xffffff00;
  pcVar5 = "data\\craft.xml";
  do {
    pcVar4 = pcVar5;
    pcVar5 = pcVar4 + 1;
  } while (*pcVar4 != '\0');
  String_Assign(local_40,(_String_base *)"data\\craft.xml",(uint)(pcVar4 + -0x52a500));
  local_8 = 1;
  Image_UpdateTexture((int)puVar10,extraout_DX,(int)local_40);
  local_8 = 0xffffffff;
  if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
    System_ShutdownHandler(local_3c,extraout_EDX);
  }
  WeaponBomb_ProcessBurstingRocket((int)&stack0xfffffee0);
  local_8 = 2;
  local_24 = 1;
  cVar1 = Font_GetTextHeight((int)puVar10);
  if (cVar1 == '\0') {
    p_Var9 = (_String_base *)(param_1 + 0xbcc);
    local_20 = p_Var9;
    do {
      cVar1 = XML_ParseDocument((int)local_18,(uint)&stack0xfffffee0,(int *)&stack0xfffffee0);
      puVar10 = local_18;
      if (cVar1 == '\0') break;
      if (in_stack_fffffee0 == (undefined4 *)0x1) {
        pcVar5 = "Craft";
        do {
          local_1c = pcVar5;
          pcVar5 = local_1c + 1;
        } while (*local_1c != '\0');
        local_1c = local_1c + -0x52a4f8;
        if (local_ec != (char *)0x0) {
          pcVar5 = local_ec;
          if (local_1c <= local_ec) {
            pcVar5 = local_1c;
          }
          ppppbVar7 = (byte ****)local_fc[0];
          if (local_e8 < 0x10) {
            ppppbVar7 = local_fc;
          }
          bVar11 = false;
          iVar6 = 0;
          bVar12 = true;
          pbVar8 = (byte *)"Craft";
          do {
            if (pcVar5 == (char *)0x0) break;
            pcVar5 = pcVar5 + -1;
            bVar11 = *(byte *)ppppbVar7 < *pbVar8;
            bVar12 = *(byte *)ppppbVar7 == *pbVar8;
            ppppbVar7 = (byte ****)((int)ppppbVar7 + 1);
            pbVar8 = pbVar8 + 1;
          } while (bVar12);
          if (!bVar12) {
            iVar6 = (1 - (uint)bVar11) - (uint)(bVar11 != 0);
          }
          p_Var9 = local_20;
          if (iVar6 != 0) goto LAB_004098e8;
        }
        if ((local_1c <= local_ec) && (local_ec == local_1c)) {
          local_44 = 0xf;
          local_48 = 0;
          local_58 = local_58 & 0xffffff00;
          pcVar5 = "name";
          do {
            pcVar4 = pcVar5;
            pcVar5 = pcVar4 + 1;
          } while (*pcVar4 != '\0');
          String_Assign(local_5c,(_String_base *)&DAT_0052a4f0,(uint)(pcVar4 + -0x52a4f0));
          local_8._0_1_ = 3;
          p_Var2 = (_String_base *)StringMap_LookupAndConcatenate(local_c8,extraout_EDX_00,local_5c)
          ;
          PowerUp_ProcessThunderstrike(p_Var9 + -0x1c,extraout_EDX_01,p_Var2,0,0xffffffff);
          local_8._0_1_ = 2;
          if (0xf < local_44) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(local_58,extraout_EDX_02);
          }
          local_48 = 0;
          local_44 = 0xf;
          local_60 = 0xf;
          local_58 = local_58 & 0xffffff00;
          local_64 = 0;
          local_74 = local_74 & 0xffffff00;
          pcVar5 = "desc";
          do {
            pcVar4 = pcVar5;
            pcVar5 = pcVar4 + 1;
          } while (*pcVar4 != '\0');
          String_Assign(local_78,(_String_base *)&DAT_0052a4e8,(uint)(pcVar4 + -0x52a4e8));
          local_8._0_1_ = 4;
          p_Var2 = (_String_base *)
                   StringMap_LookupAndConcatenate(local_c8,(uint)local_78,(_String_base *)local_78);
          PowerUp_ProcessThunderstrike(p_Var9,extraout_EDX_03,p_Var2,0,0xffffffff);
          local_8._0_1_ = 2;
          if (0xf < local_60) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(extraout_ECX,extraout_EDX_04);
          }
          local_64 = 0;
          local_60 = 0xf;
          local_98 = 0xf;
          local_74 = local_74 & 0xffffff00;
          local_9c = 0;
          local_ac = local_ac & 0xffffff00;
          pcVar5 = "arms";
          do {
            pcVar4 = pcVar5;
            pcVar5 = pcVar4 + 1;
          } while (*pcVar4 != '\0');
          String_Assign(local_b0,(_String_base *)&DAT_0052a4e0,(uint)(pcVar4 + -0x52a4e0));
          local_8._0_1_ = 5;
          p_Var2 = (_String_base *)StringMap_LookupAndConcatenate(local_c8,extraout_EDX_05,local_b0)
          ;
          PowerUp_ProcessThunderstrike(p_Var9 + 0x1c,extraout_EDX_06,p_Var2,0,0xffffffff);
          local_8._0_1_ = 2;
          if (0xf < local_98) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(extraout_ECX_00,local_ac);
          }
          local_9c = 0;
          local_98 = 0xf;
          local_28 = 0xf;
          local_ac = local_ac & 0xffffff00;
          local_2c = 0;
          local_3c = local_3c & 0xffffff00;
          pcVar5 = "points";
          do {
            pcVar4 = pcVar5;
            pcVar5 = pcVar4 + 1;
          } while (*pcVar4 != '\0');
          String_Assign(local_40,(_String_base *)"points",(uint)(pcVar4 + -0x52a4d8));
          local_8._0_1_ = 6;
          iVar6 = StringMap_LookupAndConcatenate(local_c8,extraout_EDX_07,local_40);
          if (*(uint *)(iVar6 + 0x18) < 0x10) {
            pcVar5 = (char *)(iVar6 + 4);
          }
          else {
            pcVar5 = *(char **)(iVar6 + 4);
          }
          lVar3 = _atol(pcVar5);
          *(long *)(p_Var9 + 0x38) = lVar3;
          local_8._0_1_ = 2;
          if (0xf < local_28) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(local_3c,extraout_EDX_08);
          }
          local_2c = 0;
          local_28 = 0xf;
          local_7c = 0xf;
          local_3c = local_3c & 0xffffff00;
          local_80 = 0;
          local_90 = local_90 & 0xffffff00;
          pcVar5 = "armor";
          do {
            pcVar4 = pcVar5;
            pcVar5 = pcVar4 + 1;
          } while (*pcVar4 != '\0');
          String_Assign(local_94,(_String_base *)"armor",(uint)(pcVar4 + -0x52a4d0));
          local_8._0_1_ = 7;
          iVar6 = StringMap_LookupAndConcatenate(local_c8,(uint)local_94,(_String_base *)local_94);
          if (*(uint *)(iVar6 + 0x18) < 0x10) {
            pcVar5 = (char *)(iVar6 + 4);
          }
          else {
            pcVar5 = *(char **)(iVar6 + 4);
          }
          local_1c = (char *)_atol(pcVar5);
          local_8 = CONCAT31(local_8._1_3_,2);
          *(double *)(p_Var9 + 0x44) = (double)(int)local_1c;
          if (0xf < local_7c) {
                    /* WARNING: Subroutine does not return */
            System_ShutdownHandler(extraout_ECX_01,extraout_EDX_09);
          }
          local_7c = 0xf;
          *(int *)(p_Var9 + 0x3c) = local_24;
          local_24 = local_24 + 1;
          p_Var9 = p_Var9 + 0x68;
          local_80 = 0;
          local_90 = local_90 & 0xffffff00;
          local_20 = p_Var9;
        }
      }
LAB_004098e8:
      cVar1 = Font_GetTextHeight((int)local_18);
      puVar10 = local_18;
    } while (cVar1 == '\0');
  }
  if (puVar10 != (undefined4 *)0x0) {
    (**(code **)*puVar10)(1);
  }
  local_8 = 0xffffffff;
  PowerUp_ProcessNuke((int)&stack0xfffffee0);
  ExceptionList = local_10;
  Exception_SetMessage((void *)(local_14 ^ unaff_retaddr),in_stack_fffffee0,in_stack_fffffee4);
  return;
}


