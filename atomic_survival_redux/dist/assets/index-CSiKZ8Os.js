var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,r=(e,r)=>{for(var o in r||(r={}))i.call(r,o)&&a(e,o,r[o]);if(t)for(var o of t(r))s.call(r,o)&&a(e,o,r[o]);return e},o=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())});import{S as n,T as h,R as l,a as c,s as d,M as m,C as p,P as u,G as g,b as f,d as y,e as T,f as E,A as S}from"./pixi-CVVvOrli.js";import{h as w}from"./audio-Cz0PurUi.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const v={SCREEN_WIDTH:640,SCREEN_HEIGHT:480,TANK_Y_POSITION:430,TANK_MIN_X:50,TANK_MAX_X:590,TANK_SPEED:300,TANK_ACCELERATION:1e3,TANK_DECELERATION:2e3,TANK_MAX_HEALTH:100,TANK_WIDTH:48,TANK_HEIGHT:32,ENEMY_WEAPONS:{DUMB_BOMB:{damage:10,speed:200},LASER_GUIDED:{damage:50,speed:300,tracking:!0},ARMORED_BOMB:{damage:100,speed:150,health:3},FRAG_BOMB:{damage:75,speed:200,fragments:8},ATOMIC_BOMB:{damage:200,speed:100,blastRadius:150},ENERGY_BALL:{damage:25,speed:400},BURSTING_ROCKET:{damage:150,speed:250,burstCount:5}},PLAYER_WEAPONS:{STANDARD_GUN:{damage:10,fireRate:200,projectileSpeed:800,ammo:1/0,spread:0},HOMING_MISSILES:{damage:30,fireRate:400,projectileSpeed:600,ammo:40,spread:0,tracking:!0},LASER_CANNON:{damage:50,fireRate:100,projectileSpeed:1200,ammo:60,spread:0,piercing:!0},ROCKETS:{damage:75,fireRate:500,projectileSpeed:700,ammo:30,spread:15,explosive:!0},FLAK_CANNON:{damage:20,fireRate:150,projectileSpeed:900,ammo:50,spread:30,projectileCount:5},THUNDERSTRIKE:{damage:100,fireRate:600,projectileSpeed:1e3,ammo:20,spread:0,chainLightning:!0}},WAVE_TIMING:{MIN_LENGTH:1e3,MAX_LENGTH:2900,SPAWN_INTERVAL_EARLY:1500,SPAWN_INTERVAL_MID:1e3,SPAWN_INTERVAL_LATE:500,BETWEEN_WAVES:2e3},DIFFICULTY:{TIME_INTERVAL:12e3,HEALTH_MULTIPLIER:7,MAX_DIFFICULTY_LEVEL:14,MAX_ENEMY_HEALTH:40,SPEED_INCREASE_PER_WAVE:.02,ENEMY_COUNT_INCREASE:2,DAMAGE_INCREASE_PER_10_WAVES:.03},POWERUPS:{DROP_INTERVAL:15e3,DROP_CHANCE_BASE:.3,DROP_CHANCE_LOW_HEALTH:.5,DROP_CHANCE_NO_WEAPON:.4,DROP_CHANCE_LONG_SURVIVAL:.4,DROP_CHANCE_MAX:.7,SHIELD_DURATION:1e4,SPEED_BOOST_DURATION:1e4,RAPID_FIRE_DURATION:8e3,SPREAD_SHOT_DURATION:12e3,MEGA_LASER_DURATION:3e3},MEGA_LASER:{DAMAGE_PER_TICK:10,TICK_RATE:100,WIDTH:80,DURATION:3e3},NUKE:{DAMAGE:999,SCORE_MULTIPLIER:.5},SCORING:{CHAIN_THRESHOLD:3,CHAIN_MULTIPLIER:1.5,ACCURACY_THRESHOLD:.8,ACCURACY_BONUS:500,NO_DAMAGE_WAVE_BONUS:1e3,SPEED_KILL_TIME:500,SPEED_KILL_MULTIPLIER:2,COMBO_TIMEOUT:2e3,COMBO_MULTIPLIERS:[1,1.2,1.5,2,2.5,3]},MAX_PARTICLES:500,MAX_PROJECTILES:100,MAX_ENEMIES:50,AUDIO:{MASTER_VOLUME:.7,SFX_VOLUME:.8,MUSIC_VOLUME:.5},SPAWN_ZONES:{AIR_Y_MIN:50,AIR_Y_MAX:200,GROUND_Y:380},BOUNDS:{LEFT:-100,RIGHT:740,TOP:-100,BOTTOM:580},PHYSICS:{GRAVITY:500},GROUND_Y:430},R=class{static loadCraftData(e){return o(this,null,function*(){const t=new Map;try{const i=yield fetch(e),s=yield i.text(),a=this.parser.parseFromString(s,"text/xml"),r=a.querySelector("parsererror");if(r)throw new Error(`XML parsing error: ${r.textContent}`);const o=a.querySelector("root");if(!o)throw new Error("XML file missing <root> element");o.querySelectorAll("Craft").forEach(e=>{const i=e.getAttribute("name");i&&t.set(i,{name:i,desc:e.getAttribute("desc")||"",arms:e.getAttribute("arms")||"None",points:parseInt(e.getAttribute("points")||"0",10),armor:parseInt(e.getAttribute("armor")||"1",10)})})}catch(i){}return t})}static loadWaveData(e){return o(this,null,function*(){const t=[];try{const i=yield fetch(e),s=yield i.text(),a=this.parser.parseFromString(s,"text/xml"),r=a.querySelector("parsererror");if(r)throw new Error(`XML parsing error: ${r.textContent}`);const o=a.querySelector("root");if(!o)throw new Error("XML file missing <root> element");o.querySelectorAll("Level").forEach(e=>{const i=[];e.querySelectorAll("Wave").forEach(e=>{const t=parseInt(e.getAttribute("length")||"1000",10),s=[];e.querySelectorAll("Craft").forEach(e=>{const t=e.getAttribute("id"),i=parseInt(e.getAttribute("qty")||"1",10);t&&s.push({id:t,qty:i})}),i.push({length:t,enemies:s})}),t.push({waves:i})})}catch(i){}return t})}static loadBossData(e){return o(this,null,function*(){const t=new Map;try{const i=yield fetch(e),s=yield i.text(),a=this.parser.parseFromString(s,"text/xml"),r=a.querySelector("parsererror");if(r)throw new Error(`XML parsing error: ${r.textContent}`);const o=a.querySelector("root");if(!o)throw new Error("XML file missing <root> element");const n=o.children;for(let e=0;e<n.length;e++){const i=n[e];if(i.nodeType!==Node.ELEMENT_NODE)continue;const s=i.tagName,a=i.getAttribute("info")||"",r=new Map;i.querySelectorAll("[armor]").forEach(e=>{if(e.tagName.startsWith("Level")){const t=e.tagName,i=parseInt(e.getAttribute("armor")||"100",10),s=parseInt(e.getAttribute("score")||"1000",10),a=new Map,o=e.children;for(let e=0;e<o.length;e++){const t=o[e];if(t.nodeType!==Node.ELEMENT_NODE)continue;const i=t.tagName;a.set(i,{armor:parseInt(t.getAttribute("armor")||"50",10),fire:t.hasAttribute("fire")?parseInt(t.getAttribute("fire"),10):void 0,speed:t.hasAttribute("speed")?parseFloat(t.getAttribute("speed")):void 0,stationary:"yes"===t.getAttribute("stationary")})}r.set(t,{armor:i,score:s,components:a})}}),t.set(s,{name:s,info:a,levels:r})}}catch(i){}return t})}static loadSurvivalData(e){return o(this,null,function*(){return this.loadWaveData(e)})}static loadSurvivalTier(e){return o(this,null,function*(){const t=`/HeavyWeapon/data/survival${e}.xml`;try{const i=yield fetch(t),s=yield i.text(),a=this.parser.parseFromString(s,"text/xml"),r=a.querySelector("parsererror");if(r)throw new Error(`XML parsing error: ${r.textContent}`);const o=a.querySelector("root");if(!o)throw new Error("XML file missing <root> element");const n=[];return o.querySelectorAll("Level").forEach(e=>{const t=[];e.querySelectorAll("Wave").forEach(e=>{const i=parseInt(e.getAttribute("length")||"1000",10),s=[];e.querySelectorAll("Craft").forEach(e=>{const t=e.getAttribute("id"),i=parseInt(e.getAttribute("qty")||"1",10);t&&s.push({id:t,qty:i})}),t.push({length:i,enemies:s})}),n.push({waves:t})}),{tier:e,levels:n,totalWaves:n.reduce((e,t)=>e+t.waves.length,0)}}catch(i){throw i}})}};R.parser=new DOMParser;let M=R;class x extends n{constructor(e,t,i=100,s=!0){const a=Math.floor(e.width/t),r=e.height;super(new h(e,new l(0,0,a,r))),this.currentFrame=0,this.frameTimer=0,this.frameRate=100,this.isPlaying=!0,this.loop=!0,this.baseTexture=e,this.frameCount=t,this.frameWidth=a,this.frameHeight=r,this.frameRate=i,this.loop=s}update(e){!this.isPlaying||this.frameCount<=1||(this.frameTimer+=1e3*e,this.frameTimer>=this.frameRate&&(this.frameTimer=0,this.nextFrame()))}nextFrame(){if(this.currentFrame++,this.currentFrame>=this.frameCount){if(!this.loop)return this.currentFrame=this.frameCount-1,void(this.isPlaying=!1);this.currentFrame=0}this.updateTexture()}setFrame(e){this.currentFrame=Math.max(0,Math.min(e,this.frameCount-1)),this.updateTexture()}updateTexture(){const e=this.currentFrame*this.frameWidth,t=Math.min(e,this.baseTexture.width-this.frameWidth),i=new l(t,0,this.frameWidth,this.frameHeight);this.texture=new h(this.baseTexture,i),this.currentFrame}play(){this.isPlaying=!0}pause(){this.isPlaying=!1}stop(){this.isPlaying=!1,this.currentFrame=0,this.frameTimer=0,this.updateTexture()}setFrameRate(e){this.frameRate=e}getCurrentFrame(){return this.currentFrame}getFrameCount(){return this.frameCount}}class A extends n{constructor(e,t,i=1){const s=Math.floor(e.width/t),a=Math.floor(e.height/i);super(new h(e,new l(0,0,s,a))),this.currentAngle=0,this.currentRow=0,this.baseTexture=e,this.frameCount=t,this.rowCount=i,this.frameWidth=s,this.frameHeight=a,this.updateTexture(0,0)}setAngle(e){this.currentAngle=e;let t=180*e/Math.PI;t=(t%360+360)%360;const i=360/this.frameCount;let s=Math.round(t/i)%this.frameCount;this.updateTexture(s,this.currentRow)}setWeaponLevel(e){this.currentRow=Math.max(0,Math.min(e,this.rowCount-1)),this.setAngle(this.currentAngle)}updateTexture(e,t){const i=e*this.frameWidth,s=t*this.frameHeight,a=Math.min(i,this.baseTexture.width-this.frameWidth),r=Math.min(s,this.baseTexture.height-this.frameHeight),o=new l(a,r,this.frameWidth,this.frameHeight);this.texture=new h(this.baseTexture,o),this.texture.updateUvs()}getAngle(){return this.currentAngle}getFrameCount(){return this.frameCount}}class C extends n{constructor(e,t,i=5){const s=Math.floor(e.width/t),a=Math.floor(e.height/i);super(new h(e,new l(0,0,s,a))),this.currentAngle=0,this.currentRow=0,this.baseTexture=e,this.frameCount=t,this.rowCount=i,this.frameWidth=s,this.frameHeight=a,this.updateTexture(0,0)}setAngleAndRow(e,t=0){this.currentAngle=e,this.currentRow=Math.max(0,Math.min(t,this.rowCount-1));let i=180*e/Math.PI;i=(i%360+360)%360;const s=360/this.frameCount;let a=Math.round(i/s)%this.frameCount;this.updateTexture(a,this.currentRow)}updateTexture(e,t){const i=e*this.frameWidth,s=t*this.frameHeight,a=Math.min(i,this.baseTexture.width-this.frameWidth),r=Math.min(s,this.baseTexture.height-this.frameHeight),o=new l(a,r,this.frameWidth,this.frameHeight);this.texture=new h(this.baseTexture,o),this.texture.updateUvs()}setBulletType(e){const t=Math.max(0,Math.min(e,this.rowCount-1));this.setAngleAndRow(this.currentAngle,t)}getAngle(){return this.currentAngle}getRow(){return this.currentRow}getFrameCount(){return this.frameCount}getRowCount(){return this.rowCount}}const D={tank:{frameCount:10,frameRate:80,loop:!0},gun:{frameCount:21,rowCount:5,frameRate:100,loop:!1},propfighter:{frameCount:4,frameRate:120,loop:!0},smalljet:{frameCount:1,frameRate:200,loop:!1},jetfighter:{frameCount:1,frameRate:150,loop:!1},bomber:{frameCount:1,frameRate:180,loop:!1},bigbomber:{frameCount:1,frameRate:200,loop:!1},fatbomber:{frameCount:1,frameRate:220,loop:!1},superbomber:{frameCount:1,frameRate:190,loop:!1},deltabomber:{frameCount:1,frameRate:180,loop:!1},smallcopter:{frameCount:5,frameRate:60,loop:!0},medcopter:{frameCount:7,frameRate:70,loop:!0},bigcopter:{frameCount:9,frameRate:50,loop:!0},truck:{frameCount:1,frameRate:150,loop:!1},enemytank:{frameCount:10,frameRate:100,loop:!0},dozer:{frameCount:1,frameRate:140,loop:!1},satellite:{frameCount:1,frameRate:200,loop:!1},blimp:{frameCount:1,frameRate:300,loop:!1},cruise:{frameCount:1,frameRate:160,loop:!1},deflector:{frameCount:1,frameRate:120,loop:!1},strafer:{frameCount:1,frameRate:140,loop:!1},bullets:{frameCount:21,rowCount:5,frameRate:100,loop:!1},dumbbomb:{frameCount:10,frameRate:100,loop:!0},missile:{frameCount:20,frameRate:80,loop:!0},rocket:{frameCount:21,frameRate:100,loop:!0},bigmissile:{frameCount:10,frameRate:80,loop:!0},explosion:{frameCount:12,frameRate:40,loop:!1},muzzleflash:{frameCount:4,frameRate:30,loop:!1},smoke:{frameCount:6,frameRate:100,loop:!0}},I=class{static initialize(){d.SCALE_MODE=c.LINEAR,d.ROUND_PIXELS=!0,d.MIPMAP_TEXTURES=m.OFF}static loadAll(){return o(this,null,function*(){this.loaded||(yield this.loadXMLData(),yield this.loadTextures(),yield this.loadSounds(),this.loaded=!0)})}static loadXMLData(){return o(this,null,function*(){try{const t="/HeavyWeapon/data/";this.craftData=yield M.loadCraftData(t+"craft.xml"),this.waveData=yield M.loadWaveData(t+"waves.xml");try{this.bossData=yield M.loadBossData(t+"bosses.xml")}catch(e){}for(let i=0;i<=9;i++)try{const e=yield M.loadSurvivalData(`${t}survival${i}.xml`);this.survivalData.set(i,e)}catch(e){}}catch(e){}})}static loadTextures(){return o(this,null,function*(){const e={tank:"/HeavyWeapon/Images/tank.png",tank_body:"/HeavyWeapon/Images/tank.png",gun:"/HeavyWeapon/Images/gun.png",tank_turret:"/HeavyWeapon/Images/tank.png",tank_shadow:"/HeavyWeapon/Images/tankshadow.png",propfighter:"/HeavyWeapon/Images/propfighter.png",smalljet:"/HeavyWeapon/Images/smalljet.png",bomber:"/HeavyWeapon/Images/bomber.png",jetfighter:"/HeavyWeapon/Images/jetfighter.png",truck:"/HeavyWeapon/Images/truck.png",smallcopter:"/HeavyWeapon/Images/smallcopter.png",bigbomber:"/HeavyWeapon/Images/bigbomber.png",medcopter:"/HeavyWeapon/Images/medcopter.png",bigcopter:"/HeavyWeapon/Images/bigcopter.png",fatbomber:"/HeavyWeapon/Images/fatbomber.png",deltabomber:"/HeavyWeapon/Images/deltabomber.png",deltajet:"/HeavyWeapon/Images/deltajet.png",satellite:"/HeavyWeapon/Images/satellite.png",blimp:"/HeavyWeapon/Images/blimp.png",superbomber:"/HeavyWeapon/Images/superbomber.png",bigmissile:"/HeavyWeapon/Images/bigmissile.png",strafer:"/HeavyWeapon/Images/strafer.png",enemytank:"/HeavyWeapon/Images/enemytank.png",dozer:"/HeavyWeapon/Images/dozer.png",deflector:"/HeavyWeapon/Images/deflector.png",cruise:"/HeavyWeapon/Images/cruise.png",bullets:"/HeavyWeapon/Images/bullets.png",dumbbomb:"/HeavyWeapon/Images/dumbbomb.png",lgb:"/HeavyWeapon/Images/lgb.png",fragbomb:"/HeavyWeapon/Images/fragbomb.png",ironbomb:"/HeavyWeapon/Images/ironbomb.png",bombfrag:"/HeavyWeapon/Images/bombfrag.png",missile:"/HeavyWeapon/Images/missile.png",laser:"/HeavyWeapon/Images/beam.png",rocket:"/HeavyWeapon/Images/rocket.png",explosion:"/HeavyWeapon/Images/explosion.png",smoke:"/HeavyWeapon/Images/smoke.png",shield:"/HeavyWeapon/Images/shield.png",muzzle_flash:"/HeavyWeapon/Images/tankflash.png",pupcopter:"/HeavyWeapon/Images/pupcopter.png",puprotor:"/HeavyWeapon/Images/puprotor.png",powerups:"/HeavyWeapon/Images/powerups.png"};for(const[i,s]of Object.entries(e))try{const e=yield h.fromURL(s);this.textures.set(i,e),h.addToCache(e,i)}catch(t){}this.createPlaceholderTextures()})}static createPlaceholderTextures(){this.textures.has("tank_body")||this.createColorTexture("tank_body",50,40,4881497),this.textures.has("tank_turret")||this.createColorTexture("tank_turret",8,30,2968119),this.createTexturesFromCraftData(),this.createProjectileTextures(),this.createPowerupTextures(),this.createUITextures()}static createTexturesFromCraftData(){const e={PROPFIGHTER:16729156,SMALLJET:16737894,BOMBER:13378082,JETFIGHTER:16746564,TRUCK:8930372,BIGBOMBER:11149858,SMALLCOPTER:11158596,MEDCOPTER:10048853,BIGCOPTER:8926003,DELTABOMBER:13386786,DELTAJET:16737860,BIGMISSILE:6710886,SUPERBOMBER:8921634,FATBOMBER:10044484,BLIMP:11184810,SATELLITE:13421772,STRAFER:16733525,ENEMYTANK:4473992,DOZER:8947780,DEFLECTOR:65535,CRUISE:4474111},t={PROPFIGHTER:[40,30],SMALLJET:[45,25],BOMBER:[60,40],JETFIGHTER:[50,30],TRUCK:[40,30],BIGBOMBER:[70,50],SMALLCOPTER:[45,35],MEDCOPTER:[50,40],BIGCOPTER:[60,45],DELTABOMBER:[65,35],DELTAJET:[55,30],BIGMISSILE:[20,50],SUPERBOMBER:[80,60],FATBOMBER:[75,55],BLIMP:[100,60],SATELLITE:[45,45],STRAFER:[50,25],ENEMYTANK:[50,35],DOZER:[60,40],DEFLECTOR:[55,40],CRUISE:[25,60]};this.craftData.forEach((i,s)=>{const a=s.toLowerCase();if(!this.textures.has(a)){const i=e[s]||16711680,[r,o]=t[s]||[40,30];this.createColorTexture(a,r,o,i)}})}static createProjectileTextures(){const e=[["bullets",4,8,16776960],["dumbbomb",12,16,6710886],["lgb",14,18,16711680],["fragbomb",13,17,16776960],["ironbomb",15,19,4473924],["bombfrag",6,6,16753920],["missile",6,12,16746496],["laser",4,20,65535],["rocket",8,16,16755200],["energy_ball",10,10,65280]];for(const[t,i,s,a]of e)this.textures.has(t)||this.createColorTexture(t,i,s,a)}static createUITextures(){const e=[["explosion",64,64,16746496],["smoke",32,32,6710886],["shield",80,80,65535],["ally_helicopter",60,40,43520],["health_bar",100,10,65280],["ammo_icon",20,20,16776960],["pupcopter",60,40,16777215],["puprotor",30,30,13421772]];for(const[t,i,s,a]of e)this.textures.has(t)||this.createColorTexture(t,i,s,a)}static createColorTexture(e,t,i,s){const a=document.createElement("canvas");a.width=t,a.height=i;const r=a.getContext("2d"),o=s>>16&255,n=s>>8&255,l=255&s;r.fillStyle=`rgb(${o}, ${n}, ${l})`,r.fillRect(0,0,t,i);const c=h.from(a);this.textures.set(e,c),h.addToCache(c,e)}static loadSounds(){return o(this,null,function*(){try{const e=yield this.loadSoundMappingFromXML();this.loadSoundsFromMap(e)}catch(e){throw new Error("Sound system requires HeavyWeapon_Sound_System_Mapping.xml - fallback maps have been removed")}})}static loadSoundMappingFromXML(){return o(this,null,function*(){var e;const t=yield fetch("/HeavyWeapon_Sound_System_Mapping.xml"),i=yield t.text(),s=(new DOMParser).parseFromString(i,"text/xml"),a={},r=null==(e=s.querySelector("Metadata BasePath"))?void 0:e.textContent,o=r?`/${r}`:"/HeavyWeapon/Sounds/";s.querySelectorAll("Sound").forEach(e=>{const t=e.getAttribute("file"),i=e.getAttribute("event");if(t&&i){const e=this.convertEventToSoundName(i);a[e]=o+t}});const n={tank_fire_0:o+"tankfire.ogg",powerup_drop:o+"powerup.ogg",spread_shot:o+"powerup.ogg",rapid_fire:o+"upgrade.ogg",powerup_land:o+"powerup.ogg",shield_deflect:o+"deflect.ogg",weapon_upgrade_permanent:o+"upgrade.ogg",weapon_upgrade_permanent_high:o+"upgrade.ogg"};return Object.entries(n).forEach(([e,t])=>{a[e]||(a[e]=t)}),a})}static convertEventToSoundName(e){return{StandardGun:"tank_fire",GunLevel1:"tank_fire_1",GunLevel2:"tank_fire_2",GunLevel3:"tank_fire_3",GunLevel4:"tank_fire_4",SmallExplosion:"enemy_destroyed",TankExplosion:"tank_destroyed",LargeExplosion:"explosion",NukeExplosion:"nuke",BulletHit:"tank_hit",OrbHit:"orbhit",GenericPowerUp:"powerup",GunPowerUp:"gunpowerup",LaserPowerUp:"laserpowerup",ShieldActivate:"shieldup",ShieldDeactivate:"shielddown",SpeedBoost:"speedup",MegaLaserActive:"megalaser",WeaponUpgrade:"upgrade",LaserWeapon:"laser",TankLaser:"tanklaser",HomingMissile:"missile",SmallMissile:"smallmissile",FlakCannon:"flak",Thunderstrike:"thunder",EnemyShoot:"enemyfire",EnemyTankFire:"enemytankgun",BombDrop:"bombfall",JetDive:"jetdive",TankEngine:"diesel",BulletDeflect:"deflect",SatelliteLaser:"satlaser",AllyHelicopter:"pupcopter",GetReady:"v_getready",Prepare:"v_prepare",Danger:"v_danger",LevelComplete:"v_levelcomplete",GameOver:"v_gameover",MegaLaserVoice:"v_megalaser",AtomicTank:"v_atomictank",ButtonPress:"buttondown",ButtonRelease:"buttonup",ActionDenied:"denied",StatUpdate:"statbeep",StatsScreen:"stats",MapHover:"mapover",AirRaidSiren:"airraid",DangerAlert:"alert",ElectricalSpark:"sparking",ElectricalShort:"shorting",MeteorFall:"meteor"}[e]||e.toLowerCase()}static loadSoundsFromMap(e){Object.entries(e).forEach(([e,t])=>{try{this.sounds.set(e,new w.Howl({src:[t],volume:.5,onloaderror:(e,t)=>{},onload:()=>{}}))}catch(i){}})}static getTexture(e){const t={bullet:"bullets",bomb:"dumbbomb"}[e]||e,i=this.textures.get(t);return i||(this.textures.has("error")||this.createColorTexture("error",32,32,16711935),this.textures.get("error"))}static createAnimatedSprite(e){const t=this.getTexture(e);if(!t||!t.baseTexture)return null;const i=D[e];return i?new x(t.baseTexture,i.frameCount,i.frameRate,i.loop):new x(t.baseTexture,1,100,!1)}static createRotationSprite(e){const t=this.getTexture(e);if(!t||!t.baseTexture)return null;const i=D[e];return i?new A(t.baseTexture,i.frameCount,i.rowCount||1):new A(t.baseTexture,1,1)}static createDirectionalSprite(e){const t=this.getTexture(e);if(!t||!t.baseTexture)return null;const i=D[e];return i?new C(t.baseTexture,i.frameCount,i.rowCount||1):new C(t.baseTexture,1,1)}static getSound(e){return this.sounds.get(e)||null}static isLoaded(){return this.loaded}static getProgress(){return this.loaded?1:0}static getCraftData(){return this.craftData}static getCraft(e){return this.craftData.get(e)}static getWaveData(){return this.waveData}static getBossData(){return this.bossData}static getSurvivalData(e){return this.survivalData.get(e)}static createPowerupTextures(){const e=this.getTexture("powerups");if(!e||!e.baseTexture){const e=[["powerup_weapon",30,30,65280],["powerup_shield",30,30,65535],["powerup_nuke",30,30,16711680],["powerup_health",30,30,16711935],["powerup_speed",30,30,16776960],["powerup_rapid",30,30,16746496],["powerup_spread",30,30,8913151]];for(const[t,i,s,a]of e)this.textures.has(t)||this.createColorTexture(t,i,s,a);return}const t=e.baseTexture.height;["powerup_nuke","powerup_shield","powerup_speed","powerup_rapid","powerup_weapon","powerup_spread"].forEach((i,s)=>{if(!this.textures.has(i)){const a=new h(e.baseTexture,new l(32*s,0,32,t));this.textures.set(i,a)}})}};I.textures=new Map,I.sounds=new Map,I.loaded=!1,I.craftData=new Map,I.waveData=[],I.bossData=new Map,I.survivalData=new Map;let P=I;const b=class e extends p{constructor(t,i,s,a,r,o,n,h="bullet"){super(),this.isDestroyed=!1,this.lifeTime=0,this.maxLifeTime=5e3,this.isHoming=!1,this.homingStrength=.05,this.trailPositions=[],this.isPiercing=!1,this.splashRadius=0,this.hasGravity=!1,this.gravity=0,this.isExplosive=!1,this.explosionRadius=0,this.hasPenetration=!1,this.fragmentCount=0,this.isBurst=!1,this.burstProjectiles=0,this.game=t,this.x=i,this.y=s,this.angle=a,this.speed=r,this.damage=o,this.isPlayerProjectile=n,this.type=this.getTypeFromTexture(h),this.setSpecialProperties();const l=r*e.AUTHENTIC_SPEED_MULTIPLIER;this.velocity=new u(-Math.cos(a)*l,Math.sin(a)*l),this.createProjectileSprite(h,a),this.shouldHaveTrail()&&this.createTrail(),"LASER"!==this.type&&"ENERGY_BALL"!==this.type||this.addGlowEffect()}update(t,i){if(!this.isDestroyed)if(this.lifeTime+=1e3*t,this.lifeTime>=this.maxLifeTime)this.destroy();else{if(this.hasGravity){const i=t/e.AUTHENTIC_FRAME_DELTA;this.velocity.y+=this.gravity*i}this.isHoming&&(this.homingTarget&&i?this.updateHoming(t,i):void 0!==this.homingTargetX&&void 0!==this.homingTargetY&&this.updateHomingWithCoords(t)),this.x+=this.velocity.x*t,this.y+=this.velocity.y*t,this.sprite instanceof x&&this.sprite.update(t),this.sprite&&!this.isHoming&&(this.sprite.rotation=Math.atan2(this.velocity.y,this.velocity.x)),this.sprite instanceof x&&this.sprite.update(t),this.trail&&this.updateTrail(),this.isOffScreen()&&this.destroy()}}onCollision(){this.isDestroyed||(this.isExplosive&&this.handleExplosion(),this.splashRadius>0&&!this.isExplosive&&this.createSplashDamage(),this.isPiercing||this.hasPenetration||this.destroy())}setGravity(t){this.hasGravity=t>0,this.gravity=.15===t?e.AUTHENTIC_GRAVITY_DOWN:.1===t?e.AUTHENTIC_GRAVITY_UP:t*e.AUTHENTIC_SPEED_MULTIPLIER}setHoming(e,t,i,s){this.isHoming=e,void 0!==t&&(this.homingTargetX=t),void 0!==i&&(this.homingTargetY=i),void 0!==s&&(this.homingStrength=s)}setExplosive(e,t=50){this.isExplosive=e,this.explosionRadius=t,this.splashRadius=t}setPenetration(e){this.hasPenetration=e,this.isPiercing=e}setFragments(e){this.fragmentCount=e}setBurst(e,t=4){this.isBurst=e,this.burstProjectiles=t}setGlow(e,t=.8){this.glowColor=e,this.glowIntensity=t,this.addGlowEffect()}getTypeFromTexture(e){return e.includes("missile")?"MISSILE":e.includes("laser")?"LASER":e.includes("rocket")?"ROCKET":e.includes("flak")?"FLAK":e.includes("thunder")?"THUNDER":e.includes("bomb")?"BOMB":e.includes("energy")?"ENERGY_BALL":"BULLET"}setSpecialProperties(){switch(this.type){case"MISSILE":this.isHoming=!0,this.splashRadius=30;break;case"ROCKET":this.splashRadius=50;break;case"FLAK":this.splashRadius=40,this.hasGravity=!0;break;case"LASER":this.isPiercing=!0;break;case"ENERGY_BALL":this.isHoming=!0,this.homingStrength=.02}}createProjectileSprite(e,t){if("BULLET"===this.type||"MISSILE"===this.type||"ROCKET"===this.type){const t=P.getTexture(e);t&&t.baseTexture?this.sprite=new C(t.baseTexture,21,5):this.sprite=new n(t)}else if(D[e]){const t=D[e],i=P.getTexture(e);i&&i.baseTexture?this.sprite=new x(i.baseTexture,t.frameCount,t.frameRate,t.loop):this.sprite=new n(i)}else{const t=P.getTexture(e);this.sprite=new n(t)}this.sprite.anchor.set(.5),this.sprite instanceof C?this.sprite.setAngleAndRow(t,0):this.sprite.rotation=t,this.addChild(this.sprite)}shouldHaveTrail(){return"MISSILE"===this.type||"ROCKET"===this.type||"ENERGY_BALL"===this.type}createTrail(){this.trail=new g,this.addChild(this.trail)}addGlowEffect(){if(this.glowColor&&this.glowIntensity){const e=new(void 0)({color:this.glowColor,outerStrength:this.glowIntensity,innerStrength:.5,distance:15});this.sprite.filters=[e]}}updateHoming(e,t){if(!this.homingTarget&&t.length>0){let e=1/0;for(const i of t){const t=this.getDistance(this.x,this.y,i.x,i.y);t<e&&(e=t,this.homingTarget=i)}}if(this.homingTarget&&!this.homingTarget.isDestroyed){const e=this.homingTarget.x-this.x,t=this.homingTarget.y-this.y,i=Math.atan2(t,e)-this.angle,s=Math.atan2(Math.sin(i),Math.cos(i));this.angle+=s*this.homingStrength,this.velocity.x=Math.cos(this.angle)*this.speed,this.velocity.y=Math.sin(this.angle)*this.speed,this.sprite.rotation=this.angle}}updateHomingWithCoords(e){if(!this.isHoming||void 0===this.homingTargetX||void 0===this.homingTargetY)return;const t=this.homingTargetX-this.x,i=this.homingTargetY-this.y,s=Math.atan2(i,t)-this.angle,a=Math.atan2(Math.sin(s),Math.cos(s));this.angle+=a*this.homingStrength,this.velocity.x=Math.cos(this.angle)*this.speed,this.velocity.y=Math.sin(this.angle)*this.speed,this.sprite&&(this.sprite.rotation=this.angle)}updateTrail(){if(this.trail&&(this.trailPositions.push(new u(this.x,this.y)),this.trailPositions.length>10&&this.trailPositions.shift(),this.trail.clear(),this.trailPositions.length>1)){this.trail.lineStyle(3,16777215,.8),this.trail.moveTo(this.trailPositions[0].x-this.x,this.trailPositions[0].y-this.y);for(let e=1;e<this.trailPositions.length;e++)this.trail.lineTo(this.trailPositions[e].x-this.x,this.trailPositions[e].y-this.y)}}handleExplosion(){if(!this.isExplosive)return;const e=this.isPlayerProjectile?this.explosionRadius>100?"large":this.explosionRadius>50?"medium":"small":"tiny";this.game.getParticleSystem().createExplosion(this.x,this.y,e),this.fragmentCount>0&&this.createFragments(),this.isBurst&&this.burstProjectiles>0&&this.createBurstProjectiles()}createFragments(){const t=2*Math.PI/this.fragmentCount;for(let i=0;i<this.fragmentCount;i++){const s=t*i,a=.6*this.speed,r=Math.ceil(.3*this.damage),o=new e(this.game,this.x,this.y,s,a,r,this.isPlayerProjectile,"fragment");o.setGravity(.3),this.game.addProjectile(o)}}createBurstProjectiles(){const t=2*Math.PI/this.burstProjectiles;for(let i=0;i<this.burstProjectiles;i++){const s=t*i,a=.8*this.speed,r=Math.ceil(.5*this.damage),o=new e(this.game,this.x,this.y,s,a,r,this.isPlayerProjectile,"burst_rocket");this.game.addProjectile(o)}}createSplashDamage(){const e=this.isPlayerProjectile?this.splashRadius>50?"medium":"small":"tiny";this.game.getParticleSystem().createExplosion(this.x,this.y,e)}isOffScreen(){const e=100;return this.x<-100||this.x>v.SCREEN_WIDTH+e||this.y<-100||this.y>v.SCREEN_HEIGHT+e}getDistance(e,t,i,s){return Math.sqrt(Math.pow(i-e,2)+Math.pow(s-t,2))}getBounds(){let e=10,t=10;return this.sprite&&(e=this.sprite.width||e,t=this.sprite.height||t,(e<2||e>100)&&(e=10),(t<2||t>100)&&(t=10)),new l(this.x-e/2,this.y-t/2,e,t)}getSplashRadius(){return this.splashRadius}getIsPiercing(){return this.isPiercing}get isEnemyProjectile(){return!this.isPlayerProjectile}destroy(){this.isDestroyed=!0,super.destroy()}};b.AUTHENTIC_GRAVITY_DOWN=.262,b.AUTHENTIC_GRAVITY_UP=.256,b.AUTHENTIC_SPEED_MULTIPLIER=1,b.AUTHENTIC_ROTATION_LIMIT=6.28318,b.AUTHENTIC_FRAME_DELTA=.016667;let _=b;const L=Object.freeze(Object.defineProperty({__proto__:null,Projectile:_},Symbol.toStringTag,{value:"Module"}));var F=(e=>(e.STANDARD_GUN="STANDARD_GUN",e.DEFENSE_ORB="DEFENSE_ORB",e.HOMING_MISSILES="HOMING_MISSILES",e.LASER_CANNON="LASER_CANNON",e.ROCKETS="ROCKETS",e.FLAK_CANNON="FLAK_CANNON",e.THUNDERSTRIKE="THUNDERSTRIKE",e))(F||{});class B{constructor(e,t){this.upgradeLevel=0,this.lastFireTime=0,this.game=e,this.type=t,this.damage=10,this.fireRate=200,this.projectileSpeed=800,this.ammo=1/0,this.maxAmmo=1/0,this.spread=0}getAmmo(){return this.ammo}getMaxAmmo(){return this.maxAmmo}refillAmmo(){this.ammo=this.maxAmmo}getFireRate(){return this.fireRate}getType(){return this.type}getUpgradeLevel(){return this.upgradeLevel}canFire(){return Date.now()-this.lastFireTime>=this.fireRate}upgrade(){return!(this.upgradeLevel>=3)&&(this.upgradeLevel++,this.onUpgrade(),!0)}onUpgrade(){}createProjectile(e,t,i,s,a="bullets"){const r=new _(this.game,e,t,i,this.projectileSpeed,this.damage,s,a);return this.game.addProjectile(r),r}applySpread(e){if(0===this.spread)return e;const t=this.spread*Math.PI/180;return e+(Math.random()-.5)*t}}class O extends B{constructor(e){super(e,F.STANDARD_GUN);const t=v.PLAYER_WEAPONS.STANDARD_GUN;this.damage=t.damage,this.fireRate=t.fireRate,this.projectileSpeed=t.projectileSpeed,this.ammo=t.ammo,this.maxAmmo=t.ammo,this.spread=t.spread}fire(e,t,i,s){const a=this.applySpread(i);this.createProjectile(e,t,a,s,"bullets")}}class H extends B{constructor(e){super(e,F.DEFENSE_ORB),this.speedBoostActive=!1,this.speedBoostDuration=0,this.damage=0,this.fireRate=5e3,this.ammo=-1,this.maxAmmo=-1,this.projectileSpeed=0}fire(e,t,i,s){if(!this.canFire())return;const a=this.game.getPlayerTank();a&&a.activateSpeedBoost(1e4),this.lastFireTime=Date.now()}upgrade(){if(this.upgradeLevel>=3)return!1;switch(this.upgradeLevel++,this.upgradeLevel){case 1:this.fireRate=4e3;break;case 2:this.fireRate=3e3;break;case 3:this.fireRate=2e3}return!0}cleanup(){}}class k extends B{constructor(e){super(e,F.HOMING_MISSILES);const t=v.PLAYER_WEAPONS.HOMING_MISSILES;this.damage=t.damage,this.fireRate=t.fireRate,this.projectileSpeed=t.projectileSpeed,this.ammo=t.ammo,this.maxAmmo=t.ammo,this.spread=t.spread}fire(e,t,i,s){if(this.ammo<=0)return;const a=e-15,r=t+-5;this.createProjectile(a,r,i-.1,s,"missile");const o=e+15,n=t+-5;this.createProjectile(o,n,i+.1,s,"missile"),this.ammo=Math.max(0,this.ammo-2)}}class N extends B{constructor(e){super(e,F.LASER_CANNON);const t=v.PLAYER_WEAPONS.LASER_CANNON;this.damage=t.damage,this.fireRate=t.fireRate,this.projectileSpeed=t.projectileSpeed,this.ammo=t.ammo,this.maxAmmo=t.ammo,this.spread=t.spread}fire(e,t,i,s){this.ammo<=0||(this.createProjectile(e,t,i,s,"laser"),this.ammo=Math.max(0,this.ammo-1))}}class U extends B{constructor(e){super(e,F.ROCKETS);const t=v.PLAYER_WEAPONS.ROCKETS;this.damage=t.damage,this.fireRate=t.fireRate,this.projectileSpeed=t.projectileSpeed,this.ammo=t.ammo,this.maxAmmo=t.ammo,this.spread=t.spread}fire(e,t,i,s){if(this.ammo<=0)return;const a=this.applySpread(i);this.createProjectile(e,t,a,s,"rocket"),this.ammo=Math.max(0,this.ammo-1)}}class G extends B{constructor(e){super(e,F.FLAK_CANNON),this.projectileCount=5;const t=v.PLAYER_WEAPONS.FLAK_CANNON;this.damage=t.damage,this.fireRate=t.fireRate,this.projectileSpeed=t.projectileSpeed,this.ammo=t.ammo,this.maxAmmo=t.ammo,this.spread=t.spread,this.projectileCount=t.projectileCount}fire(e,t,i,s){if(this.ammo<=0)return;const a=this.spread*Math.PI/180,r=a/(this.projectileCount-1),o=i-a/2;for(let n=0;n<this.projectileCount;n++){const i=o+r*n+.1*(Math.random()-.5);this.createProjectile(e,t,i,s,"bullet")}this.ammo=Math.max(0,this.ammo-1)}}class W extends B{constructor(e){super(e,F.THUNDERSTRIKE),this.chainRange=150,this.maxChains=3;const t=v.PLAYER_WEAPONS.THUNDERSTRIKE;this.damage=t.damage,this.fireRate=t.fireRate,this.projectileSpeed=t.projectileSpeed,this.ammo=t.ammo,this.maxAmmo=t.ammo,this.spread=t.spread}fire(e,t,i,s){if(this.ammo<=0)return;const a=this.createProjectile(e,t,i,s,"energy_ball");this.addChainLightningProperties(a),this.ammo=Math.max(0,this.ammo-1)}addChainLightningProperties(e){}}const j=class{static initialize(){w.Howler.volume(1);const e=localStorage.getItem("atomicSurvivalMusicVolume"),t=localStorage.getItem("atomicSurvivalEffectsVolume"),i=localStorage.getItem("atomicSurvivalMuted");e&&(this.musicVolume=parseFloat(e)),t&&(this.effectsVolume=parseFloat(t)),i&&(this.muted="true"===i);const s=()=>o(this,null,function*(){try{w.Howler.ctx&&"suspended"===w.Howler.ctx.state?yield w.Howler.ctx.resume():w.Howler.ctx,document.removeEventListener("click",s),document.removeEventListener("keydown",s),document.removeEventListener("touchstart",s)}catch(e){}});document.addEventListener("click",s),document.addEventListener("keydown",s),document.addEventListener("touchstart",s),window.addEventListener("focus",()=>o(this,null,function*(){if(w.Howler.ctx&&"suspended"===w.Howler.ctx.state)try{yield w.Howler.ctx.resume()}catch(e){}})),document.addEventListener("visibilitychange",()=>o(this,null,function*(){if(!document.hidden&&w.Howler.ctx&&"suspended"===w.Howler.ctx.state)try{yield w.Howler.ctx.resume()}catch(e){}}))}static play(e,t){if(this.muted)return;if(w.Howler.ctx&&"suspended"===w.Howler.ctx.state)return;const i=P.getSound(e);if(!i)return;const s=(null!=t?t:1)*this.effectsVolume;return i.volume(s),i.play()}static playAt(e,t,i){if(this.muted)return;const s=P.getSound(e);if(!s)return;const a=Math.sqrt(Math.pow(t-640,2)+Math.pow(i-360,2)),r=Math.max(0,1-a/500),o=(t-640)/640;s.volume(r*this.effectsVolume),s.stereo(o),s.play()}static playLoop(e,t){if(this.muted)return;const i=P.getSound(e);return i?(i.loop(!0),i.volume((null!=t?t:1)*this.effectsVolume),i.play()):void 0}static stop(e,t){const i=P.getSound(e);i&&(void 0!==t?i.stop(t):i.stop())}static fadeOut(e,t=1e3,i){const s=P.getSound(e);s&&(s.fade(s.volume(),0,t,i),setTimeout(()=>{void 0!==i?s.stop(i):s.stop()},t))}static playMusic(e){if(this.muted)return;this.currentMusic&&this.currentMusic.stop();const t=P.getSound(e);t&&(t.loop(!0),t.volume(this.musicVolume),t.play(),this.currentMusic=t)}static stopMusic(){this.currentMusic&&(this.currentMusic.stop(),this.currentMusic=void 0)}static setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("atomicSurvivalMusicVolume",this.musicVolume.toString()),this.currentMusic&&this.currentMusic.volume(this.musicVolume)}static setEffectsVolume(e){this.effectsVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("atomicSurvivalEffectsVolume",this.effectsVolume.toString())}static toggleMute(){this.muted=!this.muted,localStorage.setItem("atomicSurvivalMuted",this.muted.toString()),this.muted?w.Howler.volume(0):w.Howler.volume(1)}static setMuted(e){this.muted=e,localStorage.setItem("atomicSurvivalMuted",this.muted.toString()),this.muted?w.Howler.volume(0):w.Howler.volume(1)}static isMuted(){return this.muted}static playRandom(e,t){if(0===e.length)return;const i=Math.floor(Math.random()*e.length);this.play(e[i],t)}static playWeaponUpgrade(e){e<=3?this.play("weapon_upgrade_permanent",.8):this.play("weapon_upgrade_permanent_high",.9)}static playTempPowerup(e){const t={gun_power:"gunpowerup",laser:"laserpowerup",shield:"shieldup",speed:"speedup",rapid:"powerup",spread:"powerup",nuke:"nukeblast"}[e]||"powerup";this.play(t,.7)}static playShieldUp(){this.play("shieldup",.8)}static playShieldDown(){this.play("shielddown",.8)}static playShieldDeflect(){const e=.8+.4*Math.random(),t=P.getSound("shield_deflect");t&&(t.rate(e),t.volume(.6*this.effectsVolume),t.play())}static preload(e){const t=[];for(const i of e){const e=P.getSound(i);e&&"unloaded"===e.state()&&t.push(new Promise(t=>{e.once("load",()=>t()),e.load()}))}return Promise.all(t).then(()=>{})}static cleanup(){w.Howler.stop(),this.sounds.clear(),this.currentMusic=void 0}};j.sounds=new Map,j.musicVolume=.5,j.effectsVolume=.7,j.muted=!1;let K=j;class Y extends p{constructor(e){super(),this.duration=3e3,this.timer=0,this.isActive=!1,this.chargeTime=1e3,this.chargeTimer=0,this.isCharging=!1,this.laserBeams=[],this.sparkles=[],this.beamIntensity=0,this.chargeIntensity=0,this.damageTimer=0,this.damageInterval=100,this.game=e,this.createVisualEffects()}createVisualEffects(){this.backgroundFlash=new g,this.backgroundFlash.beginFill(16777215,0),this.backgroundFlash.drawRect(0,0,v.SCREEN_WIDTH,v.SCREEN_HEIGHT),this.backgroundFlash.endFill(),this.addChild(this.backgroundFlash),this.chargeEffect=new g,this.addChild(this.chargeEffect);for(let e=0;e<5;e++){const e=new g;this.laserBeams.push(e),this.addChild(e)}for(let e=0;e<20;e++){const e=new g;this.sparkles.push(e),this.addChild(e)}this.visible=!1}activate(){this.isActive||this.isCharging||(this.isCharging=!0,this.chargeTimer=0,this.timer=0,this.visible=!0,K.play("mega_laser"),this.game.layers.getLayer("effects").addChild(this))}update(e){if(!this.isCharging&&!this.isActive)return;const t=1e3*e;if(this.isCharging)this.chargeTimer+=t,this.chargeIntensity=Math.min(this.chargeTimer/this.chargeTime,1),this.updateChargeEffect(),this.chargeTimer>=this.chargeTime&&(this.isCharging=!1,this.isActive=!0,this.timer=0,this.chargeEffect.visible=!1);else if(this.isActive){this.timer+=t,this.damageTimer+=t;const e=this.timer/this.duration,i=.3*Math.sin(.02*this.timer)+.7;this.beamIntensity=(1-.3*e)*i,this.updateLaserBeams(),this.updateBackgroundFlash(),this.updateSparkles(),this.damageTimer>=this.damageInterval&&(this.dealDamageToEnemies(),this.damageTimer=0),this.timer>=this.duration&&this.deactivate()}}updateChargeEffect(){this.chargeEffect.clear();const e=this.game.getTank();if(!e)return;const t=e.x,i=e.y,s=100*this.chargeIntensity,a=.8*this.chargeIntensity;if(this.chargeEffect.beginFill(65535,.3*a),this.chargeEffect.drawCircle(t,i,s),this.chargeEffect.endFill(),this.chargeEffect.beginFill(16777215,.6*a),this.chargeEffect.drawCircle(t,i,.7*s),this.chargeEffect.endFill(),this.chargeIntensity>.5){this.chargeEffect.lineStyle(2,16711680,a);for(let e=0;e<5;e++){const s=2*Math.PI*e/5-Math.PI/2,a=t+Math.cos(s)*v.SCREEN_WIDTH,r=i+Math.sin(s)*v.SCREEN_HEIGHT;this.chargeEffect.moveTo(t,i),this.chargeEffect.lineTo(a,r)}}}updateLaserBeams(){const e=this.game.getTank();if(!e)return;const t=e.x,i=e.y;this.laserBeams.forEach((e,s)=>{e.clear();const a=2*Math.PI*s/5-Math.PI/2,r=2*v.SCREEN_WIDTH,o=t+Math.cos(a)*r,n=i+Math.sin(a)*r,h=25*this.beamIntensity,l=.8*this.beamIntensity;e.lineStyle(h,16729088,l),e.moveTo(t,i),e.lineTo(o,n);const c=12*this.beamIntensity,d=1*this.beamIntensity;e.lineStyle(c,65535,d),e.moveTo(t,i),e.lineTo(o,n);const m=4*this.beamIntensity;e.lineStyle(m,16777215,d),e.moveTo(t,i),e.lineTo(o,n)})}updateBackgroundFlash(){const e=.1*this.beamIntensity;this.backgroundFlash.clear(),this.backgroundFlash.beginFill(65535,e),this.backgroundFlash.drawRect(0,0,v.SCREEN_WIDTH,v.SCREEN_HEIGHT),this.backgroundFlash.endFill()}updateSparkles(){const e=this.game.getTank();e&&this.sparkles.forEach((t,i)=>{t.clear();const s=50+100*Math.random(),a=(.001*Date.now()+.3*i)%(2*Math.PI),r=e.x+Math.cos(a)*s,o=e.y+Math.sin(a)*s,n=3+5*Math.random(),h=Math.random()*this.beamIntensity,l=[16777215,65535,16729088],c=l[Math.floor(Math.random()*l.length)];t.beginFill(c,h),t.drawCircle(r,o,n),t.endFill()})}dealDamageToEnemies(){this.game.getEnemies().forEach(e=>{e.isDestroyed||e.takeDamage(50)})}deactivate(){this.isActive=!1,this.isCharging=!1,this.visible=!1,this.laserBeams.forEach(e=>e.clear()),this.chargeEffect.clear(),this.backgroundFlash.clear(),this.sparkles.forEach(e=>e.clear()),this.parent&&this.parent.removeChild(this)}isLaserActive(){return this.isActive||this.isCharging}forceDeactivate(){this.deactivate()}destroy(){var e,t;this.laserBeams.forEach(e=>null==e?void 0:e.destroy()),null==(e=this.chargeEffect)||e.destroy(),null==(t=this.backgroundFlash)||t.destroy(),this.sparkles.forEach(e=>null==e?void 0:e.destroy()),super.destroy()}}class X{constructor(e,t){this.isActive=!1,this.remainingTime=0,this.maxTime=0,this.deflectionRadius=60,this.impactParticles=[],this.game=e,this.tank=t,this.shieldGraphics=new g,t.addChild(this.shieldGraphics),this.shieldGraphics.visible=!1}activate(e){this.isActive=!0,this.remainingTime=e,this.maxTime=e,this.shieldGraphics.visible=!0,K.play("shield_activate")}update(e){this.isActive&&(this.remainingTime-=1e3*e,this.remainingTime<=0?this.deactivate():(this.updateShieldVisual(),this.checkBulletDeflections(),this.updateImpactParticles(e)))}updateShieldVisual(){this.shieldGraphics.clear();const e=.01*Date.now();let t=.3+.2*Math.sin(.5*e);this.remainingTime<2e3&&(t*=Math.sin(2*e)>0?1:.3),this.shieldGraphics.lineStyle(3,65535,t),this.shieldGraphics.beginFill(65535,.1*t),this.shieldGraphics.drawCircle(0,0,this.deflectionRadius),this.shieldGraphics.endFill();for(let i=0;i<8;i++){const s=i/8*Math.PI*2+.1*e,a=Math.cos(s)*(this.deflectionRadius-10),r=Math.sin(s)*(this.deflectionRadius-10),o=Math.cos(s)*this.deflectionRadius,n=Math.sin(s)*this.deflectionRadius;this.shieldGraphics.lineStyle(2,65535,.8*t),this.shieldGraphics.moveTo(a,r),this.shieldGraphics.lineTo(o,n)}}checkBulletDeflections(){const e=this.game.projectiles;for(let t=e.length-1;t>=0;t--){const i=e[t];if(!i.isEnemyProjectile||i.isDestroyed)continue;const s=i.x-this.tank.x,a=i.y-this.tank.y,r=Math.sqrt(s*s+a*a);r<=this.deflectionRadius&&(this.deflectProjectile(i,s,a,r),this.createImpactEffect(i.x,i.y),K.playShieldDeflect())}}deflectProjectile(e,t,i,s){const a=t/s,r=i/s,o=Math.cos(e.angle||0)*e.speed,n=Math.sin(e.angle||0)*e.speed,h=o*a+n*r,l=o-2*h*a,c=n-2*h*r;e.angle=Math.atan2(c,l),e.angle+=.5*(Math.random()-.5),e.isPlayerProjectile=!0;const d=this.deflectionRadius+5;e.x=this.tank.x+a*d,e.y=this.tank.y+r*d}createImpactEffect(e,t){const i=new g;i.x=e,i.y=t,i.beginFill(16777215,.8),i.drawCircle(0,0,8),i.endFill(),this.tank.parent.addChild(i),this.impactParticles.push(i)}updateImpactParticles(e){for(let t=this.impactParticles.length-1;t>=0;t--){const i=this.impactParticles[t];i.alpha-=5*e,i.scale.set(i.scale.x*(1-3*e)),i.alpha<=0&&(i.destroy(),this.impactParticles.splice(t,1))}}deactivate(){this.isActive=!1,this.shieldGraphics.visible=!1,this.impactParticles.forEach(e=>e.destroy()),this.impactParticles=[],K.play("shield_deactivate")}forceDeactivate(){this.isActive&&this.deactivate()}isShieldActive(){return this.isActive}getTimeRemaining(){return this.isActive?this.remainingTime:0}getShieldStrength(){return this.isActive?this.remainingTime/this.maxTime:0}destroy(){this.forceDeactivate(),this.shieldGraphics&&this.shieldGraphics.destroy()}}class V extends p{constructor(e){super(),this.turretAngle=0,this.speedBoost=!1,this.speedBoostTimer=0,this.rapidFire=!1,this.rapidFireTimer=0,this.spreadShot=!1,this.spreadShotTimer=0,this.gunPowerUp=!1,this.gunPowerUpTimer=0,this.originalGunStats=null,this.damageFlashTimer=0,this.weaponLevel=0,this.movementTraces=[],this.lastTracePosition={x:0,y:0},this.traceUpdateTimer=0,this.TRACE_UPDATE_INTERVAL=100,this.MAX_TRACE_POINTS=10,this.isDestroyed=!1,this.game=e,this.health=v.TANK_MAX_HEALTH,this.maxHealth=v.TANK_MAX_HEALTH,this.velocity=new u(0,0),this.speed=v.TANK_SPEED;const t=P.getTexture("tank_shadow")||P.getTexture("tank");this.shadow=new n(t),this.shadow.anchor.set(.5),this.shadow.y=22,this.shadow.alpha=.5,this.addChild(this.shadow);const i=P.getTexture("tank");i?(this.body=new A(i.baseTexture,10),this.body.anchor.set(.5),this.addChild(this.body)):(this.body=new A(h.WHITE.baseTexture,1),this.body.anchor.set(.5),this.addChild(this.body));const s=P.createRotationSprite("gun");if(s)this.turret=s,this.turret.anchor.set(.5,.5),this.turret.x=0,this.turret.y=-27,this.addChild(this.turret);else{const e=P.getTexture("gun");this.turret=new A(e.baseTexture,21),this.turret.anchor.set(.5,.5),this.turret.x=0,this.turret.y=-27,this.addChild(this.turret)}this.weapons=new Map,this.weapons.set(F.STANDARD_GUN,new O(e)),this.weapons.set(F.DEFENSE_ORB,new H(e)),this.weapons.set(F.HOMING_MISSILES,new k(e)),this.weapons.set(F.LASER_CANNON,new N(e)),this.weapons.set(F.ROCKETS,new U(e)),this.weapons.set(F.FLAK_CANNON,new G(e)),this.weapons.set(F.THUNDERSTRIKE,new W(e)),this.weaponLevels=new Map,this.weaponTimers=new Map;const a=[F.STANDARD_GUN,F.DEFENSE_ORB,F.HOMING_MISSILES,F.LASER_CANNON,F.ROCKETS,F.FLAK_CANNON,F.THUNDERSTRIKE];for(const r of a)this.weaponLevels.set(r,0),this.weaponTimers.set(r,0);this.weaponLevels.set(F.STANDARD_GUN,1),this.activeWeapons=[F.STANDARD_GUN],this.shieldSystem=new X(e,this),this.width=v.TANK_WIDTH,this.height=v.TANK_HEIGHT}update(e){if(this.isDestroyed)return;const t=this.game.getInputHandler().getInput();if(this.updateMovement(t,e),this.updateTurret(),this.updateFiring(t,e),this.updatePowerUps(e),this.shieldSystem.update(e),this.megaLaser&&(this.megaLaser.update(e),this.megaLaser.isLaserActive()||(this.megaLaser.destroy(),this.megaLaser=void 0)),this.damageFlashTimer>0){this.damageFlashTimer-=e;const t=Math.sin(20*this.damageFlashTimer)>0;this.body.tint=t?16711680:16777215}else this.body.tint=16777215;this.updatePowerUpVisuals(e),this.updateMovementTraces(e),this.updateWeaponSystems(e)}updateWeaponSystems(e){}updateMovement(e,t){const i=this.game.getInputHandler().getMousePosition(),s=this.speed,a=this.speedBoost?2*s:s,r=i.x-this.x;let o=0;if(Math.abs(r)>2){o=Math.max(-1,Math.min(1,r/100))*a}const n=o-this.velocity.x;let h=800;if(Math.abs(n)>.1){h=800*(.85+(1-.85)*(1-Math.abs(this.velocity.x)/a));const e=h*t*Math.sign(n);this.velocity.x+=e}Math.abs(r)<5&&(this.velocity.x*=Math.pow(.92,60*t),Math.abs(this.velocity.x)<.5&&(this.velocity.x=0)),this.velocity.x=Math.max(-a,Math.min(a,this.velocity.x)),this.x+=this.velocity.x*t;const l=v.TANK_MIN_X,c=v.TANK_MAX_X;if(this.x<l?(this.x=l,this.velocity.x=0):this.x>c&&(this.x=c,this.velocity.x=0),Math.abs(this.velocity.x)>1){const e=Math.atan2(0,this.velocity.x);this.body.setAngle(e)}}updateTurret(){const e=this.game.getInputHandler().getMousePosition(),t=this.x,i=this.y-12,s=e.x-t,a=e.y-i;let r=Math.atan2(a,s)-this.turretAngle;r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r+=2*Math.PI);this.turretAngle+=.15*r,this.turretAngle>Math.PI?this.turretAngle-=2*Math.PI:this.turretAngle<-Math.PI&&(this.turretAngle+=2*Math.PI),this.turret.setAngle(this.turretAngle)}updateFiring(e,t){for(const[i,s]of this.weaponTimers){const e=Math.max(0,s-1);this.weaponTimers.set(i,e)}if(e.fire){const e=this.turretAngle,t=30,i=this.x+Math.cos(e)*t,s=this.y+Math.sin(e)*t;let a=0;for(const r of this.activeWeapons){const t=this.weapons.get(r),o=this.weaponLevels.get(r);if(this.weaponTimers.get(r)<=0&&o>0){const n=t.getFireRate(),h=Math.ceil(n/16.67),l=this.rapidFire?Math.ceil(.5*h):h;this.fireWeaponAtLevel(t,r,o,i,s,e),this.weaponTimers.set(r,l),a++}}if(a>0){this.createShellCasing(i,s,e);const t=Array.from(this.weaponLevels.values()).reduce((e,t)=>e+t,0);t>1?K.play(`tank_fire_${Math.min(Math.floor(t/2),4)}`):K.play("tank_fire")}}e.special&&this.fireSpecialWeapon()}fireWeaponAtLevel(e,t,i,s,a,r){if(this.spreadShot){const t=.2;e.fire(s,a,r-t,!0),e.fire(s,a,r,!0),e.fire(s,a,r+t,!0)}else e.fire(s,a,r,!0)}fireSpecialWeapon(){}updatePowerUpVisuals(e){const t=.01*Date.now();if(this.speedBoost&&0!==this.velocity.x){this.speedTrail||(this.speedTrail=new g,this.addChild(this.speedTrail)),this.speedTrail.clear(),this.speedTrail.alpha=.6;const e=.3*Math.abs(this.velocity.x),t=this.velocity.x>0?-1:1;for(let i=0;i<5;i++){const i=20*(Math.random()-.5),s=e*(.5+.5*Math.random());this.speedTrail.lineStyle(2,65535,.8),this.speedTrail.moveTo(30*t,i),this.speedTrail.lineTo(t*(30+s),i)}}else this.speedTrail&&(this.speedTrail.visible=!1);if(this.rapidFire){this.rapidFireGlow||(this.rapidFireGlow=new g,this.turret.addChild(this.rapidFireGlow)),this.rapidFireGlow.clear();const e=.3+.2*Math.sin(.5*t);this.rapidFireGlow.beginFill(16746496,e),this.rapidFireGlow.drawCircle(0,0,25),this.rapidFireGlow.endFill()}else this.rapidFireGlow&&(this.rapidFireGlow.visible=!1);if(this.spreadShot){this.spreadShotGlow||(this.spreadShotGlow=new g,this.turret.addChild(this.spreadShotGlow)),this.spreadShotGlow.clear();const e=.3+.2*Math.sin(.3*t);this.spreadShotGlow.beginFill(8913151,e),this.spreadShotGlow.drawCircle(0,0,30),this.spreadShotGlow.endFill()}else this.spreadShotGlow&&(this.spreadShotGlow.visible=!1);if(this.gunPowerUp){this.gunPowerUpGlow||(this.gunPowerUpGlow=new g,this.turret.addChild(this.gunPowerUpGlow)),this.gunPowerUpGlow.clear();const e=.4+.3*Math.sin(.7*t);this.gunPowerUpGlow.beginFill(65280,e),this.gunPowerUpGlow.drawCircle(0,0,35),this.gunPowerUpGlow.endFill();for(let i=0;i<6;i++){const s=i/6*Math.PI*2+.2*t,a=25*Math.cos(s),r=25*Math.sin(s),o=35*Math.cos(s),n=35*Math.sin(s);this.gunPowerUpGlow.lineStyle(2,65280,e),this.gunPowerUpGlow.moveTo(a,r),this.gunPowerUpGlow.lineTo(o,n)}}else this.gunPowerUpGlow&&(this.gunPowerUpGlow.visible=!1)}updatePowerUps(e){this.speedBoost&&(this.speedBoostTimer-=1e3*e,this.speedBoostTimer<=0&&(this.speedBoost=!1)),this.rapidFire&&(this.rapidFireTimer-=1e3*e,this.rapidFireTimer<=0&&(this.rapidFire=!1)),this.spreadShot&&(this.spreadShotTimer-=1e3*e,this.spreadShotTimer<=0&&(this.spreadShot=!1)),this.gunPowerUp&&(this.gunPowerUpTimer-=1e3*e,this.gunPowerUpTimer<=0&&this.deactivateGunPowerUp())}takeDamage(e){this.isDestroyed||this.shieldSystem.isShieldActive()||(this.health-=e,this.damageFlashTimer=.5,K.play("tank_hit"),this.health<=25&&this.health>0&&!this.dangerWarningPlayed&&(K.play("v_danger"),this.dangerWarningPlayed=!0),this.health<=0&&(this.health=0,this.destroy()))}upgradeWeapon(e){const t=[F.STANDARD_GUN,F.DEFENSE_ORB,F.HOMING_MISSILES,F.LASER_CANNON,F.ROCKETS,F.FLAK_CANNON,F.THUNDERSTRIKE];let i=null;if(e){(this.weaponLevels.get(e)||0)<3&&(i=e)}else for(const s of t){const e=this.weaponLevels.get(s)||0;if(0===e&&s!==F.STANDARD_GUN){i=s;break}if(e>0&&e<3){i=s;break}}if(null!==i){const e=this.weaponLevels.get(i)||0,t=e+1;this.weaponLevels.set(i,t),0===e&&this.activeWeapons.push(i);const s=this.weapons.get(i);s&&"function"==typeof s.upgrade&&s.upgrade(),s.refillAmmo();const a=1===t?"weapon_acquire":"weapon_upgrade";K.play(a)}else this.game.getScoreManager().addScore(5e3),K.play("weapon_maxed")}getWeaponLevel(e){return this.weaponLevels.get(e)||0}hasWeapon(e){return(this.weaponLevels.get(e)||0)>0}activateShieldDeflection(e){this.shieldSystem.activate(e)}getCurrentWeapon(){return this.weapons.get(this.activeWeapons[0])}getCurrentAmmo(){let e=0;for(const t of this.activeWeapons){e+=this.weapons.get(t).getAmmo()}return e}getActiveWeapons(){return[...this.activeWeapons]}activateShield(e){this.activateShieldDeflection(e)}activateMegaLaser(e){this.megaLaser&&this.megaLaser.isLaserActive()||(this.megaLaser=new Y(this.game),this.megaLaser.activate())}activateSpeedBoost(e){this.speedBoost=!0,this.speedBoostTimer=e,K.play("speed_boost")}activateRapidFire(e){this.rapidFire=!0,this.rapidFireTimer=e,K.play("rapid_fire")}activateSpreadShot(e){this.spreadShot=!0,this.spreadShotTimer=e,K.play("spread_shot")}activateGunPowerUp(e){if(!this.gunPowerUp){const e=this.weapons.get(F.STANDARD_GUN);this.originalGunStats={damage:e.damage,fireRate:e.getFireRate()},e.damage=Math.floor(2.5*this.originalGunStats.damage),e.fireRate=Math.floor(.6*this.originalGunStats.fireRate),this.gunPowerUp=!0}this.gunPowerUpTimer=e,K.playTempPowerup("gun_power")}deactivateGunPowerUp(){if(this.gunPowerUp&&this.originalGunStats){const e=this.weapons.get(F.STANDARD_GUN);e.damage=this.originalGunStats.damage,e.fireRate=this.originalGunStats.fireRate,this.gunPowerUp=!1,this.originalGunStats=null}}heal(e){this.health=Math.min(this.health+e,this.maxHealth),K.play("health_pickup")}hasShield(){return this.shieldSystem.isShieldActive()}hasSpeedBoost(){return this.speedBoost}hasRapidFire(){return this.rapidFire}hasSpreadShot(){return this.spreadShot}createShellCasing(e,t,i){const s=i+Math.PI/2,a=this.x-15*Math.cos(s),r=this.y-8*Math.sin(s)+10,o=150*Math.cos(s)*(.5+.5*Math.random()),n=150*Math.sin(s)*(.3+.4*Math.random()),h=this.game.getParticleSystem();h&&"function"==typeof h.createShellCasing?h.createShellCasing(a,r,o,n,1500):h&&"function"==typeof h.createExplosion&&h.createExplosion(a,r,"tiny")}updateMovementTraces(e){if(this.traceUpdateTimer+=1e3*e,this.traceUpdateTimer>=this.TRACE_UPDATE_INTERVAL){this.traceUpdateTimer=0;Math.sqrt(Math.pow(this.x-this.lastTracePosition.x,2)+Math.pow(this.y-this.lastTracePosition.y,2))>2&&Math.abs(this.velocity.x)>5&&(this.movementTraces.push({x:this.x,y:this.y+15,velocity:Math.abs(this.velocity.x),timestamp:Date.now()}),this.createMovementDustParticles(),this.lastTracePosition.x=this.x,this.lastTracePosition.y=this.y,this.movementTraces.length>this.MAX_TRACE_POINTS&&this.movementTraces.shift())}const t=Date.now();this.movementTraces=this.movementTraces.filter(e=>t-e.timestamp<2e3)}createMovementDustParticles(){const e=this.game.getParticleSystem();if(!e)return;const t=Math.min(3,Math.floor(Math.abs(this.velocity.x)/50)+1);for(let i=0;i<t;i++){const t=this.x+20*(Math.random()-.5),i=this.y+15+5*(Math.random()-.5),s=.3*-this.velocity.x+30*(Math.random()-.5),a=-20-20*Math.random();"function"==typeof e.createDustParticle?e.createDustParticle(t,i,s,a,800):"function"==typeof e.createExplosion&&e.createExplosion(t,i,"tiny")}}getShieldTimeLeft(){return this.shieldSystem.getTimeRemaining()}getSpeedBoostTimeLeft(){return this.speedBoost?this.speedBoostTimer:0}getRapidFireTimeLeft(){return this.rapidFire?this.rapidFireTimer:0}getSpreadShotTimeLeft(){return this.spreadShot?this.spreadShotTimer:0}hasGunPowerUp(){return this.gunPowerUp}getGunPowerUpTimeLeft(){return this.gunPowerUp?this.gunPowerUpTimer:0}getBounds(){if(this.isDestroyed)return new l(0,0,0,0);let e=0,t=0;try{e=this.x||0,t=this.y||0}catch(i){}return new l(e-v.TANK_WIDTH/2,t-v.TANK_HEIGHT/2,v.TANK_WIDTH,v.TANK_HEIGHT)}getTurretBounds(){if(this.isDestroyed)return new l(0,0,0,0);const e=this.x+this.turret.x,t=this.y+this.turret.y;return new l(e-20,t-30,40,60)}destroy(){this.isDestroyed=!0,this.shieldSystem&&this.shieldSystem.forceDeactivate(),this.gunPowerUp&&this.deactivateGunPowerUp(),this.megaLaser&&(this.megaLaser.forceDeactivate(),this.megaLaser=void 0),super.destroy()}}const z={},q=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),r=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,i),t in z)return;z[t]=!0;const s=t.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(!!i)for(let i=e.length-1;i>=0;i--){const a=e[i];if(a.href===t&&(!s||"stylesheet"===a.rel))return}else if(document.querySelector(`link[href="${t}"]${a}`))return;const o=document.createElement("link");return o.rel=s?"stylesheet":"modulepreload",s||(o.as="script"),o.crossOrigin="",o.href=t,r&&o.setAttribute("nonce",r),document.head.appendChild(o),s?new Promise((e,i)=>{o.addEventListener("load",e),o.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};class ${constructor(e,t){this.frameTextures=[],this.texture=e,this.config=t,this.generateFrameTextures()}generateFrameTextures(){const e=this.texture.width,t=this.texture.height,i=this.config.columns*this.config.frameWidth,s=this.config.rows*this.config.frameHeight;if(i>e||s>t)return this.frameTextures[0]=[],void(this.frameTextures[0][0]=this.texture);for(let a=0;a<this.config.rows;a++){this.frameTextures[a]=[];for(let i=0;i<this.config.columns;i++){if(a*this.config.columns+i<this.config.totalFrames){const s=i*this.config.frameWidth,r=a*this.config.frameHeight;if(s+this.config.frameWidth<=e&&r+this.config.frameHeight<=t){const e=new l(s,r,this.config.frameWidth,this.config.frameHeight);this.frameTextures[a][i]=new h(this.texture.baseTexture,e)}}}}}getFrame(e,t){return e>=0&&e<this.config.rows&&t>=0&&t<this.config.columns&&this.frameTextures[e]&&this.frameTextures[e][t]?this.frameTextures[e][t]:null}getFrameByIndex(e){const t=Math.floor(e/this.config.columns),i=e%this.config.columns;return this.getFrame(t,i)}static rotationToFrameIndex(e,t){let i=e%(2*Math.PI);i<0&&(i+=2*Math.PI);const s=i/(2*Math.PI)*t;return Math.floor(s+.5)%t}static angleToRotationFrame(e){return $.rotationToFrameIndex(e,16)}static angleToColumn(e,t){return $.rotationToFrameIndex(e,t)}getRotationFrame(e,t=0){const i=$.angleToColumn(e,this.config.columns);return this.getFrame(t,i)}getConfig(){return r({},this.config)}destroy(){for(let e=0;e<this.frameTextures.length;e++)for(let t=0;t<this.frameTextures[e].length;t++)this.frameTextures[e][t]&&this.frameTextures[e][t].destroy();this.frameTextures=[]}}class J extends n{constructor(e){super(),this.currentRow=0,this.rotationAngle=0,this.spriteGrid=e,this.updateTexture()}setAnimationRow(e){e!==this.currentRow&&(this.currentRow=e,this.updateTexture())}setRotationAngle(e){e!==this.rotationAngle&&(this.rotationAngle=e,this.updateTexture())}updateTexture(){const e=this.spriteGrid.getRotationFrame(this.rotationAngle,this.currentRow);e&&(this.texture=e)}getCurrentRow(){return this.currentRow}getRotationAngle(){return this.rotationAngle}}class Z{constructor(e,t){this.fireTimer=0,this.lastFireTime=0,this.game=e,this.config=t,this.fireTimer=t.fireRate}update(e){this.fireTimer-=1e3*e}canFire(){return this.fireTimer<=0}fire(e,t,i,s){var a;if(!this.canFire())return;const r=i-e,o=s-t,n=Math.atan2(o,r);if(!(Math.sqrt(r*r+o*o)>this.config.range)){switch(this.config.type){case"dumb_bomb":this.fireDumbBomb(e,t,n);break;case"laser_guided_bomb":this.fireLaserGuidedBomb(e,t,i,s);break;case"armored_bomb":this.fireArmoredBomb(e,t,n);break;case"frag_bomb":this.fireFragBomb(e,t,n);break;case"atomic_bomb":this.fireAtomicBomb(e,t,n);break;case"energy_cannon":this.fireEnergyBullet(e,t,n);break;case"burst_rocket":this.fireBurstRocket(e,t,n);break;case"energy_ball":this.fireEnergyBall(e,t,n)}this.fireTimer=this.config.fireRate,this.lastFireTime=Date.now(),this.config.sound&&(null==(a=this.game.getAudioManager())||a.playSound(this.config.sound))}}fireDumbBomb(e,t,i){const s=new _(this.game,e,t,i,this.config.speed,this.config.damage,!1,this.config.projectileTexture);s.setGravity(.2),this.game.addProjectile(s)}fireLaserGuidedBomb(e,t,i,s){const a=Math.atan2(s-t,i-e),r=new _(this.game,e,t,a,this.config.speed,this.config.damage,!1,this.config.projectileTexture);r.setHoming(!0,i,s),r.setGravity(.1),this.game.addProjectile(r)}fireArmoredBomb(e,t,i){const s=new _(this.game,e,t,i,.8*this.config.speed,this.config.damage,!1,this.config.projectileTexture);s.setPenetration(!0),s.setGravity(.25),this.game.addProjectile(s)}fireFragBomb(e,t,i){const s=new _(this.game,e,t,i,this.config.speed,this.config.damage,!1,this.config.projectileTexture);s.setExplosive(!0,80),s.setFragments(6),s.setGravity(.15),this.game.addProjectile(s)}fireAtomicBomb(e,t,i){const s=new _(this.game,e,t,i,.6*this.config.speed,this.config.damage,!1,this.config.projectileTexture);s.setExplosive(!0,150),s.setGravity(.3),this.game.addProjectile(s)}fireEnergyBullet(e,t,i){const s=new _(this.game,e,t,i,this.config.speed,this.config.damage,!1,this.config.projectileTexture);s.setGlow(65535,.8),this.game.addProjectile(s)}fireBurstRocket(e,t,i){const s=new _(this.game,e,t,i,this.config.speed,this.config.damage,!1,this.config.projectileTexture);s.setExplosive(!0,60),s.setBurst(!0,4),s.setGravity(.1),this.game.addProjectile(s)}fireEnergyBall(e,t,i){const s=this.game.getTank();if(!s)return;const a=new _(this.game,e,t,i,.7*this.config.speed,this.config.damage,!1,this.config.projectileTexture);a.setHoming(!0,s.x,s.y,.02),a.setGlow(16711935,1),this.game.addProjectile(a)}getConfig(){return r({},this.config)}getTimeSinceLastFire(){return Date.now()-this.lastFireTime}}class Q{static createWeaponForEnemyType(e){return{PROPFIGHTER:{type:"none",damage:0,speed:0,fireRate:0,range:0,projectileTexture:""},SMALLJET:{type:"dumb_bomb",damage:10,speed:120,fireRate:800,range:400,projectileTexture:"dumbbomb"},BOMBER:{type:"dumb_bomb",damage:15,speed:100,fireRate:900,range:500,projectileTexture:"dumbbomb"},JETFIGHTER:{type:"laser_guided_bomb",damage:20,speed:140,fireRate:600,range:600,projectileTexture:"lgb",special:{homing:!0}},TRUCK:{type:"burst_rocket",damage:25,speed:180,fireRate:4e3,range:450,projectileTexture:"rocket"},BIGBOMBER:{type:"dumb_bomb",damage:18,speed:90,fireRate:2e3,range:500,projectileTexture:"dumbbomb",special:{multiShot:3}},SMALLCOPTER:{type:"energy_cannon",damage:12,speed:250,fireRate:1500,range:400,projectileTexture:"energy_bullet"},MEDCOPTER:{type:"laser_guided_bomb",damage:30,speed:200,fireRate:2500,range:500,projectileTexture:"missile",special:{homing:!0}},BIGCOPTER:{type:"laser_guided_bomb",damage:35,speed:220,fireRate:2e3,range:550,projectileTexture:"missile",special:{homing:!0}},DELTABOMBER:{type:"frag_bomb",damage:25,speed:110,fireRate:3e3,range:480,projectileTexture:"fragbomb"},DELTAJET:{type:"armored_bomb",damage:40,speed:130,fireRate:3500,range:500,projectileTexture:"ironbomb"},SATELLITE:{type:"energy_ball",damage:50,speed:80,fireRate:4e3,range:600,projectileTexture:"energy_ball"},BLIMP:{type:"atomic_bomb",damage:100,speed:60,fireRate:8e3,range:400,projectileTexture:"ironbomb"}}[e]||null}static createWeapon(e,t){const i=this.createWeaponForEnemyType(t);return i&&"none"!==i.type?new Z(e,i):null}}const ee=class{static loadCraftData(){return o(this,null,function*(){if(null!==this.craftData)return this.craftData;try{const e=yield fetch(this.CRAFT_XML_PATH),t=yield e.text(),i=new DOMParser,s=i.parseFromString(t,"text/xml").querySelectorAll("Craft");return this.craftData={},s.forEach(e=>{const t=e.getAttribute("name"),i=e.getAttribute("desc"),s=e.getAttribute("arms"),a=parseInt(e.getAttribute("points")||"0"),r=parseInt(e.getAttribute("armor")||"1"),o=parseInt(e.getAttribute("speed")||"150"),n=parseInt(e.getAttribute("firerate")||"1000"),h=parseInt(e.getAttribute("frames")||"1");t&&(this.craftData[t]={name:t,desc:i||"",arms:s||"",points:a,armor:r,speed:o,firerate:n,frames:h})}),this.craftData}catch(e){throw new Error("Could not load enemy craft data from craft_enhanced.xml")}})}static getCraftData(e){return o(this,null,function*(){return(yield this.loadCraftData())[e]||null})}static getAllCraftNames(){return o(this,null,function*(){const e=yield this.loadCraftData();return Object.keys(e)})}static craftExists(e){return o(this,null,function*(){const t=yield this.loadCraftData();return e in t})}};ee.craftData=null,ee.CRAFT_XML_PATH="/HeavyWeapon/data/craft.xml";let te=ee;var ie=(e=>(e.PROPFIGHTER="PROPFIGHTER",e.SMALLJET="SMALLJET",e.BOMBER="BOMBER",e.JETFIGHTER="JETFIGHTER",e.TRUCK="TRUCK",e.BIGBOMBER="BIGBOMBER",e.SMALLCOPTER="SMALLCOPTER",e.MEDCOPTER="MEDCOPTER",e.BIGCOPTER="BIGCOPTER",e.DELTABOMBER="DELTABOMBER",e.DELTAJET="DELTAJET",e.BIGMISSILE="BIGMISSILE",e.SUPERBOMBER="SUPERBOMBER",e.FATBOMBER="FATBOMBER",e.BLIMP="BLIMP",e.SATELLITE="SATELLITE",e.STRAFER="STRAFER",e.ENEMYTANK="ENEMYTANK",e.DOZER="DOZER",e.DEFLECTOR="DEFLECTOR",e.CRUISE="CRUISE",e))(ie||{});class se extends p{constructor(e,t,i,s){super(),this.frames=1,this.isDestroyed=!1,this.currentRotationAngle=0,this.time=0,this.velocityX=0,this.velocityY=0,this.fireTimer=0,this.fireRate=2e3,this.canFire=!1,this.frameCounter=0,this.baseFrameInterval=40,this.lastFireFrame=0,this.fireFrameInterval=48,this.damageFlashTimer=0,this.isDeflectorActive=!1,this.deflectorCooldown=0,this.deflectorDuration=3e3,this.deflectorRechargeTime=2e3,this.isLaserCharging=!1,this.laserChargeTimer=0,this.laserChargeDuration=2e3,this.laserActiveTimer=0,this.laserActiveDuration=3e3,this.laserCooldownTimer=0,this.laserCooldownDuration=4e3,this.game=e,this.type=t,this.armor=10,this.health=this.armor,this.maxHealth=this.armor,this.points=100,this.speed=150,this.loadCraftStats(),this.x=i,this.y=s,this.baseY=s,this.direction=i<0?1:-1,this.movementPattern=this.getMovementPattern(t),this.velocity=new u(this.speed*this.direction,0),this.isFlying()&&(this.shadow=new g,this.shadow.beginFill(0,.3),this.shadow.drawEllipse(0,0,25,10),this.shadow.endFill(),this.shadow.y=20,this.addChild(this.shadow));const a=this.getTextureName(t);if(this.initializeSpriteSystem(a),!this.sprite){const e=P.createAnimatedSprite(a);this.sprite=e||new n(P.getTexture(a))}this.sprite.anchor.set(.5),this.addChild(this.sprite),this.sprite.scale.x=this.direction,this.armor>10&&this.createHealthBar();const r=Q.createWeapon(this.game,t);r&&(this.enemyWeapon=r,this.canFire=!0,this.fireRate=this.enemyWeapon.getConfig().fireRate),this.weapon=this.getWeapon(t),this.weapon&&!this.enemyWeapon&&(this.canFire=!0,this.fireRate=this.getFireRate(t)),this.fireFrameInterval=this.getAuthenticFireFrameInterval(t)}canAccessPosition(){return!this.destroyed&&null!==this.parent&&void 0!==this.parent}getSafeTankPosition(e){if(!e||e.isDestroyed)return null;try{return{x:e.x,y:e.y}}catch(t){return null}}update(e,t){if(!this.isDestroyed)if(this.canAccessPosition()){if(this.frameCounter++,this.time+=e,this.updateMovement(e,t),this.enemyWeapon&&this.enemyWeapon.update(e),this.canFire&&!this.isEvacuating&&this.updateAuthenticFrameBasedCombat(e,t),this.updateSpecialBehaviors(e),this.sprite&&"function"==typeof this.sprite.update&&this.sprite.update(e),this.damageFlashTimer>0){this.damageFlashTimer-=e;const t=Math.sin(20*this.damageFlashTimer)>0;this.sprite.tint=t?16746632:this.isDeflectorActive?8978431:16777215}else this.sprite.tint=this.isDeflectorActive?8978431:16777215;this.isOffScreen()&&this.destroy()}else this.markForRemoval()}updateMovement(e,t){if(this.canAccessPosition()){if(this.isEvacuating)try{return this.x+=this.velocityX*e,void(this.y+=this.velocityY*e)}catch(i){return void this.markForRemoval()}if(t){try{switch(this.movementPattern){case 0:this.x+=this.velocity.x*e;break;case 1:this.x+=this.velocity.x*e,this.y=this.game.getRenderer().height-80;break;case 2:if(t){const i=Math.abs(this.x-t.x);this.velocity.x=i<300?this.direction*this.speed*.4*e:this.direction*this.speed*e}else this.velocity.x=this.direction*this.speed*e;this.x+=this.velocity.x}}catch(i){return void this.markForRemoval()}if(this.updatePlayerTracking(t,e),0!==this.velocity.x||0!==this.velocity.y){const e=Math.atan2(this.velocity.y,this.velocity.x);this.updateSpriteRotation(e),this.sprite instanceof J||(this.sprite.scale.x=Math.sign(this.velocity.x))}}else try{this.x+=this.velocity.x*e}catch(i){this.markForRemoval()}}else this.markForRemoval()}updateAuthenticFrameBasedCombat(e,t){if(t){if(this.frameCounter%this.baseFrameInterval===0){if(this.frameCounter-this.lastFireFrame>=this.fireFrameInterval){const e=Math.abs(this.x-t.x),i=Math.abs(this.y-t.y);let s=!1;if("TRUCK"===this.type){s=e<250&&i<100}else if("BIGBOMBER"===this.type){const i=e<300,a=this.y<t.y;s=i&&a}else{const i=e<200,a=this.y<t.y;s=i&&a}s&&(this.fireWeapon(t),this.lastFireFrame=this.frameCounter)}}if(this.enemyWeapon&&this.enemyWeapon.canFire()){Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))<=this.enemyWeapon.getConfig().range&&this.enemyWeapon.fire(this.x,this.y,t.x,t.y)}}}updateCombat(e,t){if(t)if(this.enemyWeapon){if(this.enemyWeapon.canFire()){Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))<=this.enemyWeapon.getConfig().range&&this.enemyWeapon.fire(this.x,this.y,t.x,t.y)}}else if(this.fireTimer-=1e3*e,this.fireTimer<=0&&this.weapon){const e=Math.abs(this.x-t.x);Math.abs(this.y-t.y);let i=!1;if("TRUCK"===this.type){const s=e<250,a=Math.abs(this.y-t.y)<100;i=s&&a}else if("BIGBOMBER"===this.type){const s=e<300,a=this.y<t.y;i=s&&a}else{const s=e<200,a=this.y<t.y;i=s&&a}i&&(this.fireWeapon(t),this.fireTimer=this.fireRate)}}fireWeapon(e){if(!this.weapon)return;const t=e.x-this.x,i=e.y-this.y,s=Math.atan2(i,t);switch(this.weapon){case"DUMB_BOMB":case"GUIDED_BOMB":case"ARMORED_BOMB":default:this.createEnemyProjectile(this.x,this.y+20,Math.PI/2,"dumbbomb");break;case"HEAVY_BOMB":this.createMultipleBombs(this.x,this.y+20,3);break;case"LASER_GUIDED":this.createEnemyProjectile(this.x,this.y+20,s,"dumbbomb");break;case"RPG":this.createEnemyProjectile(this.x,this.y,s,"rpg");break;case"ENERGY_BALL":this.createEnemyProjectile(this.x,this.y,s,"energy_ball")}}createMultipleBombs(e,t,i){if("BIGBOMBER"===this.type){const s=30,a=e-(i-1)*s/2;for(let e=0;e<i;e++){const i=a+e*s;setTimeout(()=>{this.createEnemyProjectile(i,t,Math.PI/2,"dumbbomb")},16.667*(6*e))}}else if("FATBOMBER"===this.type){const s=2*Math.PI/i,a=Math.PI/2;for(let r=0;r<i;r++){const i=a+s*r,o=20,n=e+Math.cos(i)*o,h=t+Math.sin(i)*o;setTimeout(()=>{this.createEnemyProjectile(n,h,i,"dumbbomb")},6*r*16.667)}}else if("BLIMP"===this.type){const s=Math.PI/4,a=Math.PI/2;for(let r=0;r<i;r++){const o=a+s*(r-(i-1)/2)/(i-1);setTimeout(()=>{this.createEnemyProjectile(e,t,o,"dumbbomb")},4*r*16.667)}}}createEnemyProjectile(e,t,i,s){q(()=>o(this,null,function*(){const{Projectile:e}=yield Promise.resolve().then(()=>L);return{Projectile:e}}),void 0,import.meta.url).then(({Projectile:a})=>{const r=v.ENEMY_WEAPONS[this.weapon],o=new a(this.game,e,t,i,(null==r?void 0:r.speed)||200,(null==r?void 0:r.damage)||10,!1,s);if("LASER_GUIDED"!==this.weapon||"lgb"!==s&&"dumbbomb"!==s)"GUIDED_BOMB"===this.weapon&&"fragbomb"===s?(o.setExplosive(!0,60),o.setFragments(4),"tint"in o&&(o.tint=16777028)):"ARMORED_BOMB"===this.weapon&&"ironbomb"===s&&(o.setPenetration(!0),"tint"in o&&(o.tint=8947848));else{const e=this.game.getTank(),t=this.getSafeTankPosition(e);t&&o.setHoming(!0,t.x,t.y,.03),"tint"in o&&(o.tint=16729156)}(s.includes("bomb")||"lgb"===s)&&o.setGravity(.15),this.game.addProjectile(o)})}updateSpecialBehaviors(e){"DEFLECTOR"===this.type&&this.updateDeflectorBehavior(e),"SATELLITE"===this.type&&this.updateSatelliteLaser(e)}updateDeflectorBehavior(e){this.deflectorCooldown-=1e3*e,this.isDeflectorActive?this.deflectorCooldown<=0&&(this.isDeflectorActive=!1,this.deflectorCooldown=this.deflectorRechargeTime):this.deflectorCooldown<=0&&(this.isDeflectorActive=!0,this.deflectorCooldown=this.deflectorDuration)}canDeflectBullets(){return"DEFLECTOR"===this.type&&this.isDeflectorActive}deflectBullet(e,t){if(!this.canDeflectBullets())return;const i=t.x-this.x,s=t.y-this.y,a=Math.atan2(s,i);q(()=>o(this,null,function*(){const{Projectile:e}=yield Promise.resolve().then(()=>L);return{Projectile:e}}),void 0,import.meta.url).then(({Projectile:t})=>{const i=new t(this.game,this.x,this.y,a,.8*e.speed,Math.ceil(.7*e.damage),!1,"bullet");"tint"in i&&(i.tint=16729156),this.game.addProjectile(i)}),K.play("deflect");try{const e=this.game.getParticleSystem();e&&"function"==typeof e.createSpark?e.createSpark(this.x,this.y,10):e&&"function"==typeof e.createExplosion&&e.createExplosion(this.x,this.y,"small")}catch(r){}}updateSatelliteLaser(e){const t=this.game.getTank();if(!t)return;const i=1e3*e;if(this.laserCooldownTimer>0)this.laserCooldownTimer-=i,this.laserBeam&&this.destroyLaserBeam();else if(!this.isLaserCharging&&this.laserActiveTimer<=0)this.isLaserCharging=!0,this.laserChargeTimer=this.laserChargeDuration;else if(this.isLaserCharging){this.laserChargeTimer-=i;const e=1-this.laserChargeTimer/this.laserChargeDuration,s=.5*Math.sin(20*e)+.5;this.sprite.tint=this.interpolateColor(16777215,16711680,s*e),this.laserChargeTimer<=0&&(this.isLaserCharging=!1,this.laserActiveTimer=this.laserActiveDuration,this.createLaserBeam(t),K.play("laser_charge"))}else if(this.laserActiveTimer>0){if(this.laserActiveTimer-=i,this.updateLaserBeam(t),this.isLaserHittingTank(t)){const i=15*e;t.hasShield()||t.takeDamage(i)}this.laserActiveTimer<=0&&(this.destroyLaserBeam(),this.laserCooldownTimer=this.laserCooldownDuration)}}createLaserBeam(e){this.destroyLaserBeam(),this.laserBeam=new g,this.addChild(this.laserBeam),this.updateLaserBeam(e)}updateLaserBeam(e){if(!this.laserBeam)return;this.laserBeam.clear();const t=e.x-this.x,i=e.y-this.y;this.laserBeam.lineStyle(4,16711680,.8),this.laserBeam.moveTo(0,0),this.laserBeam.lineTo(t,i),this.laserBeam.lineStyle(2,16777215,1),this.laserBeam.moveTo(0,0),this.laserBeam.lineTo(t,i);const s=.3*Math.sin(.01*Date.now())+.7;this.laserBeam.alpha=s}isLaserHittingTank(e){if(!this.laserBeam)return!1;return this.getDistance(this.x,this.y,e.x,e.y)<800}destroyLaserBeam(){this.laserBeam&&(this.laserBeam.destroy(),this.laserBeam=void 0)}interpolateColor(e,t,i){const s=e>>16&255,a=e>>8&255,r=255&e,o=t>>16&255,n=t>>8&255,h=255&t;return Math.round(s+(o-s)*i)<<16|Math.round(a+(n-a)*i)<<8|Math.round(r+(h-r)*i)}getDistance(e,t,i,s){return Math.sqrt(Math.pow(i-e,2)+Math.pow(s-t,2))}updateSpriteRotation(e){this.sprite instanceof J?(this.sprite.setRotationAngle(e),this.currentRotationAngle=e):this.currentRotationAngle=e}initializeSpriteSystem(e){try{let t=P.getTexture(e);if(t){if(this.shouldUseMultiRowSprite(this.type)){const e=this.getGridConfigForType(this.type);this.spriteGrid=new $(t,e),this.sprite=new J(this.spriteGrid)}else this.sprite=new n(t)}else this.sprite=new n}catch(t){this.sprite=new n}}shouldUseMultiRowSprite(e){return["SATELLITE"].includes(e)}getGridConfigForType(e){const t=this.frames||1,i={rows:1,columns:Math.max(t,1),frameWidth:64,frameHeight:64,totalFrames:t};switch(e){case"SATELLITE":return{rows:t>1?2:1,columns:Math.max(Math.ceil(t/2),1),frameWidth:96,frameHeight:96,totalFrames:t};case"BIGCOPTER":return{rows:1,columns:t,frameWidth:128,frameHeight:128,totalFrames:t};default:return i}}setAnimationRow(e){this.sprite instanceof J&&this.sprite.setAnimationRow(e)}getCurrentRotationAngle(){return this.currentRotationAngle}takeDamage(e){if(!this.isDestroyed){if(this.health-=e,this.damageFlashTimer=.3,this.healthBar){const e=this.health/this.maxHealth;this.healthBar.clear(),this.healthBar.beginFill(e>.5?65280:e>.25?16776960:16711680),this.healthBar.drawRect(-20,-35,40*e,4),this.healthBar.endFill()}this.health<=0&&this.onDestroyed()}}onDestroyed(){this.isDestroyed=!0,this.game.getScoreManager().addScore(this.points),this.game.getPowerUpSystem().onEnemyKilled(),this.game.getParticleSystem().createExplosion(this.x,this.y,"small"),K.play("enemy_destroyed"),this.destroy()}createHealthBar(){this.healthBar=new g,this.healthBar.beginFill(65280),this.healthBar.drawRect(-20,-35,40,4),this.healthBar.endFill(),this.addChild(this.healthBar)}getMovementPattern(e){switch(e){case"TRUCK":case"ENEMYTANK":case"DOZER":return 1;case"BIGBOMBER":case"SUPERBOMBER":case"FATBOMBER":return 2;default:return 0}}getTextureName(e){switch(e){case"PROPFIGHTER":default:return"propfighter";case"SMALLJET":return"smalljet";case"BOMBER":return"bomber";case"JETFIGHTER":return"jetfighter";case"TRUCK":return"truck";case"BIGBOMBER":return"bigbomber";case"SMALLCOPTER":return"smallcopter";case"MEDCOPTER":return"medcopter";case"BIGCOPTER":return"bigcopter";case"DELTABOMBER":return"deltabomber";case"DELTAJET":return"deltajet";case"BIGMISSILE":return"bigmissile";case"SUPERBOMBER":return"superbomber";case"FATBOMBER":return"fatbomber";case"BLIMP":return"blimp";case"SATELLITE":return"satellite";case"STRAFER":return"strafer";case"ENEMYTANK":return"enemytank";case"DOZER":return"dozer";case"DEFLECTOR":return"deflector";case"CRUISE":return"cruise"}}getWeapon(e){switch(e){case"PROPFIGHTER":case"DOZER":case"DEFLECTOR":default:return;case"SMALLJET":case"BOMBER":case"BLIMP":return"DUMB_BOMB";case"JETFIGHTER":return"LASER_GUIDED";case"TRUCK":return"RPG";case"BIGBOMBER":return"HEAVY_BOMB";case"SUPERBOMBER":return"NUCLEAR_BOMB";case"FATBOMBER":return"ATOMIC_BOMB";case"SMALLCOPTER":case"MEDCOPTER":return"MISSILE";case"BIGCOPTER":return"HEAVY_MISSILE";case"DELTABOMBER":return"GUIDED_BOMB";case"DELTAJET":return"ARMORED_BOMB";case"BIGMISSILE":case"CRUISE":return"EXPLOSIVE_WARHEAD";case"SATELLITE":return"LASER";case"STRAFER":return"RAPID_FIRE";case"ENEMYTANK":return"TANK_CANNON"}}getAuthenticFireFrameInterval(e){const t=e=>Math.round(e/16.667);switch(e){case"SMALLJET":case"DELTAJET":return t(800);case"JETFIGHTER":return t(600);case"BOMBER":return t(900);case"BIGBOMBER":case"TRUCK":return t(1200);case"DELTABOMBER":case"SATELLITE":case"DEFLECTOR":return t(1e3);case"SMALLCOPTER":case"FATBOMBER":return t(1500);case"MEDCOPTER":case"SUPERBOMBER":return t(1800);case"BIGCOPTER":case"ENEMYTANK":return t(2e3);case"BLIMP":return t(2500);case"STRAFER":return t(300);default:return 60}}getFireRate(e){switch(e){case"PROPFIGHTER":case"BIGMISSILE":case"DOZER":case"CRUISE":return 0;case"SMALLJET":case"DELTAJET":return 800;case"BOMBER":return 900;case"JETFIGHTER":return 600;case"TRUCK":case"BIGBOMBER":return 1200;case"SMALLCOPTER":case"FATBOMBER":return 1500;case"MEDCOPTER":case"SUPERBOMBER":return 1800;case"BIGCOPTER":case"ENEMYTANK":return 2e3;case"DELTABOMBER":case"SATELLITE":case"DEFLECTOR":default:return 1e3;case"BLIMP":return 2500;case"STRAFER":return 300}}isFlying(){return"TRUCK"!==this.type&&"ENEMYTANK"!==this.type&&"DOZER"!==this.type}getDeflectorStatus(){return{active:this.isDeflectorActive,cooldown:this.deflectorCooldown}}isOffScreen(){return this.x<v.BOUNDS.LEFT||this.x>v.BOUNDS.RIGHT||this.y>v.BOUNDS.BOTTOM}getBounds(){var e,t;if(this.isDestroyed)return new l(0,0,0,0);try{const i=(null==(e=this.sprite)?void 0:e.width)||40,s=(null==(t=this.sprite)?void 0:t.height)||30,a=this.x||0,r=this.y||0;return new l(a-i/2,r-s/2,i,s)}catch(i){return new l(0,0,0,0)}}loadCraftStats(){return o(this,null,function*(){try{const e=yield te.getCraftData(this.type);e&&(this.armor=e.armor,this.health=e.armor,this.maxHealth=e.armor,this.points=e.points,this.speed=e.speed,this.frames=e.frames,this.velocity.x=this.speed*this.direction)}catch(e){}})}updatePlayerTracking(e,t){if(!e)return;if(!this.canAccessPosition())return void this.markForRemoval();let i;try{i=this.x}catch(r){return void this.markForRemoval()}const s=this.getSafeTankPosition(e);if(!s)return void this.markForRemoval();const a=i-s.x;if(i<-200)this.markForRemoval();else{if(Math.abs(a)>400){const e=1*Math.sign(-a);try{this.x+=e*t}catch(r){return void this.markForRemoval()}}if(0===this.movementPattern&&("SMALLJET"===this.type||"JETFIGHTER"===this.type)){const i=100,s=this.y-e.y;if(Math.abs(s)>i&&this.y>50){const e=.5*Math.sign(-s);this.y+=e*t}}}}markForRemoval(){this.isDestroyed=!0}destroy(){this.isDestroyed=!0,this.laserBeam&&this.destroyLaserBeam(),super.destroy()}}const ae=Object.freeze(Object.defineProperty({__proto__:null,Enemy:se,EnemyType:ie},Symbol.toStringTag,{value:"Module"}));function re(e){const t=Math.floor(e/4);return{level:t,wave:e%4,isComplete:t>=20}}var oe=(e=>(e.SCATTERED="scattered",e.LOOSE_GROUP="loose_group",e))(oe||{});class ne{constructor(e,t){this.x=e,this.y=t}}class he{constructor(e){this.activeFormations=new Map,this.formationUpdateTimer=0,this.formationCounter=0,this.game=e}spawnFormation(e,t,i,s="left"){const a=this.generateFormationId(),r=[],o=this.calculateFormationPositions(t,i,s),n={id:a,enemies:r,formationType:i,leaderIndex:0,cohesion:this.getFormationCohesion(i),completed:!1,spawnComplete:!1};return this.activeFormations.set(a,n),o.forEach((t,i)=>{setTimeout(()=>{const s=new se(this.game,e,t.x,t.y);this.setFormationBehavior(s,a,i),r.push(s),this.game.addEnemy(s),i===o.length-1&&(n.spawnComplete=!0)},200*i)}),a}calculateFormationPositions(e,t,i){const s=[],a="left"===i?-100:v.SCREEN_WIDTH+100,r=100+Math.random()*(v.SCREEN_HEIGHT-300);switch(t){case"scattered":default:this.createScatteredPattern(s,e,a,r);break;case"loose_group":this.createLooseGroup(s,e,a,r)}return s}createScatteredPattern(e,t,i,s){const a=.7*v.SCREEN_HEIGHT;for(let r=0;r<t;r++)e.push(new ne(i,50+Math.random()*(a-50)))}createLooseGroup(e,t,i,s){const a=s;for(let r=0;r<t;r++)e.push(new ne(i,a+80*(Math.random()-.5)))}setFormationBehavior(e,t,i){e.formationId=t,e.formationIndex=i,e.isSimpleSpawn=!0}update(e){this.formationUpdateTimer+=1e3*e,this.formationUpdateTimer>=100&&(this.activeFormations.forEach(t=>{t.spawnComplete&&this.updateFormation(t,e)}),this.cleanupCompletedFormations(),this.formationUpdateTimer=0)}updateFormation(e,t){const i=e.enemies.filter(e=>!e.isDestroyed);if(0!==i.length){if(i.length>1&&e.cohesion>0){const t=this.findFormationLeader(i,e);this.maintainFormation(i,t,e)}}else e.completed=!0}findFormationLeader(e,t){let i=e[0],s=i.x;return e.forEach(e=>{e.x<s&&(s=e.x,i=e)}),i}maintainFormation(e,t,i){e.forEach((e,s)=>{if(e===t)return;const a=this.getFormationOffset(s,i.formationType,i.enemies.length),r=t.x+a.x,o=t.y+a.y,n=r-e.x,h=o-e.y;if(Math.sqrt(n*n+h*h)>80){const t=.02*i.cohesion;e.formationForceX=n*t,e.formationForceY=h*t,e.applyFormationForce&&e.applyFormationForce(e.formationForceX,e.formationForceY)}})}getFormationOffset(e,t,i){const s=70;switch(t){case oe.V_FORMATION:const t=Math.floor(i/2),a=Math.abs(e-t);return new ne(a*s*.5,(e<t?-1:1)*a*s);case oe.LINE_FORMATION:return new ne(0,(e-i/2)*s);case oe.DIAMOND_FORMATION:const r=e/i*Math.PI*2;return new ne(Math.cos(r)*s,Math.sin(r)*s*.7);case oe.WEDGE_FORMATION:if(0===e)return new ne(0,0);const o=Math.floor((e-1)/2)+1;return new ne(o*s*.3,((e-1)%2==0?-1:1)*o*s*.7);default:return new ne(0,0)}}generateFormationId(){return`formation_${++this.formationCounter}_${Date.now()}`}getFormationCohesion(e){return{[oe.V_FORMATION]:.8,[oe.LINE_FORMATION]:.9,[oe.DIAMOND_FORMATION]:.7,[oe.SWARM_FORMATION]:.3,[oe.WEDGE_FORMATION]:.85}[e]||.5}cleanupCompletedFormations(){const e=[];this.activeFormations.forEach((t,i)=>{t.completed&&e.push(i)}),e.forEach(e=>{this.activeFormations.delete(e)})}selectFormationType(e,t){return t>=5?"scattered":"loose_group"}getActiveFormationCount(){return this.activeFormations.size}getFormationStats(){const e=[];return this.activeFormations.forEach((t,i)=>{e.push({id:i,type:t.formationType,enemies:t.enemies.filter(e=>!e.isDestroyed).length})}),{active:this.activeFormations.size,totalSpawned:this.formationCounter,formations:e}}clear(){this.activeFormations.clear(),this.formationCounter=0}}const le=class e{constructor(e){this.currentWave=0,this.waveInProgress=!1,this.enemiesInWave=0,this.enemiesSpawned=0,this.enemiesDefeated=0,this.isWaveActive=!1,this.waveTimer=0,this.waveDelay=1e3,this.totalWaves=0,this.difficultyLevel=0,this.difficultyTimer=0,this.difficultyIncreaseInterval=12e3,this.spawnTimer=0,this.currentSpawnInterval=1500,this.waveDelayTimer=0,this.currentWaveDelay=1e3,this.enemyQueue=[],this.spawnSide="left",this.totalEnemiesDefeated=0,this.wavesCompleted=0,this.game=e,this.formationSpawner=new he(e)}update(e){"GAME_OVER"!==this.game.getState()&&(this.difficultyTimer+=1e3*e,this.difficultyTimer>=this.difficultyIncreaseInterval&&(this.increaseDifficulty(),this.difficultyTimer=0),this.formationSpawner.update(e),this.waveInProgress?(this.waveTimer+=1e3*e,this.updateSpawning(e),Math.floor(this.waveTimer/1e3)%5==0&&this.waveTimer,this.enemiesSpawned>=this.enemiesInWave&&this.areAllEnemiesDefeated()&&this.completeWave()):(this.waveDelayTimer+=1e3*e,this.waveDelayTimer>=this.currentWaveDelay&&(this.startNextWave().catch(e=>{}),this.waveDelayTimer=0)))}startNextWave(){return o(this,null,function*(){this.currentWave++,this.waveInProgress=!0,this.enemiesSpawned=0,this.enemiesDefeated=0;const e=yield this.generateWave(this.currentWave,this.difficultyLevel);this.enemiesInWave=e.enemies.reduce((e,t)=>e+t.count,0),this.currentSpawnInterval=e.spawnInterval,this.currentWaveDelay=e.waveDelay,this.enemyQueue=[];for(const t of e.enemies)for(let e=0;e<t.count;e++)this.enemyQueue.push(t.type);this.shuffleArray(this.enemyQueue)})}generateWave(e,t){return o(this,null,function*(){const{level:i,wave:s}=re(e),a=yield this.generateWaveFromXMLSurvivalData(0,i,s);if(a)return a;const r=P.getWaveData();if(r&&r.length>0)return this.generateWaveFromXML(e,t,r);const o=6+2*Math.floor(e/5),n=Math.max(500,1500-100*t),h=Math.max(2e3,3e3-50*t),l=[];if(e<=3)l.push({type:ie.PROPFIGHTER,count:Math.floor(.6*o)}),l.push({type:ie.SMALLJET,count:Math.floor(.4*o)});else if(e<=6)l.push({type:ie.PROPFIGHTER,count:Math.floor(.3*o)}),l.push({type:ie.SMALLJET,count:Math.floor(.3*o)}),l.push({type:ie.BOMBER,count:Math.floor(.3*o)}),l.push({type:ie.TRUCK,count:Math.floor(.1*o)});else if(e<=10)l.push({type:ie.SMALLJET,count:Math.floor(.2*o)}),l.push({type:ie.BOMBER,count:Math.floor(.2*o)}),l.push({type:ie.JETFIGHTER,count:Math.floor(.2*o)}),l.push({type:ie.SMALLCOPTER,count:Math.floor(.2*o)}),l.push({type:ie.TRUCK,count:Math.floor(.2*o)});else if(e<=15)l.push({type:ie.BOMBER,count:Math.floor(.15*o)}),l.push({type:ie.JETFIGHTER,count:Math.floor(.15*o)}),l.push({type:ie.BIGBOMBER,count:Math.floor(.15*o)}),l.push({type:ie.SMALLCOPTER,count:Math.floor(.15*o)}),l.push({type:ie.MEDCOPTER,count:Math.floor(.15*o)}),l.push({type:ie.TRUCK,count:Math.floor(.25*o)});else if(e<=20)l.push({type:ie.JETFIGHTER,count:Math.floor(.15*o)}),l.push({type:ie.BIGBOMBER,count:Math.floor(.15*o)}),l.push({type:ie.MEDCOPTER,count:Math.floor(.15*o)}),l.push({type:ie.BIGCOPTER,count:Math.floor(.15*o)}),l.push({type:ie.FATBOMBER,count:Math.floor(.2*o)}),l.push({type:ie.SATELLITE,count:Math.floor(.1*o)}),l.push({type:ie.CRUISE,count:Math.floor(.1*o)});else{const e=[ie.JETFIGHTER,ie.BIGBOMBER,ie.BIGCOPTER,ie.FATBOMBER,ie.SATELLITE,ie.BLIMP,ie.CRUISE],t=Math.max(1,Math.floor(o/e.length));for(const i of e)l.push({type:i,count:t})}return 0!==l.length&&0!==l.reduce((e,t)=>e+t.count,0)||l.push({type:ie.PROPFIGHTER,count:o}),{enemies:l,spawnInterval:n,waveDelay:h,length:2e3}})}generateWaveFromXML(e,t,i){const s=Math.floor((e-1)/20),a=(e-1)%20,r=i[Math.min(s,i.length-1)];if(!r||!r.waves||0===r.waves.length)return this.generateWave(e,t);const o=r.waves[Math.min(a,r.waves.length-1)],n=[];for(const l of o.enemies){const e=this.xmlIdToEnemyType(l.id);if(e){const i=Math.ceil(l.qty*(1+.1*t));n.push({type:e,count:i})}}0===n.length&&n.push({type:ie.PROPFIGHTER,count:5});const h=o.length||1e3;return{enemies:n,spawnInterval:Math.max(500,h-50*t),waveDelay:Math.max(2e3,3e3-50*t),length:o.length||2e3}}xmlIdToEnemyType(e){return{PROPFIGHTER:ie.PROPFIGHTER,SMALLJET:ie.SMALLJET,BOMBER:ie.BOMBER,JETFIGHTER:ie.JETFIGHTER,TRUCK:ie.TRUCK,SMALLCOPTER:ie.SMALLCOPTER,BIGBOMBER:ie.BIGBOMBER,MEDCOPTER:ie.MEDCOPTER,BIGCOPTER:ie.BIGCOPTER,FATBOMBER:ie.FATBOMBER,SATELLITE:ie.SATELLITE,BLIMP:ie.BLIMP,CRUISE:ie.CRUISE,DEFLECTOR:ie.DEFLECTOR,DELTABOMBER:ie.DELTABOMBER,DELTAJET:ie.DELTAJET,BIGMISSILE:ie.BIGMISSILE,SUPERBOMBER:ie.SUPERBOMBER,STRAFER:ie.STRAFER,ENEMYTANK:ie.ENEMYTANK,DOZER:ie.DOZER}[e]||null}updateSpawning(e){0!==this.enemyQueue.length&&(this.spawnTimer+=1e3*e,this.spawnTimer>=this.currentSpawnInterval&&(this.spawnEnemy(),this.spawnTimer=0))}spawnEnemy(){if(0===this.enemyQueue.length)return;const e=this.enemyQueue.shift(),t="left"===this.spawnSide?-50:v.SCREEN_WIDTH+50;this.spawnSide="left"===this.spawnSide?"right":"left";const i=.6*v.SCREEN_HEIGHT,s=50+Math.random()*(i-50),a=new se(this.game,e,t,s),r=a.health,o=(n=r,h=this.difficultyLevel,Math.floor(n*(1+.2*h)));var n,h;a.health=o,a.maxHealth=o,this.game.addEnemy(a),this.enemiesSpawned++}areAllEnemiesDefeated(){return 0===this.game.getEnemies().length}completeWave(){this.waveInProgress=!1,this.wavesCompleted++;const e=1e3*this.currentWave;this.game.getScoreManager().addScore(e),this.checkPowerUpDrop()}increaseDifficulty(){this.difficultyLevel++}checkPowerUpDrop(){this.wavesCompleted;Math.random()}shuffleArray(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}}onEnemyDefeated(){this.enemiesDefeated++,this.totalEnemiesDefeated++}getCurrentWave(){return this.currentWave}nextWave(){this.currentWave++,this.waveTimer=0,this.isWaveActive=!1,this.enemiesSpawned=0,this.enemiesAlive=0,this.waveDelay=1e3}getDifficultyLevel(){return this.difficultyLevel}getWaveProgress(){return{spawned:this.enemiesSpawned,total:this.enemiesInWave}}getTotalEnemiesDefeated(){return this.totalEnemiesDefeated}reset(){this.currentWave=0,this.waveInProgress=!1,this.enemiesInWave=0,this.enemiesSpawned=0,this.enemiesDefeated=0,this.difficultyLevel=0,this.difficultyTimer=0,this.spawnTimer=0,this.waveDelayTimer=0,this.enemyQueue=[],this.totalEnemiesDefeated=0,this.wavesCompleted=0,this.formationSpawner.clear()}start(){this.reset()}generateWaveFromSurvivalData(e,t){const i=[];for(const r of e.enemies){const e=this.xmlIdToEnemyType(r.id);e&&i.push({type:e,count:r.qty})}const s=i.reduce((e,t)=>e+t.count,0),a=s>0?e.length/s:1e3;return{enemies:i,spawnInterval:Math.max(300,a),waveDelay:1e3,length:e.length}}startSurvivalWave(){this.totalWaves++,this.isWaveActive=!1,this.waveTimer=0,this.enemiesSpawned=0,this.enemiesAlive=0;const{level:e,wave:t}=re(this.totalWaves-1)}static getSurvivalWaveFromXML(e,t,i){return o(this,null,function*(){try{if(!this.survivalDataCache.has(e)){const t=yield M.loadSurvivalTier(e);this.survivalDataCache.set(e,t)}const s=this.survivalDataCache.get(e);if(!s||t>=s.levels.length)return null;const a=s.levels[t];return i>=a.waves.length?null:a.waves[i]}catch(s){return null}})}generateWaveFromXMLSurvivalData(t,i,s){return o(this,null,function*(){const a=yield e.getSurvivalWaveFromXML(t,i,s);if(!a)return null;const r=[];for(const e of a.enemies){const t=this.xmlIdToEnemyType(e.id);t&&r.push({type:t,count:e.qty})}return{enemies:r,spawnInterval:this.calculateSpawnInterval(a,r.length),waveDelay:1e3,length:a.length}})}calculateSpawnInterval(e,t){return t<=0?1e3:Math.max(100,e.length/t)}};le.survivalDataCache=new Map;let ce=le;class de{constructor(e){this.backgroundElements=[],this.game=e}addBackgroundElement(e){this.backgroundElements.push(e)}removeBackgroundElement(e){const t=this.backgroundElements.indexOf(e);t>-1&&this.backgroundElements.splice(t,1)}update(e,t,i,s){this.checkProjectileEnemyCollisions(i,t),this.checkProjectileTankCollisions(i,e),this.checkProjectileProjectileCollisions(i),this.checkEnemyTankCollisions(t,e),this.checkTankPowerUpCollisions(e,s),this.checkSplashDamage(i,t,e)}checkProjectileEnemyCollisions(e,t){for(const i of e)if(i&&!i.isDestroyed&&i.isPlayerProjectile&&void 0!==i.x&&void 0!==i.y)for(const e of t)if(e&&!e.isDestroyed&&void 0!==e.x&&void 0!==e.y&&this.checkRectCollision(i.getBounds(),e.getBounds()))if(e.canDeflectBullets&&e.canDeflectBullets()){const t=this.game.getTank();if(t&&e.deflectBullet(i,t),i.onCollision(),!i.getIsPiercing())break}else if(e.takeDamage(i.damage),i.onCollision(),e.isDestroyed&&this.game.getWaveSystem().onEnemyDefeated(),!i.getIsPiercing())break}checkProjectileTankCollisions(e,t){if(t&&!t.isDestroyed&&void 0!==t.x&&void 0!==t.y)for(const i of e)!i||i.isDestroyed||i.isPlayerProjectile||void 0!==i.x&&void 0!==i.y&&this.checkRectCollision(i.getBounds(),t.getBounds())&&(t.hasShield()||t.takeDamage(i.damage),i.onCollision())}checkProjectileProjectileCollisions(e){for(let t=0;t<e.length;t++){const i=e[t];if(i&&!i.isDestroyed&&i.isPlayerProjectile&&(void 0!==i.x&&void 0!==i.y))for(let s=0;s<e.length;s++){if(t===s)continue;const a=e[s];if(a&&!a.isDestroyed&&a.isEnemyProjectile&&(void 0!==a.x&&void 0!==a.y&&this.checkRectCollision(i.getBounds(),a.getBounds()))){const e=(i.x+a.x)/2,t=(i.y+a.y)/2;i.onCollision(),a.onCollision(),this.game.getParticleSystem().createExplosion(e,t,3,13421772);break}}}}checkEnemyTankCollisions(e,t){if(t&&!t.isDestroyed&&void 0!==t.x&&void 0!==t.y)for(const i of e)if(i&&!i.isDestroyed&&void 0!==i.x&&void 0!==i.y&&this.checkRectCollision(i.getBounds(),t.getBounds())){const e=50;t.hasShield()||t.takeDamage(e),i.takeDamage(2*e),i.isDestroyed&&this.game.getWaveSystem().onEnemyDefeated()}}checkTankPowerUpCollisions(e,t){if(e&&!e.isDestroyed&&void 0!==e.x&&void 0!==e.y)for(const i of t)i.isDestroyed||this.checkRectCollision(e.getBounds(),i.getBounds())&&i.collect(e)}checkSplashDamage(e,t,i){for(const s of e){if(s.isDestroyed)continue;const e=s.getSplashRadius();if(!(e<=0)&&(s.y>=v.GROUND_Y||s.isDestroyed)){const a=s.x,r=s.y;for(const i of t){if(i.isDestroyed)continue;const t=this.getDistance(a,r,i.x,i.y);if(t<=e){const a=1-t/e,r=s.damage*a;i.takeDamage(r),i.isDestroyed&&this.game.getWaveSystem().onEnemyDefeated()}}if(!s.isPlayerProjectile&&i&&!i.isDestroyed){const t=this.getDistance(a,r,i.x,i.y);if(t<=e&&!i.hasShield()){const a=1-t/e,r=s.damage*a*.5;i.takeDamage(r)}}}}}checkRectCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}checkCircleCollision(e,t,i,s,a,r){return this.getDistance(e,t,s,a)<i+r}getDistance(e,t,i,s){return Math.sqrt(Math.pow(i-e,2)+Math.pow(s-t,2))}pointInRect(e,t,i){return e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height}checkProjectileBackgroundCollisions(e){for(let t=e.length-1;t>=0;t--){const i=e[t];if(i&&!i.isDestroyed&&void 0!==i.x&&void 0!==i.y&&i.isPlayerProjectile)for(let s=this.backgroundElements.length-1;s>=0;s--){const a=this.backgroundElements[s];if(a.checkCollision(i)){const s=a.takeDamage(i.damage);i.destroy(),e.splice(t,1),s&&this.removeBackgroundElement(a);break}}}}}class me{constructor(e){this.particles=[],this.maxParticles=500,this.textures=new Map,this.game=e,this.container=new p,this.createParticleTextures()}createParticleTextures(){const e=[16746496,16755200,6710886,4473924,16777215,16776960,8947848,10066329,65535],t=[4,8,12,16,20];for(const i of e)for(const e of t){const t=new g;t.beginFill(i),t.drawCircle(e/2,e/2,e/2),t.endFill();const s=this.game.app.renderer.generateTexture(t);this.textures.set(`${i}_${e}`,s),t.destroy()}}getContainer(){return this.container}update(e){for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];if(i.lifeTime+=1e3*e,i.lifeTime>=i.maxLifeTime){this.container.removeChild(i.sprite),i.sprite.destroy(),this.particles.splice(t,1);continue}i.sprite.x+=i.velocity.x*e,i.sprite.y+=i.velocity.y*e,i.gravity&&(i.velocity.y+=v.PHYSICS.GRAVITY*e),i.sprite.rotation+=i.rotationSpeed*e;const s=i.lifeTime/i.maxLifeTime;if(i.sprite.alpha=Math.max(0,1-s*i.fadeRate),0!==i.scaleRate){const e=1+s*i.scaleRate;i.sprite.scale.set(e)}}}createExplosion(e,t,i="medium"){const s="tiny"===i?3:"small"===i?10:"medium"===i?20:30,a="tiny"===i?30:"small"===i?100:"medium"===i?200:300,r="tiny"===i?.15:"small"===i?.5:"medium"===i?1:1.5;for(let o=0;o<s;o++){const i=2*Math.PI*o/s+.5*Math.random(),n=a*(.5+.5*Math.random());this.createParticle({x:e,y:t,velocityX:Math.cos(i)*n,velocityY:Math.sin(i)*n,color:Math.random()>.5?16746496:16755200,size:(10+10*Math.random())*r,lifeTime:500+500*Math.random(),fadeRate:1.5,scaleRate:.5,gravity:!1,rotationSpeed:5*Math.random()-2.5})}for(let o=0;o<s/2;o++){const i=Math.random()*Math.PI*2,s=.3*a;this.createParticle({x:e,y:t,velocityX:Math.cos(i)*s,velocityY:Math.sin(i)*s-50,color:6710886,size:(15+15*Math.random())*r,lifeTime:1e3+1e3*Math.random(),fadeRate:1,scaleRate:1,gravity:!1,rotationSpeed:2*Math.random()-1})}for(let o=0;o<s/3;o++){const i=Math.random()*Math.PI*2,s=1.5*a;this.createParticle({x:e,y:t,velocityX:Math.cos(i)*s,velocityY:Math.sin(i)*s-100,color:4473924,size:3+5*Math.random(),lifeTime:2e3,fadeRate:.5,scaleRate:0,gravity:!0,rotationSpeed:10*Math.random()-5})}}createSmoke(e,t){this.createParticle({x:e,y:t,velocityX:20*(Math.random()-.5),velocityY:-30-20*Math.random(),color:8947848,size:10+10*Math.random(),lifeTime:1500,fadeRate:1,scaleRate:.5,gravity:!1,rotationSpeed:2*Math.random()-1})}createMuzzleFlash(e,t,i){const s=e+20*Math.cos(i),a=t+20*Math.sin(i);this.createParticle({x:s,y:a,velocityX:50*Math.cos(i),velocityY:50*Math.sin(i),color:16776960,size:15,lifeTime:100,fadeRate:2,scaleRate:-.5,gravity:!1,rotationSpeed:0});for(let r=0;r<3;r++)this.createParticle({x:s,y:a,velocityX:30*Math.cos(i+(Math.random()-.5)),velocityY:30*Math.sin(i+(Math.random()-.5)),color:10066329,size:8,lifeTime:300,fadeRate:1.5,scaleRate:.5,gravity:!1,rotationSpeed:2*Math.random()-1})}createImpact(e,t){for(let i=0;i<5;i++){const i=Math.random()*Math.PI*2,s=100+100*Math.random();this.createParticle({x:e,y:t,velocityX:Math.cos(i)*s,velocityY:Math.sin(i)*s,color:16776960,size:2,lifeTime:200,fadeRate:2,scaleRate:0,gravity:!0,rotationSpeed:0})}}createNukeFlash(){const e=new g;e.beginFill(16777215),e.drawRect(0,0,v.SCREEN_WIDTH,v.SCREEN_HEIGHT),e.endFill(),e.alpha=1,this.container.addChild(e);const t=setInterval(()=>{e.alpha-=.05,e.alpha<=0&&(this.container.removeChild(e),e.destroy(),clearInterval(t))},16),i=new g;i.lineStyle(5,16777215,.8),i.drawCircle(0,0,10),i.x=v.SCREEN_WIDTH/2,i.y=v.SCREEN_HEIGHT/2,this.container.addChild(i);const s=setInterval(()=>{i.scale.x+=.5,i.scale.y+=.5,i.alpha-=.02,i.alpha<=0&&(this.container.removeChild(i),i.destroy(),clearInterval(s))},16)}createShieldHit(e,t){for(let i=0;i<10;i++){const s=2*Math.PI*i/10,a=50;this.createParticle({x:e,y:t,velocityX:Math.cos(s)*a,velocityY:Math.sin(s)*a,color:65535,size:5,lifeTime:300,fadeRate:2,scaleRate:1,gravity:!1,rotationSpeed:0})}}createExhaust(e,t,i){this.createParticle({x:e-25*i,y:t+10,velocityX:20*-i+10*(Math.random()-.5),velocityY:20+10*Math.random(),color:4473924,size:5+5*Math.random(),lifeTime:500,fadeRate:1.5,scaleRate:.5,gravity:!1,rotationSpeed:2*Math.random()-1})}createParticle(e){if(this.particles.length>=this.maxParticles){const e=this.particles.shift();e&&(this.container.removeChild(e.sprite),e.sprite.destroy())}const t=[4,8,12,16,20].reduce((t,i)=>Math.abs(i-e.size)<Math.abs(t-e.size)?i:t),i=`${e.color}_${t}`;let s=this.textures.get(i);s||(s=this.textures.get(`0xffffff_${t}`)||this.textures.get("0xffffff_8"));const a=new n(s);a.anchor.set(.5),a.x=e.x,a.y=e.y,a.tint=e.color,this.container.addChild(a);const r={sprite:a,velocity:new u(e.velocityX,e.velocityY),lifeTime:0,maxLifeTime:e.lifeTime,fadeRate:e.fadeRate,scaleRate:e.scaleRate,gravity:e.gravity,rotation:0,rotationSpeed:e.rotationSpeed};this.particles.push(r)}clear(){for(const e of this.particles)this.container.removeChild(e.sprite),e.sprite.destroy();this.particles=[]}getParticleCount(){return this.particles.length}}class pe{constructor(){this.score=0,this.highScore=0,this.multiplier=1,this.comboCount=0,this.comboTimer=0,this.comboTimeout=2e3,this.enemiesDestroyed=0,this.accuracy=0,this.shotsTotal=0,this.shotsHit=0;const e=localStorage.getItem("atomicSurvivalHighScore");e&&(this.highScore=parseInt(e,10))}update(e){this.comboTimer>0&&(this.comboTimer-=1e3*e,this.comboTimer<=0&&this.resetCombo())}addScore(e){const t=Math.floor(e*this.multiplier);this.score+=t,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("atomicSurvivalHighScore",this.highScore.toString()))}onEnemyDestroyed(e){this.enemiesDestroyed++,this.comboCount++,this.comboTimer=this.comboTimeout,this.comboCount>=10?this.multiplier=3:this.comboCount>=5?this.multiplier=2:this.comboCount>=3&&(this.multiplier=1.5),this.addScore(e)}onShotFired(){this.shotsTotal++,this.updateAccuracy()}onShotHit(){this.shotsHit++,this.updateAccuracy()}updateAccuracy(){this.shotsTotal>0&&(this.accuracy=this.shotsHit/this.shotsTotal*100)}resetCombo(){this.comboCount=0,this.multiplier=1,this.comboTimer=0}awardAccuracyBonus(){this.accuracy>=80&&this.addScore(500)}awardWaveBonus(e,t){let i=1e3*e;t&&(i*=2),this.addScore(i)}getScore(){return this.score}getHighScore(){return this.highScore}getMultiplier(){return this.multiplier}getComboCount(){return this.comboCount}getAccuracy(){return this.accuracy}getEnemiesDestroyed(){return this.enemiesDestroyed}reset(){this.score=0,this.multiplier=1,this.comboCount=0,this.comboTimer=0,this.enemiesDestroyed=0,this.accuracy=0,this.shotsTotal=0,this.shotsHit=0}}var ue=(e=>(e.WEAPON_UPGRADE="WEAPON_UPGRADE",e.SHIELD="SHIELD",e.NUKE="NUKE",e.MEGA_LASER="MEGA_LASER",e.SPEED_BOOST="SPEED_BOOST",e.RAPID_FIRE="RAPID_FIRE",e.SPREAD_SHOT="SPREAD_SHOT",e.HEALTH="HEALTH",e))(ue||{});class ge extends p{constructor(e,t,i,s){super(),this.isDestroyed=!1,this.fallSpeed=50,this.swayAmount=30,this.swaySpeed=2,this.time=0,this.landed=!1,this.glowPulse=0,this.bounceOffset=0,this.lifeTime=0,this.maxLifeTime=3e4,this.game=e,this.type=t,this.x=i,this.y=s,this.baseX=i,this.velocity=new u(0,this.fallSpeed),this.createParachute(),this.glow=new g,this.addChild(this.glow);const a=this.getTextureName(t);this.sprite=new n(P.getTexture(a)),this.sprite.anchor.set(.5),this.addChild(this.sprite),this.addLabel()}createParachute(){this.parachute=new g,this.parachute.beginFill(16777215,.8),this.parachute.moveTo(-20,-40),this.parachute.quadraticCurveTo(0,-50,20,-40),this.parachute.lineTo(20,-30),this.parachute.quadraticCurveTo(0,-35,-20,-30),this.parachute.closePath(),this.parachute.endFill(),this.parachute.lineStyle(1,6710886),this.parachute.moveTo(-15,-30),this.parachute.lineTo(-5,0),this.parachute.moveTo(15,-30),this.parachute.lineTo(5,0),this.parachute.moveTo(0,-35),this.parachute.lineTo(0,0),this.addChild(this.parachute)}addLabel(){const e=new f({fontFamily:"Arial",fontSize:10,fill:16777215,stroke:0,strokeThickness:2}),t=this.getLabelText(),i=new y(t,e);i.anchor.set(.5),i.y=20,this.addChild(i)}update(e){if(!this.isDestroyed){if(this.time+=e,this.landed){if(this.lifeTime+=1e3*e,this.lifeTime>.8*this.maxLifeTime){const e=Math.sin(10*this.time)>0;this.alpha=e?.5:1}this.lifeTime>=this.maxLifeTime&&this.destroy(),this.bounceOffset=5*Math.sin(3*this.time),this.sprite.y=this.bounceOffset}else this.y+=this.velocity.y*e,this.x=this.baseX+Math.sin(this.time*this.swaySpeed)*this.swayAmount,this.y>=v.GROUND_Y-30&&this.land();this.updateGlow()}}land(){this.landed=!0,this.y=v.GROUND_Y-30,this.parachute&&(this.removeChild(this.parachute),this.parachute.destroy(),this.parachute=void 0),K.play("powerup_land")}updateGlow(){this.glowPulse+=.05;const e=25+5*Math.sin(this.glowPulse),t=.3+.1*Math.sin(this.glowPulse);this.glow.clear(),this.glow.beginFill(this.getGlowColor(),t),this.glow.drawCircle(0,0,e),this.glow.endFill()}collect(e){if(!this.isDestroyed){switch(this.type){case"WEAPON_UPGRADE":this.applyGunPowerUp(e);break;case"SHIELD":e.activateShieldDeflection(1e4);break;case"NUKE":this.triggerNuke();break;case"MEGA_LASER":e.activateMegaLaser(5e3);break;case"SPEED_BOOST":e.activateSpeedBoost(8e3);break;case"RAPID_FIRE":e.activateRapidFire(1e4);break;case"SPREAD_SHOT":e.activateSpreadShot(1e4);break;case"HEALTH":e.heal(50)}K.play("powerup"),this.game.getScoreManager().addScore(500),this.destroy()}}applyGunPowerUp(e){e.activateGunPowerUp(15e3)}triggerNuke(){const e=this.game.getEnemies();for(const s of e)s.isDestroyed||s.takeDamage(99999);try{const e=this.game.projectiles;for(let t=e.length-1;t>=0;t--){const i=e[t];i&&i.isEnemyProjectile&&!i.isDestroyed&&(i.destroy(),e.splice(t,1))}}catch(i){}const t=this.game.getBackgroundSystem().getInteractiveElements();for(const s of t)s.destroyed||s.takeDamage(99999,!0);this.game.getParticleSystem().createNukeFlash(),K.play("nuke")}getTextureName(e){switch(e){case"WEAPON_UPGRADE":case"MEGA_LASER":default:return"powerup_weapon";case"SHIELD":return"powerup_shield";case"NUKE":return"powerup_nuke";case"SPEED_BOOST":return"powerup_speed";case"RAPID_FIRE":return"powerup_rapid";case"SPREAD_SHOT":return"powerup_spread";case"HEALTH":return"powerup_health"}}getGlowColor(){switch(this.type){case"WEAPON_UPGRADE":return 65280;case"SHIELD":return 65535;case"NUKE":return 16711680;case"MEGA_LASER":case"HEALTH":return 16711935;case"SPEED_BOOST":return 16776960;case"RAPID_FIRE":return 16746496;case"SPREAD_SHOT":return 8913151;default:return 16777215}}getLabelText(){switch(this.type){case"WEAPON_UPGRADE":return"WEAPON";case"SHIELD":return"SHIELD";case"NUKE":return"NUKE";case"MEGA_LASER":return"MEGA";case"SPEED_BOOST":return"SPEED";case"RAPID_FIRE":return"RAPID";case"SPREAD_SHOT":return"SPREAD";case"HEALTH":return"HEALTH";default:return""}}getBounds(){return new l(this.x-20,this.y-20,40,40)}destroy(){this.isDestroyed=!0,super.destroy()}}class fe extends p{constructor(e,t,i){super(),this.speed=2,this.hoverTimer=0,this.hoverDuration=2e3,this.mainRotorFrameIndex=0,this.mainRotorFrameTimer=0,this.MAIN_ROTOR_FRAMES=7,this.MAIN_ROTOR_FRAME_DELAY=50,this.tailRotorFrameIndex=0,this.tailRotorFrameTimer=0,this.TAIL_ROTOR_FRAMES=4,this.TAIL_ROTOR_FRAME_DELAY=30,this.startX=-100,this.exitX=v.SCREEN_WIDTH+100,this.flightY=100,this.hasDropped=!1,this.game=e,this.powerUpType=t,this.phase="enter",this.dropX=null!=i?i:v.SCREEN_WIDTH/2,this.dropY=.7*v.SCREEN_HEIGHT,this.targetX=this.dropX,this.x=this.startX,this.y=this.flightY,this.createVisuals(),this.playHelicopterSound()}createVisuals(){const e=P.getTexture("pupcopter");this.helicopterSprite=new n(e),this.helicopterSprite.anchor.set(.5),this.addChild(this.helicopterSprite);const t=P.getTexture("puprotor");this.mainRotorSprite=new n(t),this.mainRotorSprite.anchor.set(.5),this.mainRotorSprite.y=-12,this.addChild(this.mainRotorSprite),this.tailRotorSprite=new n(t),this.tailRotorSprite.anchor.set(.5),this.tailRotorSprite.scale.set(.3),this.tailRotorSprite.x=25,this.tailRotorSprite.y=8,this.tailRotorSprite.rotation=Math.PI/2,this.addChild(this.tailRotorSprite),this.mainRotorFrameIndex=0,this.mainRotorFrameTimer=0,this.tailRotorFrameIndex=0,this.tailRotorFrameTimer=0,this.updateMainRotorFrame(),this.updateTailRotorFrame()}update(e){switch(this.phase){case"enter":this.updateEntering(e);break;case"hover":this.updateHovering(e);break;case"drop":this.updateDropping(e);break;case"exit":this.updateExiting(e)}this.updateRotorAnimations(e)}updateEntering(e){this.x+=this.speed*e*60,this.x>=this.targetX&&(this.x=this.targetX,this.phase="hover",this.hoverTimer=0)}updateHovering(e){this.hoverTimer+=1e3*e,this.y=this.flightY+3*Math.sin(.005*this.hoverTimer),this.hoverTimer>=this.hoverDuration&&(this.phase="drop")}updateDropping(e){this.hasDropped||(this.dropPowerUp(),this.hasDropped=!0,setTimeout(()=>{"drop"===this.phase&&(this.phase="exit")},500))}updateExiting(e){this.x+=this.speed*e*60,this.x>=this.exitX&&(this.phase="complete",this.destroy())}updateRotorAnimations(e){this.updateMainRotorAnimation(e),this.updateTailRotorAnimation(e)}updateMainRotorAnimation(e){this.mainRotorSprite&&this.mainRotorSprite.parent&&(this.mainRotorFrameTimer+=1e3*e,this.mainRotorFrameTimer>=this.MAIN_ROTOR_FRAME_DELAY&&(this.mainRotorFrameTimer=0,this.mainRotorFrameIndex=(this.mainRotorFrameIndex+1)%this.MAIN_ROTOR_FRAMES,this.updateMainRotorFrame()))}updateTailRotorAnimation(e){this.tailRotorSprite&&this.tailRotorSprite.parent&&(this.tailRotorFrameTimer+=1e3*e,this.tailRotorFrameTimer>=this.TAIL_ROTOR_FRAME_DELAY&&(this.tailRotorFrameTimer=0,this.tailRotorFrameIndex=(this.tailRotorFrameIndex+1)%this.TAIL_ROTOR_FRAMES,this.updateTailRotorFrame()))}updateMainRotorFrame(){if(!this.mainRotorSprite)return;const e=P.getTexture("puprotor");if(!e||!e.baseTexture)return;const t=e.baseTexture.width/this.MAIN_ROTOR_FRAMES,i=e.baseTexture.height,s=new h(e.baseTexture,new l(this.mainRotorFrameIndex*t,0,t,i));this.mainRotorSprite.texture=s}updateTailRotorFrame(){if(!this.tailRotorSprite)return;const e=P.getTexture("puprotor");if(!e||!e.baseTexture)return;const t=e.baseTexture.width/this.MAIN_ROTOR_FRAMES,i=e.baseTexture.height,s=new h(e.baseTexture,new l(this.tailRotorFrameIndex*t,0,t,i));this.tailRotorSprite.texture=s}dropPowerUp(){const e=new ge(this.game,this.powerUpType,this.x,this.y);e.fallSpeed=60,e.hasParachute=!0,this.game.addPowerUp(e),K.play("powerup_drop")}playHelicopterSound(){try{K.play("pupcopter")}catch(e){}}isComplete(){return"complete"===this.phase}completeMission(){this.phase="complete",this.destroy()}evacuate(){this.phase="exit",this.speed=6}destroy(){this.helicopterSprite&&this.helicopterSprite.destroy(),this.mainRotorSprite&&this.mainRotorSprite.destroy(),this.tailRotorSprite&&this.tailRotorSprite.destroy(),super.destroy()}}class ye{constructor(){this.lastDropTime=0,this.recentPowerUps=[],this.maxRecentTracking=5}selectOptimalPowerUp(e){if(this.recentPowerUps.length>this.maxRecentTracking&&this.recentPowerUps.shift(),e.playerHealth/e.maxHealth<.3&&!this.wasRecentlyDropped(ue.SHIELD))return ue.SHIELD;if(0===e.weaponTier&&e.survivalTime>1e4){if(!this.wasRecentlyDropped(ue.WEAPON_UPGRADE))return ue.WEAPON_UPGRADE;if(!this.wasRecentlyDropped(ue.SPREAD_SHOT))return ue.SPREAD_SHOT}if(e.enemyCount>20)return this.wasRecentlyDropped(ue.NUKE)?ue.MEGA_LASER:ue.NUKE;if(e.survivalTime>6e4){const e=[ue.RAPID_FIRE,ue.SPEED_BOOST].filter(e=>!this.wasRecentlyDropped(e));if(e.length>0){return this.selectFromArray(e)}}const t=this.getAvailablePowerUps(),i=t.filter(e=>!this.wasRecentlyDropped(e));return this.selectFromArray(i.length>0?i:t)}wasRecentlyDropped(e){return this.recentPowerUps.includes(e)}selectFromArray(e){return 0===e.length?ue.NUKE:e[Math.floor(Math.random()*e.length)]}getAvailablePowerUps(){return[ue.SHIELD,ue.NUKE,ue.MEGA_LASER,ue.SPEED_BOOST,ue.RAPID_FIRE,ue.WEAPON_UPGRADE,ue.SPREAD_SHOT,ue.HEALTH]}recordPowerUpDrop(e){null!=e&&(this.recentPowerUps.push(e),this.lastDropTime=Date.now())}static createGameContext(e){var t;const i=e.getTank(),s=i&&(null==(t=i.getCurrentWeaponTier)?void 0:t.call(i))||0;return{playerHealth:i?i.health:100,maxHealth:i?i.maxHealth:100,weaponTier:s,enemyCount:e.getEnemies().length,survivalTime:e.getElapsedTime(),timeSinceLastDrop:0,recentPowerUps:[]}}getStats(){return{recentDrops:this.recentPowerUps.map(e=>ue[e]),lastDropTime:this.lastDropTime}}}class Te{constructor(e){this.lastDropTime=0,this.activeHelicopters=[],this.game=e,this.dropCalculation={baseInterval:2e4,healthBonus:.15,weaponBonus:.1,timeBonus:.05,maxDropChance:.4},this.powerUpSelector=new ye}calculateDropChance(e){let t=.15;const i=e.playerHealth/e.maxHealth;return i<.3?t+=this.dropCalculation.healthBonus:i<.6&&(t+=.5*this.dropCalculation.healthBonus),0===e.weaponTier&&(t+=this.dropCalculation.weaponBonus),e.timeSinceLastDrop>6e4&&(t+=this.dropCalculation.timeBonus),e.survivalTime>12e4&&(t+=.05),e.enemyCount>15&&(t+=.1),Math.min(t,this.dropCalculation.maxDropChance)}shouldSpawnHelicopter(e){const t=e.survivalTime;if(t-this.lastDropTime<this.dropCalculation.baseInterval)return!1;if(Math.floor(t/1e3)%5!=0)return!1;const i=this.calculateDropChance(e),s=Math.random()<i;return s}spawnHelicopter(e){e||(e=ye.createGameContext(this.game));const t=this.powerUpSelector.selectOptimalPowerUp(e),i=this.calculateOptimalDropPosition(e),s=new fe(this.game,t,i);this.activeHelicopters.push(s);try{this.game.layers.getLayer("allies").addChild(s)}catch(a){this.game.layers.getLayer("effects").addChild(s)}this.powerUpSelector.recordPowerUpDrop(t),this.lastDropTime=e.survivalTime}calculateOptimalDropPosition(e){const t=this.game.getTank();if(!t||t.isDestroyed||!t.position)return v.SCREEN_WIDTH/2;const i=t.x||v.SCREEN_WIDTH/2,s=Math.max(100,i-200),a=Math.min(v.SCREEN_WIDTH-100,i+200);return s+Math.random()*(a-s)}update(e){const t=ye.createGameContext(this.game);t.timeSinceLastDrop=t.survivalTime-this.lastDropTime,this.updateActiveHelicopters(e),this.shouldSpawnHelicopter(t)&&this.spawnHelicopter(t)}updateActiveHelicopters(e){this.activeHelicopters=this.activeHelicopters.filter(t=>(t.update(e),!t.isComplete()))}reset(){this.activeHelicopters.forEach(e=>{e.destroy()}),this.activeHelicopters=[],this.lastDropTime=0}forceHelicopterDrop(e){const t=ye.createGameContext(this.game);if(e){const s=this.calculateOptimalDropPosition(t),a=new fe(this.game,e,s);try{this.game.layers.getLayer("allies").addChild(a)}catch(i){this.game.layers.getLayer("effects").addChild(a)}this.powerUpSelector.recordPowerUpDrop(e)}else this.spawnHelicopter(t);this.lastDropTime=t.survivalTime}getDropStats(){const e=ye.createGameContext(this.game);return{lastDropTime:this.lastDropTime,timeSinceLastDrop:e.survivalTime-this.lastDropTime,selectorStats:this.powerUpSelector.getStats()}}evacuateAllHelicopters(){this.activeHelicopters.forEach((e,t)=>{e.evacuate()})}}class Ee{constructor(e){this.spawnFrameCounter=0,this.spawnCheckInterval=200,this.enemyKillCounter=0,this.powerUpSlots=[null,null,null,null],this.powerUps=[],this.helicopters=[],this.game=e,this.helicopterDropManager=new Te(e)}update(e){if("GAME_OVER"!==this.game.getState()){this.spawnFrameCounter++,this.spawnFrameCounter>=this.spawnCheckInterval&&(this.checkPowerUpSpawnConditions(),this.spawnFrameCounter=0),this.helicopterDropManager.update(e);for(let t=this.powerUps.length-1;t>=0;t--){const i=this.powerUps[t];i.update(e),i.isDestroyed&&this.powerUps.splice(t,1)}for(let t=this.helicopters.length-1;t>=0;t--){const i=this.helicopters[t];i.update(e),i.isComplete()&&this.helicopters.splice(t,1)}}}checkPowerUpSpawnConditions(){const e=this.game.getWaveSystem().getCurrentWave(),t=Math.floor(e/10),i=this.findEmptyPowerUpSlot();if(-1===i)return;const s=5+2*t;this.enemyKillCounter<s||(this.spawnPowerUpInSlot(i,t),this.enemyKillCounter=0)}findEmptyPowerUpSlot(){for(let e=0;e<this.powerUpSlots.length;e++)if(null===this.powerUpSlots[e])return e;return-1}spawnPowerUpInSlot(e,t){const i=[ue.WEAPON_UPGRADE,ue.SHIELD,ue.SPEED_BOOST,ue.RAPID_FIRE];t>=1&&i.push(ue.MEGA_LASER),t>=2&&i.push(ue.NUKE),t>=3&&i.push(ue.SPREAD_SHOT);const s=i[Math.floor(Math.random()*i.length)];this.dropPowerUp(s)}dropPowerUp(e){if(!e){const t=[ue.WEAPON_UPGRADE,ue.SHIELD,ue.NUKE,ue.MEGA_LASER,ue.SPEED_BOOST,ue.RAPID_FIRE,ue.SPREAD_SHOT,ue.HEALTH],i=this.game.getTank();i&&i.health<.5*i.maxHealth&&t.push(ue.HEALTH,ue.HEALTH),e=t[Math.floor(Math.random()*t.length)]}const t=100+Math.random()*(v.SCREEN_WIDTH-200),i=new fe(this.game,e,t);this.helicopters.push(i),this.game.layers.getLayer("effects").addChild(i)}calculateNextDropTime(){this.nextDropTime=1e4+1e4*Math.random()}forceDrop(e,t,i){t=null!=t?t:v.SCREEN_WIDTH/2,i=null!=i?i:-50;const s=new ge(this.game,e,t,i);this.powerUps.push(s),this.game.addPowerUp(s)}getPowerUps(){return this.powerUps}spawnPowerUp(e,t,i){const s=new ge(this.game,e,t,i);this.powerUps.push(s),this.game.addPowerUp(s)}clear(){for(const e of this.powerUps)e.destroy();this.powerUps=[];for(const e of this.helicopters)e.completeMission();this.helicopters=[]}triggerHelicopterDrop(e){this.helicopterDropManager.forceHelicopterDrop(e)}getDropStats(){return this.helicopterDropManager.getDropStats()}onEnemyKilled(){this.enemyKillCounter++}reset(){this.clear(),this.spawnFrameCounter=0,this.enemyKillCounter=0,this.powerUpSlots.fill(null),this.helicopterDropManager.reset()}start(){this.reset()}evacuateAllHelicopters(){this.helicopterDropManager.evacuateAllHelicopters()}}var Se=(e=>(e[e.SKY=4]="SKY",e[e.FAR_BG=3]="FAR_BG",e[e.MID_BG=2]="MID_BG",e[e.GROUND=1]="GROUND",e))(Se||{});class we extends p{constructor(e,t,i,s,a){super(),this.parallaxFactor=1,this.game=e,this.x=t,this.y=i,this.baseX=t,this.maxHealth=s,this.currentHealth=s,this.scoreValue=a,this.destructible=!0}setParallaxFactor(e){this.parallaxFactor=e}updateParallax(e){!this.destroyed&&this.position&&(this.x=this.baseX-e*this.parallaxFactor)}takeDamage(e,t=!1){return!(!this.destructible||this.currentHealth<=0)&&(!(!t&&e<5e4)&&(this.currentHealth-=e,this.updateVisualState(),this.currentHealth<=0&&(this.destroyElement(),!0)))}destroyElement(){this.destructible=!1,this.game.getScoreManager().addScore(this.scoreValue),this.game.getParticleSystem().createExplosion(this.x,this.y,"medium"),this.parent&&this.parent.removeChild(this),this.destroy()}checkCollision(e){const t=this.getBounds(),i=e.getBounds();return t.intersects(i)}}class ve{constructor(e){this.cameraX=0,this.autoScrollEnabled=!0,this.autoScrollSpeed=20,this.interactiveElements=[],this.game=e,this.layers=new Map,T();try{this.initializeLayers()}catch(t){}}initializeLayers(){this.addLayer(4,"images/backgrounds/survival_sky.png",.1),this.addLayer(3,"images/backgrounds/survival_bg.png",.3),this.addLayer(2,"images/backgrounds/survival_bg2.png",.6),this.addLayer(1,"images/backgrounds/survival_ground.png",1)}createTestLayer(e,t,i,s){const a=new g;a.beginFill(t),a.drawRect(0,0,3*v.SCREEN_WIDTH,100),a.endFill();const r=this.game.getRenderer().generateTexture(a),o=new E(r,3*v.SCREEN_WIDTH,100);o.y=i,o.x=0,o.visible=!0,o.alpha=1,o.zIndex=e;const n=this.game.layers.getLayer("ground");n.addChild(o),n.sortableChildren=!0,this.layers.set(e,{plane:e,sprites:[o],parallaxFactor:s,scrollSpeed:this.autoScrollSpeed*s})}addLayer(e,t,i){const s=h.from(t);s.baseTexture.on("error",()=>{this.createFallbackLayer(e,i)}),s.baseTexture.on("loaded",()=>{r&&s.width>0&&s.height>0&&(r.height=s.height||a[e])});const a={4:480,3:300,2:300,1:120},r=new E(s,3*v.SCREEN_WIDTH,s.height||a[e]),o={4:0,3:v.SCREEN_HEIGHT-300,2:v.SCREEN_HEIGHT-200,1:v.SCREEN_HEIGHT-60};r.y=o[e];const n={4:0,3:-50,2:-100,1:-25};r.x=n[e];const l={plane:e,sprites:[r],parallaxFactor:i,scrollSpeed:this.autoScrollSpeed*i};r.visible=!0,r.alpha=1,r.zIndex=e;const c={4:"background",3:"shadows",2:"ground",1:"ground_enemies"},d=this.game.layers.getLayer(c[e]||"ground");d.addChild(r),d.sortableChildren=!0,this.layers.set(e,l)}createFallbackLayer(e,t){const i=new g,s={4:8900331,3:16711680,2:65280,1:255},a={4:200,3:150,2:100,1:100},r={4:0,3:v.SCREEN_HEIGHT-300,2:v.SCREEN_HEIGHT-200,1:v.SCREEN_HEIGHT-60};i.beginFill(s[e]||3355443),i.drawRect(0,0,3*v.SCREEN_WIDTH,a[e]),i.endFill();const o=this.game.getRenderer().generateTexture(i),n=new E(o,3*v.SCREEN_WIDTH,a[e]);n.y=r[e];const h={4:0,3:-50,2:-100,1:-25};n.x=h[e];const l={plane:e,sprites:[n],parallaxFactor:t,scrollSpeed:this.autoScrollSpeed*t};n.visible=!0,n.alpha=1,n.zIndex=e;const c={4:"background",3:"shadows",2:"ground",1:"ground_enemies"},d=this.game.layers.getLayer(c[e]||"ground");d.addChild(n),d.sortableChildren=!0,this.layers.set(e,l)}update(e){this.autoScrollEnabled&&(this.cameraX+=this.autoScrollSpeed*e),this.layers.forEach((e,t)=>{const i=this.cameraX*e.parallaxFactor;e.sprites.forEach(e=>{e.tilePosition.x=-i})}),this.interactiveElements=this.interactiveElements.filter(e=>!(!e||e.destroyed)&&(e.updateParallax(this.cameraX),!0))}addInteractiveElement(e,t){const i=this.layers.get(t);i&&(e.setParallaxFactor(i.parallaxFactor),this.game.layers.getLayer("background").addChild(e),this.interactiveElements.push(e))}removeInteractiveElement(e){var t;const i=this.interactiveElements.indexOf(e);i>-1&&(this.interactiveElements.splice(i,1),null==(t=e.parent)||t.removeChild(e))}getInteractiveElements(){return[...this.interactiveElements]}setScrollSpeed(e){this.autoScrollSpeed=e,this.layers.forEach(t=>{t.scrollSpeed=e*t.parallaxFactor})}setAutoScroll(e){this.autoScrollEnabled=e}getCameraX(){return this.cameraX}setCameraX(e){this.cameraX=e}destroy(){this.layers.forEach(e=>{e.sprites.forEach(e=>e.destroy())}),this.layers.clear(),this.interactiveElements.forEach(e=>e.destroy()),this.interactiveElements=[]}}class Re extends we{constructor(e,t,i,s=1){super(e,t,i,100,1e3),this.currentFrame=0,this.posterType=s,this.loadFrames(),this.createSprite()}loadFrames(){try{const e=5===this.posterType?`images/anims/survival/propaganda${this.posterType}.png`:`images/anims/survival/Propaganda${this.posterType}.png`;this.frames=[h.from(e)],this.frames.push(this.frames[0])}catch(e){this.createFallbackFrames()}}createFallbackFrames(){this.frames=[];const e=[16711680,3355443];for(let t=0;t<2;t++){const i=new g;i.beginFill(e[t]),i.drawRect(0,0,64,96),i.endFill(),i.lineStyle(2,0),i.drawRect(8,8,48,80);const s=this.game.getRenderer().generateTexture(i);this.frames.push(s)}}createSprite(){this.sprite=new n(this.frames[0]),this.sprite.anchor.set(.5,1),this.addChild(this.sprite)}updateVisualState(){const e=this.currentHealth/this.maxHealth;this.currentFrame=e>0?0:1,this.sprite.texture=this.frames[this.currentFrame]}destroyElement(){var e;this.game.getParticleSystem().createExplosion(this.x,this.y,"medium"),this.game.getScoreManager().addScore(this.scoreValue),null==(e=this.parent)||e.removeChild(this),this.destroy()}static spawnPosters(e,t){const i=[];return[{x:70,y:330,type:1},{x:200,y:330,type:2},{x:300,y:330,type:3},{x:400,y:330,type:4},{x:500,y:330,type:5}].forEach(s=>{const a=new Re(e,s.x,s.y,s.type);t.addInteractiveElement(a,Se.MID_BG),i.push(a)}),i}getPosterType(){return this.posterType}}class Me extends we{constructor(e,t,i){super(e,t,i,500,5e3),this.frames=[],this.currentFrame=0,this.defenseRadius=150,this.loadFrames(),this.createSprite()}loadFrames(){try{const e=h.from("images/anims/survival/controltower1.png");this.frames=[e,e,e,e,e]}catch(e){this.createFallbackFrames()}}createFallbackFrames(){this.frames=[];const e=[6710886,5592405,4473924,3355443,2236962];for(let t=0;t<5;t++){const i=new g;if(i.beginFill(e[t]),i.drawRect(0,60,80,60),i.endFill(),i.beginFill(e[t]),i.drawRect(20,20,40,80),i.endFill(),t>0){i.beginFill(16729088,.7);for(let e=0;e<t;e++)i.drawRect(70*Math.random(),100*Math.random(),10,10);i.endFill()}i.lineStyle(2,0),i.drawRect(0,60,80,60),i.drawRect(20,20,40,80);const s=this.game.getRenderer().generateTexture(i);this.frames.push(s)}}createSprite(){this.sprite=new n(this.frames[0]),this.sprite.anchor.set(.5,1),this.addChild(this.sprite)}updateVisualState(){const e=this.currentHealth/this.maxHealth;e>.8?this.currentFrame=0:e>.6?this.currentFrame=1:e>.4?this.currentFrame=2:e>.2?this.currentFrame=3:e>0&&(this.currentFrame=4),this.sprite.texture=this.frames[this.currentFrame],e<.5&&Math.random()<.1&&(this.sprite.x=4*(Math.random()-.5),this.sprite.y=2*(Math.random()-.5),setTimeout(()=>{this.sprite.x=0,this.sprite.y=0},100))}destroyElement(){var e;this.game.getParticleSystem().createExplosion(this.x,this.y,"large");const t=this.scoreValue+2e3;this.game.getScoreManager().addScore(t),this.createScreenShake(),null==(e=this.parent)||e.removeChild(this),this.destroy()}createScreenShake(){const e=this.game.layers.getLayer("background").parent;if(!e)return;const t=e.x,i=e.y;let s=0;const a=()=>{s+=16;const r=s/500,o=1-r;r<1?(e.x=t+15*(Math.random()-.5)*o,e.y=i+15*(Math.random()-.5)*o,requestAnimationFrame(a)):(e.x=t,e.y=i)};a()}static spawnTowers(e,t){const i=[];return[{x:200,y:170}].forEach(s=>{const a=new Me(e,s.x,s.y);t.addInteractiveElement(a,Se.FAR_BG),i.push(a)}),i}getDefenseRadius(){return this.defenseRadius}isHeavilyDamaged(){return this.currentHealth/this.maxHealth<.3}}class xe extends p{constructor(){super(),this.currentTime=0,this.createTimerStyle(),this.createTimerDisplay(),this.positionTimer()}createTimerStyle(){this.timerStyle=new f({fontFamily:"Arial Black",fontSize:24,fill:"#00ff00",stroke:"#000000",strokeThickness:2,dropShadow:!0,dropShadowDistance:2,dropShadowColor:"#000000",dropShadowAlpha:.8})}createTimerDisplay(){this.timerText=new y("0:00:00",this.timerStyle),this.timerText.anchor.set(0,0),this.addChild(this.timerText)}positionTimer(){this.x=20,this.y=40}update(e){this.currentTime=e;const t=Math.floor(e/6e4),i=Math.floor(e%6e4/1e3),s=Math.floor(e%1e3/10),a=`${t}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;this.timerText.text=a,this.updateTimerColor(e)}updateTimerColor(e){const t=Math.floor(e/6e4);let i;i=t>=10?"#ffd700":t>=5?"#ff9900":t>=2?"#ffff00":"#00ff00",this.timerStyle.fill!==i&&(this.timerStyle.fill=i,this.timerText.style=this.timerStyle)}getFormattedTime(){return this.timerText.text}getCurrentTime(){return this.currentTime}}class Ae extends p{constructor(){super(),this.currentTier=0,this.createTitleDisplay(),this.createTierBadge(),this.positionElements()}createTitleDisplay(){const e=new f({fontFamily:"Arial Black",fontSize:20,fill:"#ffffff",stroke:"#000000",strokeThickness:3,dropShadow:!0,dropShadowDistance:3,dropShadowColor:"#000000"});this.titleText=new y("SURVIVAL MODE",e),this.titleText.anchor.set(0,0),this.addChild(this.titleText)}createTierBadge(){this.tierBadge=new g,this.addChild(this.tierBadge);const e=new f({fontFamily:"Arial Black",fontSize:14,fill:"#ffffff",stroke:"#000000",strokeThickness:2});this.tierText=new y("T0",e),this.tierText.anchor.set(.5),this.tierBadge.addChild(this.tierText),this.updateTierBadge(0)}positionElements(){this.x=209,this.y=20,this.tierBadge.x=this.titleText.width+10,this.tierBadge.y=0,this.tierText.x=20,this.tierText.y=10}updateTierBadge(e){this.tierBadge.clear();let t=4473924;e>=7?t=16711680:e>=4?t=16750848:e>=2&&(t=16776960),this.tierBadge.beginFill(t),this.tierBadge.drawRoundedRect(0,0,40,20,5),this.tierBadge.endFill(),this.tierBadge.lineStyle(2,16777215,1),this.tierBadge.drawRoundedRect(0,0,40,20,5),this.tierText.text=`T${e}`}updateTier(e){e=Math.max(0,Math.min(9,e)),this.currentTier!==e&&(this.currentTier=e,this.updateTierBadge(e),this.tierBadge.x=this.titleText.width+10)}getCurrentTier(){return this.currentTier}}class Ce{constructor(e){this.activePowerUps=new Map,this.game=e,this.container=new p,this.textStyle=new f({fontFamily:"Arial",fontSize:16,fill:16777215,stroke:0,strokeThickness:3}),this.smallTextStyle=new f({fontFamily:"Arial",fontSize:12,fill:16777215,stroke:0,strokeThickness:2}),this.largeTextStyle=new f({fontFamily:"Arial",fontSize:24,fill:16777215,stroke:0,strokeThickness:4}),this.createScoreDisplay(),this.createWaveDisplay(),this.createHealthBar(),this.createAmmoDisplay(),this.createComboDisplay(),this.createPowerUpIndicators(),this.createStatsDisplay(),this.createSurvivalHUD(),this.game.isDebugMode()&&this.createFPSCounter()}createScoreDisplay(){this.scoreText=new y("SCORE: 0",this.textStyle),this.scoreText.x=10,this.scoreText.y=10,this.container.addChild(this.scoreText),this.highScoreText=new y("HIGH: 0",this.smallTextStyle),this.highScoreText.x=10,this.highScoreText.y=35,this.container.addChild(this.highScoreText)}createWaveDisplay(){this.waveText=new y("WAVE 1",this.largeTextStyle),this.waveText.anchor.set(.5,0),this.waveText.x=v.SCREEN_WIDTH/2,this.waveText.y=10,this.container.addChild(this.waveText),this.enemiesText=new y("Enemies: 0/0",this.smallTextStyle),this.enemiesText.anchor.set(.5,0),this.enemiesText.x=v.SCREEN_WIDTH/2,this.enemiesText.y=40,this.container.addChild(this.enemiesText)}createHealthBar(){const e=v.SCREEN_HEIGHT-40;this.healthBarBg=new g,this.healthBarBg.beginFill(3355443),this.healthBarBg.drawRect(10,e,200,20),this.healthBarBg.endFill(),this.container.addChild(this.healthBarBg),this.healthBar=new g,this.container.addChild(this.healthBar),this.healthText=new y("100/100",this.smallTextStyle),this.healthText.anchor.set(.5),this.healthText.x=110,this.healthText.y=e+10,this.container.addChild(this.healthText)}createAmmoDisplay(){this.weaponText=new y("STANDARD GUN",this.textStyle),this.weaponText.anchor.set(1,1),this.weaponText.x=v.SCREEN_WIDTH-10,this.weaponText.y=v.SCREEN_HEIGHT-40,this.container.addChild(this.weaponText),this.ammoText=new y("AMMO: ",this.smallTextStyle),this.ammoText.anchor.set(1,1),this.ammoText.x=v.SCREEN_WIDTH-10,this.ammoText.y=v.SCREEN_HEIGHT-20,this.container.addChild(this.ammoText)}createComboDisplay(){this.comboText=new y("",this.largeTextStyle),this.comboText.anchor.set(1,0),this.comboText.x=v.SCREEN_WIDTH-10,this.comboText.y=10,this.container.addChild(this.comboText),this.multiplierText=new y("",this.textStyle),this.multiplierText.anchor.set(1,0),this.multiplierText.x=v.SCREEN_WIDTH-10,this.multiplierText.y=40,this.container.addChild(this.multiplierText)}createPowerUpIndicators(){this.powerUpContainer=new p,this.powerUpContainer.x=v.SCREEN_WIDTH/2-100,this.powerUpContainer.y=v.SCREEN_HEIGHT-80,this.container.addChild(this.powerUpContainer)}createStatsDisplay(){this.accuracyText=new y("",this.smallTextStyle),this.accuracyText.x=10,this.accuracyText.y=60,this.container.addChild(this.accuracyText)}createSurvivalHUD(){this.survivalTimer=new xe,this.container.addChild(this.survivalTimer),this.survivalTitle=new Ae,this.container.addChild(this.survivalTitle)}createFPSCounter(){this.fpsText=new y("FPS: 0",this.smallTextStyle),this.fpsText.anchor.set(1,0),this.fpsText.x=v.SCREEN_WIDTH-10,this.fpsText.y=70,this.container.addChild(this.fpsText)}update(e,t){const i=this.game.getScoreManager(),s=this.game.getWaveSystem();this.scoreText.text=`SCORE: ${i.getScore().toLocaleString()}`,this.highScoreText.text=`HIGH: ${i.getHighScore().toLocaleString()}`,this.waveText.text=`WAVE ${s.getCurrentWave()}`;const a=s.getWaveProgress();this.enemiesText.text=`Enemies: ${a.spawned}/${a.total}`;const r=t.health/t.maxHealth;this.healthBar.clear();const o=r>.5?65280:r>.25?16776960:16711680;this.healthBar.beginFill(o),this.healthBar.drawRect(10,v.SCREEN_HEIGHT-40,200*r,20),this.healthBar.endFill(),this.healthText.text=`${Math.ceil(t.health)}/${t.maxHealth}`;const n=t.getCurrentWeapon();this.weaponText.text=n.getType().replace("_"," ");const h=n.getAmmo();this.ammoText.text=h===1/0?"AMMO: ":`AMMO: ${h}/${n.getMaxAmmo()}`;const l=i.getComboCount();l>2?(this.comboText.text=`${l}x COMBO!`,this.comboText.tint=l>=10?16711680:l>=5?16755200:16776960):this.comboText.text="";const c=i.getMultiplier();c>1?(this.multiplierText.text=`x${c.toFixed(1)}`,this.multiplierText.tint=65280):this.multiplierText.text="";const d=i.getAccuracy();if(d>0&&(this.accuracyText.text=`Accuracy: ${d.toFixed(1)}%`),this.fpsText){const t=Math.round(1/e);this.fpsText.text=`FPS: ${t}`,this.fpsText.tint=t>=55?65280:t>=30?16776960:16711680}this.updatePowerUpIndicators(t),this.updateSurvivalHUD(e)}updatePowerUpIndicators(e){this.powerUpContainer.removeChildren(),this.activePowerUps.clear();let t=0;if(e.hasShield()){const i=Math.ceil(e.getShieldTimeLeft()/1e3);this.addPowerUpIndicatorWithTimer("SHIELD",65535,t,i),t+=60}if(e.hasSpeedBoost()){const i=Math.ceil(e.getSpeedBoostTimeLeft()/1e3);this.addPowerUpIndicatorWithTimer("SPEED",16776960,t,i),t+=60}if(e.hasRapidFire()){const i=Math.ceil(e.getRapidFireTimeLeft()/1e3);this.addPowerUpIndicatorWithTimer("RAPID",16746496,t,i),t+=60}if(e.hasSpreadShot()){const i=Math.ceil(e.getSpreadShotTimeLeft()/1e3);this.addPowerUpIndicatorWithTimer("SPREAD",8913151,t,i),t+=60}}addPowerUpIndicatorWithTimer(e,t,i,s){const a=new p,r=new g,o=s<=3&&Math.floor(Date.now()/250)%2?16711680:0;r.beginFill(o,.7),r.drawRoundedRect(0,0,55,30,5),r.endFill(),r.lineStyle(2,t),r.drawRoundedRect(0,0,55,30,5),a.addChild(r);const n=new y(e,this.smallTextStyle);n.anchor.set(.5),n.x=27.5,n.y=8,n.style.fontSize=8,a.addChild(n);const h=new y(s.toString()+"s",this.smallTextStyle);h.anchor.set(.5),h.x=27.5,h.y=20,h.style.fontSize=10,h.style.fill=s<=3?16729156:16777215,a.addChild(h),a.x=i,this.powerUpContainer.addChild(a),this.activePowerUps.set(e,a)}addPowerUpIndicator(e,t,i){this.addPowerUpIndicatorWithTimer(e,t,i,0)}showMessage(e,t=2e3){const i=new y(e,this.largeTextStyle);i.anchor.set(.5),i.x=v.SCREEN_WIDTH/2,i.y=v.SCREEN_HEIGHT/2,this.container.addChild(i);let s=0;const a=setInterval(()=>{s+=16;const e=s/t;i.scale.set(1+.5*e),i.alpha=1-e,s>=t&&(this.container.removeChild(i),i.destroy(),clearInterval(a))},16)}getContainer(){return this.container}updateSurvivalHUD(e){const t=this.game.getElapsedTime();this.survivalTimer.update(t);const i=this.calculateSurvivalTier(t);this.survivalTitle.updateTier(i)}calculateSurvivalTier(e){const t=Math.floor(e/6e4);return Math.min(Math.floor(t/2),9)}reset(){this.activePowerUps.clear(),this.powerUpContainer.removeChildren(),this.survivalTimer&&this.survivalTimer.update(0),this.survivalTitle&&this.survivalTitle.updateTier(0)}}class De{constructor(e){this.parent=e,this.layers=new Map;[{name:"background",zIndex:0},{name:"ground",zIndex:1},{name:"shadows",zIndex:2},{name:"ground_enemies",zIndex:3},{name:"powerups",zIndex:4},{name:"enemies",zIndex:5},{name:"tank",zIndex:6},{name:"allies",zIndex:7},{name:"projectiles",zIndex:8},{name:"explosions",zIndex:9},{name:"particles",zIndex:10},{name:"effects",zIndex:11}].forEach(e=>{const t=new p;t.zIndex=e.zIndex,t.name=e.name,this.layers.set(e.name,t),this.parent.addChild(t)}),this.parent.sortableChildren=!0}getLayer(e){const t=this.layers.get(e);if(!t)throw new Error(`Layer '${e}' not found`);return t}addToLayer(e,t){this.getLayer(e).addChild(t)}removeFromLayer(e,t){this.getLayer(e).removeChild(t)}clearLayer(e){this.getLayer(e).removeChildren()}clearAll(){this.layers.forEach(e=>{e.removeChildren()})}getLayerChildren(e){return this.getLayer(e).children}sortLayer(e,t){this.getLayer(e).children.sort(t)}setLayerVisible(e,t){this.getLayer(e).visible=t}setLayerAlpha(e,t){this.getLayer(e).alpha=t}}class Ie{constructor(e){this.keys=new Map,this.mousePosition=new u,this.mouseDown=!1,this.rightMouseDown=!1,this.enabled=!1,this.canvas=e,this.setupKeyboardEvents(),this.setupMouseEvents(),this.setupTouchEvents()}setupKeyboardEvents(){window.addEventListener("keydown",e=>{this.enabled&&(this.keys.set(e.code,!0),["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Space"].includes(e.code)&&e.preventDefault())}),window.addEventListener("keyup",e=>{this.keys.set(e.code,!1)}),window.addEventListener("blur",()=>{this.keys.clear(),this.mouseDown=!1,this.rightMouseDown=!1})}setupMouseEvents(){this.canvas.addEventListener("mousemove",e=>{const t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,s=this.canvas.height/t.height;this.mousePosition.x=(e.clientX-t.left)*i,this.mousePosition.y=(e.clientY-t.top)*s}),this.canvas.addEventListener("mousedown",e=>{this.enabled&&(0===e.button?this.mouseDown=!0:2===e.button&&(this.rightMouseDown=!0),e.preventDefault())}),this.canvas.addEventListener("mouseup",e=>{0===e.button?this.mouseDown=!1:2===e.button&&(this.rightMouseDown=!1)}),this.canvas.addEventListener("contextmenu",e=>{e.preventDefault()}),this.canvas.addEventListener("mouseleave",()=>{this.mouseDown=!1,this.rightMouseDown=!1})}setupTouchEvents(){let e=null;this.canvas.addEventListener("touchstart",t=>{if(this.enabled){if(t.touches.length>0){const i=t.touches[0];e=i.identifier;const s=this.canvas.getBoundingClientRect(),a=this.canvas.width/s.width,r=this.canvas.height/s.height;this.mousePosition.x=(i.clientX-s.left)*a,this.mousePosition.y=(i.clientY-s.top)*r,this.mouseDown=!0}t.preventDefault()}}),this.canvas.addEventListener("touchmove",t=>{if(null!==e)for(let i=0;i<t.touches.length;i++){const s=t.touches[i];if(s.identifier===e){const e=this.canvas.getBoundingClientRect(),t=this.canvas.width/e.width,i=this.canvas.height/e.height;this.mousePosition.x=(s.clientX-e.left)*t,this.mousePosition.y=(s.clientY-e.top)*i;break}}t.preventDefault()}),this.canvas.addEventListener("touchend",t=>{if(null!==e)for(let i=0;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e){e=null,this.mouseDown=!1;break}t.preventDefault()}),this.canvas.addEventListener("touchcancel",t=>{e=null,this.mouseDown=!1,t.preventDefault()})}getInput(){return{fire:this.mouseDown||this.keys.get("Space")||!1,special:this.rightMouseDown||this.keys.get("ShiftLeft")||!1}}getMousePosition(){return this.mousePosition.clone()}isKeyPressed(e){return this.keys.get(e)||!1}clearInput(){this.keys.clear(),this.mouseDown=!1,this.rightMouseDown=!1}setEnabled(e){this.enabled=e,e||this.clearInput()}}class Pe{constructor(e){this.enabled=!1,this.lastKeyPress=new Map,this.keyDelay=200,this.game=e,this.enabled=this.isDebugMode(),this.enabled&&(this.printCheatSheet(),this.setupCheatListeners())}isDebugMode(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("192.168")||"5173"===window.location.port||!0===window.DEBUG_MODE}printCheatSheet(){}setupCheatListeners(){window.addEventListener("keydown",e=>{if(!this.enabled)return;const t=this.game.getGameState();if(!t||"playing"!==t.getState())return;const i=Date.now();if(i-(this.lastKeyPress.get(e.code)||0)<this.keyDelay)return;this.lastKeyPress.set(e.code,i);const s=t.getTank();if(s&&!s.isDestroyed)switch(e.code){case"Digit1":this.setWeapon(F.STANDARD_GUN);break;case"Digit2":this.setWeapon(F.HOMING_MISSILES);break;case"Digit3":this.setWeapon(F.LASER_CANNON);break;case"Digit4":this.setWeapon(F.ROCKETS);break;case"Digit5":this.setWeapon(F.FLAK_CANNON);break;case"Digit6":this.setWeapon(F.THUNDERSTRIKE);break;case"Digit7":this.activateShield();break;case"Digit8":this.activateSpeedBoost();break;case"Digit9":this.activateRapidFire();break;case"Digit0":this.activateNuke();break;case"Minus":this.healToFull();break;case"Equal":this.spawnRandomPowerUp();break;case"BracketLeft":this.previousWave();break;case"BracketRight":this.nextWave();break;case"Backslash":this.toggleInvincibility();break;case"KeyT":this.spawnDeflectorEnemy();break;case"KeyY":this.spawnSatelliteEnemy();break;case"KeyM":this.activateMegaLaser()}})}setWeapon(e){const t=this.game.getGameState(),i=null==t?void 0:t.getTank();if(!i)return;const s=i.activeWeapons;if(!s.includes(e)){s.push(e);const t=i.weapons.get(e);t&&t.refillAmmo()}}activateShield(){const e=this.game.getGameState(),t=null==e?void 0:e.getTank();t&&t.activateShield(1e4)}activateSpeedBoost(){const e=this.game.getGameState(),t=null==e?void 0:e.getTank();t&&t.activateSpeedBoost(1e4)}activateRapidFire(){const e=this.game.getGameState(),t=null==e?void 0:e.getTank();t&&t.activateRapidFire(1e4)}activateNuke(){const e=this.game.getGameState();if(!e)return;e.getEnemies().forEach(e=>{e.isDestroyed||e.takeDamage(99999)})}healToFull(){const e=this.game.getGameState(),t=null==e?void 0:e.getTank();t&&t.heal(v.TANK_MAX_HEALTH)}spawnRandomPowerUp(){const e=this.game.getGameState();if(!e)return;const t=[ue.SHIELD,ue.MEGA_LASER,ue.SPEED_BOOST,ue.RAPID_FIRE,ue.SPREAD_SHOT,ue.HEALTH],i=t[Math.floor(Math.random()*t.length)],s=100+Math.random()*(v.SCREEN_WIDTH-200);e.spawnPowerUp(i,s,100)}previousWave(){const e=this.game.getWaveSystem();if(!e)return;const t=e.getCurrentWave();t>1&&(e.currentWave=t-2,e.nextWave())}nextWave(){const e=this.game.getWaveSystem();if(!e)return;e.nextWave();e.getCurrentWave()}toggleInvincibility(){const e=this.game.getGameState(),t=null==e?void 0:e.getTank();if(!t)return;const i=t.__invincible||!1;if(t.__invincible=!i,i)t.__originalTakeDamage&&(t.takeDamage=t.__originalTakeDamage);else{const e=t.takeDamage.bind(t);t.__originalTakeDamage=e,t.takeDamage=()=>{}}}spawnDeflectorEnemy(){const e=Math.random()<.5?-50:v.SCREEN_WIDTH+50,t=100+200*Math.random();q(()=>o(this,null,function*(){const{Enemy:e,EnemyType:t}=yield Promise.resolve().then(()=>ae);return{Enemy:e,EnemyType:t}}),void 0,import.meta.url).then(({Enemy:i,EnemyType:s})=>{const a=new i(this.game,s.DEFLECTOR,e,t);this.game.addEnemy(a)})}spawnSatelliteEnemy(){const e=200+Math.random()*(v.SCREEN_WIDTH-400);q(()=>o(this,null,function*(){const{Enemy:e,EnemyType:t}=yield Promise.resolve().then(()=>ae);return{Enemy:e,EnemyType:t}}),void 0,import.meta.url).then(({Enemy:t,EnemyType:i})=>{const s=new t(this.game,i.SATELLITE,e,50);this.game.addEnemy(s)})}activateMegaLaser(){const e=this.game.getTank();e&&e.activateMegaLaser(3e3)}disable(){this.enabled=!1}enable(){this.enabled=!0,this.printCheatSheet()}}class be{constructor(e){this.game=e,this.upgradeState={defenseOrb:0,homingMissiles:0,laserCannon:0,rocketPods:0,flakCannon:0,thunderstrike:0}}upgradeWeapon(e){const t=this.getUpgradeLevel(e);if(t>=3)return!1;this.setUpgradeLevel(e,t+1);const i=this.game.getTank();return i&&this.applyUpgradesToTank(i),!0}getUpgradeLevel(e){switch(e){case F.STANDARD_GUN:return this.upgradeState.defenseOrb;case F.HOMING_MISSILES:return this.upgradeState.homingMissiles;case F.LASER_CANNON:return this.upgradeState.laserCannon;case F.ROCKETS:return this.upgradeState.rocketPods;case F.FLAK_CANNON:return this.upgradeState.flakCannon;case F.THUNDERSTRIKE:return this.upgradeState.thunderstrike;default:return 0}}setUpgradeLevel(e,t){switch(t=Math.max(0,Math.min(3,t)),e){case F.STANDARD_GUN:this.upgradeState.defenseOrb=t;break;case F.HOMING_MISSILES:this.upgradeState.homingMissiles=t;break;case F.LASER_CANNON:this.upgradeState.laserCannon=t;break;case F.ROCKETS:this.upgradeState.rocketPods=t;break;case F.FLAK_CANNON:this.upgradeState.flakCannon=t;break;case F.THUNDERSTRIKE:this.upgradeState.thunderstrike=t}}applyUpgradesToTank(e){for(const[t,i]of e.weapons.entries()){const e=this.getUpgradeLevel(t);e>0&&this.applyWeaponLevelBoosts(i,e)}}applyWeaponLevelBoosts(e,t){const i=e.baseDamage||e.damage,s=e.baseFireRate||e.getFireRate(),a=1+.25*t,r=1-.15*t;e.damage=Math.floor(i*a),e.fireRate=Math.floor(s*r),e.baseDamage=i,e.baseFireRate=s}getTotalUpgradePoints(){return this.upgradeState.defenseOrb+this.upgradeState.homingMissiles+this.upgradeState.laserCannon+this.upgradeState.rocketPods+this.upgradeState.flakCannon+this.upgradeState.thunderstrike}reset(){this.upgradeState={defenseOrb:0,homingMissiles:0,laserCannon:0,rocketPods:0,flakCannon:0,thunderstrike:0}}getUpgradeState(){return r({},this.upgradeState)}setUpgradeState(e){this.upgradeState=r({},e);const t=this.game.getTank();t&&this.applyUpgradesToTank(t)}}class _e{constructor(){this.state=0,this.isPaused=!1,this.enemies=[],this.projectiles=[],this.powerUps=[],this.survivalTime=0,this.lastFrameTime=0,this.elapsedTime=0,this.lastLogTime=0,this.gameOverScreenShown=!1,this.tankDeathSequenceStarted=!1,this.app=new S({width:v.SCREEN_WIDTH,height:v.SCREEN_HEIGHT,backgroundAlpha:0,resolution:window.devicePixelRatio||1,autoDensity:!0,antialias:!0}),document.body.appendChild(this.app.view),this.app.view.tabIndex=1,this.app.view.focus(),this.stage=this.app.stage,this.gameContainer=new p,this.uiContainer=new p,this.stage.addChild(this.gameContainer),this.stage.addChild(this.uiContainer),this.layers=new De(this.gameContainer),this.inputHandler=new Ie(this.app.view),this.waveSystem=new ce(this),this.collisionSystem=new de(this),this.particleSystem=new me(this),this.scoreManager=new pe,this.powerUpSystem=new Ee(this),this.weaponUpgradeSystem=new be(this),this.backgroundSystem=new ve(this),this.hud=new Ce(this),this.layers.getLayer("particles").addChild(this.particleSystem.getContainer()),this.initializeBackgroundElements(),this.uiContainer.addChild(this.hud.getContainer()),this.debugCheats=new Pe(this),this.app.ticker.add(this.gameLoop.bind(this))}start(){return o(this,null,function*(){this.tank=new V(this),this.tank.x=-100,this.tank.y=v.TANK_Y_POSITION,this.layers.getLayer("tank").addChild(this.tank),this.weaponUpgradeSystem.applyUpgradesToTank(this.tank),K.play("v_prepare"),yield this.animateTankEntry(),K.play("v_getready"),yield this.showGetReady(),this.state=1,this.waveSystem.start(),this.powerUpSystem.start(),this.inputHandler.enabled=!0})}gameLoop(e){const t=e/60;switch(this.state){case 0:break;case 1:this.isPaused||this.updateGameplay(t)}}updateGameplay(e){if(this.survivalTime+=1e3*e,this.elapsedTime+=1e3*e,this.elapsedTime-this.lastLogTime>=1e4){Math.floor(this.elapsedTime/6e4),Math.floor(this.elapsedTime%6e4/1e3),this.waveSystem.getCurrentWave(),this.enemies.length,this.tank&&Math.ceil(this.tank.health),this.scoreManager.getScore();this.lastLogTime=this.elapsedTime}this.backgroundSystem.update(e),this.waveSystem.update(e),this.powerUpSystem.update(e),!this.tank||this.tank.isDestroyed||this.tankDeathSequenceStarted||this.tank.update(e);for(let s=this.enemies.length-1;s>=0;s--){const a=this.enemies[s];if(a&&!a.isDestroyed&&a.position)try{if(a.update(e,this.tank),!a||a.isDestroyed||!a.position){this.enemies.splice(s,1);continue}a.isEvacuating&&a.position&&(a.position.x<-100||a.position.x>v.SCREEN_WIDTH+100||a.position.y<-100||a.position.y>v.SCREEN_HEIGHT+100)&&(a.destroy(),this.enemies.splice(s,1))}catch(t){if(a&&"function"==typeof a.destroy)try{a.destroy()}catch(i){}this.enemies.splice(s,1)}else this.enemies.splice(s,1)}for(let s=this.projectiles.length-1;s>=0;s--){const t=this.projectiles[s];t.isDestroyed?this.projectiles.splice(s,1):t.update(e,this.enemies)}for(let s=this.powerUps.length-1;s>=0;s--){const t=this.powerUps[s];t.isDestroyed?this.powerUps.splice(s,1):t.update(e)}!this.tank||this.tank.isDestroyed||this.tankDeathSequenceStarted||this.collisionSystem.update(this.tank,this.enemies,this.projectiles,this.powerUps),this.particleSystem.update(e),this.tank&&!this.tank.isDestroyed&&this.hud.update(e,this.tank),this.tank&&this.tank.health<=0&&!this.tankDeathSequenceStarted&&(this.hud.update(e,this.tank),this.tankDeathSequenceStarted=!0,this.gameOver())}animateTankEntry(){return o(this,null,function*(){return new Promise(e=>{const t=v.SCREEN_WIDTH/2;let i=0;const s=()=>{i++;const a=i/120,r=1-Math.pow(1-a,3);this.tank.x=(t+100)*r-100,i>=120&&(this.app.ticker.remove(s),e())};this.app.ticker.add(s)})})}showGetReady(){return o(this,null,function*(){return new Promise(e=>{const t=new f({fontFamily:"Arial Black",fontSize:72,fill:["#ffffff","#ffff00"],stroke:"#000000",strokeThickness:8,dropShadow:!0,dropShadowDistance:6}),i=new y("GET READY!",t);i.anchor.set(.5),i.x=v.SCREEN_WIDTH/2,i.y=v.SCREEN_HEIGHT/2-100,this.uiContainer.addChild(i);let s=0;const a=()=>{if(s++,s<30){const e=1+.2*Math.sin(.2*s);i.scale.set(e)}else s>60&&(i.alpha=Math.max(0,1-(s-60)/30));s>=90&&(this.app.ticker.remove(a),i.destroy(),e())};this.app.ticker.add(a)})})}gameOver(){if(this.tank&&!this.tank.isDestroyed){let t=v.SCREEN_WIDTH/2,i=v.TANK_Y_POSITION;try{t=this.tank.x||t,i=this.tank.y||i}catch(e){}this.particleSystem.createExplosion(t,i,"large");try{this.tank.visible=!1}catch(e){}}else this.particleSystem.createExplosion(v.SCREEN_WIDTH/2,v.TANK_Y_POSITION,"large");K.play("tank_destroyed"),K.play("v_gameover"),this.screenShake(),this.evacuateAllEnemies(),setTimeout(()=>{this.state=2,this.showGameOverScreen()},2500)}screenShake(){let e=0;const t=()=>{if(e++,e<30){const t=1-e/30;this.gameContainer.x=20*(Math.random()-.5)*t,this.gameContainer.y=20*(Math.random()-.5)*t}else this.gameContainer.x=0,this.gameContainer.y=0,this.app.ticker.remove(t)};this.app.ticker.add(t)}evacuateAllEnemies(){this.enemies.forEach((e,t)=>{const i=e.x<v.SCREEN_WIDTH-e.x;e.velocityX=i?-600:600,e.velocityY=-50-50*Math.random(),e.isEvacuating=!0}),this.projectiles=this.projectiles.filter(e=>!e.isEnemyProjectile||(e.destroy(),!1)),this.powerUpSystem.evacuateAllHelicopters()}showGameOverScreen(){if(this.gameOverScreenShown)return;this.gameOverScreenShown=!0,this.currentFlashAnimation&&(this.app.ticker.remove(this.currentFlashAnimation),this.currentFlashAnimation=null),this.currentGameOverContainer&&(this.currentGameOverContainer.destroy(),this.currentGameOverContainer=null);const e=new g;e.beginFill(0,.7),e.drawRect(0,0,v.SCREEN_WIDTH,v.SCREEN_HEIGHT),e.endFill();const t=new f({fontFamily:"Arial Black",fontSize:96,fill:"#ff0000",stroke:"#000000",strokeThickness:8}),i=new y("GAME OVER",t);i.anchor.set(.5),i.x=v.SCREEN_WIDTH/2,i.y=200;const s=new f({fontFamily:"Arial",fontSize:36,fill:"#ffffff",align:"center"}),a=`${Math.floor(this.survivalTime/6e4)}:${Math.floor(this.survivalTime%6e4/1e3).toString().padStart(2,"0")}`,r=new y(`SCORE: ${this.scoreManager.getScore().toLocaleString()}\nTIME: ${a}\nWAVES: ${this.waveSystem.getCurrentWave()}`,s);r.anchor.set(.5),r.x=v.SCREEN_WIDTH/2,r.y=360;const o=new f({fontFamily:"Arial",fontSize:32,fill:"#00ff00"}),n=new y("PRESS SPACE TO RESTART",o);n.anchor.set(.5),n.x=v.SCREEN_WIDTH/2,n.y=500;let h=0;const l=()=>{h++,n.alpha=.5+.5*Math.sin(.1*h)};this.app.ticker.add(l);const c=new p;c.addChild(e),c.addChild(i),c.addChild(r),c.addChild(n),this.uiContainer.addChild(c),this.currentGameOverContainer=c,this.currentFlashAnimation=l;const d=e=>{"Space"===e.code&&(window.removeEventListener("keydown",d),this.app.ticker.remove(l),c.destroy(),this.currentGameOverContainer=null,this.currentFlashAnimation=null,this.restart())};window.addEventListener("keydown",d)}restart(){this.cleanup(),this.state=1,this.survivalTime=0,this.elapsedTime=0,this.lastLogTime=0,this.gameOverScreenShown=!1,this.tankDeathSequenceStarted=!1,this.scoreManager.reset(),this.waveSystem.reset(),this.powerUpSystem.reset(),this.tank=new V(this),this.tank.x=v.SCREEN_WIDTH/2,this.tank.y=v.TANK_Y_POSITION,this.layers.getLayer("tank").addChild(this.tank),this.weaponUpgradeSystem.applyUpgradesToTank(this.tank);const e=new f({fontFamily:"Arial Black",fontSize:72,fill:"#00ff00",stroke:"#000000",strokeThickness:8}),t=new y("GO!",e);t.anchor.set(.5),t.x=v.SCREEN_WIDTH/2,t.y=v.SCREEN_HEIGHT/2-100,this.uiContainer.addChild(t);let i=0;const s=()=>{i++,t.alpha=Math.max(0,1-i/60),t.y-=1,i>=60&&(this.app.ticker.remove(s),t.destroy())};this.app.ticker.add(s),this.waveSystem.start(),this.powerUpSystem.start(),this.inputHandler.enabled=!0}cleanup(){this.enemies.forEach(e=>e.destroy()),this.enemies=[],this.projectiles.forEach(e=>e.destroy()),this.projectiles=[],this.powerUps.forEach(e=>e.destroy()),this.powerUps=[],this.particleSystem.clear(),this.tank&&this.tank.destroy()}pause(){this.isPaused=!0,this.app.ticker.stop()}resume(){this.isPaused=!1,this.app.ticker.start()}getInputHandler(){return this.inputHandler}getScoreManager(){return this.scoreManager}getParticleSystem(){return this.particleSystem}addProjectile(e){if(this.projectiles.length>=v.MAX_PROJECTILES){const e=this.projectiles.shift();e&&!e.isDestroyed&&e.destroy()}this.projectiles.push(e),this.layers.getLayer("projectiles").addChild(e)}addEnemy(e){if(this.enemies.length>=v.MAX_ENEMIES)e.destroy();else{this.enemies.push(e);try{this.layers.getLayer("enemies").addChild(e)}catch(t){}}}addPowerUp(e){this.powerUps.push(e),this.layers.getLayer("powerups").addChild(e)}getEnemies(){return this.enemies}getTank(){return this.tank}getRenderer(){return this.app.renderer}getWaveSystem(){return this.waveSystem}getPowerUpSystem(){return this.powerUpSystem}getElapsedTime(){return this.elapsedTime}getState(){return this.state}initializeBackgroundElements(){let e=[],t=[];Math.random()<.2&&(e=Re.spawnPosters(this,this.backgroundSystem),e.forEach(e=>{this.collisionSystem.addBackgroundElement(e)})),Math.random()<.2&&(t=Me.spawnTowers(this,this.backgroundSystem),t.forEach(e=>{this.collisionSystem.addBackgroundElement(e)}))}isDebugMode(){return new URLSearchParams(window.location.search).has("debug")}getGameState(){return{getState:()=>1===this.state?"playing":"other",getTank:()=>this.tank,getEnemies:()=>this.enemies,spawnPowerUp:(e,t,i)=>{this.powerUpSystem.spawnPowerUp(e,t,i)}}}}function Le(){return o(this,null,function*(){const e=document.getElementById("loading");try{e&&(e.textContent="LOADING ASSETS..."),yield P.initialize(),yield P.loadAll(),K.initialize(),e&&(e.style.opacity="0",setTimeout(()=>e.remove(),500));const t=new _e;window.game=t,yield t.start()}catch(t){e&&(e.textContent="FAILED TO LOAD - REFRESH TO RETRY",e.style.color="#ff0000")}})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Le):Le(),document.addEventListener("visibilitychange",()=>{window.game&&(document.hidden?window.game.pause():window.game.resume())});
